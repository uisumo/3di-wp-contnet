<?php  if(!defined('ABSPATH')){exit;}class IW_ProductReview_Trigger extends IW_Automation_Trigger{function trigger_when(){add_action('comment_post',array($this,'comment_posted'),10,3);}public $merge_handlers=array('Comment' =>array('Product Review Data','merge_handler_comment_value'));function merge_fields(){return array('Comment' =>array('comment_content' =>'Review Content','rating' =>'Review Rating (0 to 5)','verified' =>'Is Verified Customer (1 or 0)','title' =>'Review Subject','comment_approved' =>'Is Review Approved (1 or 0)','comment_author' =>'Reviewer Name','comment_author_email' =>'Reviewer Email','comment_author_IP' =>"Reviewer's IP",'comment_author_url' =>"Author's URL",'comment_date' =>'Comment Date'));}public function get_desc(){return 'when a user posted a product review';}function get_title(){return 'Product Review Trigger';}function get_icon(){return '<i class="fa fa-star" style="position:relative; left: 2px;"></i>';}function comment_posted($comment_ID,$comment_approved,$commentdata){$comment=get_comment($comment_ID);$post_id=$comment->comment_post_ID;if(get_post_type($post_id)=="product"){$pass_vars=func_get_args();$this->pass_vars=$pass_vars;$pass_vars[]=$post_id;$this->trigger();}}function get_log_details(){return "Event ".$this->event;}function get_contact_email(){$commentdata=$this->pass_vars[2];if($commentdata['comment_author_email'])return $commentdata['comment_author_email'];if(is_user_logged_in()){$user=wp_get_current_user();$email=get_user_meta($user->ID,'billing_email',true);if(empty($email))$email=$user->user_email;return $email;}}function merge_handler_comment_value($key){$comment_ID=$this->pass_vars[0];$commentdata=$this->pass_vars[2];if($key =='title'){return get_comment_meta($comment_ID,'title',true);}else if($key =='rating'){return get_comment_meta($comment_ID,'rating',true);}else if($key =='verified'){return get_comment_meta($comment_ID,'verified',true);}else{return $commentdata[$key];}}}iw_add_trigger_class('IW_ProductReview_Trigger');