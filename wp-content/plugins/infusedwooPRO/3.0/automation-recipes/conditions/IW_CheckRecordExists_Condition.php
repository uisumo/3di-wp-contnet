<?php  if(!defined('ABSPATH')){exit;}class IW_CheckRecordExists_Condition extends IW_Automation_Condition{public $allow_multiple=true;function get_title(){return 'Check if referral partner exists in Infusionsoft ...';}function allowed_triggers(){return array('IW_AddToCart_Trigger','IW_OrderCreation_Trigger','IW_OrderStatusChange_Trigger','IW_Purchase_Trigger','IW_WishlistEvent_Trigger','IW_HttpPost_Trigger','IW_PageVisit_Trigger','IW_UserAction_Trigger','IW_WooSubEvent_Trigger','IW_Checkout_Trigger','IW_UserConsent_Trigger','IW_ProductReview_Trigger');}function on_class_load(){}function display_html($config=array()){$record_type=isset($config['record_type'])?$config['record_type']:'Affiliate';$record_check_field=isset($config['record_check_field'])?$config['record_check_field']:'AffCode';$record_check_val=isset($config['record_check_val'])?$config['record_check_val']:'';$html='<div>Enter Affiliate Code <input type="text" style="width: 62%; margin-left: 4px;" name="record_check_val" placeholder="Enter Value" value="'.$record_check_val.'" class="iwar-mergeable" />';$html .='<i class="fa fa-compress merge-button merge-overlap" aria-hidden="true" title="Insert Merge Field"></i>';$html .='</div>';return $html;}function validate_entry($conditions){if(empty($conditions['record_check_val'])){return "Please enter an Affiliate Code";}}function test($config,$trigger){global $iwpro;if($iwpro->ia_app_connect()){$val=trim($trigger->merger->merge_text($config['record_check_val']));if(strpos($val,",")){$val=explode(",",$val);}else{$val=array($val);}foreach($val as $v){$a=$iwpro->app->dsFind('Affiliate',1,0,'AffCode',$v,array('Id'));if(is_array($a)&&isset($a[0])){return true;}}}return false;}}iw_add_condition_class('IW_CheckRecordExists_Condition');