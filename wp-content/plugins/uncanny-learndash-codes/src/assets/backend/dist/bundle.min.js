!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=jQuery},function(e,t){function n(e,t,n){if(n||(n=location.href),e=escape(e),!(t=escape(t)))return a(e,n);var s=e+"="+t,o=new RegExp("(&|\\?)"+e+"=[^&]*");return(n=n.replace(o,"$1"+s)).indexOf(e+"=")>-1||(n.indexOf("?")>-1?n+="&"+s:n+="?"+s),n}function a(e,t){t||(t=location.href),e=escape(e);var n=new RegExp("(&|\\?)"+e+"=[^&]*");return t=t.replace(n,"")}jQuery(document).ready((function(e){function t(t=!1){if(e("#uoc-generate-code-preview-fake-code").length>0){var n=uoCodesStrings.avail_characters,a=e("input[name='coupon-dash']").val(),s=e("input[name='coupon-length']").val(),o=e("input[name='coupon-prefix']").val(),r=o.length,i=e("input[name='coupon-suffix']").val(),d=i.length,l="",c=e("input[type=checkbox][name='coupon-character-type[]']:checked").map((function(){return e(this).val()})).get();-1==e.inArray("lowercase-letters",c)&&(n=n.replace("abcdefghjkmnpqrstuvwxyz","")),-1==e.inArray("uppercase-letters",c)&&(n=n.replace("ABCDEFGHJKLMNPQRSTUVWXYZ","")),-1==e.inArray("numbers",c)&&(n=n.replace("123456789","")),0==n.length&&(n="123456789ABCDEFGHJKLMNPQRSTUVWXYZ"),s=s-r-d;for(var u=0;u<s;u++){var h=Math.floor(Math.random()*n.length);l+=n.substring(h,h+1)}var p=o+l+i;if(a){a=a.split("-");var m=p.split(""),g="",f=0,y=0;e(m).each((function(t){g+=e(this)[0],f++,a[y]<=f&&(y++,f=0,g+="-")})),"-"==g.substring(g.length-1,g.length)&&(g=g.substring(0,g.length-1))}else g=p;if(t)return g;e("#uoc-generate-code-preview-fake-code").html(g)}}function s(){"courses"==e("#uncanny_form_input_vendor #assign_where").val()?(e("#uncanny_form_input_vendor #assign_courses").show(),e("#uncanny_form_input_vendor #assign_lessons").hide()):(e("#uncanny_form_input_vendor #assign_courses").hide(),e("#uncanny_form_input_vendor #assign_lessons").show())}e("#coupon-length").keypress((function(e){10!==e.which&&13!==e.which||e.preventDefault()})),e(".uo-btn-delete").on("click",(function(e){confirm(uoCodesStrings.Doyoureallywanttodeletethesecodes)||e.preventDefault()})),t(),e("input[name='coupon-length'], input[name='coupon-prefix'], input[name='coupon-suffix'], input[name='coupon-dash']").on("input",(function(e){t()})),e("input[type=checkbox][name='coupon-character-type[]']").change((function(e){t()})),e("#uncanny_form_input_vendor #assign_where").length&&(s(),e("#uncanny_form_input_vendor #assign_where").change((function(){s()}))),e("#page_coupon_stat .btn_delete, #page_coupon_stat .btn_delete").click((function(e){confirm(uoCodesStrings.Doyoureallywanttodeletethis)||e.preventDefault()})),e("#prefix_selector_for_coupon_group").change((function(){e(this).val()?location.href=n("prefix",e(this).val()):location.href=a("prefix")})),e("#badge_selector_for_coupon_group").change((function(){e(this).val()?location.href=n("badge_id",e(this).val()):location.href=a("badge_id")}))})),jQuery.fn.regexMask=function(e){jQuery(this).keypress((function(t){if(!t.charCode)return!0;var n=this.value.substring(0,this.selectionStart),a=this.value.substring(this.selectionEnd,this.value.length);return!!e.test(n+String.fromCharCode(t.charCode)+a)&&void 0}))},jQuery(document).ready((function(){var e=new RegExp("^[A-Za-z0-9]*$");jQuery("input.regex-alphanumeric").regexMask(e)}))},function(e,t){jQuery(document).ready((function(e){e(document).ready((function(){const n=window.location.href,a=new URL(n);(a.searchParams.has("action")&&"edit"===a.searchParams.get("action")||a.searchParams.has("post_type")&&"product"===a.searchParams.get("post_type"))&&e("body").hasClass("post-type-product")&&t.init()}));let t={init:function(){this.getElements(),this.setupUncannyCodesType(),this.setCodesGroupID(),this.addActions()},getElements:function(){this.$elements={product_type:jQuery("#product-type"),virtual_input:jQuery("#_virtual"),general_tab:jQuery(".product_data_tabs .general_tab"),general_tab_link:jQuery("li.general_options a"),general_pricing:jQuery("#general_product_data .pricing"),inventory_options:e(".inventory_options"),inventory_manage_stock:e("#_manage_stock"),inventory_manage_stock_field:e("#inventory_product_data ._manage_stock_field"),inventory_stock:jQuery("#_stock"),inventory_stock_status:jQuery("#_stock_status"),inventory_backorders:jQuery("#_backorders"),inventory_sold_individually_field:e("#inventory_product_data ._sold_individually_field"),codesGroupName:e("#codes_group_name"),codesGroupTotal:e("#codes_group_total"),codesGroupAvailable:e("#codes_group_available"),codesGroupEdit:e("#codes_group_edit"),codesGroupError:e("#codes_group_error")}},setupUncannyCodesType:function(){this.$elements.general_pricing.addClass("show_if_automator_codes"),this.$elements.inventory_manage_stock_field.addClass("show_if_automator_codes"),this.$elements.inventory_sold_individually_field.addClass("show_if_automator_codes"),this.$elements.inventory_sold_individually_field.parent().addClass("show_if_automator_codes"),"automator_codes"===this.$elements.product_type.val()&&(this.$elements.general_tab.show(),this.$elements.general_pricing.show(),this.$elements.inventory_options.show(),this.$elements.inventory_manage_stock_field.show(),this.$elements.inventory_stock_status.prop("disabled",!0),this.$elements.inventory_backorders.prop("disabled",!0))},setCodesGroupID:function(){"automator_codes"===this.$elements.product_type.val()&&this.updateGroupCodesFields()},addActions:function(){let t=this;this.$elements.product_type.on("change",(function(e){"automator_codes"===t.$elements.product_type.val()&&(t.$elements.inventory_manage_stock.trigger("click"),t.$elements.virtual_input.trigger("click"),t.$elements.inventory_stock_status.prop("disabled",!0),t.$elements.inventory_backorders.prop("disabled",!0),t.$elements.inventory_options.show(),t.$elements.inventory_manage_stock_field.show(),t.updateGroupCodesFields())})),this.$elements.codesGroupName.on("change",(function(e){t.updateGroupCodesFields()})),this.$elements.codesGroupEdit.on("click",(function(){let t=e(this).data("group"),n=e(this).data("href");window.open(n+t,"_blank")}))},updateGroupCodesFields:function(){t.$elements.codesGroupTotal.val(""),t.$elements.codesGroupTotal.val(""),t.$elements.codesGroupAvailable.val(""),t.$elements.codesGroupEdit.data("group",this.$elements.codesGroupName.val()),n.restCall()}},n={restCall:function(){t.$elements.codesGroupTotal.val(""),t.$elements.codesGroupAvailable.val(""),e.ajax({method:"GET",url:uoCodesStrings.root+"/get_codes_group_detail/"+t.$elements.codesGroupName.val()+"/",beforeSend:function(e){t.$elements.codesGroupName.attr("disabled","disabled"),t.$elements.codesGroupEdit.attr("disabled","disabled"),t.$elements.codesGroupError.hide(),e.setRequestHeader("X-WP-Nonce",uoCodesStrings.nonce)}}).done((function(e){!0===e.success?(t.$elements.codesGroupTotal.val(e.total),t.$elements.codesGroupAvailable.val(e.available),t.$elements.inventory_stock.val(e.available),t.$elements.inventory_stock_status.val(e.stock_status)):(t.$elements.codesGroupTotal.val(""),t.$elements.codesGroupAvailable.val(""),t.$elements.codesGroupError.first().html(e.message),t.$elements.codesGroupError.show().delay(7e3).fadeOut())})).fail((function(e){})).always((function(e){t.$elements.codesGroupName.removeAttr("disabled"),t.$elements.codesGroupEdit.removeAttr("disabled")}))}}}))},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a);const o=e=>null!=e,r=e=>{let t=!0;return o(e)&&(t=e.isArray?0==e.length:i(e)?Object.keys(e).length:""==e),t},i=e=>"object"==typeof e&&null!==e,d=(e,t)=>{let n=!1;return n=Array.isArray(e)?0==arrayDifference(e,t).length:-1!==s.a.inArray(e,t),n},l=(e,t)=>{var n=-1;return function(){clearTimeout(n);var a=arguments,s=this;n=setTimeout((function(){e.apply(s,a)}),t)}};let c=jQuery;class u{constructor(){this.isTheCodesBatchGenerator()&&(this.getElements(),this.getData(),this.updateUI(),this.listenChangesToBatchName(),this.listenChangesToDependencyOptions(),this.listenChangesToLearnDashContent(),this.listenChangesToGenerationMethod(),this.listenChangesToNumberOfUsesPerCode(),this.initSelect2Fields())}getElements(){this.$elements={container:c("#uoc-generate"),batchName:c("#uoc-generate-batch-name"),batchNameError:c("#uoc-generate-batch-name-error"),batchNameContainer:c("#uoc-generate-batch-name-container"),select2Fields:c(".uoc-generate--select2-js"),dependencyOptions:c(".uoc-generate-dependency-option--js"),dependencyLearnDashContent:c(".uoc-generate-dependency-ld-content-option--js"),generationMethod:c(".uoc-generate-generation-method--js"),numberOfUsesPerCode:c("#uoc-generate-coupon-max-usage"),submitButton:c("#uoc-generate-submit-button"),allFieldsWithDynamicRequiredProp:c("#uoc-generate input:not(.uoc-generate--always-required-js), #uoc-generate select:not(.uoc-generate--always-required-js), #uoc-generate textarea:not(.uoc-generate--always-required-js)"),sections:{dependencyLearnDash:c("#uoc-generate-dependency-specific-learndash"),dependencyLearnDashCourses:c("#uoc-generate-dependency-specific-learndash-courses"),dependencyLearnDashGroups:c("#uoc-generate-dependency-specific-learndash-groups"),codeSetup:c("#uoc-generate-code-setup"),creationMethodAuto:c("#uoc-generate-generation-method-auto"),creationMethodManual:c("#uoc-generate-generation-method-manual")},notices:{youMustInstallAutomator:c("#uoc-generate-dependency-automator-install"),youMustUpdateAutomator:c("#uoc-generate-dependency-automator-update"),automatorNextStep:c("#uoc-generate-dependency-automator-what-now"),youMustInstallLearnDash:c("#uoc-generate-dependency-learndash-install"),codeMaxUsageWooCommerce:c("#uoc-generate-code-setup-max-usage-woocommerce-notice")}}}getData(){this.data={isFirstStepReady:!1,selectedData:{dependency:null,learnDashContent:null,generationMethod:null,numberOfUsesPerCode:null},dynamicRequiredFields:{learndash:{always:["learndash-content","learndash-code-type"],whenSelectingCourses:["learndash-courses[]"],whenSelectingGroups:["learndash-groups[]"]},generationMethod:{auto:["coupon-amount","coupon-length","coupon-dash"],manual:["manual-codes"]}},batchNameRestCall:null,batchNameRestCallInProgress:!1,batchNameIsUnique:"edit"==UncannyCodes.generate.mode},this.updateSelectedDependency(),this.updateSelectedLearnDashContent(),this.updateSelectedGenerationMethod(),this.updateSelectedNumberOfUsesPerCode(),this.updateIsFirstStepReady()}initSelect2Fields(){c.fn.select2&&this.$elements.select2Fields.select2({theme:"uoc-select2",language:{noResults:function(){return UncannyCodes.generate.i18n.noResults}}})}updateUI(){Object.values(this.$elements.sections).forEach(e=>{c(e).hide()}),Object.values(this.$elements.notices).forEach(e=>{c(e).hide()}),"learndash"==this.data.selectedData.dependency&&(UncannyCodes.generate.hasLearnDashInstalled?this.$elements.sections.dependencyLearnDash.show():this.$elements.notices.youMustInstallLearnDash.show(),this.$elements.submitButton.val(UncannyCodes.generate.i18n.submitButton.forLearnDash)),"learndash-courses"==this.data.selectedData.learnDashContent&&this.$elements.sections.dependencyLearnDashCourses.show(),"learndash-groups"==this.data.selectedData.learnDashContent&&this.$elements.sections.dependencyLearnDashGroups.show(),"automator"==this.data.selectedData.dependency&&(UncannyCodes.generate.hasAutomatorInstalled?UncannyCodes.generate.hasToUpdateAutomator?this.$elements.notices.youMustUpdateAutomator.show():this.$elements.notices.automatorNextStep.show():this.$elements.notices.youMustInstallAutomator.show(),this.$elements.submitButton.val(UncannyCodes.generate.i18n.submitButton.forAutomator),UncannyCodes.generate.hasWooCommerceInstalled&&this.data.selectedData.numberOfUsesPerCode>1&&this.$elements.notices.codeMaxUsageWooCommerce.show()),"edit"==UncannyCodes.generate.mode&&this.$elements.submitButton.val(UncannyCodes.generate.i18n.submitButton.modifyBatch),"auto"==this.data.selectedData.generationMethod&&this.$elements.sections.creationMethodAuto.show(),"manual"==this.data.selectedData.generationMethod&&this.$elements.sections.creationMethodManual.show(),this.data.isFirstStepReady?this.$elements.sections.codeSetup.show():this.$elements.sections.codeSetup.hide(),this.updateRequiredFields()}updateRequiredFields(){this.$elements.allFieldsWithDynamicRequiredProp.prop("required",!1);let e=[];"learndash"==this.data.selectedData.dependency&&(e.push(...this.data.dynamicRequiredFields.learndash.always),"learndash-courses"==this.data.selectedData.learnDashContent&&e.push(...this.data.dynamicRequiredFields.learndash.whenSelectingCourses),"learndash-groups"==this.data.selectedData.learnDashContent&&e.push(...this.data.dynamicRequiredFields.learndash.whenSelectingGroups)),"auto"==this.data.selectedData.generationMethod&&e.push(...this.data.dynamicRequiredFields.generationMethod.auto),"manual"==this.data.selectedData.generationMethod&&e.push(...this.data.dynamicRequiredFields.generationMethod.manual),e.forEach(e=>{this.$elements.allFieldsWithDynamicRequiredProp.filter(`input[name="${e}"], select[name="${e}"], textarea[name="${e}"]`).prop("required",!0)})}listenChangesToDependencyOptions(){this.$elements.dependencyOptions.on("change",()=>{this.updateSelectedDependency(),this.updateUI()})}listenChangesToLearnDashContent(){this.$elements.dependencyLearnDashContent.on("change",()=>{this.updateSelectedLearnDashContent(),this.updateUI()})}listenChangesToGenerationMethod(){this.$elements.generationMethod.on("change",()=>{this.updateSelectedGenerationMethod(),this.updateUI()})}listenChangesToNumberOfUsesPerCode(){this.$elements.numberOfUsesPerCode.on("input",l(()=>{this.updateSelectedNumberOfUsesPerCode(),this.updateUI()},200))}listenChangesToBatchName(){this.$elements.batchName.on("input",()=>{this.$elements.batchNameContainer.removeClass("uoc-generate-section-form-field--loading")}),this.$elements.batchName.on("input",l(()=>{this.checkIfBatchNameIsAvailable()},500))}updateSelectedDependency(){let e=null;const t=this.$elements.dependencyOptions.filter(":checked");return t.length>0&&(e=t.val(),function(e="",t={},n={}){r(e)&&(e=window.location.href);try{e=new URL(e)}catch(t){return e}let a=e.search.substr(1).split("&");for(let[e,n]of Object.entries(t)){e=encodeURI(e),n=encodeURI(n);let t,s=a.length;for(;s--;)if(t=a[s].split("="),t[0]==e){t[1]=n,a[s]=t.join("=");break}s<0&&(a[a.length]=[e,n].join("="))}if(a=a.filter(e=>!r(e)),e.search=a.join("&"),(n=s.a.extend({},{setAsURL:!1,refresh:!1},n)).setAsURL)if(n.refresh)window.location.href=e.href;else{let t=document.title;window.history.pushState({},t,e.href)}e.href}("",{dependency:e},{setAsURL:!0})),this.data.selectedData.dependency=e,this.updateIsFirstStepReady(),e}updateSelectedLearnDashContent(){let e=null;const t=this.$elements.dependencyLearnDashContent.filter(":checked");return t.length>0&&(e=t.val()),this.data.selectedData.learnDashContent=e,this.updateIsFirstStepReady(),e}updateSelectedGenerationMethod(){let e=null;const t=this.$elements.generationMethod.filter(":checked");return t.length>0&&(e=t.val()),this.data.selectedData.generationMethod=e,this.updateIsFirstStepReady(),e}updateSelectedNumberOfUsesPerCode(){let e=parseInt(this.$elements.numberOfUsesPerCode.val());return this.data.selectedData.numberOfUsesPerCode=e,e}updateIsFirstStepReady(){let e=null;return e=this.data.batchNameIsUnique&&("automator"==this.data.selectedData.dependency&&UncannyCodes.generate.hasAutomatorInstalled&&!UncannyCodes.generate.hasToUpdateAutomator||"learndash"==this.data.selectedData.dependency&&UncannyCodes.generate.hasLearnDashInstalled&&!r(this.data.selectedData.learnDashContent)),this.data.isFirstStepReady=e,e}checkIfBatchNameIsAvailable(){const e=this.$elements.batchName.val();this.$elements.batchNameError.text(""),this.$elements.batchNameContainer.removeClass("uoc-generate-section-form-field--success"),this.data.batchNameIsUnique=!1,r(e)?(this.updateIsFirstStepReady(),this.updateUI()):(this.data.batchNameRestCallInProgress&&o(this.data.batchNameRestCall)&&this.data.batchNameRestCall.abort(),this.$elements.batchNameContainer.addClass("uoc-generate-section-form-field--loading"),this.data.batchNameRestCall=((e=null,t=null,n=null,a=null,r={})=>{let i=["group_batch_has_name"];d(e,i)?s.a.ajax({method:"POST",url:`${UncannyCodes.restURL}/${e}/`,data:s.a.param(t)+"&"+s.a.param({doing_rest:1}),dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",UncannyCodes.nonce)},success:function(e){e.success?o(n)&&n(e):(console.error("The call was successful, but there were errors."),o(a)&&a(e))},statusCode:{403:function(e){o(a)&&a(e)}},error:function(e,t,n){o(a)&&a({success:!1})},fail:function(e){o(a)&&a(e)}}):console.error(vsprintf("The %s endPoint does not exists. The valid endpoints are %s",[e,i.join(", ")]))})("group_batch_has_name",{batch_name:e},e=>{this.$elements.batchNameContainer.removeClass("uoc-generate-section-form-field--loading"),e.is_available?(this.$elements.batchNameContainer.addClass("uoc-generate-section-form-field--success"),this.data.batchNameIsUnique=!0):this.$elements.batchNameError.text(UncannyCodes.generate.i18n.batchName.errors.nameExists),this.updateIsFirstStepReady(),this.updateUI()},e=>{this.$elements.batchNameContainer.removeClass("uoc-generate-section-form-field--loading"),o(e.message)?this.$elements.batchNameError.text(e.message):this.$elements.batchNameError.text(UncannyCodes.generate.i18n.somethingWentWrong)}))}isTheCodesBatchGenerator(){return 1==c("#uoc-generate").length}}n(1),n(2),n(3);document.addEventListener("DOMContentLoaded",()=>{new u})}]);