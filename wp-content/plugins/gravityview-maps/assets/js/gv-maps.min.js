function gm_authFailure(){gvMapsDisplayErrorNotice(window.GV_MAPS.google_maps_api_error)}function gvMapsDisplayErrorNotice(error_text){var notice;notice=window.GV_MAPS.display_errors?jQuery("<div/>",{text:error_text,class:"gv-notice gv-error error"}):jQuery(document.createComment(error_text)),jQuery(".gv-map-canvas").hide().each(function(){notice.insertBefore(jQuery(this))})}window.GV_MAPS=window.GV_MAPS||{},function($){"use strict";var self=$.extend({did_scroll:!1,map_offset:0,map_sticky_container:null,map_entries_container_selector:".gv-map-entries",markers:[],maps:[],is_single_entry:!1,infowindow:{no_empty:!0,max_width:300},mobile_breakpoint:600},window.GV_MAPS);if(self.init=function(){document.querySelectorAll('[id^="'+self.map_id_prefix+'-"]')&&(0<$(".gv-map-single-container").length&&(self.is_single_entry=!0),self.sticky_canvas_prepare(),self.setup_map_options(),self.setup_maps(),self.markers_process(),self.mobile_init(),self.start_scroll_check(),self.markers_animate_init())},self.setup_map_options=function(){self.MapOptions.zoom=parseInt(self.MapOptions.zoom,10),self.MapOptions.mapTypeId=google.maps.MapTypeId[self.MapOptions.mapTypeId],self.MapOptions.hasOwnProperty("zoomControl")&&!0===self.MapOptions.zoomControl&&self.MapOptions.zoomControlOptions&&self.MapOptions.zoomControlOptions.hasOwnProperty("position")&&(self.MapOptions.zoomControlOptions={position:google.maps.ControlPosition[self.MapOptions.zoomControlOptions.position]})},self.setup_maps=function(){for(var m,map_element,maps=document.querySelectorAll('[id^="'+self.map_id_prefix+'-"]'),i=0;i<maps.length;i++)if(map_element=maps[i]){var trafficLayer=new google.maps.TrafficLayer,transitLayer=new google.maps.TransitLayer,bicyclingLayer=new google.maps.BicyclingLayer;m=new google.maps.Map(map_element,$.extend({},self.MapOptions,{_index:i,_entryId:parseInt(map_element.getAttribute("data-entryid"),10),_bounds:new google.maps.LatLngBounds})),1===self.layers.bicycling&&bicyclingLayer.setMap(m),1===self.layers.transit&&transitLayer.setMap(m),1===self.layers.traffic&&trafficLayer.setMap(m),self.maps.push(m),self.set_zoom_and_center(m)}else console&&console.error("GravityView map DOM element not found at #"+self.map_id_prefix+"-"+i.toString()+"; map not created.")},self.set_zoom_and_center=function(map){google.maps.event.addListenerOnce(map,"idle",function(){map.getZoom()>self.MapOptions.zoom&&map.setZoom(self.MapOptions.zoom),void 0!==self.MapOptions.center&&self.MapOptions.center.lat&&self.MapOptions.center.lng&&map.setCenter(self.MapOptions.center)})},self.markers_process=function(){self.maps.forEach(function(map){self.markers_info.forEach(function(marker){self.marker_add(map,marker)}),self.setup_cluster(map),self.setup_spider(map)})},self.setup_cluster=function(map){self.MapOptions.markerClustering&&self.markers[map._index]&&google.maps.event.addListenerOnce(map,"idle",function(){new MarkerClusterer(map,self.markers[map._index],{imagePath:self.markerClusterIconPath,maxZoom:self.MapOptions.markerClusteringMaxZoom||self.MapOptions.zoom})})},self.setup_spider=function(map){0!==self.markers.length&&self.markers[map._index]&&google.maps.event.addListener(map,"idle",function(){var oms=new OverlappingMarkerSpiderfier(map,{markersWontMove:!0,markersWontHide:!0,keepSpiderfied:!0});self.markers[map._index].forEach(function(marker){oms.addMarker(marker)})})},self.marker_add=function(map,markerData){if(!map._entryId||map._entryId==markerData.entry_id){var geo=new google.maps.LatLng(markerData.lat,markerData.long),icon=markerData.icon_url||self.icon,marker=new google.maps.Marker({map:map,icon:icon,url:markerData.url,position:geo,entryId:markerData.entry_id,content:markerData.content});self.maps[map._index]._bounds.extend(marker.position),self.maps[map._index].fitBounds(self.maps[map._index]._bounds),void 0===self.markers[map._index]&&(self.markers[map._index]=[]),self.marker_add_events(marker,map),self.markers[map._index].push(marker)}},self.marker_add_events=function(marker,map){self.is_single_entry||(google.maps.event.addListener(marker,"spider_click",function(){self.marker_on_click(marker)}),google.maps.event.addListener(marker,"mouseover",self.marker_on_over(marker)),google.maps.event.addListener(marker,"mouseout",self.marker_on_mouseout(marker)),google.maps.event.addListener(map,"click",function(){infowindow.close()}))},self.marker_on_click=function(marker){var content=self.infowindow_get_content(marker.content);if(content)return infowindow.setContent(content),void infowindow.open(marker.map,marker);infowindow.close(),window.open(marker.url,self.marker_link_target)},self.infowindow_get_content=function(content){if(!self.infowindow.no_empty)return content;var $content=$(content);return $content.find('img[src=""]').remove().end().addClass(function(){if(0===$content.find("img").length)return"gv-infowindow-no-image"}).find("a.gv-infowindow-entry-link:not([allow-empty]):empty").text(self.infowindow.empty_text),$content.prop("outerHTML")},self.marker_on_over=function(marker){return function(){$("#gv_map_"+marker.entryId).addClass("gv-highlight-entry")}},self.marker_on_mouseout=function(marker){return function(){$("#gv_map_"+marker.entryId).removeClass("gv-highlight-entry")}},self.markers_animate_init=function(){self.is_single_entry||""===self.icon_bounce||$(".gv-map-view").on("mouseenter",self.marker_animate)},self.marker_animate=function(e){var id=this.id.replace("gv_map_","");self.markers.forEach(self.marker_animation_start,id)},self.marker_animation_start=function(marker,i,array){if(marker.entryId===this){if(marker.animating)return;marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(self.marker_animation_stop,750,marker)}},self.marker_animation_stop=function(marker,i){marker.setAnimation(null)},self.sticky_canvas_prepare=function(){self.map_sticky_container=$(".gv-map-sticky-container");var windowHeight=$(window).height();windowHeight<2*self.map_sticky_container.height()&&$(".gv-map-canvas").height(windowHeight/2)},self.window_scroll_init_offset=function(){self.map_offset=self.map_sticky_container.offset().top},self.scroll_set=function(){self.did_scroll=!0},self.start_scroll_check=function(){0<self.map_sticky_container.length&&($(window).one("scroll",self.window_scroll_init_offset),setInterval(self.window_on_scroll,250))},self.window_on_scroll=function(){if(self.did_scroll){self.did_scroll=!1;var scroll=$(window).scrollTop(),canvasObj=self.map_sticky_container.find("."+self.map_id_prefix),listObj=$(self.map_entries_container_selector),canvasWidth=canvasObj.width(),canvasHeight=canvasObj.height();scroll>=self.map_offset?(canvasObj.width(canvasWidth),self.map_sticky_container.addClass("gv-sticky"),"top"===self.template_layout&&listObj.css("margin-top",canvasHeight+"px")):(canvasObj.width("100%"),self.map_sticky_container.removeClass("gv-sticky"),"top"===self.template_layout&&listObj.css("margin-top",""))}},self.mobile_init=function(){self.map_sticky_container.length<=0||$(window).width()<=parseInt(self.mobile_breakpoint,10)&&self.mobile_map_to_top()},self.mobile_map_to_top=function(){var parent=self.map_sticky_container.parent(),grandpa=$(".gv-map-container");parent.hasClass("gv-grid-col-1-3")&&1===parent.index()&&parent.detach().prependTo(grandpa)},self.api_key)if(void 0===window.google)gvMapsDisplayErrorNotice(self.google_maps_script_not_loaded);else if(self.markers_info.length){var infowindow=new google.maps.InfoWindow({content:"",maxWidth:parseInt(self.infowindow.max_width,10)});self.init()}else gvMapsDisplayErrorNotice(self.entries_missing_coordinates);else gvMapsDisplayErrorNotice(self.google_maps_api_key_not_found);$(window).scroll(self.scroll_set),window.GV_MAPS=self}(jQuery);