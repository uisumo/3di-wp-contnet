<?php
/**
 * Copyright (c) 2012-2020 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 if (! defined('ABSPATH') ) { die(); } final class wplmu94w { private $wpdb; private $sessions_table; private $ttl; private $simultaneous_sessions; private $encrypted; function __construct() { global $wpdb; $this->wpdb = $wpdb; $this->sessions_table = MEMBERIUM_DB_SESSIONS; $this->ttl = (int) ini_get('session.gc_maxlifetime'); $this->simultaneous_sessions = 0; $this->encrypted = function_exists('gzuncompress') && function_exists('gzcompress'); return true; } function __destruct() { return true; } function wplnz2mln($vwplnzlj0t) { $this->sessions_table = $vwplnzlj0t; return true; } function wplazdbo($vwplbd6m3) { $this->wpdb = $vwplbd6m3; return true; } function wplccj4($vwpljypm) { $this->simultaneous_sessions = (int) $vwpljypm; return true; } function wplr1stv($vwplm_4wlh) { $this->ttl = (int) $vwplm_4wlh; return true; } function wplier5($vwplsng017, $vwplupwkr) { return true; } function wplmq90m7() { return true; } function wplqsa2u($vwply17edn) { $vwplx1ap5_ = "SELECT `value` FROM `{$this->sessions_table}` WHERE `session_key` = %s "; $vwplyio4f = $this->wpdb->prepare($vwplx1ap5_, $vwply17edn); $vwplz4g7n = $this->wpdb->get_var($vwplyio4f); if (empty($vwplz4g7n) ) { return ''; } $vwplx1ap5_ = "UPDATE `{$this->sessions_table}` SET `expiration` = %d WHERE `session_key` = %s "; $vwplx1ap5_ = $this->wpdb->prepare($vwplx1ap5_, time() + $this->ttl, $vwply17edn); $this->wpdb->query($vwplx1ap5_); if ($this->encrypted && substr($vwplz4g7n, 0, 2) == 'eN') { $vwplz4g7n = gzuncompress(base64_decode($vwplz4g7n) ); } session_decode($vwplz4g7n); return $vwplz4g7n; } function wpleom2uw($vwply17edn, $vwplz4g7n) { if (empty($vwplz4g7n) ) { return true; } global $user_email, $user_login; $vwpln0fq1 = (! empty($user_login) ) ? strtolower($user_login) : ''; $vwplj68lcy = (! empty($user_email) ) ? strtolower($user_email) : '';  if ($this->simultaneous_sessions == 1) { if ($vwplj68lcy > '' && isset($_SESSION['admin']) && (int) $_SESSION['admin'] == 0) { $vwplx1ap5_ = "DELETE FROM `{$this->sessions_table}` WHERE `email_key` = %s AND `session_key` <> %s"; $vwplx1ap5_ = $this->wpdb->prepare($vwplx1ap5_, $vwplj68lcy, $vwply17edn); $vwply4j8x = $this->wpdb->query($vwplx1ap5_); } }  if ($this->encrypted) { $vwplz4g7n = base64_encode(gzcompress($vwplz4g7n, 9) ); } $vwplx1ap5_ = "REPLACE INTO `{$this->sessions_table}` (session_key, email_key, expiration, value) VALUES (%s, %s, %d, %s)"; $vwplx1ap5_ = $this->wpdb->prepare($vwplx1ap5_, $vwply17edn, $vwplj68lcy, time() + $this->ttl, $vwplz4g7n); $vwply4j8x = $this->wpdb->query($vwplx1ap5_); $row_id = $this->wpdb->insert_id; return $row_id; } function wply4tx($vwply17edn) { $vwplx1ap5_ = "DELETE FROM {$this->sessions_table} WHERE `session_key` = %s"; $vwplx1ap5_ = $this->wpdb->prepare($vwplx1ap5_, $vwply17edn); $vwplyio4f = $this->wpdb->query($vwplx1ap5_); return true; } static function wpl_yq_2($vwpldur4ip) { global $wpdb; $vwplnzlj0t = MEMBERIUM_DB_SESSIONS; $vwplin_i8 = time(); $vwplx1ap5_ = "DELETE FROM `{$vwplnzlj0t}` WHERE `expiration` < {$vwplin_i8} OR value = ''; " ; $vwply4j8x = $wpdb->query($vwplx1ap5_); return $vwply4j8x; } }
