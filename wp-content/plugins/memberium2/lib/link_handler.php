<?php
/**
 * Copyright (c) 2015-2020 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 if (! defined('ABSPATH') ) { die(); } final class wpls_mw {        static function wpls2cn0w() { global $i2sdk, $wpdb; $vwplamdi = $_GET; wplpwn3::wplbryv(); $vwplnbzsux = isset($vwplamdi['debug']) ? true : false; $vwplup7mi = wplz8bid::wplvf1d('settings', 'password_field'); $vwpl_2cd9 = wplz8bid::wplvf1d('settings', 'username_field'); $vwplv421 = wplz8bid::wplvf1d('settings', 'default_reglink_tag'); $vwploia7_d = isset($vwplamdi['action']) ? strtolower(trim($vwplamdi['action']) ) : ''; $vwplgist5g = explode(',', wplz8bid::wplvf1d('settings', 'autologin_authkeys') ); $vwpldmyu = isset($vwplamdi['authkey']) ? trim($vwplamdi['authkey']) : ''; $vwplvtmqd = isset($vwplamdi['cid']) ? (int) trim($vwplamdi['cid']) : 0; $vwplz4izhe = isset($vwplamdi['email']) ? strtolower(trim($vwplamdi['email']) ) : ''; $vwplebey = isset($vwplamdi['pid']) ? strtolower(trim($vwplamdi['pid']) ) : ''; $vwpltalx = true; $vwpll5uo = false; $vwplvkv3 = array(); $vwplimo5 = isset($vwplamdi['redir']) ? $vwplamdi['redir'] : site_url('/'); $vwplimo5 = isset($vwplamdi['redirect']) ? $vwplamdi['redirect'] : $vwplimo5; $vwplxjnz = isset($vwplamdi['fail_url']) ? $vwplamdi['fail_url'] : site_url('/'); if ($vwplnbzsux) echo __LINE__, " - Debug Mode Enabled<br>";  if ($vwplnbzsux) echo __LINE__, " - Checking Authentication Keys<br>"; if (! in_array($vwpldmyu, $vwplgist5g) ) { if ($vwplnbzsux) { echo __LINE__, ' :: Invalid Authentication Key<br>'; die(); } wp_redirect(site_url('/') ); die(); }  $vwplvkv3['tag'] = wplz8bid::wplvf1d('settings', 'default_reglink_tag' , ''); $vwplvkv3['goal'] = ''; $vwplvkv3['login_post_id'] = ''; if (! empty($vwplebey) ) { $vwplv0vzua = get_option('memberium_registration_profiles'); $vwplv0vzua[$vwplebey] = array( 'login_post_id' => 0, 'tag' => '', 'goal' => '', ); if (isset($vwplv0vzua[$vwplebey]) && is_array($vwplv0vzua[$vwplebey]) ) { $vwplvkv3 = $vwplv0vzua[$vwplebey]; } else { if ($vwplnbzsux) { echo __LINE__, ' :: Invalid Profile Id<br>'; die(); } $vwpltalx = false; } } else { } if ($vwpltalx) { if (is_user_logged_in() ) { $url = isset($_SESSION['memb_user']['login_page']) ? get_permalink($_SESSION['memb_user']['login_page']) : site_url(); if ($vwplnbzsux) { echo __LINE__, ' :: User Logged In<br>'; echo __LINE__, ' :: Redirecting to ', $url, '<br>'; die(); } wp_redirect($vwplimo5); exit; }  $vwplx1ap5_ = "SELECT count(*) FROM `{$wpdb->users}` WHERE `user_login` = %s OR `user_email` = %s "; $vwplx1ap5_ = $wpdb->prepare($vwplx1ap5_, $vwplz4izhe, $vwplz4izhe); $vwplbk4y2 = (boolean) $wpdb->get_var($vwplx1ap5_); $vwpltalx = ! $vwplbk4y2; if ($vwplnbzsux) echo __LINE__, ' :: User Exists ', (int) $vwplbk4y2, '<br>'; if (! $vwpltalx) { wp_redirect($vwplimo5); if ($vwplnbzsux) echo __LINE__, ' :: Redirect to ', $vwplimo5, '<br>'; die(); } }  if ($vwpltalx && (! $vwplbk4y2) ) { memberium_app()->wplj9ye($vwplvtmqd, false); $vwplrp9u24 = wpllbej::wplrande($vwplvtmqd, false); $vwpltalx = is_array($vwplrp9u24) && ! empty ($vwplrp9u24); if ($vwplvtmqd <> $vwplrp9u24['Id']) { if ($vwplnbzsux) echo __LINE__, ' :: Invalid Confirmation Link<br>'; if ($vwplnbzsux) die(); return; } if ($vwpltalx) { $vwplrp9u24[$vwplup7mi] = trim($vwplrp9u24[$vwplup7mi]); $vwpll5uo = ! empty($vwplrp9u24[$vwplup7mi]); if (! $vwpll5uo) { $vwplrp9u24[$vwplup7mi] = memberium_app()->wpleh1zcw(); $vwplv09c = array( $vwplup7mi => $vwplrp9u24[$vwplup7mi], ); memberium_app()->wplto2h4($vwplrp9u24); $vwplyio4f = $i2sdk->isdk->updateCon($vwplvtmqd, $vwplv09c);  $vwpllzly5b = memberium_app()->wplqd_lae($vwplvtmqd); $vwplgogvie = get_userdata($vwpllzly5b); $vwpln1la_j = $vwplgogvie->user_login; $vwpltalx = (boolean) $vwpllzly5b; } else { if ($vwplnbzsux) echo __LINE__, ' Password Already Exists<br>'; $vwpltalx = false; } } } if ($vwpltalx) {  memberium_app()->wplt263_($vwplvkv3['tag'], $vwplvtmqd);  wp_set_auth_cookie($vwpllzly5b); wp_set_current_user($vwpllzly5b); memberium_app()->frontend_class->wplmmu74($vwpln1la_j); do_action('wp_login', $vwpln1la_j, $vwplgogvie); memberium_app()->frontend_class->wplo4tqd($vwplrp9u24, $vwpllzly5b); memberium_app()->frontend_class->wplh3645(); session_write_close(); if ($vwplnbzsux) echo __LINE__, ' Success Redirect<br>'; if ($vwplnbzsux) echo __LINE__, ' :: Redirect to ', $vwplimo5, '<br>'; wp_redirect($vwplimo5); exit; } else { wp_redirect($vwplxjnz); if ($vwplnbzsux) echo __LINE__, ' Failure Redirect<br>'; if ($vwplnbzsux) echo __LINE__, ' :: Redirect to ', site_url('/'), '<br>'; exit; } } }
