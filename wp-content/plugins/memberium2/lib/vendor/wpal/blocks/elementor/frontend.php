<?php
  class wplx0ij4{  public $builder_slug;  public $container_els = array( 'section', 'column' );  public $container_visibility = array();  public $widget_visibility = array();  function __construct( $builder_slug ) { $this->builder_slug = $builder_slug; $this->init(); }  function init() {  $this->container_els = apply_filters( 'wpal/blocks/'.$this->builder_slug.'/editor/container_slugs/', $this->container_els );  add_action('elementor/widgets/widgets_registered', array( $this, 'wplus08' ), 20 );  add_action('elementor/frontend/before_render', array( $this, 'wplqp6s19' ), 10, 1 );  add_action('elementor/frontend/after_render', array( $this, 'wplj0k_y' ), 10, 1 );  add_filter('elementor/frontend/section/should_render', array( $this, 'wpl_gt0b' ), 1, 2 ); add_filter('elementor/frontend/column/should_render', array( $this, 'wpl_gt0b' ), 1, 2 ); add_filter('elementor/frontend/widget/should_render', array( $this, 'wpl_gt0b' ), 1, 2 );  add_filter('wpal/blocks/'.$this->builder_slug.'/element_visibility', array( $this, 'wpl_aofg' ), 10, 1 ); }  function wplus08( $widgets_manager ){ $widgets_manager->unregister_widget_type( 'shortcode' ); include_once trailingslashit( __DIR__ ) . 'widgets/shortcode.php'; $widgets_manager->register_widget_type( new wpla4vc ); }  function wplqp6s19( $el ){  if ( \Elementor\Plugin::$instance->editor->is_edit_mode() || empty( $el ) ) { return; } $element_type = $el->get_type(); $element_id = $el->get_id(); $settings = $el->get_settings_for_display(); $show = wploxfckj()->wplo3d_4( $settings, $this->builder_slug ); $is_container = in_array( $element_type, $this->container_els );  if ( $is_container ){  if ( !$show ) { $this->container_visibility[ $element_id ] = $this->wpll2z4( $el ); } }  else { $widget_name = $el->get_name();  if ( $show ) {  $show = $this->wplt2it8( $element_id, $show );  if ( !$show ){ $this->widget_visibility[] = $element_id; } }  else { $this->widget_visibility[] = $element_id; }  if ( !$show ){ if ( $widget_name === 'text-editor' ){ add_filter('widget_text', array( $this, 'wplm4nr1e' ), 1, 2 ); } if ( $widget_name === 'shortcode' ){ add_filter('wpal/blocks/'.$this->builder_slug.'/widget/shortcode/render', array( $this, 'wplm4nr1e' ), 1, 2 ); } } } }  function wplj0k_y( $el ){  if ( \Elementor\Plugin::$instance->editor->is_edit_mode() || empty( $el ) ) { return; } $element_type = $el->get_type(); $element_id = $el->get_id(); $is_container = in_array( $element_type, $this->container_els );  if ( $is_container ){ }  else { $widget_name = $el->get_name();  if ( in_array( $element_id, $this->widget_visibility ) ){ if ( $widget_name === 'text-editor' ){ remove_filter('widget_text', array( $this, 'wplm4nr1e' ), 1 ); } if ( $widget_name === 'shortcode' ){ remove_filter('wpal/blocks/'.$this->builder_slug.'/widget/shortcode/render', array( $this, 'wplm4nr1e' ), 1, 2 ); } } } }  function wpll2z4( $el ){ $container_data = $el->get_data( 'elements' ); $widgets = array(); if ( is_array( $container_data ) && !empty( $container_data ) ){ foreach ($container_data as $key => $container) { $widgets = $this->wpltpmh( $widgets, $container ); $container_els = ( isset($container['elements']) && !empty($container['elements']) ) ? $container['elements'] : false; if ( $container_els ){ foreach ($container_els as $el => $element) { $widgets = $this->wpltpmh( $widgets, $element ); $element_elements = ( isset($element['elements']) ) ? $element['elements'] : false; if ( $element_elements ){ foreach ($element_elements as $e => $value) { $widgets = $this->wpltpmh( $widgets, $value ); } } } } } } return $widgets; }  function wpltpmh( $widgets, $data ){ $type = ( isset($data['elType']) && !empty($data['elType']) ) ? $data['elType'] : false; $id = ( isset($data['id']) && !empty($data['id']) ) ? $data['id'] : false; if ( $type === 'wplylz4m1' && $id ){ $widgets[] = $id; } return $widgets; }  function wplt2it8( $element_id, $show ){  $container_hidden = false; if ( !empty($this->container_visibility) ){ foreach ($this->container_visibility as $container_id => $ids) { if ( is_array( $ids ) ){ foreach ($ids as $id) { if ( $element_id === $id ){ $show = false; } } } } } return $show; }  function wpl_gt0b( $should_render, $el ){  if ( \Elementor\Plugin::$instance->editor->is_edit_mode() || empty( $el ) ) { return $should_render; } $element_type = $el->get_type(); $element_id = $el->get_id(); $is_container = in_array( $element_type, $this->container_els );  if ( $is_container ){ if ( array_key_exists( $element_id, $this->container_visibility ) ){  if ( $element_type === 'section' ){ $should_render = false; } } }  else { if ( in_array( $element_id, $this->widget_visibility ) ){ $should_render = false; } } return $should_render; }  function wplm4nr1e( $content, $settings ){ return ' '; }  function wpl_aofg( $settings ){ $return = array();  $memberships = array(); foreach ($settings as $name => $value) { if ( strpos($name, WPAL_BLOCKS_PREFIX . '_membership_levels') !== false && $value === '1' ) { $memberships[] = (int) str_replace(WPAL_BLOCKS_PREFIX."_membership_levels-","",$name); } } $return['memberships'] = implode( ',', $memberships ); $return['any_membership'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_anymembership'] ) && $settings[WPAL_BLOCKS_PREFIX . '_anymembership'] === '1' ) ? 1 : 0; $return['logged_in_only'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_loggedin'] ) && $settings[WPAL_BLOCKS_PREFIX . '_loggedin'] === '1' ) ? 1 : 0; $return['logged_out_only'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_anonymous_only'] ) && $settings[WPAL_BLOCKS_PREFIX . '_anonymous_only'] === '1' ) ? 1 : 0; $return['invert_results'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_invert_results'] ) && $settings[WPAL_BLOCKS_PREFIX . '_invert_results'] === '1' ) ? 1 : 0; $return['contact_ids'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_contact_ids'] ) && $settings[WPAL_BLOCKS_PREFIX . '_contact_ids'] > '' ) ? sanitize_text_field($settings[WPAL_BLOCKS_PREFIX . '_contact_ids']) : ''; $tags1 = ( isset($settings[WPAL_BLOCKS_PREFIX . '_access_tags']) ) ? $settings[WPAL_BLOCKS_PREFIX . '_access_tags'] : ''; $return['tags1'] = ( is_array($tags1) ) ? implode( ',', $tags1 ) : $tags1; $tags2 = ( isset($settings[WPAL_BLOCKS_PREFIX . '_access_tags2']) ) ? $settings[WPAL_BLOCKS_PREFIX . '_access_tags2'] : ''; $return['tags2'] = ( is_array($tags2) ) ? implode( ',', $tags2 ) : $tags2; $return['eval'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_eval'] ) && $settings[WPAL_BLOCKS_PREFIX . '_eval'] > '' ) ? trim($settings[WPAL_BLOCKS_PREFIX . '_eval']) : ''; $return['asset_id'] = ( isset( $settings[WPAL_BLOCKS_PREFIX . '_asset_id'] ) && $settings[WPAL_BLOCKS_PREFIX . '_asset_id'] > '' ) ? sanitize_text_field($settings[WPAL_BLOCKS_PREFIX . '_asset_id']) : ''; return $return; } }
