<?php
/**
 * Copyright (c) 2020 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 if (! defined('ABSPATH') ) { die(); } final class wplmlj0f { private function wplzd4b() { add_action('wplss4f', array($this, 'wpltfkxw'), 10, 0); add_action('memberium_remove_shortcodes', array($this, 'wply7s5g4'), 10, 0); if (! empty($_POST['memb_form_type']) ) { add_action('template_redirect', array($this, 'wplt314'), 1); } } private function wplb3r25() { $vwplyd39['standard'] = array( 'memb_spiffy_login' => 'wpl__cmyb', ); return $vwplyd39; } function wplt314() { $vwplhx8pj = strtolower($_POST['memb_form_type']); $vwplfdf6 = array( 'memberium/spiffy_login_button' => 'wplqbcza', ); if (array_key_exists($vwplhx8pj, $vwplfdf6)) { $vwplqwfy = $vwplfdf6[$vwplhx8pj]; $this->$vwplqwfy(); } } function wpltfkxw() { $vwpls0hwb5 = $this->wplb3r25();  if (isset($vwpls0hwb5['standard']) && is_array($vwpls0hwb5['standard']) ) { foreach($vwpls0hwb5['standard'] as $vwpltmveju => $vwplmh6qr) { add_shortcode($vwpltmveju, array($this, $vwplmh6qr) ); } } } function wply7s5g4() { $vwpls0hwb5 = $this->wplb3r25(); if (isset($vwpls0hwb5['standard']) && is_array($vwpls0hwb5['standard']) ) { foreach($vwpls0hwb5['standard'] as $vwpltmveju => $vwplmh6qr) { remove_shortcode($vwpltmveju); } } } function wpl__cmyb($vwplvpexdn, $vwplckl3 = NULL, $vwpluvdiz = '') { if (! wpln9_s::wplq6kurm() ) { return; } if (! is_user_logged_in() ) { return; } if (! wpln9_s::wplq6kurm() ) { return; } $vwplbypxr = wplz8bid::wplvf1d('settings', 'spiffy_subdomain'); if (empty($vwplbypxr) && is_super_admin() ) { return "<strong style='color:red;'>Admin Notice:  The [{$vwpluvdiz}] shortcode has been disabled due to missing configuration.</strong>"; } $vwplsb_pf = array( 'button_text' => 'Get Spiffy Login', 'button_url' => '', 'css_button_class' => 'memb_spiffy_login_button', 'css_button_id' => 'memb_spiffy_login_button', 'css_button_name' => 'memb_spiffy_login_button', 'css_button_style' => '', 'css_class' => 'memb_spiffy_login_form', 'css_id' => 'memb_spiffy_login_form', 'css_message_class' => 'memb_spiffy_login_message', 'css_message_id' => 'memb_spiffy_login_message', 'css_message_style' => '', 'css_name' => 'memb_spiffy_login_form', 'css_style' => '', 'message' => 'Please check your email for your Spiffy login link.', 'email' => empty($_SESSION['memb_db_fields']['email']) ? wp_get_current_user()->user_email : $_SESSION['memb_db_fields']['email'], 'style' => '', ); $vwplvpexdn = shortcode_atts($vwplsb_pf, $vwplvpexdn, 'memberium'); $vwplun47e = array( 'email' => $vwplvpexdn['email'], 'message' => $vwplvpexdn['message'], ); $vwplun47e = base64_encode(serialize($vwplun47e) ); $vwpltmfi = memberium_app()->wpln4nyq2($vwplun47e); $vwplceqp = wp_nonce_field('memb_spiffy_login_' . $vwplvpexdn['css_id'], '_wpnonce', true, false); $vwpld576f2 = ''; $vwplygr2 = wplz8bid::wplkcmj('memb_spiffy_login'); if (! empty($vwplygr2)) { $vwpld576f2 .= "<div id='{$vwplvpexdn['css_message_id']}' class='{$vwplvpexdn['css_message_class']}' style='{$vwplvpexdn['css_message_style']}'>{$vwplygr2}</div>"; } else { $vwpld576f2 .= "<form name='{$vwplvpexdn['css_name']}' id='{$vwplvpexdn['css_id']}' method='post' action=''>"; $vwpld576f2 .= "<input type='hidden' name='memb_form_type' value='memberium/spiffy_login_button'>"; $vwpld576f2 .= "<input type='hidden' name='form_id' value='{$vwplvpexdn['css_id']}'>"; $vwpld576f2 .= "<input type='hidden' name='parameters' value='{$vwplun47e}'>"; $vwpld576f2 .= "<input type='hidden' name='signature' value='{$vwpltmfi}'>"; $vwpld576f2 .= $vwplceqp; if (empty($vwplvpexdn['button_url']) ) { $vwpld576f2 .= "<input type='submit' style='{$vwplvpexdn['css_button_style']}' id='{$vwplvpexdn['css_button_id']}' value='{$vwplvpexdn['button_text']}'>"; } else { $vwpld576f2 .= "<input type='image' src='{$button_url}' class='{$css_class}' id='{$vwplcf6y18}' >"; } $vwpld576f2 .= "</form>"; } return $vwpld576f2; }    function wplqbcza() { if (! wpln9_s::wplio5sck() ) { return; } if (! wp_verify_nonce($_POST['_wpnonce'], "memb_spiffy_login_{$_POST['form_id']}") ) { wp_die(_x('Security Check Failed - Nonce Validation Error', 'wpl__cmyb', 'memberium') ); exit; } if (! memberium_app()->wplc3l0b($_POST['signature'], $_POST['parameters']) ) { wp_die(_x('Security Check Failed - Signature Validation Error', 'wpl__cmyb', 'memberium') ); exit; } $vwplnlyfv3 = wplz8bid::wplvf1d('settings', 'spiffy_subdomain'); $vwplun47e = unserialize(base64_decode($_POST['parameters']));  $vwplfkojlf = 'https://api.spiffy.co/customer-portal/auth'; $vwplgitq = array( 'headers' => array( 'x-subdomain' => $vwplnlyfv3, ), 'body' => array( 'email' => $vwplun47e['email'], ), 'sslverify' => false, ); $vwplyio4f = wp_remote_post($vwplfkojlf, $vwplgitq); wplz8bid::wpljwh1('memb_spiffy_login', $vwplun47e['message'] ); } function __construct() { $this->wplzd4b(); } }
