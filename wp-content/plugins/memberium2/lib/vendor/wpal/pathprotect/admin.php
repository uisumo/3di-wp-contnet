<?php
/**
 * Copyright (c) 2020 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 if ( !defined( 'ABSPATH' ) ) { die(); } final class wplvsbzr { function wpli9df() { if ( ! defined( 'DOING_CRON' ) && current_user_can( 'manage_options' ) ) { add_action('admin_menu', array( $this, 'wplk5i42' ) ); } } function wplk5i42() { if ( current_user_can( 'manage_options' ) ) { add_options_page( __('WPaL Path Protect'), __('WPaL Path Protect'), 'manage_options', 'pathprotect', array( $this, 'wplgax0gr' ) ); } } function wplgax0gr() { if ( ! current_user_can( 'manage_options' ) ) { wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); } $vwplelob86 = $this->wplrw2ix9(); $vwplzzlf5b = $_POST; $vwplqsatk2 = $_SERVER; if ( $vwplqsatk2['REQUEST_METHOD'] == 'POST' ) { if (! empty($vwplzzlf5b['update_rules']) ) { $vwplelob86['rules'] = array(); if ( isset($_POST['rules']) && is_array( $_POST['rules'] ) ) { foreach( $_POST['rules'] as $vwplumpq ) { $vwplumpq['urls'] = trim( $vwplumpq['urls'] ); if ( $vwplumpq['anonymous_only'] ) { $vwplumpq['logged_in'] = 0; } if ( $vwplumpq['logged_in'] ) { $vwplumpq['anonymous_only'] = 0; } if ( ! $vwplumpq['anonymous_only'] && ! $vwplumpq['logged_in'] ) { $vwplumpq['logged_in'] = 1; } if ( $vwplumpq['prohibited_action'] == 'redirect' && empty( $vwplumpq['redirect_url'] ) ) { $vwplumpq['redirect_url'] = get_site_url(); } if ( ! empty( $vwplumpq['urls'] ) && $vwplumpq['delete'] == 0 ) { $vwplelob86['rules'][] = $vwplumpq; } } } } if (! empty($_POST['add_rules']) ) { $vwplelob86['rules'][] = array( 'urls' => '', 'logged_in' => 0, 'anonymous_only' => 0, 'prohibited_action' => 'redirect', ); } $this->wpltj3pd($vwplelob86); } $vwplydl4 = array(); $vwplydl4['hide'] = 'Hide Completely'; $vwplydl4['redirect'] = 'Redirect'; echo '<style>'; echo 'label { width:200px; display:inline-block; }'; echo '#htmlmessage { width:500px !important; }'; echo '</style>'; echo '<div class="wrap">'; echo '<h1>Path Protect for Membership Sites</h1>'; echo '<form method="POST" action="">'; echo '<ul>'; echo '</ul>'; echo '<h3>Current Rules</h3>'; echo '<div style="width:800px;">'; echo '<hr />'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr style="font-weight:bold;">'; echo '<th>Requirements</th>'; echo '<th>URLs</th>'; echo '<th>Prohibited Action</th>'; echo '<th>Delete?</th>'; echo '</tr>'; if (! empty($vwplelob86['rules']) && is_array($vwplelob86['rules']) ) { foreach ( $vwplelob86['rules'] as $vwply17edn => $vwplumpq ) { $vwplumpq['logged_in'] = isset( $vwplumpq['logged_in'] ) ? $vwplumpq['logged_in'] : 0; $vwplumpq['anonymous_only'] = isset( $vwplumpq['anonymous_only'] ) ? $vwplumpq['anonymous_only'] : 0; $vwplumpq['urls'] = isset( $vwplumpq['urls'] ) ? $vwplumpq['urls'] : ''; $vwplumpq['redirect_url'] = isset( $vwplumpq['redirect_url'] ) ? $vwplumpq['redirect_url'] : ''; echo '<tr>'; echo '<td>'; echo '<input type="hidden" name="rules[', $vwply17edn, '][logged_in]" value="0">'; echo '<input type="checkbox" value="1" name="rules[', $vwply17edn, '][logged_in]"', $vwplumpq['logged_in'] == 1 ? ' checked="checked" ' : '', ' /> Logged In<br>'; echo '<input type="hidden" name="rules[', $vwply17edn, '][anonymous_only]" value="0">'; echo '<input type="checkbox" value="1" name="rules[', $vwply17edn, '][anonymous_only]"', $vwplumpq['anonymous_only'] == 1 ? ' checked="checked" ' : '', ' /> Anonymous Only<br>'; echo '</td>'; $vwplhhwxl = count( explode( "\n", $vwplumpq['urls'] ) ); echo '<td>'; echo '<textarea cols="80" rows="', $vwplhhwxl + 1, '" name="rules[', $vwply17edn, '][urls]">', $vwplumpq['urls'], '</textarea>'; echo '</td>'; echo '<td>'; echo '<select name="rules[', $vwply17edn, '][prohibited_action]">'; foreach ( $vwplydl4 as $vwplph268z => $vwplaco6 ) { $vwpl_ycm2b = $vwplumpq['prohibited_action'] == $vwplph268z ? ' selected="selected" ' : ''; echo '<option value="' . $vwplph268z . '" ' . $vwpl_ycm2b . '>' . $vwplaco6 . '</option>'; } echo '</select><br />'; echo 'Redirection URL<br>'; echo '<input type="text" name="rules[', $vwply17edn, '][redirect_url]" value="', $vwplumpq['redirect_url'],'">'; echo '</td>'; echo '<td>'; echo '<input type="hidden" name="rules[', $vwply17edn, '][delete]" value="0">'; echo '<input type="checkbox" name="rules[', $vwply17edn, '][delete]" value="1">'; echo '</td>'; echo '</tr>'; } } else { echo '<tr><td colspan="99">You have no rules created</td></tr>'; } echo '</table>'; echo '&nbsp;<br>'; echo '<input type="submit" name="update_rules" value="Save Changes" class="button-primary" />'; echo '</form>'; echo '<form method="post">'; echo '&nbsp;<br>'; echo '<input type="submit" name="add_rules" value="Add Ruleset" class="button-primary" />'; echo '</form>'; echo '</div>'; echo '</div>'; } function __construct() { $this->settings = get_option('MemberiumPathProtect'); unset($this->settings['active']); add_action('init', array( $this, 'wpli9df' ), 9 ); } private function wplrw2ix9() { $vwply17edn = 'WPAL/pathprotect/settings'; $vwpl_lz_n = 'MemberiumPathProtect'; $vwplelob86 = get_option($vwply17edn, false); if ($vwplelob86 === false) { $vwplelob86 = get_option($vwpl_lz_n, ''); if (is_array($vwplelob86) ) { update_option($vwply17edn, $vwplelob86); } } if (! is_array($vwplelob86) || empty($vwplelob86) ) { $vwplelob86 = array( 'rules' => array(), ); } return $vwplelob86; } private function wpltj3pd($vwplelob86) { $vwply17edn = 'WPAL/pathprotect/settings'; $vwpl_lz_n = 'MemberiumPathProtect'; update_option($vwply17edn, $vwplelob86); delete_option($vwpl_lz_n); } private $settings; }
