<?php
 if ( ! defined( 'ABSPATH' ) ) { die(); } final class wpls3sm { private function wpljupn($vwpllzly5b, $vwpl_cpfi) { global $wpdb; $vwpl_cpfi = (int) $vwpl_cpfi; $vwpllzly5b = (int) $vwpllzly5b; $vwplx1ap5_ = "SELECT `comment_ID` FROM `{$wpdb->comments}` WHERE `comment_post_ID` = {$vwpl_cpfi} AND `user_id` = {$vwpllzly5b} AND `comment_approved` = 'complete' AND `comment_type` = 'sensei_lesson_status';"; $vwplxwkne1 = (int) $wpdb->get_var($vwplx1ap5_); if ($vwplxwkne1) { $vwplkd1jx = get_comment_meta($vwplxwkne1); } else { $vwplkd1jx = array(); } return $vwplkd1jx; } private function wplfv7min($vwpllzly5b, $vwplvbkdn) { global $wpdb; $vwplvbkdn = (int) $vwplvbkdn; $vwpllzly5b = (int) $vwpllzly5b; $vwplx1ap5_ = "SELECT `comment_ID` FROM `{$wpdb->comments}` WHERE `comment_post_ID` = {$vwplvbkdn} AND `user_id` = {$vwpllzly5b} AND `comment_approved` = 'complete' AND `comment_type` = 'sensei_course_status';"; $vwplxwkne1 = (int) $wpdb->get_var($vwplx1ap5_); if ($vwplxwkne1) { $vwplkd1jx = get_comment_meta($vwplxwkne1); } else { $vwplkd1jx = array(); } return $vwplkd1jx; } private function wplcdb81u($vwpllzly5b, $vwplgm_9s, $vwplatgvu) { $vwplvtmqd = wpllbej::wplbmo_1($vwpllzly5b); if (! $vwplvtmqd) { return; } if ($vwplgm_9s == 'course') { $vwplkmd5 = $this->wplfv7min($vwpllzly5b, $vwplatgvu); } elseif ($vwplgm_9s == 'lesson') { $vwplkmd5 = $this->wpljupn($vwpllzly5b, $vwplatgvu); } else { return; } $vwplct26 = get_post_meta($vwplatgvu); if (! empty($vwplct26['_is4wp_lms_start_date'][0]) ) { $vwple2yn = isset($vwplct26['_is4wp_lms_start_date'][0]) ? $vwplct26['_is4wp_lms_start_date'][0] : ''; $vwplgzj6fs = isset($vwplkmd5['start'][0]) ? $vwplkmd5['start'][0] : ''; memberium_app()->wplwjd3g($vwplvtmqd, $vwple2yn, $vwplgzj6fs); } if (! empty($vwplct26['_is4wp_lms_complete_percent'][0]) ) { $vwple2yn = isset($vwplct26['_is4wp_lms_complete_percent'][0]) ? $vwplct26['_is4wp_lms_complete_percent'][0] : ''; $vwplgzj6fs = isset($vwplkmd5['percent'][0]) ? $vwplkmd5['percent'][0] : ''; memberium_app()->wplwjd3g($vwplvtmqd, $vwple2yn, $vwplgzj6fs); } if ( ! empty( $vwplct26['_is4wp_learndash_goals'][0] ) ) { memberium_app()->wplge1yc6( $vwplct26['_is4wp_learndash_goals'][0], $vwplvtmqd ); } if ( ! empty( $vwplct26['_is4wp_learndash_tags'][0] ) ) { memberium_app()->wplt263_( $vwplct26['_is4wp_learndash_tags'][0], $vwplvtmqd ); } if ( ! empty( $vwplct26['_is4wp_learndash_actions'][0] ) ) { memberium_app()->wplmupt( $vwplct26['_is4wp_learndash_actions'][0], $vwplvtmqd ); } if ( function_exists( 'badgeos_award_achievement_to_user' ) && ! empty( $vwplct26['_is4wp_learndash_achievement'][0] ) ) { badgeos_award_achievement_to_user( (int) $vwplct26['_is4wp_learndash_achievement'][0], $vwpllzly5b ); } } private function wplicnz() { add_action('sensei_user_lesson_end', array($this, 'wplze5jwt'), 10, 2); add_action('sensei_user_course_end', array($this, 'wpluiuc'), 10, 2); add_action('sensei_user_quiz_grade', array($this, 'wplsvl1'), 10, 5); } function wplsvl1($vwpllzly5b, $vwplsmd9, $vwplc0t2, $vwpld2cet, $vwplw_t5) { $vwplvtmqd = wpllbej::wplbmo_1($vwpllzly5b); if (! $vwplvtmqd) { return; } $vwplqx3s = wp_get_post_parent_id($vwplsmd9);  $vwplgm_9s = get_post_type($vwplqx3s); if ($vwplgm_9s == 'course') { $vwplkmd5 = $this->wplfv7min($vwpllzly5b, $vwplqx3s); } elseif ($vwplgm_9s == 'lesson') { $vwplkmd5 = $this->wpljupn($vwpllzly5b, $vwplqx3s); } else { return; } $vwplct26 = get_post_meta($vwplsmd9); if ( ! empty( $vwplct26['_is4wp_lms_grade'][0] ) ) { $vwple2yn = isset($vwplct26['_is4wp_lms_grade'][0]) ? $vwplct26['_is4wp_lms_grade'][0] : ''; $vwplgzj6fs = $vwplc0t2; memberium_app()->wplwjd3g($vwplvtmqd, $vwple2yn, "{$vwplgzj6fs}"); } if (! empty($vwplct26['_is4wp_lms_completed'][0]) ) { $vwple2yn = isset($vwplct26['_is4wp_lms_completed'][0]) ? $vwplct26['_is4wp_lms_completed'][0] : ''; $vwplgzj6fs = (int) ($vwplc0t2 >= $vwpld2cet); memberium_app()->wplwjd3g( $vwplvtmqd, $vwple2yn, $vwplgzj6fs ); }  if (false) { echo __LINE__, ' @ ', __FUNCTION__, '<br>'; echo '<pre>elv_contact_id = ', print_r($vwplvtmqd, true), '</pre>'; echo '<pre>elv_fieldname = ', print_r($vwple2yn, true), '</pre>'; echo '<pre>elv_meta_value = ', print_r($vwplgzj6fs, true), '</pre>'; echo '<pre>elv_user_id = ', print_r($vwpllzly5b, true), '</pre>'; echo '<pre>elv_type = ', print_r($vwplgm_9s, true), '</pre>'; echo '<pre>elv_grade = ', print_r($vwplc0t2, true), '</pre>'; echo '<pre>elv_quiz_passmark = ', print_r($vwpld2cet, true), '</pre>'; echo '<pre>elv_quiz_grade_type = ', print_r($vwplw_t5, true), '</pre>'; echo '<pre>elv_quiz_id = ', print_r($vwplsmd9, true), '</pre>'; echo '<pre>elv_parent_module_id = ', print_r($vwplqx3s, true), '</pre>'; echo '<pre>elv_comment_metas = ', print_r($vwplkmd5, true), '</pre>'; echo '<pre>elv_metas = ', print_r($vwplct26, true), '</pre>'; die(); } } function wplze5jwt($vwpllzly5b, $vwpl_cpfi) { $this->wplcdb81u($vwpllzly5b, 'lesson', $vwpl_cpfi); } function wpluiuc($vwpllzly5b, $vwplvbkdn) { $this->wplcdb81u($vwpllzly5b, 'course', $vwplvbkdn); } function __construct() { $this->wplicnz(); } }
