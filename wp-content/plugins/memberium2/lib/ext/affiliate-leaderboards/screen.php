<?php
if ( !defined( 'ABSPATH' ) ) { die(); } if ( !current_user_can( 'manage_options' ) ) { wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); } global $wpdb; $vwplv0vzua = $this->leaderboard_core->wplxhl7(); $vwplx1ht_ = include_once __DIR__ . '/cron.php'; $_GET['tab'] = isset( $_GET['tab'] ) ? $_GET['tab'] : 'leaderboards'; if ( $_SERVER['REQUEST_METHOD'] == 'POST' ) { if ( isset( $_POST['create-leaderboard'] ) ) { unset( $_POST['create-leaderboard'] ); $vwpld_gmv5 = $_POST; $vwpld_gmv5['last_updated'] = 0; $vwpld_gmv5['cache'] = array(); $vwplv0vzua[] = $vwpld_gmv5; } elseif ( isset( $_POST['update-leaderboard'] ) ) { foreach( $_POST['profile'] as $vwply17edn => $vwpllhp906 ) { $vwplv0vzua[$vwply17edn]['slots'] = $vwpllhp906['slots']; $vwplv0vzua[$vwply17edn]['start_date'] = $vwpllhp906['start_date']; $vwplv0vzua[$vwply17edn]['end_date'] = $vwpllhp906['end_date']; $vwplv0vzua[$vwply17edn]['last_updated'] = 0;  if ( ! empty( $vwpllhp906['delete'] ) ) { unset( $vwplv0vzua[$vwply17edn] ); } } $this->leaderboard_core->wply3hw4g( $vwplv0vzua ); $vwplx1ht_ = require_once __DIR__ . '/cron.php'; } if ( isset( $_POST['refresh'] ) ) { $vwplopnf = (int) $_POST['refresh']; $vwplv0vzua[$vwplopnf] = $vwplx1ht_->wplr8antl( $vwplv0vzua[$vwplopnf] ); } $this->leaderboard_core->wply3hw4g( $vwplv0vzua ); } wpljwbf2::wplyb40j1(); $vwpln5qyc = array( 'leaderboards' => '<i class="fa fa-list-ol"></i> Create Leaderboards',  'about' => '<i class="fa fa-users"></i> About', ); $vwpl_qd2 = isset( $_GET['tab'] ) ? strtolower( $_GET['tab'] ) : 'general'; echo '<div class="wrap">'; echo '<h2>', _( 'Affiliate Leaderboard Settings' ), '</h2>'; echo '<h2 class="nav-tab-wrapper">'; foreach ( $vwpln5qyc as $vwplesora => $vwplso1pw ) { $vwpl_7gr2b = ( $vwplesora == $vwpl_qd2 ) ? ' nav-tab-active' : ''; if ( $vwplesora == $vwpl_qd2 ) { echo "<span class='nav-tab$vwpl_7gr2b'>$vwplso1pw</span>"; } else { echo "<a class='nav-tab{$vwpl_7gr2b}' href='?page=", $_GET['page'], "&tab={$vwplesora}'>{$vwplso1pw}</a>"; } } echo '</h2>'; echo '<div class="tabcontent" style="margin-top:10px;">'; $vwplv0vzua = $this->leaderboard_core->wplxhl7(); $vwplvwi2o = memberium_app()->wplpg5eox(); if ( $vwpl_qd2 == 'leaderboards' ) { if ( ! empty( $vwplv0vzua ) ) { echo '<h3>Live Leaderboards</h3>'; echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr>'; echo '<td style="width:50px;">Delete</td>'; echo '<td>Name</td>'; echo '<td style="width:50px;">Type</td>'; echo '<td style="width:50px;">Slots</td>'; echo '<td style="width:75px;">Start</td>'; echo '<td style="width:75px;">End</td>'; echo '<td>Products</td>'; echo '<td style="width:75px;">&nbsp;</td>'; echo '</tr>'; foreach( $vwplv0vzua as $vwply17edn => $vwplvkv3 ) { echo '<tr>'; echo '<td><input type="checkbox" name="profile[',$vwply17edn,'][delete]" value="1"></td>'; echo '<td>', $vwplvkv3['name'] ,'</td>'; echo '<td>', ucwords( $vwplvkv3['type'] ) ,'</td>'; echo '<td><input type="number" style="width:50px;" value="', $vwplvkv3['slots'], '" step="1" min="1" name="profile[',$vwply17edn,'][slots]"></td>'; echo '<td><input type="date" value="', $vwplvkv3['start_date'], '" name="profile[',$vwply17edn,'][start_date]"></td>'; echo '<td><input type="date" value="', $vwplvkv3['end_date'], '" name="profile[',$vwply17edn,'][end_date]"></td>'; echo '<td>'; $vwplgiwcx7 = array_filter( explode( ',', $vwplvkv3['products'] ) ); $vwpltlkdcw = ''; if ( ! empty( $vwplgiwcx7 ) ) { foreach( $vwplgiwcx7 as $vwplopnf ) { $vwpltlkdcw .= $vwplvwi2o[$vwplopnf]['ProductName'] . ', '; } unset( $vwplgiwcx7, $vwplopnf ); } echo trim( $vwpltlkdcw, ', ' ); echo '</td>'; echo '<td><button name="refresh" class="button button-primary" value="', $vwply17edn, '">Refresh</button></td>';  echo '</tr>'; } echo '</table>'; echo '<p><input type="submit" name="update-leaderboard" value="Update Leaderboards" class="button-primary"></p>'; echo '</form>'; } else { echo '<p>You have no affiliate leaderboards created.  Create one now!</p>'; } echo '<form method="post" id="newprofile">'; echo '<ul>'; echo '<h3>Create New Leaderboard</h3>'; $vwplgitq = array( 'id' => 'newprofile_name', 'label' => 'Profile Name', 'placeholder' => 'Enter a name for your Leaderboard here', 'required' => true, 'size' => 40, ); echo wpljwbf2::wplm57_u1( 'name', $vwplgitq ); $vwplnkj9d_ = array( 'leads' => 'Most Leads', 'dollars' => 'Most Sales by Dollar Amount', 'invoices' => 'Most Sales by Invoice Count', ); $vwplgitq = array( 'id' => 'newprofile_type', 'class' => 'basic-single', 'style' => 'width:250px;', ); $vwplmnovmz = null; echo '<li><label>Leaderboard Type</label>'; echo memberium_app()->wplk1zp_v()->wplxrx8pd('type', $vwplnkj9d_, $vwplmnovmz, $vwplgitq); echo wpljwbf2::wplypewkt( 0000 ), '</li>'; $vwplgitq = array( 'id' => 'newprofile_slots', 'label' => 'Slots', 'placeholder' => '', 'type' => 'number', 'min' => 1, 'step' => 1, 'value' => 10, 'style' => 'width:50px;', 'required' => true, ); echo wpljwbf2::wplm57_u1( 'slots', $vwplgitq ); $vwplgitq = array( 'id' => 'newprofile_start_date', 'label' => 'Start Date', 'placeholder' => 'mm/dd/yyyy', 'size' => 10, 'type' => 'date', 'required' => true, ); echo wpljwbf2::wplm57_u1( 'start_date', $vwplgitq ); $vwplgitq = array( 'id' => 'newprofile_end_date', 'label' => 'End Date', 'placeholder' => 'mm/dd/yyyy', 'size' => 10, 'type' => 'date', 'required' => true, ); echo wpljwbf2::wplm57_u1( 'end_date', $vwplgitq ); echo '<div class="filteroptions" style="display:none;">'; $vwplgitq = array( 'id' => 'newprofile_products', 'label' => 'Products', 'placeholder' => 'Select the products for your leaderboard, or leave blank for all', 'type' => 'text', 'class' => 'multiproductlistdropdown', 'style' => 'width:500px;', 'required' => false, ); echo wpljwbf2::wplm57_u1( 'products', $vwplgitq ); echo '</div><!-- filteroptions -->'; echo '</ul>'; echo '<p><input type="submit" name="create-leaderboard" value="Create Leaderboard" class="button-primary"></p>'; echo '</form>'; echo '<hr>'; echo '</div>'; echo '</div>'; echo '<script>



	</script>';  } elseif ( $vwpl_qd2 == 'about' ) { echo '<h2>Memberium Affiliate Leaderboard Extension for Infusionsoft</h2>'; echo '<p>', _( 'Version' ), ' ', $this->leaderboard_core->wplyo16nv(), '</p>'; echo '<p>Copyright &copy; 2017 David Bullock</p>'; } elseif ( $vwpl_qd2 == 'test' ) {  $vwplv0vzua = $this->leaderboard_core->wplxhl7(); foreach( $vwplv0vzua as $vwplvkv3 ) { echo '<pre>', print_r( $vwplvkv3['cache'], true ), '</pre>'; } } $vwplqnhd6j = array(); foreach( $vwplvwi2o as $vwplb3hm ) { $vwplqnhd6j[] = array( 'id' => $vwplb3hm['Id'], 'text' => $vwplb3hm['ProductName'] . ' (' . $vwplb3hm['Id'] . ')' ); } $vwplqnhd6j = json_encode( $vwplqnhd6j ); unset( $vwplb3hm ); echo '<script>'; echo 'var productlist = ', $vwplqnhd6j, ';'; echo '</script>'; unset( $vwplvmes5, $vwpljn21, $vwplbhf2 ); ?>
<script>
	jQuery( '#newprofile').change( function() {
		var profile_type = jQuery( '#newprofile_type' ).val();
		if ( profile_type == 'leads' ) {
			jQuery(".filteroptions").prop( 'disabled', true );
			jQuery(".filteroptions").hide();
		}
		else {
			jQuery(".filteroptions").prop( 'disabled', false );
			jQuery(".filteroptions").show();
		}
	});

</script>
