<?php
if ( !defined( 'ABSPATH' ) ) { die(); } if ( ( ! class_exists( 'BP_Groups_Group' ) ) || ( ! class_exists( 'BP_Group_Extension' ) ) ) { return; } if ( is_admin() ) { final class wplur2i extends BP_Group_Extension { function __construct() { add_filter('memberium\enhanced_admin_scripts', array($this, 'wpln02qz'), 10, 1); $vwplgitq = array( 'slug' => 'bp-groups-for-memberium', 'name' => 'BuddyPress Groups for Memberium', ); parent::init( $vwplgitq ); } function wpln02qz($vwplij97q2) { $vwplij97q2[] = 'toplevel_page_bp-groups';  $vwplij97q2[] = 'buddyboss_page_bp-groups';  return $vwplij97q2; } function display( $vwplyn_o59 = null ) { $vwplyn_o59 = bp_get_group_id(); } function settings_screen( $vwplyn_o59 = null ) { if ( empty($vwplyn_o59) ) { return; } $vwplmnovmz = groups_get_groupmeta($vwplyn_o59, '_is4wp_autojoin'); $vwplmnovmz = empty( $vwplmnovmz ) ? array() : $vwplmnovmz; $vwplmnovmz['autojoin_admin'] = isset( $vwplmnovmz['autojoin_admin'] ) ? $vwplmnovmz['autojoin_admin'] : ''; $vwplmnovmz['autojoin_moderator'] = isset( $vwplmnovmz['autojoin_moderator'] ) ? $vwplmnovmz['autojoin_moderator'] : ''; $vwplmnovmz['autojoin_member'] = isset( $vwplmnovmz['autojoin_member'] ) ? $vwplmnovmz['autojoin_member'] : ''; $vwplmnovmz['autoban'] = isset( $vwplmnovmz['autoban'] ) ? $vwplmnovmz['autoban'] : ''; echo '<label class="memberium_label">Autojoin as Admin:</label>'; echo '<input type="text" name="is4wp_autojoin_admin" value="' . $vwplmnovmz['autojoin_admin'] . '" class="tag-selector" style="width:500px;">'; echo '<br>'; echo '<label class="memberium_label">Autojoin as Moderator:</label>'; echo '<input type="text" name="is4wp_autojoin_moderator" value="' . $vwplmnovmz['autojoin_moderator'] . '" class="tag-selector" style="width:500px;">'; echo '<br>'; echo '<label class="memberium_label">Autojoin as Member:</label>'; echo '<input type="text" name="is4wp_autojoin_member" value="' . ( $vwplmnovmz['autojoin_member'] > '' ? $vwplmnovmz['autojoin_member'] : '' ) . '" class="tag-selector" style="width:500px;">'; echo '<br>'; echo '<label class="memberium_label">Auto-Ban:</label>'; echo '<input type="text" name="is4wp_autoban" value="' . ( $vwplmnovmz['autoban'] > '' ? $vwplmnovmz['autoban'] : '' ) . '" class="tag-selector" style="width:500px;">'; echo '<br>'; echo '<style>'; echo ' .memberium_label { display:inline-block; width:175px; margin-right: 20px; }'; echo ' .tag-selector { margin-bottom:6px; }'; echo '</style>'; $vwpls0hwb5 = wplj_l2t::wplaajf( true ); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwplechli = array(); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju ) { $vwplechli[] = array( 'id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); } $vwplechli = json_encode( $vwplechli ); unset( $vwpls0hwb5, $vwplopnf, $vwpltmveju ); echo '<script>'; echo '	var taglist = ', $vwplechli, ';'; echo '</script>'; unset( $vwpls0hwb5, $vwplechli ); echo '<script> '; echo '	jQuery( document ).ready( function() { '; echo '		jQuery(".tag-selector").memb_select2({ '; echo '			placeholder: "Select the tags for this role.", '; echo '			tags: taglist '; echo '		}); '; echo '}); '; echo '</script>'; } function settings_screen_save( $vwplyn_o59 = NULL ) { $vwplmnovmz = array(); $vwplmnovmz['autojoin_admin'] = isset( $_POST['is4wp_autojoin_admin'] ) ? $_POST['is4wp_autojoin_admin'] : ''; $vwplmnovmz['autojoin_moderator'] = isset( $_POST['is4wp_autojoin_moderator'] ) ? $_POST['is4wp_autojoin_moderator'] : ''; $vwplmnovmz['autojoin_member'] = isset( $_POST['is4wp_autojoin_member'] ) ? $_POST['is4wp_autojoin_member'] : ''; $vwplmnovmz['autoban'] = isset( $_POST['is4wp_autoban'] ) ? $_POST['is4wp_autoban'] : ''; groups_update_groupmeta( $vwplyn_o59, '_is4wp_autojoin', $vwplmnovmz ); } } } add_filter('memberium_session_filter', 'wplnckp', 20, 1 ); add_shortcode('memb_buddypressgroup_grid', 'wplsukq4'); if ( function_exists( 'bp_register_group_extension' ) ) { bp_register_group_extension( 'wplur2i' ); } function wplnckp($vwplc0nobe) { if ( ! function_exists('groups_get_groups') || ! class_exists( 'BP_Groups_Group' ) ) { return $vwplc0nobe; } $vwpllzly5b = isset( $vwplc0nobe['memb_user']['Id'] ) ? $vwplc0nobe['memb_user']['Id'] : get_current_user_id(); if ( user_can($vwpllzly5b, 'manage_options') ) { return $vwplc0nobe; } $vwplgitq = array( 'show_hidden' => true, ); $vwplrudn1 = groups_get_groups($vwplgitq); $vwplrudn1 = isset($vwplrudn1['groups']) ? $vwplrudn1['groups'] : array(); if ( is_array($vwplrudn1) ) { foreach ( $vwplrudn1 as $vwplae8n ) { $vwplmnovmz = groups_get_groupmeta( $vwplae8n->id, '_is4wp_autojoin' ); $vwplmnovmz['autoban'] = isset( $vwplmnovmz['autoban'] ) ? $vwplmnovmz['autoban'] : ''; $vwplmnovmz['autojoin_admin'] = isset( $vwplmnovmz['autojoin_admin'] ) ? $vwplmnovmz['autojoin_admin'] : ''; $vwplmnovmz['autojoin_moderator'] = isset( $vwplmnovmz['autojoin_moderator'] ) ? $vwplmnovmz['autojoin_moderator'] : ''; $vwplmnovmz['autojoin_member'] = isset( $vwplmnovmz['autojoin_member'] ) ? $vwplmnovmz['autojoin_member'] : ''; $vwplej9d7u = groups_is_user_member( $vwpllzly5b, $vwplae8n->id ); $vwplp9sje7 = groups_is_user_mod( $vwpllzly5b, $vwplae8n->id ); $vwplbje3ox = groups_is_user_admin( $vwpllzly5b, $vwplae8n->id ); $vwplktf019 = false; $vwplm7gchj = false; $vwplh6mh0_ = false; $vwplhlw3 = ''; if ( ! empty( $vwplmnovmz['autoban'] ) ) { if ( wplj_l2t::wpl_n2s9( $vwplmnovmz['autoban'], $vwplc0nobe ) ) { $vwplm7gchj = true; } } if ( $vwplm7gchj ) { if ( $vwplej9d7u ) { $vwplgpnbh = new BP_Groups_Member( $vwpllzly5b, $vwplae8n->id ); $vwplgpnbh->demote(); } $vwplgpnbh = new BP_Groups_Member( $vwpllzly5b, $vwplae8n->id ); $vwplgpnbh->ban(); } else { $vwplb38i = wplj_l2t::wpl_n2s9( $vwplmnovmz['autojoin_admin'], $vwplc0nobe ); $vwplbqfusd = wplj_l2t::wpl_n2s9( $vwplmnovmz['autojoin_moderator'], $vwplc0nobe ); $vwpl_8ydj_ = wplj_l2t::wpl_n2s9( $vwplmnovmz['autojoin_member'], $vwplc0nobe ); if ( ! $vwplej9d7u ) { if ( $vwplb38i || $vwplbqfusd || $vwpl_8ydj_ ) { groups_join_group( $vwplae8n->id, $vwpllzly5b ); $vwplej9d7u = true; } } $vwplgpnbh = new BP_Groups_Member( $vwpllzly5b, $vwplae8n->id ); if ( ! empty( $vwplmnovmz['autojoin_moderator'] ) ) { if ( $vwplbqfusd && ( $vwplb38i == false ) ) { $vwplgpnbh->promote( 'mod' ); $vwplp9sje7 = true; $vwplej9d7u = true; } else { if ( ! $vwplb38i ) { $vwplgpnbh->demote(); } } } if ( ! empty( $vwplmnovmz['autojoin_admin'] ) ) { if ( $vwplb38i ) { $vwplgpnbh->promote( 'admin' ); $vwplej9d7u = true; } else { if ( $vwplbje3ox && ( $vwplbqfusd == false ) ) { $vwplgpnbh->demote(); } } } if ( ! empty( $vwplmnovmz['autojoin_member'] ) ) { if ( ! $vwpl_8ydj_ ) { if ( ( $vwplb38i == false ) && ( $vwplbqfusd == false ) ) { BP_Groups_Member::delete( $vwpllzly5b, $vwplae8n->id ); } } } } } } return $vwplc0nobe; } function wplsukq4( $vwplvpexdn, $vwplckl3 = null, $vwpluvdiz = '' ) { $vwplsb_pf = array( 'img_size' => '120', ); $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); $vwplgitq = array( 'type' => 'alphabetical', 'per_page' => 999 ); $vwplbcm93 = $vwplrudn1 = BP_Groups_Group::get($vwplgitq); print_r( $vwplbcm93 ); echo '<pre>', print_r( $vwplbcm93, true ), '</pre>'; }
