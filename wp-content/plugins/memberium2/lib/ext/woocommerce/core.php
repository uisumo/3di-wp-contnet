<?php
/**
 * Copyright (c) 2017-2020 David J Bullock
 * Web Power and Light
 */

 if (! defined('ABSPATH') ) { die(); }  class wplg6_7 { public $post_keys = array( 'canc' => '_memberium_canc_tag', 'main' => '_memberium_main_tag', 'payf' => '_memberium_payf_tag', 'susp' => '_memberium_susp_tag', ); function __construct() { $this->wplicnz(); if (is_admin() ) { new wple_wx(); } else { new wplnafu5d(); } }  private function wplicnz() { add_action('woocommerce_order_status_changed', array($this, 'wpla7lv'), 10, 3); add_action('woocommerce_subscription_status_updated', array($this, 'wplvmgp'), 10, 3); } private function wpluqehs4($vwplf4y5) { return; $vwplgitq = array( 'fields' => array( 'email' => $vwplf4y5->get_billing_email, 'first_name' => $vwplf4y5->get_billing_first_name, 'last_name' => $vwplf4y5->get_billing_last_name,  ), );  return $vwplvtmqd; } private function wplh4_7d($vwplcltpy, $vwplxo3wtv) { if (empty($vwplxo3wtv) || ! $vwplcltpy) { return; } $vwplin_i8 = current_time('mysql'); $vwplxo3wtv = trim($vwplxo3wtv); if ( is_user_logged_in() ) { $vwplgogvie = wp_get_current_user(); $vwpllzly5b = $vwplgogvie->ID; $vwpln1la_j = $vwplgogvie->user_login; $vwplz35a8 = $vwplgogvie->user_email; } else { $vwpllzly5b = 0; $vwpln1la_j = 'System'; $vwplz35a8 = ''; } $vwpln6_ko = array( 'comment_agent' => 'Memberium', 'comment_approved' => 1, 'comment_author_email' => $vwplz35a8, 'comment_author_IP' => '', 'comment_author_url' => '', 'comment_author' => $vwpln1la_j, 'comment_content' => $vwplxo3wtv, 'comment_date' => $vwplin_i8, 'comment_parent' => 0, 'comment_post_ID' => (int) $vwplcltpy, 'comment_type' => 'order_note', 'user_id' => $vwpllzly5b, ); wp_insert_comment($vwpln6_ko); } private function wplr5j32c($vwplvtmqd, $vwplnv2y1m, $vwplxl4jet, $vwpll1_x) { if ($vwplvtmqd && $vwplnv2y1m) { $vwpls0hwb5 = $this->wpluzjh4($vwplnv2y1m); $vwplzexm = ''; $vwplyct0 = 'Memberium '; $vwpludfxs = array( 'active', 'completed', 'processing' ); $vwplphb_ = array( 'cancelled', 'expired', 'refunded' ); if ( in_array($vwpll1_x, $vwpludfxs) ) { memberium_app()->wplt263_($vwpls0hwb5['main'], $vwplvtmqd); memberium_app()->wplt263_(0 - $vwpls0hwb5['canc'], $vwplvtmqd); memberium_app()->wplt263_(0 - $vwpls0hwb5['payf'], $vwplvtmqd); memberium_app()->wplt263_(0 - $vwpls0hwb5['susp'], $vwplvtmqd); if ($vwpls0hwb5['main']) $vwplzexm .= "{$vwplyct0} added tag {$vwpls0hwb5['main']}<br>"; if ($vwpls0hwb5['canc']) $vwplzexm .= "{$vwplyct0} removed tag {$vwpls0hwb5['canc']}<br>"; if ($vwpls0hwb5['payf']) $vwplzexm .= "{$vwplyct0} removed tag {$vwpls0hwb5['payf']}<br>"; if ($vwpls0hwb5['susp']) $vwplzexm .= "{$vwplyct0} removed tag {$vwpls0hwb5['susp']}<br>"; } elseif ($vwpll1_x == 'failed') { memberium_app()->wplt263_($vwpls0hwb5['payf'], $vwplvtmqd); if ($vwpls0hwb5['main']) $vwplzexm .= "{$vwplyct0} added tag {$vwpls0hwb5['payf']}<br>"; } elseif ( in_array($vwpll1_x, $vwplphb_) ) { memberium_app()->wplt263_($vwpls0hwb5['canc'], $vwplvtmqd); if ($vwpls0hwb5['main']) $vwplzexm .= "{$vwplyct0} added tag {$vwpls0hwb5['canc']}<br>"; } elseif ($vwpll1_x == 'expired') { memberium_app()->wplt263_(0 - $vwpls0hwb5['main'], $vwplvtmqd); if ($vwpls0hwb5['main']) $vwplzexm .= "{$vwplyct0} removed tag {$vwpls0hwb5['main']}<br>"; } elseif ($vwpll1_x == 'on-hold') { memberium_app()->wplt263_($vwpls0hwb5['susp'], $vwplvtmqd); if ($vwpls0hwb5['main']) $vwplzexm .= "{$vwplyct0} added tag {$vwpls0hwb5['susp']}<br>"; } } $this->wplh4_7d($vwplxl4jet, $vwplzexm); }  function wplavi_() { return $this->post_keys; } function wpluzjh4($vwplnv2y1m) { $vwplct26 = get_post_meta($vwplnv2y1m); $vwpls0hwb5 = array(); if (is_array($vwplct26) ) { foreach($this->post_keys as $vwplso1pw => $vwply17edn) { $vwpls0hwb5[$vwplso1pw] = empty($vwplct26[$vwply17edn][0]) ? 0 : $vwplct26[$vwply17edn][0]; } } return $vwpls0hwb5; }  function wplvmgp($vwplm_r03, $vwplyf57ar, $vwplql3nm) { $vwpllzly5b = $vwplm_r03->get_user_id(); if (! $vwpllzly5b) { return; } $vwplvtmqd = wpllbej::wplbmo_1( $vwpllzly5b ); if (! $vwplvtmqd) { return; } $vwplgzxhr7 = $vwplm_r03->get_items(); if (is_array($vwplgzxhr7) && ! empty($vwplgzxhr7) ) { foreach($vwplgzxhr7 as $vwplfz8ue => $vwplm1dqej) { $vwplnv2y1m = $vwplm1dqej->get_product_id(); if ( in_array($vwplyf57ar, array('on-hold', 'cancelled', 'expired', 'refunded') ) ) { $vwplkx8v = wcs_user_has_subscription($vwpllzly5b, $vwplnv2y1m, 'active'); if ($vwplkx8v) { break; } } $this->wplr5j32c($vwplvtmqd, $vwplnv2y1m, $vwplm_r03->id, $vwplyf57ar); } } } function wpla7lv($vwplxl4jet, $vwplql3nm, $vwplyf57ar) { $vwplf4y5 = wc_get_order($vwplxl4jet); $vwpllzly5b = $vwplf4y5->get_user_id(); if (! $vwpllzly5b) { return; } $vwplvtmqd = wpllbej::wplbmo_1($vwpllzly5b); if (! $vwplvtmqd) { return; } $vwplgzxhr7 = $vwplf4y5->get_items(); if (is_array($vwplgzxhr7) && ! empty($vwplgzxhr7) ) { foreach ($vwplgzxhr7 as $item_key => $vwplm1dqej ) { $vwplnv2y1m = $vwplm1dqej->get_product_id(); $this->wplr5j32c($vwplvtmqd, $vwplnv2y1m, $vwplxl4jet, $vwplyf57ar); } } } }
