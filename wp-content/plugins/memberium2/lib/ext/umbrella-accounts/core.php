<?php
/**
 * Copyright (c) 2012-2020 David J Bullock
 * Web Power and Light
 */

 if (! defined( 'ABSPATH' ) ) { die(); } return new wplul1_fc; final class wplul1_fc { private $version = '2.4'; private $core;  private $add_child_actionset = 0;  private $child_cancel_actionset = 0;  private $parent_added_actionset = 0;  private $child_field = 'ReferralCode';  private $inherited_fields = '';  private $max_child_accounts = 10;  private $max_child_field = '';  private $parent_cache_ttl = 86400;  private $parent_field = 'ReferralCode'; private $settings = array();  private $tag_mask = '';  private $tag_mask_field = '';  private $tag_translation = array();  private $enabled = false; private $doing_raw_load = false; function __construct() { $this->settings = $this->wplarowq(); if ( empty( $this->settings['enabled'] ) ) { return; } $this->wplicnz(); $this->wploj43(); } private function wplicnz() { add_action('learndash_quiz_completed', array( $this, 'learndash_quiz_email_notifications' ), 5, 1 ); add_action('memberium_email_change', array( $this, 'wplqy_riz' ) ); add_filter('learndash_get_report_user_ids', array( $this, 'wplhkjtci' ), 10, 1 ); add_filter('memberium_contact_load', array( $this, 'wplw4oi0' ), 10, 1 ); add_filter('memberium/umbrella/child_contact_ids', array( $this, 'wplqghwq' ), 10, 1 ); add_filter('memberium/umbrella/child_wpuser_ids', array( $this, 'wplx_rjl' ), 10, 1 ); add_filter('memberium/umbrella/child_count', array( $this, 'wplz_40w' ), 10, 1 ); add_filter('memberium/umbrella/parent_wpuser_id', array( $this, 'wpleh7s5j' ), 10, 1 ); if ( defined( 'DOING_CRON' ) ) { add_action('memberium_maintenance12', array( $this, 'wplyfoq_5' ) ); } } function wplyo16nv() { return $this->version; } function wplarowq() { $this->settings = get_option('memberium_umbrella_settings', array() ); $vwplsb_pf = array( 'add_child_actionset' => 0, 'child_cancel_actionset' => 0, 'child_field' => 'ReferralCode', 'ecommerce' => 1, 'inherited_fields' => '', 'ld_quiz_notify_parent' => 0, 'max_child_accounts' => 10, 'parent_added_actionset' => 0, 'parent_cache_ttl' => 86400, 'parent_field' => 'ReferralCode', 'parent_tags' => '', 'tag_mask' => '', 'tag_mask_field' => '', 'tag_translation' => array(), ); $this->settings = wp_parse_args( $this->settings, $vwplsb_pf ); foreach( $this->settings as $vwply17edn => $vwplph268z ) { $this->$vwply17edn = $this->settings[$vwply17edn]; } return $this->settings; } function wpla_iysg( $vwplelob86 = false ) { if ( $vwplelob86 === false ) { $vwplelob86 = $this->settings; } update_option( 'memberium_umbrella_settings', $vwplelob86, 'yes' ); }  function wpln9dn_k( $vwpls0hwb5 = '' ) { $this->tag_mask = trim( $vwpls0hwb5 ); $this->settings['tag_mask'] = $this->tag_mask; } function wplan0g( $vwplui_mye = '' ) { $this->tag_mask_field = $vwplui_mye; $this->settings['tag_mask_field'] = $this->tag_mask_field; } function wplhc9zr( $vwplm_4wlh = 86400 ) { $this->parent_cache_ttl = (int) $vwplm_4wlh; $this->settings['parent_cache_ttl'] = $this->parent_cache_ttl; } function wplt_9vrm( $vwpl_s6l = 'Email' ) { $this->child_field = $vwpl_s6l; $this->settings['child_field'] = $this->child_field; } function wpltnxw6( $vwple2yn, $vwpldtnh = true ) { if ( $vwpldtnh === null ) { unset( $this->inherited_fields[$vwple2yn] ); } else { $this->inherited_fields[$vwple2yn] = (boolean) $vwpldtnh; } $this->settings['inherited_fields'] = $this->inherited_fields; } function wploav0( $vwplc51l = 0, $vwplcs_vo5 = 0 ) { if ( ! $vwplc51l && ! $vwplcs_vo5 ) { return; } if ( $vwplcs_vo5 == 0 ) { unset( $this->tag_translation[$vwplc51l] ); } if ( $vwplcs_vo5 > 0 ) { $this->tag_translation[$vwplc51l] = $vwplcs_vo5; } $this->settings['tag_translation'] = $this->tag_translation; } function wplek_yi( $vwpllu186s = 'Email3' ) { $this->parent_field = $vwpllu186s; $this->settings['parent_field'] = $this->parent_field; } function wpla_by( $vwplj6iv7z ) { $vwplj6iv7z = (int) $vwplj6iv7z; $this->add_child_actionset = (int) $vwplj6iv7z; $this->settings['add_child_actionset'] = $this->add_child_actionset; } function wply6qyrt( $vwplj6iv7z ) { $vwplj6iv7z = (int) $vwplj6iv7z; $this->parent_added_actionset = (int) $vwplj6iv7z; $this->settings['parent_added_actionset'] = $this->parent_added_actionset; } function wplqr54hi( $vwplj6iv7z ) { $vwplj6iv7z = (int) $vwplj6iv7z; $this->child_cancel_actionset = (int) $vwplj6iv7z; $this->settings['child_cancel_actionset'] = $this->child_cancel_actionset; }  function wplhcri() { return $this->settings['tag_mask']; } function wpln70k2() { return $this->settings['parent_cache_ttl']; } function wplufva8y() { return $this->settings['tag_mask_field']; } function wplvjcn4() { return $this->settings['parent_field']; } function wpls2tms1() { return $this->settings['child_field']; } function wplcsvoe() {  $vwpltidk1 = (int) $this->settings['max_child_accounts'];  if ( ! empty( $this->settings['child_count_add'] ) ) { $vwply17edn = strtolower( $this->settings['child_count_add'] ); $vwpltidk1 = $vwpltidk1 + (int) wplsbzgvp::wplc4na( $vwply17edn ); }  if ( ! empty( $this->settings['tag_grants'] ) ) { foreach( $this->settings['tag_grants'] as $vwplqxosl => $vwplph268z ) { if ( wplj_l2t::wpl_n2s9( $vwplqxosl ) ) { $vwpltidk1 = $vwpltidk1 + $vwplph268z; } } }  if ( $this->settings['ecommerce'] ) { $vwplurqb3 = memberium_app()->wpljkrho(); if ( ! empty( $vwplurqb3 ) ) { $vwplpamo = date('Ymd') . 'T23:59:59'; foreach( $vwplurqb3 as $vwplm_r03 ) { $vwplm_r03['EndDate'] = isset($vwplm_r03['EndDate']) ? $vwplm_r03['EndDate'] : ''; $vwplm_r03['Active'] = isset($vwplm_r03['Active']) ? $vwplm_r03['Active'] : ''; if ($vwplm_r03['Status'] == 'Active' || $vwplm_r03['EndDate'] > $vwplpamo) { $vwplpqxz = $vwplm_r03['SubscriptionPlanId']; $vwpltidk1 = $vwpltidk1 + ( empty( $this->settings['subscriptions'][$vwplpqxz] ) ? 0 : ($this->settings['subscriptions'][$vwplpqxz] * $vwplm_r03['Qty']) ); } } } }  $vwpltidk1 = apply_filters( 'umbrella_child_count', $vwpltidk1 ); return $vwpltidk1; } function wplrojdi() { return $this->settings['add_child_actionset']; } function wplbf8h7z() { return $this->settings['parent_added_actionset']; } function wplqot3yp() { return $this->settings['child_cancel_actionset']; }    function wploj43() { if ( wp_doing_ajax() || ! is_admin() ) { add_shortcode('umbrella_list_children', array( $this, 'wplc3my' ) ); add_shortcode('umbrella_child_count', array( $this, 'wplms68a' ) ); add_shortcode('umbrella_enroll_child', array( $this, 'wpliyd87m' ) ); add_shortcode('umbrella_list_children_nav', array( $this, 'wplmxg7r' ) ); add_shortcode('umbrella_ld_course_info', array( $this, 'wplsykbq' ) ); add_shortcode('umbrella_lms_dashboard', array($this, 'wplvw_o4n') ); add_shortcode('umbrella_transfer_points', array($this, 'wplasq5') ); add_shortcode('umbrella_download_csv', array($this, 'wplj3z9') ); if ( isset( $_POST['formtype'] ) && $_POST['formtype'] == 'childenroll' ) { $this->wpljuv30(); } elseif ( isset( $_POST['formtype'] ) && $_POST['formtype'] == 'childdisconnect' ) { $this->wplgaud(); } elseif (! empty($_POST['umbrella_transfer_points_wpnonce']) ) { $this->wplx_pad(); } elseif (! empty($_POST['umbrella_download_csv_wpnonce']) ) { $this->wplnk54(); } } } function wplyfoq_5() { }    function wplhkjtci( $vwplzpsdz ) { $vwpl_54etd = $this->wplx_rjl(); $vwplzpsdz = array_merge( $vwplzpsdz, $vwpl_54etd ); return $vwplzpsdz; } function wplw4oi0( $vwplrp9u24 = array() ) { if ( empty( $vwplrp9u24 ) ) { return $vwplrp9u24; } if ( $this->doing_raw_load ) { return $vwplrp9u24; } global $i2sdk; $this->settings = $this->wplarowq(); $vwplj1_sg = $this->wplvjcn4(); $vwplghdys = $this->wpls2tms1(); $vwplaelawb = $this->wplufva8y(); $vwplu8viy = ! empty( $vwplrp9u24[$vwplghdys] ) ? $vwplrp9u24[$vwplghdys] : ''; $vwplc0nobe['memb_db_fields']['groups'] = isset( $vwplrp9u24['Groups'] ) ? $vwplrp9u24['Groups'] : '';  if ( empty( $vwplu8viy ) && wplj_l2t::wpl_n2s9( $this->settings['parent_tags'], $vwplc0nobe ) ) { if ( ! in_array( $vwplj1_sg, array( 'Email', 'EmailAddress2', 'EmailAddress3' ) ) ) { $vwplrp9u24[$vwplj1_sg] = $this->wplpg5h(); $vwplmu62n = array( $vwplj1_sg => $vwplrp9u24[$vwplj1_sg] ); if ( ! empty( $vwplrp9u24['Id'] ) ) { $i2sdk->isdk->updateCon( (int) $vwplrp9u24['Id'], $vwplmu62n );  $vwple_q4 = $this->doing_raw_load; $this->doing_raw_load = true; memberium_app()->wplj9ye( $vwplrp9u24['Id'] ); $this->doing_raw_load = $vwple_q4; } } return $vwplrp9u24; }  if ( empty( $vwplrp9u24[$vwplghdys] ) ) { return $vwplrp9u24; }  if ( wplj_l2t::wpl_n2s9( $this->settings['parent_tags'], $vwplc0nobe ) ) { return $vwplrp9u24; } if ( empty( $vwplu8viy ) ) { return $vwplrp9u24; } if ( ! empty( $vwplu8viy ) ) { $vwplgitq = array( 'parent_id' => $vwplu8viy, 'contact_id' => $vwplrp9u24['Id'], 'contact' => $vwplrp9u24, ); $vwplqlnf = $this->wplltv2( $vwplgitq ); if ( $vwplqlnf > 0 ) { $vwplgitq = array( 'contact_id' => $vwplqlnf, 'cache_ttl' => $this->wpln70k2() ); memberium_app()->wplf68fx( $vwplgitq ); $vwplrp9u24['!parent_id'] = $vwplqlnf; $this->doing_raw_load = true; $vwplrm30 = wpllbej::wplrande( $vwplqlnf ); $this->doing_raw_load = false; $vwplniem = explode( ',', $this->settings['parent_tags'] ); $vwplhul6 = isset( $vwplrm30['Groups'] ) ? array_filter( explode( ',', $vwplrm30['Groups'] ) ) : array(); $vwplkb4iek = isset( $vwplrm30[$vwplaelawb] ) ? array_filter( explode( ',', $vwplrm30[$vwplaelawb] ) ) : array(); $vwplhjadhc = array_filter( explode( ',', $this->wplhcri() ) ); $vwplkqz3a = $this->settings['tag_translation']; $vwplygv_ = isset( $this->settings['whitelist_memberships'] ) ? explode( ',', $this->settings['whitelist_memberships'] ) : array(); $vwplhul6 = array_diff( $vwplhul6, $vwplniem );   if ( ! empty( $this->settings['tag_whitelist'] ) || ! empty( $this->settings['whitelist_memberships'] ) ) { $vwplygv_ = array_filter( explode( ',', $this->settings['tag_whitelist'] ) ); if ( ! empty( $this->settings['whitelist_memberships'] ) ) { $vwplgxrbm = wplz8bid::wplvf1d(); $vwplgxrbm = $vwplgxrbm['memberships']; foreach( $vwplgxrbm as $vwplbquy ) { $vwplygv_[] = (int) $vwplbquy['main_id']; $vwplygv_[] = (int) $vwplbquy['addltag_ids']; $vwplygv_[] = (int) $vwplbquy['payf_id']; $vwplygv_[] = (int) $vwplbquy['cancel_id']; $vwplygv_[] = (int) $vwplbquy['suspend_id']; } unset( $vwplgxrbm, $vwplbquy ); $vwplygv_ = array_filter( $vwplygv_ ); } $vwplhul6 = array_intersect( $vwplhul6, $vwplygv_ ); } else {   $vwplhul6 = array_diff( $vwplhul6, $vwplhjadhc, $vwplkb4iek ); }  if ( is_array( $vwplkqz3a ) ) { foreach( $vwplkqz3a as $vwplsrzyp => $vwplz4uke ) { $vwply17edn = array_search( $vwplsrzyp, $vwplhul6 ); if ( $vwply17edn !== false ) { $vwplhul6[$vwply17edn] = $vwplz4uke; } } } $vwplrp9u24['Groups'] = implode( ',', array_unique( array_filter( array_merge( explode( ',', $vwplrp9u24['Groups'] ), $vwplhul6 ) ) ) ); $vwplq_30j = array_filter( explode( ',', $this->inherited_fields ) );  if ( ! empty( $vwplq_30j ) ) { foreach( $vwplq_30j as $vwple2yn ) { if ( empty( $vwplrp9u24[$vwple2yn] ) ) { $vwplrp9u24[$vwple2yn] = $vwplrm30[$vwple2yn]; } } } } } return $vwplrp9u24; } function wplqy_riz( $vwplvtmqd = 0, $vwpllzly5b = 0, $vwpltm3g_ = '', $vwplz4izhe = '' ) { $vwplmnem = $this->wpls2tms1(); $lparent_field = strtolower( $this->wplvjcn4() ); if ( ! in_array( $lparent_field, array( 'email', 'emailaddress2', 'emailaddress3' ) ) ) { return; } if ( empty( $vwpltm3g_ ) || empty( $vwplz4izhe ) ) { return; } $vwplgitq = array( $vwplmnem => $vwpltm3g_ ); $vwplj9dl = $this->wplqghwq( $vwplgitq ); if ( is_array( $vwplj9dl ) && ! empty( $vwplj9dl ) ) { foreach( $vwplj9dl as $vwplvtmqd ) { $vwplmu62n = array( $vwplmnem => $vwplz4izhe, ); $i2sdk->isdk->updateCon( $vwplvtmqd, $vwplmu62n );  } } }    function wplpg5h() { return uniqid( 'prnt-', true ); } function wplltv2( $vwplgitq = array() ) { global $i2sdk, $wpdb; if ( empty( $vwplgitq['contact_id'] ) ) { return false; } $vwplrp9u24 = empty( $vwplgitq['contact'] ) ? array() : $vwplgitq['contact']; $vwplvtmqd = empty( $vwplgitq['contact_id'] ) ? 0 : $vwplgitq['contact_id']; $vwplqlnf = empty( $vwplgitq['parent_id'] ) ? 0 : $vwplgitq['parent_id']; $vwplji1ez = $this->settings['child_field']; $vwplcwd0xb = explode( ',', $this->settings['parent_tags'] ); $vwplxm1e = false; if ( empty( $vwplrp9u24[$vwplji1ez] ) ) { return false; } $vwplsb_pf = array( 'appname' => wplz8bid::wplm3z9k('appname'), 'contact_id' => isset( $vwplrp9u24['Id'] ) ? $vwplrp9u24['Id'] : 0, 'child_field' => $this->settings['child_field'], 'parent_id' => isset( $vwplrp9u24[$vwplji1ez] ) ? $vwplrp9u24[$vwplji1ez] : '', ); $vwplgitq = wp_parse_args( $vwplgitq, $vwplsb_pf ); $vwplgitq['parent_id'] = $this->wpls4l_q( $vwplgitq['parent_id'], 'parent' ); $vwplnzlj0t = MEMBERIUM_DB_CONTACTS; $vwplx1ap5_ = "SELECT `c1`.`id`, `c2`.`value` as `tags` FROM `{$vwplnzlj0t}` AS `c1`, `{$vwplnzlj0t}` AS `c2` WHERE `c1`.`appname` = %s AND `c1`.`fieldname` = %s AND `c1`.`value` = %s AND `c1`.`id` <> %d AND `c2`.`id` = `c1`.`id` AND `c2`.`fieldname` = 'Groups' ORDER BY `c1`.`id`; "; $vwplx1ap5_ = $wpdb->prepare( $vwplx1ap5_, $vwplgitq['appname'], $vwplgitq['child_field'], $vwplgitq['parent_id'], $vwplgitq['contact_id'] ); $vwplrm30 = $wpdb->get_row( $vwplx1ap5_ ); $vwpls0hwb5 = explode( ',', $vwplrm30->tags ); if ( array_intersect( $vwplcwd0xb, $vwpls0hwb5 ) ) { $vwplxm1e = $vwplrm30->id; } return $vwplxm1e; } function wplz_40w( $vwplgitq = array() ) { global $i2sdk, $wpdb; $vwplw5rgd3 = wplz8bid::wplm3z9k('appname'); $vwplmnem = $this->settings['child_field']; $vwplm2hi = wplsbzgvp::wplfhxj9(); $vwplqb5a = strtolower( $this->settings['parent_field'] ); $vwplvtmqd = isset( $vwplgitq['contact_id'] ) ? $vwplgitq['contact_id'] : $vwplm2hi; $vwplqlnf = memberium_app()->wplvyjh( $vwplvtmqd, $vwplmnem ); $vwplsfk1bd = MEMBERIUM_DB_CONTACTS; $vwplsb_pf = array( 'appname' => $vwplw5rgd3, 'child_field' => $vwplmnem, 'contact_id' => $vwplvtmqd, 'limit' => 0, 'offset' => 0, 'parent_id' => $vwplqlnf, ); $vwplgitq = wp_parse_args( $vwplgitq, $vwplsb_pf ); if ( $vwplgitq['parent_id'] <> $this->wpls4l_q( $vwplgitq['parent_id'], 'parent' ) ) { return array(); } $vwplgitq['parent_id'] = $this->wpls4l_q( $vwplgitq['parent_id'], 'child' ); $vwplx1ap5_ = "SELECT count(*) FROM `{$vwplsfk1bd}` WHERE `appname` = %s AND `fieldname` = %s AND `value` = %s AND `id` <> %d "; $vwplx1ap5_ = $wpdb->prepare( $vwplx1ap5_, $vwplgitq['appname'], $vwplgitq['child_field'], $vwplgitq['parent_id'], $vwplgitq['contact_id'] ); $vwpltidk1 = $wpdb->get_var( $vwplx1ap5_ ); return $vwpltidk1; } function wpleh7s5j($vwplgitq = array() ) { $vwplsb_pf = array( 'user_id' => get_current_user_id(), ); $vwplgitq = wp_parse_args($vwplgitq, $vwplsb_pf); if ( memberium_app()->wpllxp79n($vwplgitq['user_id'])) { return isset($_SESSION['memb_db_fields']['!parent_id']) ? $_SESSION['memb_db_fields']['!parent_id'] : 0; } } function wplqghwq( $vwplgitq = array() ) { global $i2sdk, $wpdb; $vwplw5rgd3 = wplz8bid::wplm3z9k('appname'); $vwplmnem = $this->settings['child_field']; $vwplm2hi = wplsbzgvp::wplfhxj9(); $vwplqb5a = strtolower( $this->settings['parent_field'] ); $vwplvtmqd = isset( $vwplgitq['contact_id'] ) ? $vwplgitq['contact_id'] : $vwplm2hi; $vwplqlnf = memberium_app()->wplvyjh( $vwplvtmqd, $vwplmnem ); $vwplsfk1bd = MEMBERIUM_DB_CONTACTS; $vwplsb_pf = array( 'appname' => $vwplw5rgd3, 'child_field' => $vwplmnem, 'contact_id' => $vwplvtmqd, 'limit' => 0, 'offset' => 0, 'parent_id' => $vwplqlnf, ); $vwplgitq = wp_parse_args( $vwplgitq, $vwplsb_pf ); if ( $vwplgitq['parent_id'] <> $this->wpls4l_q( $vwplgitq['parent_id'], 'parent' ) ) { return array(); } $vwplgitq['parent_id'] = $this->wpls4l_q( $vwplgitq['parent_id'], 'child' ); $vwplp8cs = ( $vwplgitq['limit'] > 0 ) ? " LIMIT {$vwplgitq['limit']} OFFSET {$vwplgitq['offset']} " : ''; $vwplx1ap5_ = "
			SELECT `c1`.`id`
			FROM `{$vwplsfk1bd}` AS `c1`
			LEFT JOIN `{$vwplsfk1bd}` AS `c2`
			ON ( `c2`.`id` = `c1`.`id` AND `c2`.`appname` = %s AND `c2`.`fieldname` = 'LastName' )
			LEFT JOIN `{$vwplsfk1bd}` AS `c3`
			ON ( `c3`.`id` = `c1`.`id` AND `c3`.`appname` = %s AND `c3`.`fieldname` = 'FirstName' )
			WHERE `c1`.`appname` = %s
			AND `c1`.`fieldname` = %s
			AND `c1`.`value` = %s
			AND `c1`.`id` <> %d
			ORDER BY `c2`.`value`, `c3`.`value`, `c1`.`id` ASC
			{$vwplp8cs}
		"; $vwplx1ap5_ = $wpdb->prepare( $vwplx1ap5_, $vwplgitq['appname'], $vwplgitq['appname'], $vwplgitq['appname'], $vwplgitq['child_field'], $vwplgitq['parent_id'], $vwplgitq['contact_id'] ); $vwplj9dl = $wpdb->get_col( $vwplx1ap5_ ); return $vwplj9dl; } function wplx_rjl( $vwplgitq = array() ) { $vwplj9dl = $this->wplqghwq( $vwplgitq ); if ( empty( $vwplj9dl ) ) { return array(); } $wp_user_ids = array(); foreach( $vwplj9dl as $vwplvtmqd ) { $vwpllzly5b = wpllbej::wplsgpnk( $vwplvtmqd ); if ( $vwpllzly5b ) { $wp_user_ids[] = $vwpllzly5b; } } return $wp_user_ids; } function wplh61b74() { $vwplj9dl = $this->wplqghwq(); return (int) count( $vwplj9dl ); }   function wplxsnu8( $vwplgitq = array() ) { global $i2sdk, $wpdb; $vwplsb_pf = array( 'child_contact' => array(), 'wpleh1zcw' => true, 'optin' => true, 'parent_contact_id' => 0, 'parent_contact' => array(), ); $vwplgitq = wp_parse_args( $vwplgitq, $vwplsb_pf );   if ( $vwplgitq['parent_contact_id'] ) { $vwplgitq['parent_contact'] = wpllbej::wplrande( $vwplgitq['parent_contact_id'] ); }  if ( $vwplgitq['child_contact_id'] ) { $vwplgitq['child_contact'] = wpllbej::wplrande( $vwplgitq['child_contact_id'] ); } if ( empty( $vwplgitq['child_contact'] ) || empty( $vwplgitq['parent_contact'] ) ) { return -1; }  $vwpllu186s = $this->wplvjcn4(); $vwplo6pd = isset( $vwplgitq['parent_contact'][$vwpllu186s] ) ? $vwplgitq['parent_contact'][$vwpllu186s] : ''; if ( empty( $vwplo6pd ) ) { return -2; }  $vwplmnem = $this->wpls2tms1(); if ( ! empty( $vwplgitq['child_contact'][$vwplmnem] ) ) { return -3; }  $vwplnkj9d_ = wplz8bid::wplvf1d(); $vwplup7mi = isset( $vwplnkj9d_['settings']['password_field']) ? $vwplnkj9d_['settings']['password_field'] : ''; if ( $vwplgitq['wpleh1zcw'] && empty( $vwplgitq['child_contact'][$vwplup7mi] ) ) { $vwplgitq['child_contact'][$vwplup7mi] = memberium_app()->wpleh1zcw(); }  if ( empty( $vwplgitq['child_contact']['Id'] ) && ! empty( $vwplgitq['child_contact_id']['Email'] ) ) { $vwplmu62n = $vwplgitq['child_contact']; $vwplmu62n[$vwplmnem] = $this->wpls4l_q( $vwplo6pd, 'child' ); $vwplmn6cg = (int) $i2sdk->isdk->addWithDupCheck( $vwplmu62n, 'Email' ); if ( $vwplmn6cg ) { $vwplgitq = array( 'contact_id' => $vwplmn6cg, 'cache_ttl' => 0 ); memberium_app()->wplf68fx( $vwplgitq ); $vwplgitq['child_contact_id'] = $vwplmn6cg; $vwplgitq['child_contact']['Id'] = $vwplmn6cg; if ( $vwplgitq['optin'] ) { $i2sdk->isdk->optin( $vwplgitq['child_contact']['Email'], 'Added by Memberium Umbrella Account System' ); } $i2sdk->isdk->runAS( (int) $vwplmn6cg, (int) $this->settings['add_child_actionset'] ); $i2sdk->isdk->runAS( (int) $vwplgitq['parent_contact_id'], (int) $this->settings['parent_added_actionset'] ); return $vwplmn6cg; } } } function wpls4l_q( $vwpluvdiz = '', $vwplsfdb_t = 'raw' ) { if ( ! in_array( substr( $vwpluvdiz, 0, 5 ), array( 'chld-', 'prnt-' ) ) ) { $vwplsfdb_t = 'raw'; } $vwplsfdb_t = strtolower( trim( $vwplsfdb_t ) ); if ( $vwplsfdb_t == 'parent' ) { return 'prnt-' . substr( $vwpluvdiz, 5 ); } elseif ( $vwplsfdb_t == 'child' ) { return 'chld-' . substr( $vwpluvdiz, 5 ); } else { return $vwpluvdiz; } }    function wplmxg7r( $vwplvpexdn, $vwplckl3 = null, $vwpluvdiz ) { if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplsb_pf = array( 'limit' => isset( $_GET['limit'] ) ? (int) $_GET['limit'] : 0, 'page' => isset( $_GET['pg'] ) ? (int) $_GET['pg'] : 1, 'parent_id' => wplsbzgvp::wplfhxj9(), ); $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); if ( $vwplvpexdn['limit'] == 0 ) { return; } $vwplvpexdn['count'] = $this->wplz_40w(); $vwplvpexdn['page'] = $vwplvpexdn['page'] < 1 ? 1 : $vwplvpexdn['page']; $vwpldqjgk = $vwplvpexdn['count'] > 0 ? (int) ceil( $vwplvpexdn['count'] / $vwplvpexdn['limit'] ) : 1; if ( $vwpldqjgk < 2 ) { return; } $vwplvpexdn['page'] = ( $vwplvpexdn['page'] < 1 ) ? 1 : $vwplvpexdn['page']; $vwpltlkdcw = '<div class="memberium_umbrella_nav" style="width:100%;">'; if ( $vwplvpexdn['page'] > 1 ) { $vwpltlkdcw .= '<span class="memberium_umbrella_nav_previous" style="margin-left:30px;margin-right:30px;"><a href="' . add_query_arg( 'pg', ( $vwplvpexdn['page'] - 1) ) . '">&lt;Previous&gt;</a></span>'; } $vwpltlkdcw .= '<span class="">Page ' . ( $vwplvpexdn['page'] ) . ' of ' . ( $vwpldqjgk ) . '</span>'; if ( $vwplvpexdn['page'] < $vwpldqjgk ) { $vwpltlkdcw .= '<span class="memberium_umbrella_nav_next" style="margin-left:30px;margin-right:30px;"><a href="' . add_query_arg( 'pg', ( $vwplvpexdn['page'] + 1 ) ) . '">&lt;Next&gt;</a></span>'; } $vwpltlkdcw .= '</div>'; return $vwpltlkdcw; } function wplc3my( $vwplvpexdn, $vwplckl3 = null, $vwpluvdiz ) { if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplsb_pf = array( 'can_disconnect' => 'y', 'limit' => isset( $_GET['limit'] ) ? (int) $_GET['limit'] : 0, 'page' => isset( $_GET['pg'] ) ? (int) $_GET['pg'] : 1, 'parent_id' => wplsbzgvp::wplfhxj9(), ); $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); $vwplvpexdn['can_disconnect'] = wplczvi98::wplbyhn( $vwplvpexdn['can_disconnect'], true ); $vwplvpexdn['page'] = ( $vwplvpexdn['page'] > 0 ) ? $vwplvpexdn['page'] : 1; $vwplvpexdn['page'] = ( $vwplvpexdn['page'] < 1 ) ? 1 : $vwplvpexdn['page']; $vwplvpexdn['parent_id'] = (int) $vwplvpexdn['parent_id']; if ( empty($vwplvpexdn['parent_id']) ) { return; } $vwplea8r7 = ( $vwplvpexdn['page'] - 1 ) * $vwplvpexdn['limit']; if ( $vwplvpexdn['limit'] ) { $vwplgitq = array( 'contact_id' => $vwplvpexdn['parent_id'], 'limit' => $vwplvpexdn['limit'], 'offset' => $vwplea8r7 ) ; $vwplj9dl = $this->wplqghwq( $vwplgitq ); } else { $vwplj9dl = $this->wplqghwq(); } $count = count( $vwplj9dl ); $vwpltlkdcw = ''; if ( ! empty( $vwplckl3 ) ) { foreach( $vwplj9dl as $vwplvtmqd ) { $vwplzxhjbg = $vwplckl3; $vwpldg7vd = '<form method="post">'; $vwpldg7vd .= '<input type="hidden" name="formtype" value="childdisconnect">'; $vwpldg7vd .= '<input type="hidden" name="contact_id" value="' . $vwplvtmqd . '">'; $vwpldg7vd .= '<input type="hidden" name="signature" value="' . md5( 'mmm' . $vwplvtmqd ) . '">'; $vwpldg7vd .= '<input type="submit" value="Disconnect">'; $vwpldg7vd .= '</form>'; $vwplzxhjbg = str_ireplace( '%%contact.id%%', $vwplvtmqd, $vwplzxhjbg ); $vwplzxhjbg = str_ireplace( '{{contact.id}}', $vwplvtmqd, $vwplzxhjbg ); $vwplzxhjbg = str_ireplace( '%%disconnect.button%%', $vwpldg7vd, $vwplzxhjbg ); $vwpltlkdcw .= $vwplzxhjbg; } $vwpltlkdcw = do_shortcode( $vwpltlkdcw ); } else { $vwpltlkdcw = "<table style='width:100%;'>"; $vwpltlkdcw .= "<tr>"; $vwpltlkdcw .= '<td>First Name</td>'; $vwpltlkdcw .= '<td>Last Name</td>'; $vwpltlkdcw .= '<td>Email</td>'; $vwpltlkdcw .= '<td>Mobile Phone</td>'; $vwpltlkdcw .= '<td</td>'; $vwpltlkdcw .= "</tr>"; if ( count( $vwplj9dl ) ) { foreach( $vwplj9dl as $vwplvtmqd ) { $vwplrp9u24 = wpllbej::wplrande( $vwplvtmqd ); $vwpltlkdcw .= '<tr>'; $vwpltlkdcw .= '<td>' . $vwplrp9u24['FirstName'] . '</td>'; $vwpltlkdcw .= '<td>' . $vwplrp9u24['LastName'] . '</td>'; $vwpltlkdcw .= '<td><a href="mailto:' . $vwplrp9u24['Email'] . '">' . $vwplrp9u24['Email'] . '</a></td>'; $vwpltlkdcw .= '<td>' . $vwplrp9u24['Phone3'] . '</td>'; $vwpltlkdcw .= '<td>'; if ( $vwplvpexdn['can_disconnect'] ) { $vwpltlkdcw .= '<form method="post">'; $vwpltlkdcw .= '<input type="hidden" name="formtype" value="childdisconnect">'; $vwpltlkdcw .= '<input type="hidden" name="contact_id" value="' . $vwplrp9u24['Id'] . '">'; $vwpltlkdcw .= '<input type="hidden" name="signature" value="' . md5( 'mmm' . $vwplrp9u24['Id'] ) . '">'; $vwpltlkdcw .= '<input type="submit" value="Disconnect">'; $vwpltlkdcw .= '</form>'; } $vwpltlkdcw .= '</td>'; $vwpltlkdcw .= '</tr>'; } } else { } $vwpltlkdcw .= "</table>"; } return $vwpltlkdcw; } function wplgaud() { $vwplmn6cg = (int) $_POST['contact_id']; if ( md5( 'mmm' . $vwplmn6cg ) <> $_POST['signature'] ) { return; } global $i2sdk, $memb_messages; $vwplmu62n = array( $this->wpls2tms1() => '', ); $i2sdk->isdk->updateCon( (int) $vwplmn6cg, $vwplmu62n );  $i2sdk->isdk->runAS( (int) $vwplmn6cg, (int) $this->wplqot3yp() ); memberium_app()->wplj9ye( $vwplmn6cg ); $memb_messages['flash']['create_child_result'] = '<p style="color:green;font-weight:bold;">' . _x( 'Child Account removed.', 'umbrella_list_children', 'memberium' ) . '</p>'; } function wplms68a( $vwplvpexdn, $vwplckl3 = null, $vwpluvdiz ) { if ( is_super_admin() ) { return; } if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplnur9p3 = $this->wplh61b74(); $vwplapwgk1 = $this->wplcsvoe(); if ( empty( $vwplvpexdn ) ) { return $vwplnur9p3 . ' ' . _x( 'of', 'umbrella_child_count', 'memberium' ) . ' ' . $vwplapwgk1; } $vwplsb_pf = array( 'cancel_text' => 'Cancel', 'confirm_button' => 'Yes, Stop Subscription', 'confirm_cancel' => 'Keep Subscription', 'confirm_title' => 'Cancel Subscription?', 'confirm' => 0, 'date_format' => 'M d, Y', 'jqueryui' => 1, 'onlyids' => '', 'orderby' => 'StartDate', 'sort' => 'a',  'status' => 'all',  ); $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); } function wpliyd87m( $vwplvpexdn, $vwplckl3 = null, $vwpluvdiz ) { global $memb_messages; if ( is_super_admin() ) { return; } if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwpltlkdcw = ''; $vwpltidk1 = $this->wplh61b74(); if ( $vwpltidk1 >= $this->wplcsvoe() ) { return '<p style="subacct_maxed">' . _x( 'All sub accounts Are Assigned.', 'umbrella_enroll_child', 'memberium' ) . '</p>' ; } $vwplsb_pf = array( 'button_text' => 'Add Account', 'form_id' => '', ); foreach($vwplvpexdn as $vwplyq9i7o => $vwplcjpa) { if (! array_key_exists($vwplyq9i7o, $vwplsb_pf) ) { $vwplsb_pf[$vwplyq9i7o] = $vwplcjpa; } } $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); $vwplr25oub = array(); $vwploh26c = '<select name="actions">'; if ( is_array( $vwplvpexdn ) ) { foreach( $vwplvpexdn as $vwply17edn => $vwplph268z ) { $vwply17edn = substr( $vwply17edn, 1 ); if ( $vwply17edn > 0 || $vwply17edn === '0' ) { $vwploh26c .= '<option value="' . $vwply17edn . '">' . $vwplph268z . '</option>'; $vwplz1bp7[] = $vwply17edn; } } } $vwploh26c .= '</select>'; $vwplr25oub = is_array( $vwplz1bp7 ) ? implode( ',', $vwplz1bp7 ) : ''; if ( empty( $vwplz1bp7 ) ) { $vwploh26c .= ''; } if ( ! empty( $vwplckl3 ) ) { $vwplckl3 = str_ireplace( '%%action.dropdown%%', $vwploh26c, $vwplckl3 ); } $vwplg6lz4 = base64_encode( serialize( array( 'allowed_actions' => $vwplr25oub, 'custom' => ! empty( $vwplckl3 ), ) ) ); $vwpltmfi = memberium_app()->wpln4nyq2( $vwplg6lz4 );  if ( $memb_messages['flash']['create_child_result'] > '' ) { $vwpltlkdcw .= $memb_messages['flash']['create_child_result']; } $vwpltlkdcw .= '<form method="POST" action="" id="' . $vwplvpexdn['form_id'] . '">'; $vwpltlkdcw .= '<input type="hidden" name="formtype" value="childenroll">'; $vwpltlkdcw .= "<input type=\"hidden\" name=\"params\" value=\"{$vwplg6lz4}\">"; $vwpltlkdcw .= "<input type=\"hidden\" name=\"digital_signature\" value=\"{$vwpltmfi}\">"; $vwpltlkdcw .= wp_nonce_field( 'memb_childenroll', '_wpnonce', true, false ); if ( empty( $vwplckl3 ) ) { $vwpltlkdcw .= '<label>' . _x( 'First Name:', 'umbrella_enroll_child', 'memberium' ) . '</label><input type="text" value="" name="FirstName" required="required"> *<br />'; $vwpltlkdcw .= '<label>' . _x( 'Last Name:', 'umbrella_enroll_child', 'memberium' ) . '</label><input type="text" value="" name="LastName" required="required"> *<br />'; $vwpltlkdcw .= '<label>' . _x( 'Email Address:', 'umbrella_enroll_child', 'memberium' ) . '</label><input type="email" value="" name="Email" required="required"> *<br />'; $vwpltlkdcw .= '<label>' . _x( 'Mobile Number:', 'umbrella_enroll_child', 'memberium' ) . '</label><input type="tel" value="" name="Phone3"><br />'; } else { $vwpltlkdcw .= do_shortcode( $vwplckl3 ); } $vwpltlkdcw .= '<label></label><input type="submit" value="' . $vwplvpexdn['button_text'] . '" name=""><br />'; $vwpltlkdcw .= '</form>'; $memb_messages['flash']['create_child_result'] = ''; return $vwpltlkdcw; } function wpljuv30() { global $i2sdk, $memb_messages; if ( ! wp_verify_nonce( $_POST['_wpnonce'], 'memb_childenroll' ) ) { wp_die( 'Security Check Failed - Nonce Validation Error' ); exit; } if ( ! memberium_app()->wplc3l0b( $_POST['digital_signature'], $_POST['params'] ) ) { wp_die( 'Security Check Failed - Signature Validation Error'); exit; } $vwplxm1e = (int) wplsbzgvp::wplfhxj9(); $vwplw5rgd3 = wplz8bid::wplm3z9k('appname'); $vwpllu186s = $this->wplvjcn4(); $vwplqo9f = strtolower( $vwpllu186s ); $vwplmnem = $this->wpls2tms1(); $vwplmn6cg = 0; $vwplg6lz4 = unserialize( base64_decode( $_POST['params'] ) ); $vwplr25oub = explode( ',', $vwplg6lz4['allowed_actions'] ); $vwpll4k8w = isset( $_POST['actions'] ) ? (int) $_POST['actions'] : 0;  if ( ! in_array( $vwpll4k8w, $vwplr25oub ) ) { $vwpll4k8w = 0; } $_POST['Email'] = strtolower( trim( $_POST['Email'] ) ); if ( empty( $_POST['Email'] ) ) { $memb_messages['flash']['create_child_result'] = '<p style="color:red;font-weight:bold;">' . _x( 'Email is Required', 'umbrella_enroll_child', 'memberium' ) . '</p>'; return; } if ( empty( $_POST['FirstName'] ) ) { $memb_messages['flash']['create_child_result'] = '<p style="color:red;font-weight:bold;">' . _x( 'First Name is Required', 'umbrella_enroll_child', 'memberium' ) . '</p>'; return; }  if ( strtolower( trim( $_POST['Email'] ) ) == strtolower( trim( wplsbzgvp::wplc4na( $vwplmnem ) ) ) ) { $memb_messages['flash']['create_child_result'] = '<p style="color:red;font-weight:bold;">' . _x( "You can't add yourself.", 'umbrella_enroll_child', 'memberium' ) . '</p>'; return; }  $vwplc0g3p = array( 'Id', $vwpllu186s, $vwplmnem ); $vwplzcmnhi = $i2sdk->isdk->findByEmail( $_POST['Email'], $vwplc0g3p ); foreach( $vwplzcmnhi as $vwplopnf => $child_contact ) { if ( isset($child_contact[$vwplmnem]) && $child_contact[$vwplmnem] == wplsbzgvp::wplc4na( $vwplqo9f ) ) { $vwplmn6cg = $child_contact['Id']; } if ( empty( $child_contact[$vwplmnem] ) ) { $vwplmn6cg = $child_contact['Id']; } } $vwplpv8rgm = $i2sdk->getInfusionsoftFieldsByTable( 'Contact' );  if ( $vwplmn6cg == 0 ) {  $vwplmu62n = array(); $vwplmu62n[$vwplmnem] = $this->wpls4l_q( wplsbzgvp::wplc4na( $vwplqo9f ), 'child' ); foreach ( $_POST as $vwple2yn => $vwplph268z ) { if ( in_array( $vwple2yn, $vwplpv8rgm ) ) { $vwplmu62n[$vwple2yn] = stripslashes($vwplph268z); } } $vwplmn6cg = (int) $i2sdk->isdk->addWithDupCheck( $vwplmu62n, 'Email' ); $i2sdk->isdk->updateCon( $vwplmn6cg, $vwplmu62n ); if ( $vwplmn6cg > 0 ) { $i2sdk->isdk->optin( $_POST['Email'], 'Added by Memberium Umbrella Account System' ); $i2sdk->isdk->runAS( (int) $vwplmn6cg, (int) $this->settings['child_added_actionset'] ); $i2sdk->isdk->runAS( (int) $vwplxm1e, (int) $this->settings['parent_added_actionset'] ); if ( $vwpll4k8w ) { $i2sdk->isdk->runAS( (int) $vwplmn6cg, (int) $vwpll4k8w ); } $memb_messages['flash']['create_child_result'] = '<p style="color:green;font-weight:bold;">' . _x( 'Child Account added.', 'umbrella_enroll_child', 'memberium' ) . '</p>'; } } else { foreach ( $_POST as $vwple2yn => $vwplph268z ) { if ( in_array( $vwple2yn, $vwplpv8rgm ) ) { $vwplmu62n[$vwple2yn] = stripslashes($vwplph268z); } } if ( empty( $child_contact[$vwplmnem] ) ) { $vwplmu62n[$vwplmnem] = $this->wpls4l_q( wplsbzgvp::wplc4na( $vwplqo9f ), 'child' ); $i2sdk->isdk->updateCon( $vwplmn6cg, $vwplmu62n );  $i2sdk->isdk->runAS( $vwplmn6cg, (int) $this->settings['child_added_actionset'] ); $i2sdk->isdk->runAS( $vwplxm1e, (int) $this->settings['parent_added_actionset'] ); if ( $vwpll4k8w ) { $i2sdk->isdk->runAS( (int) $vwplmn6cg, (int) $vwpll4k8w ); } $memb_messages['flash']['create_child_result'] = '<p style="color:green;font-weight:bold;">' . _x( 'Child Account assigned.', 'umbrella_enroll_child', 'memberium' ) . '</p>'; } else { $memb_messages['flash']['create_child_result'] = '<p style="color:red;font-weight:bold;">' . _x( 'That account already assigned to a user.', 'umbrella_enroll_child', 'memberium' ) . '</p>'; } }  if ( $vwplmn6cg ) { memberium_app()->wplj9ye($vwplmn6cg); } do_action('memberium_umbrella_add_child', $vwplmn6cg, $vwplxm1e); return; } function wplsykbq($vwplvpexdn, $vwplckl3 = null, $vwpluvdiz) { if ( ! is_user_logged_in() ) { return; } $vwplsb_pf = array( 'contact_id' => isset( $_GET['contact_id'] ) ? $_GET['contact_id'] : wplsbzgvp::wplfhxj9(), ); $vwplvpexdn = shortcode_atts( $vwplsb_pf, $vwplvpexdn, 'memberium' ); $vwplvpexdn['contact_id'] = (int) $vwplvpexdn['contact_id']; if ( ! $vwplvpexdn['contact_id'] ) { return '<p>No valid user to display.</p>'; }  $vwplyjxldo = is_super_admin();  if ( ! $vwplyjxldo ) { $vwpl_54etd = $this->wplqghwq(); $vwplyjxldo = in_array( $vwplvpexdn['contact_id'], $vwpl_54etd ); }  if ( ! $vwplyjxldo ) { $vwplyjxldo = ( $vwplvpexdn['contact_id'] == $_SESSION['memb_db_fields']['id'] ); }  if ( $vwplyjxldo ) { $vwpllzly5b = wpllbej::wplsgpnk( $vwplvpexdn['contact_id'] ); if ( $vwpllzly5b ) { return do_shortcode( "[ld_course_info user_id='{$vwpllzly5b}']" ); } else { $vwplyjxldo = false; } }  if ( ! $vwplyjxldo ) { return "<p>Access not permitted to this user's course records</p>"; } } function wplvw_o4n($vwplvpexdn, $vwplckl3 = null, $vwpluvdiz) { if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplsb_pf = array( 'course_class' => 'umbrella_lms_dashboard_course', 'course_style' => 'margin-bottom:6px;padding:20px 10px 20px 10px;background-color:#eee;', 'date_format' => 'F j, Y', 'template' => $vwpluvdiz, 'user_class' => 'umbrella_lms_dashboard_user', 'user_style' => 'margin-bottom:12px;padding:20px 10px 20px 10px;background-color:#eee;', ); $vwplvpexdn = shortcode_atts($vwplsb_pf, $vwplvpexdn, 'memberium'); $vwplwcre = array(); $vwplpmts = array(); $vwpl_54etd = $this->wplx_rjl(); if (count($vwpl_54etd) ) { $vwplgitq = array( 'fields' => array('ID', 'display_name', 'user_email'), 'include' => $vwpl_54etd, 'order' => 'ASC', 'orderby' => 'display_name', ); $vwplzker_ = new WP_User_Query( $vwplgitq ); $vwplwcre = $vwplzker_->results; } foreach($vwplwcre as $vwply17edn => $vwplgogvie) { $uid = $vwplgogvie->ID;  if (function_exists('learndash_user_get_enrolled_courses') ) { $vwplf1e7 = learndash_user_get_enrolled_courses($uid); sort($vwplf1e7); $vwplfatxz = get_user_meta($uid, '_sfwd-course_progress', true); $vwplwcre[$vwply17edn]->courses = array(); foreach($vwplf1e7 as $vwplnu9_s) { if (get_post_status($vwplnu9_s) == 'publish' && get_post_type($vwplnu9_s) == 'sfwd-courses') { $vwplzzlf5b = get_post($vwplnu9_s); $vwplp9bh_ = learndash_get_course_steps_count($vwplnu9_s); $vwplln9s7 = isset($vwplfatxz[$vwplnu9_s]['last_id']) ? $vwplfatxz[$vwplnu9_s]['last_id'] : 0; $vwpldknj6 = learndash_course_get_completed_steps($uid, $vwplnu9_s); $vwplud201n = empty($vwplp9bh_) ? 0 : (int) ($vwpldknj6 / $vwplp9bh_ * 100); $vwplwcre[$vwply17edn]->courses[$vwplnu9_s] = new stdclass; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->course_title = $vwplzzlf5b->post_title; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->completed_timestamp = function_exists('learndash_user_get_course_completed_date') ? (int) learndash_user_get_course_completed_date($uid, $vwplnu9_s) : 0; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->course_steps = $vwplp9bh_; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->completed_steps = $vwpldknj6; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->step_title = empty($vwplln9s7) ? 'None' : get_the_title($vwplln9s7); $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->percentage = $vwplud201n; $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->access_expired = (int) ld_course_access_expired($vwplnu9_s, $uid); $vwplwcre[$vwply17edn]->courses[$vwplnu9_s]->expiration_timestamp = (int) ld_course_access_expires_on($vwplnu9_s, $uid); } else { } } }  }  return wplczvi98::wplve025m($vwpluvdiz, $vwplvpexdn, $vwplckl3, $vwpluvdiz, $vwplwcre); }  function wplasq5($vwplvpexdn, $vwplckl3 = null, $vwpluvdiz) { if ( ($contact_id = wplsbzgvp::wplfhxj9() ) == 0) { return; } if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplsb_pf = array( 'button_class' => '', 'button_text' => 'Transfer Points', 'field' => '', 'max' => 0, 'min' => 1, 'redirect' => '', ); $vwplvpexdn = shortcode_atts($vwplsb_pf, $vwplvpexdn, 'memberium'); $vwplvpexdn['field'] = strtolower(trim($vwplvpexdn['field']) ); if (empty($vwplvpexdn['field']) ) { return; } $vwpl_qom9 = (float) $_SESSION['memb_db_fields'][$vwplvpexdn['field']]; $params = array( 'field' => $vwplvpexdn['field'], 'max_points' => $vwpl_qom9, 'pcid' => $contact_id, 'redirect' => $vwplvpexdn['redirect'], );  $child_ids = $this->wplx_rjl(); $vwple_jhya = array(); if ( count($child_ids) ) { $vwplgitq = array( 'fields' => array('ID', 'display_name', 'user_email'), 'include' => $child_ids, 'order' => 'ASC', 'orderby' => 'display_name', ); $vwplzker_ = new WP_User_Query( $vwplgitq ); $vwple_jhya = $vwplzker_->results; } $vwplz4g7n = new stdclass; $vwplz4g7n->params = base64_encode(serialize($params) ); $vwplz4g7n->users = $vwple_jhya; $vwplz4g7n->points = $vwpl_qom9; $vwplz4g7n->headers = wp_nonce_field($vwplz4g7n->params, 'umbrella_transfer_points_wpnonce', true, false); $vwplz4g7n->headers .= "<input type='hidden' name='signature' value='{$vwplz4g7n->params}'>"; $vwplz4g7n->redirect = $vwplvpexdn['redirect']; return wplczvi98::wplve025m($vwpluvdiz, $vwplvpexdn, $vwplckl3, $vwpluvdiz, $vwplz4g7n); } function wplx_pad() {  if ( ! wp_verify_nonce($_POST['umbrella_transfer_points_wpnonce'], $_POST['signature']) ) { wp_die( 'Security Check Failed - Nonce Validation Error' ); exit; } $vwplnrd9 = false; $vwplg6lz4 = unserialize(base64_decode($_POST['signature']) ); $vwpl_qom9 = (int) $_POST['points']; $vwplc1_7el = sanitize_email($_POST['recipient']); $vwpl_s6l = $vwplg6lz4['field']; $vwplu_gxri = new stdclass; $vwplu_gxri->max_points = $vwplg6lz4['max_points']; $vwplu_gxri->points = $vwpl_qom9;  $parent_contact_id = $vwplg6lz4['pcid']; $child_contact_id = memberium_app()->wplckwp7($vwplc1_7el); if ($vwpl_qom9 == 0) { $vwplnrd9 = true; $vwplu_gxri->error_type = 'no_points_transferred'; } if ($vwpl_qom9 > $vwplg6lz4['max_points'] || $vwpl_qom9 < 1) { $vwplnrd9 = true; $vwplu_gxri->error_type = 'invalid_points'; } if (! $parent_contact_id || ! $child_contact_id) { $vwplnrd9 = true; $vwplu_gxri->error_type = 'invalid_users'; } if ( ! $vwplnrd9) { $vwplkp59 = memberium_app()->wplvyjh($child_contact_id, $vwpl_s6l); $vwplh89rd = $vwplu_gxri->max_points - $vwpl_qom9; $vwpld6xt = $vwplkp59 + $vwpl_qom9; memberium_app()->wplox2qcd($vwpl_s6l, $vwplh89rd, $parent_contact_id ); memberium_app()->wplox2qcd($vwpl_s6l, $vwpld6xt, $child_contact_id ); $vwplu_gxri->error_type = false; $vwplu_gxri->points = $vwpl_qom9; } $_SESSION['flash']['umbrella_transfer_points'] = wplczvi98::wplve025m('umbrella_transfer_points_result', null, null, null, $vwplu_gxri); } function wplj3z9($vwplvpexdn, $vwplckl3 = null, $vwpluvdiz) { if ( ($vwplvtmqd = wplsbzgvp::wplfhxj9() ) == 0) { return; } if ( ! wplj_l2t::wpl_n2s9( $this->settings['parent_tags'] ) ) { return; } $vwplsb_pf = array( 'button_text' => 'Download CSV', 'button_class' => '', 'filter_name' => '', ); $vwplvpexdn = shortcode_atts($vwplsb_pf, $vwplvpexdn, 'memberium'); $vwplg6lz4 = array( 'filter_name' => $vwplvpexdn['filter_name'], ); $vwplg6lz4 = base64_encode(serialize($vwplg6lz4) ); $vwpltlkdcw = ''; $vwpltlkdcw .= '<form method=post>'; $vwpltlkdcw .= wp_nonce_field(-1, 'umbrella_download_csv_wpnonce', true, false); $vwpltlkdcw .= "<input type=hidden name='params' value='{$vwplg6lz4}'>"; $vwpltlkdcw .= "<input type=submit class='' name='' value='{$vwplvpexdn['button_text']}'>"; $vwpltlkdcw .= '</form>'; return $vwpltlkdcw; } function wplnk54() { $vwpllzly5b = get_current_user_id(); $vwplwcre = array(); $vwpl_54etd = $this->wplx_rjl(); $vwplg6lz4 = isset($_POST['params']) ? unserialize(base64_decode($_POST['params']) ) :array();  $vwpl_54etd = apply_filters('memberium/umbrella/download_csv', $vwpl_54etd); $vwpl_54etd = apply_filters("memberium/umbrella/download_csv/{$vwplg6lz4['filter_name']}", $vwpl_54etd); foreach($vwpl_54etd as $k => $v) { } }  }
