<?php
 if ( !defined( 'ABSPATH' ) ) { die(); } if ( !current_user_can( 'manage_options' ) ) { wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); } global $wpdb; $vwplelob86 = $this->memberium_umbrella_core_class->wplarowq(); $vwplsb_pf = array( 'enabled' => false, 'child_added_actionset' => 0, 'child_cancel_actionset' => 0, 'parent_added_actionset' => 0, 'whitelist_memberships' => false, 'tag_whitelist' => '', ); $vwplelob86 = wp_parse_args( $vwplelob86, $vwplsb_pf ); $_GET['tab'] = isset( $_GET['tab'] ) ? $_GET['tab'] : 'general'; if ( $_SERVER['REQUEST_METHOD'] == 'POST' ) {  $vwplqzdlu3 = array( 'enabled', ); foreach( $vwplqzdlu3 as $vwply17edn ) { $vwplelob86[$vwply17edn] = ( isset( $_POST[$vwply17edn] ) ? (int) (bool) $_POST[$vwply17edn] : $vwplelob86[$vwply17edn] ); }  $vwplqzdlu3 = array( 'child_field', 'parent_field', 'child_count_add', 'whitelist_memberships', ); foreach( $vwplqzdlu3 as $vwply17edn ) { $vwplelob86[$vwply17edn] = ( isset( $_POST[$vwply17edn] ) ? trim( $_POST[$vwply17edn] ) : $vwplelob86[$vwply17edn] ); }  $vwplqzdlu3 = array( 'inherited_fields', 'tag_whitelist', 'parent_tags', ); foreach( $vwplqzdlu3 as $vwply17edn ) { $vwplelob86[$vwply17edn] = ( isset( $_POST[$vwply17edn] ) ? trim( implode( ',', $_POST[$vwply17edn] ) ) : $vwplelob86[$vwply17edn] ); }  $vwplqzdlu3 = array( 'child_added_actionset', 'child_cancel_actionset', 'parent_added_actionset', 'max_child_accounts', 'parent_cache_ttl', ); foreach( $vwplqzdlu3 as $vwply17edn ) { $vwplelob86[$vwply17edn] = ( isset( $_POST[$vwply17edn] ) ? trim( $_POST[$vwply17edn] ) : $vwplelob86[$vwply17edn] ); } if ( ! empty( $_POST['subscription'] ) ) { unset( $vwplelob86['subscriptions'] ); $vwplelob86['subscriptions'] = array_map( 'intval', $_POST['subscription'] ); $vwplelob86['ecommerce'] = (int) ( array_sum( $vwplelob86['subscriptions'] ) > 0 ); } if ( isset( $_POST['add-tag-grant'] ) ) { $vwplelob86['tag_grants'][$_POST['tag']] = (int) $_POST['seats']; } if ( isset( $_POST['update-tag-grants'] ) ) { $vwplelob86['tag_grants'] = $_POST['tag_grants']; foreach( $_POST['tag_grants'] as $vwpltmveju => $vwplats4 ) { if ( $vwplats4 == 0 ) { unset( $vwplelob86['tag_grants'][$vwpltmveju] ); } } } if ( isset( $_POST['add-tag-translation'] ) ) { if ( $_POST['oldtag'] <> $_POST['newtag'] ) { $_POST['oldtag'] = (int) $_POST['oldtag']; $_POST['newtag'] = (int) $_POST['newtag']; $vwplelob86['tag_translation'][$_POST['oldtag']] = $_POST['newtag']; } if ( ( $_POST['oldtag'] == $_POST['newtag'] ) || $_POST['newtag'] == 0 ) { unset( $vwplelob86['tag_translation'][$_POST['oldtag']] ); } } if ( isset( $_POST['update-tag-translation'] ) ) { } $this->memberium_umbrella_core_class->wpla_iysg( $vwplelob86 ); } wpljwbf2::wplyb40j1(); $vwpln5qyc = array( 'general' => '<i class="fa fa-umbrella"></i> General', 'tags' => '<i class="fa fa-tags"></i> Tags', 'subscriptions' => '<i class="fa fa-shopping-cart"></i> Subscriptions', 'about' => '<i class="fa fa-users"></i> About', ); $vwpl_qd2 = isset( $_GET['tab'] ) ? strtolower( $_GET['tab'] ) : 'general'; echo '<div class="wrap">'; echo '<h2>', _( 'Umbrella Account Settings' ), '</h2>'; echo '<h2 class="nav-tab-wrapper">'; foreach ( $vwpln5qyc as $vwplesora => $vwplso1pw ) { $class = ( $vwplesora == $vwpl_qd2 ) ? ' nav-tab-active' : ''; if ( $vwplesora == $vwpl_qd2 ) { echo "<span class='nav-tab{$class}'>{$vwplso1pw}</span>"; } else { echo "<a class='nav-tab{$class}' href='?page=", $_GET['page'], "&tab={$vwplesora}'>{$vwplso1pw}</a>"; } } echo '</h2>'; echo '<div class="tabcontent" style="margin-top:10px;">'; if ( $vwpl_qd2 == 'general' ) {  $vwplbhf2 = wpllbej::wplntnyv( 'Contact', true ); foreach( $vwplbhf2 as $vwpl_s6l ) { $vwplmu62n[$vwpl_s6l] = $vwpl_s6l; } unset( $vwplbhf2 ); echo '<form method="POST" action="">'; wp_nonce_field( MEMBERIUM_LIB, 'memberium_umbrella_account_nonce' ); echo '<ul>'; echo '<h3>Overview</h3>'; $vwplelob86['enabled'] = isset( $vwplelob86['enabled'] ) ? $vwplelob86['enabled'] : 0; $vwplgitq = array( 'id' => 'enabled', 'label' => 'Extension Enabled', ); echo '<li><label>Extension Enabled</label>'; wpljwbf2::wplcst4( 'enabled', $vwplelob86['enabled'], $vwplgitq ); echo '<h3>Management Actionsets</h3>'; echo '<li><label>Child Added Actionset</label>'; echo '<input value="', $vwplelob86['child_added_actionset'], '"  name="child_added_actionset" id="child_added_actionset" type="text" class="dropdown actionsetdropdown">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '<li><label>Child Cancel Actionset</label>'; echo '<input value="', $vwplelob86['child_cancel_actionset'], '"  name="child_cancel_actionset" id="child_cancel_actionset" type="text" class="dropdown actionsetdropdown">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '<li><label>Parent Added Actionset</label>'; echo '<input value="', $vwplelob86['parent_added_actionset'], '"  name="parent_added_actionset" id="parent_added_actionset" type="text" class="dropdown actionsetdropdown">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Profile</h3>'; echo '<li><label>Parent Tags</label>'; echo '<input value="', $vwplelob86['parent_tags'], '" type="text" class="multitaglist" id="parent_tags" name="parent_tags[]" style="width:500px;">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; $vwplgitq = array( 'id' => 'child_field', 'class' => 'basic-single', 'style' => 'width:400px;', ); echo '<li><label>Child\'s Field to Match to Parent</label>'; echo $this->memberium_admin->wplxrx8pd( 'child_field', $vwplmu62n, $vwplelob86['child_field'], $vwplgitq ); echo wpljwbf2::wplypewkt( 0000 ), ' <strong style="color:red;">Do Not Change Unless Advised by Support</strong></li>'; $vwplgitq = array( 'class' => 'basic-single', 'id' => 'parent_field', 'style' => 'width:400px;', ); echo '<li><label>Parent Field to Match To</label>'; echo $this->memberium_admin->wplxrx8pd( 'parent_field', $vwplmu62n, $vwplelob86['parent_field'], $vwplgitq ); echo wpljwbf2::wplypewkt( 0000 ), ' <strong style="color:red;">Do Not Change Unless Advised by Support</strong></li>'; $vwplgitq = array( 'class' => 'basic-single', 'id' => 'inherited_fields', 'multiple' => true, 'size' => 2, 'style' => 'width:400px;', ); echo '<li><label>Inherited Fields</label>'; echo $this->memberium_admin->wplxrx8pd( 'inherited_fields[]', $vwplmu62n, $vwplelob86['inherited_fields'], $vwplgitq ); echo wpljwbf2::wplypewkt( 0000 ), '</li>'; $vwplgitq = array( 'id' => 'whitelist_memberships', 'label' => 'Whitelist Memberships', ); echo '<li><label>Whitelist Memberships</label>'; wpljwbf2::wplcst4( 'whitelist_memberships', $vwplelob86['whitelist_memberships'], $vwplgitq ); echo '<li><label>Tag Whitelist</label>'; echo '<input value="', $vwplelob86['tag_whitelist'], '" type="text" class="multitaglist" id="tag_whitelist" name="tag_whitelist[]" style="width:500px;">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Child Accounts</h3>'; echo '<li><label>Minimum Child Accounts</label>'; echo '<input value="', $vwplelob86['max_child_accounts'], '"  name="max_child_accounts" id="max_child_accounts" type="number" min="-1" max="999999" class="">'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; $vwplgitq = array( 'id' => 'child_count_add', 'class' => 'basic-single', 'style' => 'width:400px;', ); $this_fields = array_merge( array( '' => '(None)' ), $vwplmu62n ); $vwplelob86['child_count_add'] = isset( $vwplelob86['child_count_add'] ) ? $vwplelob86['child_count_add'] : ''; echo '<li><label>Additional Children Field</label>'; echo $this->memberium_admin->wplxrx8pd( 'child_count_add', $this_fields, $vwplelob86['child_count_add'], $vwplgitq ); echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Performance</h3>'; echo '<li><label>Parent Cache TTL</label>'; echo '<input value="', $vwplelob86['parent_cache_ttl'], '"  name="parent_cache_ttl" id="parent_cache_ttl" type="number" min="0" max="999999" class=""> seconds'; echo wpljwbf2::wplypewkt( 0000 ), '</li>'; echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; } elseif ( $vwpl_qd2 == 'tags' ) { $vwpls0hwb5 = wplj_l2t::wplaajf( true ); $vwpls0hwb5 = $vwpls0hwb5['mc'];  $vwplxfo326 = isset( $vwplelob86['tag_grants'] ) ? $vwplelob86['tag_grants'] : array(); $vwplkstw = count( $vwplxfo326 ); echo '<h3>Tag Grants</h3>'; if ( $vwplkstw > 0 ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:150px;">Children/Tag</td>'; echo '<td style="width:100px;">Tag Id</td>'; echo '<td>Tag Name</td>'; echo '</tr>'; foreach( $vwplxfo326 as $vwply17edn => $vwplph268z ) { echo '<tr>'; echo '<td><input min=0 step=1 type="number" name="tag_grants[', $vwply17edn,']" value="', $vwplph268z, '" style="width:70px; !important"></td>'; echo '<td>', $vwply17edn, '</td>'; echo '<td>', $vwpls0hwb5[$vwply17edn], '</td>'; echo '</tr>'; } echo '</table>'; echo '<p><input type="submit" class="button-primary" name="update-tag-grants" value="Update"></p>'; echo '</form>'; } else { echo '<p>You have no tags assigned to give child account slots.  Create a new tag grant below:</p>'; } echo '<form method="post">'; echo '<p>'; echo '<label>Create New Tag Grant</label>'; $vwplgitq = array( 'class' => 'basic-single', 'required' => true, 'style' => 'width:250px;margin-right:30px;' ); memberium_app()->wplk1zp_v()->wplxrx8pd( 'tag', $vwpls0hwb5, '', $vwplgitq ); echo 'Seats:  <input name="seats" type="number" min="1" value="1" style="width:60px;margin-right:30px;"> '; echo '<input type="submit" class="button-primary" name="add-tag-grant" value="Add Tag Grant"></p>'; echo '</form>'; echo '<hr>'; echo '<h3>Tag Translations</h3>'; if ( ! empty( $vwplelob86['tag_translation'] ) ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:350px;">Original Tag</td>'; echo '<td style="width:350px;">New Tag</td>'; echo '<td></td>'; echo '</tr>'; foreach( $vwplelob86['tag_translation'] as $vwply3etv => $vwplc1e_a ) { echo '<tr>'; echo '<td>', $vwpls0hwb5[$vwply3etv], ' (', $vwply3etv, ')</td>'; echo '<td>', $vwpls0hwb5[$vwplc1e_a], ' (', $vwplc1e_a, ')</td>'; echo '</tr>'; } echo '</table>';  echo '</form>'; } else { echo '<p>You have no tag translations created.  Create a new tag translation below:</p>'; } echo '<form method="post">'; echo '<p>'; echo '<label>Create New Tag Translation</label>'; $vwplgitq = array( 'class' => 'basic-single', 'required' => true, 'style' => 'width:250px;margin-right:30px;' ); memberium_app()->wplk1zp_v()->wplxrx8pd( 'oldtag', $vwpls0hwb5, '', $vwplgitq );  $vwplg26o = array( '0' => '(None)' ) + $vwpls0hwb5; memberium_app()->wplk1zp_v()->wplxrx8pd( 'newtag', $vwplg26o, '', $vwplgitq ); unset( $vwplg26o ); echo '<input type="submit" class="button-primary" name="add-tag-translation" value="Set Tag Translation"></p>'; echo '</form>'; } elseif ( $vwpl_qd2 == 'about' ) { echo '<h2>Memberium Umbrella Account Extension for Infusionsoft</h2>'; echo '<p>', _( 'Version' ), ' ', $this->memberium_umbrella_core_class->wplyo16nv(), '</p>'; echo '<p>Copyright &copy; 2015-2017 David Bullock</p>'; echo '<p>For documentation on this extension, please <a href="https://memberium.com/?p=12000" target="_blank">view our help page</a>.</p>'; } elseif ( $vwpl_qd2 == 'subscriptions' ) { $vwplyoqc = memberium_app()->wplvkevh(); $vwplvwi2o = memberium_app()->wplpg5eox(); $vwplbd6q = array( 6 => 'Days', 3 => 'Weeks', 2 => 'Months', 1 => 'Years', ); if ( ! empty($vwplyoqc) ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:150px;">Children/Active Sub</td>'; echo '<td>Subscription Plan Name</td>'; echo '<td>Charge</td>'; echo '<td>Frequency</td>'; echo '<td>Cycles</td>'; echo '</tr>'; foreach( $vwplyoqc as $vwpl_my3tc ) { if ( $vwpl_my3tc['Active'] ) { $vwpl_my3tc['name'] = $vwplvwi2o[$vwpl_my3tc['ProductId']]['ProductName']; $vwpl_my3tc['period'] = $vwplbd6q[$vwpl_my3tc['Cycle']]; $vwpl_my3tc['NumberOfCycles'] = isset( $vwpl_my3tc['NumberOfCycles'] ) ? $vwpl_my3tc['NumberOfCycles'] : 0; $vwplph268z = ( empty( $vwplelob86['subscriptions'][$vwpl_my3tc['Id']] ) ? 0 : $vwplelob86['subscriptions'][$vwpl_my3tc['Id']] ); echo '<tr>'; echo '<td><input min=0 step=1 type="number" name="subscription[',$vwpl_my3tc['Id'],']" value="', $vwplph268z, '" style="width:70px; !important"></td>'; echo '<td>', $vwpl_my3tc['name'], '</td>'; echo '<td>$', $vwpl_my3tc['PlanPrice'], '</td>'; echo '<td>', $vwpl_my3tc['Frequency'], ' ', $vwpl_my3tc['period'], '</td>'; echo '<td>', $vwpl_my3tc['NumberOfCycles'] > 0 ? $vwpl_my3tc['NumberOfCycles'] : 'Unlimited', '</td>'; echo '</tr>'; } } echo '</table>'; echo '<p><input type="submit" class="button-primary"></p>'; echo '</form>'; } } $vwpls0hwb5 = wplj_l2t::wplaajf( true ); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwplechli = array(); $vwplechli[] = array( 'id' => 0, 'text' => '(None)' ); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju ) { $vwplechli[] = array( 'id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); } $vwplechli = json_encode( $vwplechli ); unset( $vwpls0hwb5, $vwplopnf, $vwpltmveju ); $vwplbhf2 = wpllbej::wplntnyv( 'Contact', true ); $vwpljn21 = array(); $vwpljn21[] = array( 'id' => '', 'text' => '(None)' ); foreach ( $vwplbhf2 as $vwpl_s6l ) { $vwpljn21[] = array( 'id' => $vwpl_s6l, 'text' => $vwpl_s6l ); } $vwpljn21 = json_encode( $vwpljn21 ); unset( $vwplbhf2 ); $vwplx1ap5_ = 'SELECT `id`, `name` FROM ' . MEMBERIUM_DB_ACTIONSETS . ' WHERE `appname` = %s AND `name` > "" ORDER BY `name` ASC'; $vwplx1ap5_ = $wpdb->prepare( $vwplx1ap5_, wplz8bid::wplm3z9k('appname') ); $vwplewhxt_ = $wpdb->get_results( $vwplx1ap5_, ARRAY_A ); $vwplvmes5 = array(); $vwplvmes5[] = array( 'id' => 0, 'text' => '(No Action)' ); foreach ( $vwplewhxt_ as $vwplopnf => $vwplheakg ) { $vwplvmes5[] = array( 'id'=>$vwplheakg['id'], 'text'=>$vwplheakg['name'] ); } $vwplvmes5 = json_encode( $vwplvmes5 ); unset( $vwplewhxt_, $vwplopnf, $vwplheakg, $vwplx1ap5_ ); echo '<script>'; echo 'var actionsetlist = ', $vwplvmes5, ';'; echo 'var fieldlist     = ', $vwpljn21, ';'; echo 'var taglist       = ', $vwplechli, ';'; echo '</script>'; unset( $vwplvmes5, $vwpljn21, $vwplbhf2 ); echo '</div>'; echo '</div>';
