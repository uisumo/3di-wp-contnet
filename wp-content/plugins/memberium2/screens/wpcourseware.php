<?php
 if (!defined('ABSPATH') ) { die(); } if (! current_user_can('manage_options') ) { wp_die(__('You do not have sufficient permissions to access this page.') ); } global $i2sdk, $wpdb, $wpcwdb; $vwplax68 = get_option('memberium_wpcw', array() ); if ($_SERVER['REQUEST_METHOD'] == 'POST') { if ($_POST['type'] == 'courses') { $vwplax68['courses']['access_tags'] = $_POST['access_tags']; $vwplax68['courses']['completion_tag'] = $_POST['completion_tag']; } elseif ($_POST['type'] == 'modules') { $vwplax68['modules']['completion_tag'] = $_POST['completion_tag']; } update_option('memberium_wpcw', $vwplax68); } $vwplx1ap5_ = "SELECT `course_id`, `course_title`, `course_desc`, `course_opt_user_access` FROM `{$wpcwdb->courses}` WHERE '1' ORDER BY `course_opt_user_access` ASC, `course_id` DESC;"; $vwplpmts = $wpdb->get_results($vwplx1ap5_, ARRAY_A); if (count($vwplpmts) ) { echo '<h2>WP Courseware Courses</h2>'; echo '<form method="post" action="">'; echo '<input type="hidden" name="type" value="courses">'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr>'; echo '<td>Title</td>'; echo '<td>Mode</td>'; echo '<td>Access Tag</td>'; echo '<td>Completion Tag</td>'; echo '</tr>'; foreach($vwplpmts as $vwplknsp1) { $vwplcgat2 = (bool) ($vwplknsp1['course_opt_user_access'] == 'default_hide'); $vwpl_7hrws = isset($vwplax68['courses']['access_tags'][$vwplknsp1['course_id']]) ? $vwplax68['courses']['access_tags'][$vwplknsp1['course_id']] : ''; $vwplf27cj = isset($vwplax68['courses']['completion_tag'][$vwplknsp1['course_id']]) ? $vwplax68['courses']['completion_tag'][$vwplknsp1['course_id']] : ''; echo '<tr>'; echo '<td><strong>', $vwplknsp1['course_title'], '</strong><br>', $vwplknsp1['course_desc'], '</td>'; echo '<td>', $vwplcgat2 ? '<strong style="color:red;">Protected</strong>' : '<strong style="color:green;">Public</strong>', '</td>'; if ($vwplcgat2) { echo '<td><input style="width:300px;" type="text" class="multitaglist" value="', $vwpl_7hrws, '" name="access_tags[', $vwplknsp1['course_id'], ']"></td>'; } else { echo '<td><em>Automatic</em>'; echo '<input type="hidden" value="0" name="access_tags[', $vwplknsp1['course_id'], ']"></td>'; } echo '<td><input type="text" style="width:300px;" class="multitaglist" value="', $vwplf27cj, '" name="completion_tag[', $vwplknsp1['course_id'], ']"></td>'; echo '</tr>'; } unset($vwplknsp1, $vwplcgat2, $vwpl_7hrws, $vwplf27cj, $vwplpmts); echo '</table>'; echo '<p><input type="submit" class="button-primary"value="Update" /></p>'; echo '</form>'; $vwplx1ap5_ = "SELECT * FROM {$wpcwdb->modules} WHERE 1 ORDER BY parent_course_id ASC, module_order ASC;"; $vwplz1aiqs = $wpdb->get_results($vwplx1ap5_, ARRAY_A); if (count($vwplz1aiqs) ) { echo '<h2>WP Courseware Modules</h2>'; echo '<form method="post" action="">'; echo '<input type="hidden" name="type" value="modules">'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr>'; echo '<td>Title</td>'; echo '<td>Completion Tag</td>'; echo '</tr>'; foreach($vwplz1aiqs as $vwplhrxd1) { $vwplf27cj = isset($vwplax68['modules']['completion_tag'][$vwplhrxd1['module_id']]) ? $vwplax68['modules']['completion_tag'][$vwplhrxd1['module_id']] : ''; echo '<tr>'; echo '<td><strong>', $vwplhrxd1['module_title'], '</strong><br>', $vwplhrxd1['module_desc'], '</td>'; echo '<td><input type="text" style="width:300px;" class="multitaglist" value="', $vwplf27cj, '" name="completion_tag[', $vwplhrxd1['module_id'], ']"></td>'; echo '</tr>'; } unset($vwplhrxd1, $vwplf27cj, $vwplz1aiqs); echo '</table>'; echo '<p><input type="submit" class="button-primary"value="Update" /></p>'; echo '</form>'; } else { echo '<p>No modules found.</p>'; } } else { echo '<p>No courses found.</p>'; } $vwpls0hwb5 = wplj_l2t::wplaajf(true); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwpldbhwy9 = array(); $vwpldbhwy9[] = array('id' => 0, 'text' => '(None)'); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju) { if (! in_array($vwplopnf, $vwplu14yc9) ) { $vwpldbhwy9[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')'); } } $vwpldbhwy9 = json_encode($vwpldbhwy9); echo '<script>'; echo 'var taglist = ', $vwpldbhwy9, ';'; echo '</script>';
