<?php
 if (!defined('ABSPATH' ) ) { die(); } if (! current_user_can('manage_options' ) ) { wp_die(__('You do not have sufficient permissions to access this page.' ) ); } memberium_app()->wpllfqh_('view_memberships' ); global $i2sdk, $wpdb, $wp_roles; $vwplgxrbm = empty($this->settings['memberships'] ) ? array() : $this->settings['memberships']; $vwplwfy9 = $wp_roles->roles; $vwplluny3 = array(); foreach ($vwplwfy9 as $vwpltmtyd=>$vwplbhlt_ ) { if ($vwpltmtyd <> 'administrator' ) { $vwplluny3[] = array( 'id' => $vwpltmtyd, 'name' => $vwplbhlt_['name'] ); } } unset($vwplwfy9, $vwpltmtyd, $vwplbhlt_ );  $vwplwabz = array(); foreach($vwplgxrbm as $vwplopnf => $vwply4fkhi ) { if ( (int) $vwplopnf > 0 && (int) $vwply4fkhi['main_id'] == $vwplopnf ) { $vwply4fkhi['login_redirect_priority'] = isset($vwply4fkhi['login_redirect_priority'] ) ? $vwply4fkhi['login_redirect_priority'] : 0; $vwplwabz[$vwplopnf] = $vwply4fkhi; } } $vwplgxrbm = $vwplwabz; $this->settings['memberships'] = $vwplgxrbm; unset($vwplwabz ); update_option('memberium', $this->settings ); if ($_SERVER['REQUEST_METHOD'] == 'POST' ) {  if (isset($_POST['main_action'] ) ) { if (! empty($_POST['level'] ) && is_array($_POST['level'] ) ) { foreach($_POST['level'] as $vwply17edn => $vwplph268z ) { $vwplgxrbm[$vwply17edn]['level'] = $vwplph268z; } } if (! empty($_POST['login_redirect_priority'] ) && is_array($_POST['login_redirect_priority'] ) ) { foreach($_POST['login_redirect_priority'] as $vwply17edn => $vwplph268z ) { $vwplgxrbm[$vwply17edn]['login_redirect_priority'] = $vwplph268z; } } if (! empty($_POST['main_action'] ) && is_array($_POST['main_action'] ) ) { $deleted_memberships = array(); foreach($_POST['main_action'] as $vwply17edn => $vwplph268z ) { if ($vwplph268z == 'Delete' ) {  $vwpltmtyd = 'Memberium ' . $vwplgxrbm[$vwply17edn]['name']; $vwpla7qz = sanitize_key('memberium_' . $vwplgxrbm[$vwply17edn]['name'] ); remove_role($vwpla7qz ); wpljwbf2::wplc1on7('Your membership level &ldquo;<strong>' . $vwplgxrbm[$vwply17edn]['name'] . '</strong>&rdquo; has been deleted.' ); unset($vwplgxrbm[$vwply17edn] ); $deleted_memberships[] = $vwply17edn; } } $this->wplfwm12($deleted_memberships ); } } if (isset($_GET['action'] ) && $_GET['action'] == 'edit' ) { if (isset($_GET['id'] ) && is_array($vwplgxrbm[$_GET['id']] ) ) { $vwplgxrbm[$_GET['id']]['cancel_id'] = isset($_POST['cancel_id'] ) ? (int) $_POST['cancel_id'] : $vwplgxrbm[$_GET['id']]['cancel_id']; $vwplgxrbm[$_GET['id']]['level'] = isset($_POST['level'] ) ? (int) $_POST['level'] : $vwplgxrbm[$_GET['id']]['level']; $vwplgxrbm[$_GET['id']]['login_page'] = isset($_POST['login_page'] ) ? (int) $_POST['login_page'] : $vwplgxrbm[$_GET['id']]['login_page']; $vwplgxrbm[$_GET['id']]['first_login_page'] = isset($_POST['first_login_page'] ) ? (int) $_POST['first_login_page'] : $vwplgxrbm[$_GET['id']]['first_login_page']; $vwplgxrbm[$_GET['id']]['addltag_ids'] = isset($_POST['addltag_ids'] ) ? $_POST['addltag_ids'] : ''; $vwplgxrbm[$_GET['id']]['logout_page'] = isset($_POST['logout_page'] ) ? (int) $_POST['logout_page'] : $vwplgxrbm[$_GET['id']]['logout_page']; $vwplgxrbm[$_GET['id']]['name'] = isset($_POST['name'] ) ? $_POST['name'] : $vwplgxrbm[$_GET['id']]['name']; $vwplgxrbm[$_GET['id']]['payf_id'] = isset($_POST['payf_id'] ) ? (int) $_POST['payf_id'] : $vwplgxrbm[$_GET['id']]['payf_id']; $vwplgxrbm[$_GET['id']]['suspend_id'] = isset($_POST['suspend_id'] ) ? (int) $_POST['suspend_id'] : $vwplgxrbm[$_GET['id']]['suspend_id']; $vwplgxrbm[$_GET['id']]['theme'] = isset($_POST['theme'] ) ? $_POST['theme'] : $vwplgxrbm[$_GET['id']]['theme']; $vwplgxrbm[$_GET['id']]['roles'] = array_filter(isset($_POST['roles'] ) ? $_POST['roles'] : $vwplgxrbm[$_GET['id']]['roles'] ); $vwplgxrbm[$_GET['id']]['main_id'] = $_GET['id']; $vwplgxrbm[$_GET['id']]['login_redirect_priority'] = isset($_POST['login_redirect_priority'] ) ? (int) $_POST['login_redirect_priority'] : $vwplgxrbm[$_GET['id']]['login_redirect_priority']; $vwplgxrbm[$_GET['id']]['payf_homepage'] = isset($_POST['payf_homepage'] ) ? (int) $_POST['payf_homepage'] : $vwplgxrbm[$_GET['id']]['payf_homepage']; $vwplgxrbm[$_GET['id']]['susp_homepage'] = isset($_POST['susp_homepage'] ) ? (int) $_POST['susp_homepage'] : $vwplgxrbm[$_GET['id']]['payf_homepage']; $vwplgxrbm[$_GET['id']]['canc_homepage'] = isset($_POST['canc_homepage'] ) ? (int) $_POST['canc_homepage'] : $vwplgxrbm[$_GET['id']]['canc_homepage']; $vwplgxrbm[$_GET['id']]['dynamic_menus'] = isset($_POST['dynamic_menus'] ) ? (int) $_POST['dynamic_menus'] : $vwplgxrbm[$_GET['id']]['dynamic_menus']; wpljwbf2::wplc1on7('Your membership level &ldquo;<strong>' . $_POST['name'] . '</strong>&rdquo; has been updated.' ); } } elseif (isset($_POST['action'] ) && $_POST['action'] == 'add' ) { if (! empty($_POST['name'] ) && ! empty($_POST['main_id'] ) ) { $vwplgxrbm[$_POST['main_id']]['name'] = ucwords(trim($_POST['name'] ) ); $vwplgxrbm[$_POST['main_id']]['main_id'] = (int) $_POST['main_id']; $vwplgxrbm[$_POST['main_id']]['addltag_ids'] = (empty($_POST['addltag_ids'] ) ? '' : $_POST['addltag_ids'] ); $vwplgxrbm[$_POST['main_id']]['payf_id'] = (int) $_POST['payf_id']; $vwplgxrbm[$_POST['main_id']]['cancel_id'] = (int) $_POST['cancel_id']; $vwplgxrbm[$_POST['main_id']]['suspend_id'] = (int) $_POST['suspend_id']; $vwplgxrbm[$_POST['main_id']]['level'] = (int) $_POST['level']; $vwplgxrbm[$_POST['main_id']]['roles'] = (array) $_POST['roles']; $vwplgxrbm[$_POST['main_id']]['login_page'] = (int) $_POST['login_page']; $vwplgxrbm[$_POST['main_id']]['first_login_page'] = (int) $_POST['first_login_page']; $vwplgxrbm[$_POST['main_id']]['logout_page'] = (int) $_POST['logout_page']; $vwplgxrbm[$_POST['main_id']]['theme'] = $_POST['theme']; $vwplgxrbm[$_POST['main_id']]['payf_homepage'] = (int) $_POST['payf_homepage']; $vwplgxrbm[$_POST['main_id']]['susp_homepage'] = (int) $_POST['susp_homepage']; $vwplgxrbm[$_POST['main_id']]['canc_homepage'] = (int) $_POST['canc_homepage']; $vwplgxrbm[$_POST['main_id']]['dynamic_menus'] = isset($_POST['dynamic_menus'] ) ? (int) $_POST['dynamic_menus'] : 0;  $vwpltmtyd = 'Memberium ' . $vwplgxrbm[$_POST['main_id']]['name']; $vwpla7qz = sanitize_key('memberium_' . $vwplgxrbm[$_POST['main_id']]['name'] ); $vwpl_ecm2 = get_role($vwpla7qz ); if (! $vwpl_ecm2 ) { $vwpl_ecm2 = add_role($vwpla7qz, $vwpltmtyd ); } $vwpl_ecm2->add_cap('wplqsa2u'); } else { wpljwbf2::wplc1on7('Failed to add Membership Level.  Missing Fields' ); } } elseif (isset($_POST['action'] ) && $_POST['action'] == 'Delete' ) { unset($vwplgxrbm[$_POST['membership_id']] ); wpljwbf2::wplc1on7('Your membership level &ldquo;<strong>' . $vwplgxrbm[$_POST['membership_id']]['name'] . '</strong>&rdquo; has been deleted.' ); } elseif (! empty($_POST['create-category'] ) ) {  $vwplhv_d2x = trim($_POST['category_name'] ); $vwplx1ap5_ = 'SELECT count(*) FROM ' . MEMBERIUM_DB_CONTACTGROUPCATEGORIES . ' WHERE appname = %s AND name = %s ;'; $vwplx1ap5_ = $wpdb->prepare($vwplx1ap5_, $this->appname, $vwplhv_d2x ); $vwpltidk1 = $wpdb->get_var($vwplx1ap5_ ); if (! $vwpltidk1 ) { $vwplheakg = array('CategoryName' => $vwplhv_d2x ); $this->isdk->dsAdd('ContactGroupCategory', $vwplheakg ); memberium_app()->wplaw3p(); wpljwbf2::wplc1on7('Your Category &ldquo;<strong>' . $vwplhv_d2x . '</strong>&rdquo; has been created.' ); } else { wpljwbf2::wplc1on7('Your Category &ldquo;<strong>' . $vwplhv_d2x . '</strong>&rdquo; already exists.' ); } } elseif (! empty($_POST['create-tag'] ) ) {  $vwpljy5dw3 = trim($_POST['tag_name'] ); $vwplk_sn = (int) abs(trim($_POST['category_id'] ) ); $vwplx1ap5_ = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; $vwplx1ap5_ = $wpdb->prepare($vwplx1ap5_, $this->appname, $vwpljy5dw3 ); $vwpltidk1 = $wpdb->get_var($vwplx1ap5_ ); if (! $vwpltidk1 ) { memberium_app()->wplstw20($vwpljy5dw3, $vwplk_sn, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); wpllbej::wplwwbm9(); wpljwbf2::wplc1on7('Your Tag &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; has been created.' ); } else { wpljwbf2::wplc1on7('Your Tag &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; already exists.' ); } } elseif (! empty($_POST['create-membership'] ) ) {  $vwpljy5dw3 = trim($_POST['tag_name'] ); $vwplk_sn = (int) abs(trim($_POST['category_id'] ) ); $vwplqz3lcx = (empty($_POST['create_set']) ) ? false : true; $vwplxs06g8 = $vwplqz3lcx ? array('', 'PAYF', 'CANC', 'SUSP' ) : array('', 'PAYF' ); $vwpltalx = false; $vwplefuy_k = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; $vwplc1e_a = array(); foreach($vwplxs06g8 as $vwpllrdc ) { $vwplhmzlyo = $vwpljy5dw3 . $vwpllrdc; $vwplx1ap5_ = $wpdb->prepare($vwplefuy_k, $this->appname, $vwplhmzlyo ); $vwpltidk1 = $wpdb->get_var($vwplx1ap5_ ); if (! $vwpltidk1 ) { $vwplc1e_a['Tag' . $vwpllrdc] = memberium_app()->wplstw20($vwpljy5dw3 . $vwpllrdc, $vwplk_sn, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); $vwpltalx = true; } } if ($vwpltalx ) { wpllbej::wplwwbm9(); $vwplf1tb = array( 'name' => $vwpljy5dw3, 'main_id' => $vwplc1e_a['Tag'], 'payf_id' => isset($vwplc1e_a['TagPAYF'] ) ? $vwplc1e_a['TagPAYF'] : 0, 'cancel_id' => isset($vwplc1e_a['TagCANC'] ) ? $vwplc1e_a['TagCANC'] : 0, 'suspend_id' => isset($vwplc1e_a['TagSUSP'] ) ? $vwplc1e_a['TagSUSP'] : 0, 'level' => 0, 'roles' => array(), 'login_page' => 0, 'first_login_page' => 0, 'logout_page' => 0, 'theme' => '', 'login_redirect_priority' => 0, 'addltag_ids' => '', 'payf_homepage' => 0, 'susp_homepage' => 0, 'canc_homepage' => 0, 'dynamic_menus' => 0, ); $vwplgxrbm[$vwplc1e_a['Tag']] = $vwplf1tb;  $vwpltmtyd = 'Memberium ' . $vwpljy5dw3; $vwpla7qz = sanitize_key('memberium_' . $vwpljy5dw3 ); $vwpl_ecm2 = get_role($vwpla7qz ); if (! $vwpl_ecm2 ) { $vwpl_ecm2 = add_role($vwpla7qz, $vwpltmtyd ); } $vwpl_ecm2->add_cap('wplqsa2u'); wpljwbf2::wplc1on7('Your Membership Tags for &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; and Level have been created.' ); } else { wpljwbf2::wplc1on7('Your Membership Tags for &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; already exist.' ); } } elseif (! empty($_POST['create-tags'] ) ) {  $vwplv8ziv = trim($_POST['tag_name'] ); $vwplx5d8 = (int) $_POST['start']; $vwplbts4 = (int) $_POST['end']; $vwplk_sn = (int) abs(trim($_POST['category_id'] ) ); $vwpltalx = false; $vwplefuy_k = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; if (false === strpos($vwplv8ziv, '%d' ) ) { $vwplv8ziv .= ' %d'; } for ($vwplt_5ro = $vwplx5d8; $vwplt_5ro <= $vwplbts4; $vwplt_5ro++ ) { $vwpljy5dw3 = sprintf($vwplv8ziv, $vwplt_5ro ); memberium_app()->wplstw20($vwpljy5dw3 . $vwpllrdc, $vwplk_sn, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); $vwpltalx = true; } if ($vwpltalx ) { wpllbej::wplwwbm9(); wpljwbf2::wplc1on7('Your Drip Tags for &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; have been created.' ); } else { wpljwbf2::wplc1on7('Your Drip Tags for &ldquo;<strong>' . $vwpljy5dw3 . '</strong>&rdquo; already exist.' ); } } else {   } uasort($vwplgxrbm, function ($vwplchgu, $vwplbb83 ) { if ($vwplchgu['level'] == $vwplbb83['level'] ) { if ($vwplchgu['name'] == $vwplbb83['name'] ) { return 0; } return ($vwplchgu['name'] < $vwplbb83['name'] ) ? -1 : 1; } return ($vwplchgu['level'] < $vwplbb83['level'] ) ? -1 : 1; } ); $this->settings['memberships'] = $vwplgxrbm; update_option('memberium', $this->settings ); wpljwbf2::wplyb40j1(); } if (! empty($_GET['id'] ) && ! empty($_GET['action'] ) && $_GET['action'] == 'edit' ) { $vwplbquy = $this->settings['memberships'][$_GET['id']]; if (is_array($vwplbquy ) ) { if (! isset($vwplbquy['main_id'] ) ) { $vwplbquy['main_id'] = $_GET['id']; } if (empty($vwplbquy['addltag_ids'] ) ) { $vwplbquy['addltag_ids'] = ''; }  echo '<div class="wrap memberium">'; echo '<p>Return to <a href="?page=memberium-memberships">Membership Screen</a></p>'; echo '<form method="post">'; echo '<h1 style="margin-bottom:10px;">Membership Level Editor</h1>'; echo '<label style="margin-left:0px;">Membership Name:</label>'; echo '<input type="text" name="name" value="', $vwplbquy['name'], '" required="required" style="font-size:180%; margin-top:-10px;">'; echo '<ul>'; echo '<h3>Tags</h3>'; echo '<li>'; echo '<label style="color:green;"><strong>Access Tag</strong></label>'; echo '<input disabled="disabled" value="', (int) $_GET['id'], '" type="text" class="requiredtaglistdropdown" required="required" style="width:300px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<li>'; echo '<label style="color:green;"><strong>Add\'l Access Tags</strong></label>'; echo '<input value="', $vwplbquy['addltag_ids'], '" type="text" class="multitaglist" name="addltag_ids" style="width:500px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<li>'; echo '<label style="color:red;"><strong>Payment Failure</strong></label>'; echo '<input value="', (int) $vwplbquy['payf_id'], '" name="payf_id" type="text" class="taglistdropdown" style="width:350px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<li>'; echo '<label style="color:red;"><strong>Cancellation</strong></label>'; echo '<input value="', (int) $vwplbquy['cancel_id'], '" name="cancel_id" type="text" class="taglistdropdown" style="width:350px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<li>'; echo '<label style="color:red;"><strong>Suspension Tag</strong></label>'; echo '<input value="', (int) $vwplbquy['suspend_id'], '" name="suspend_id" type="text" class="taglistdropdown" style="width:350px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<hr>'; echo '<h3>Level</h3>'; echo '<li>'; echo '<label>Level</label>'; echo '<input type="number" value="', $vwplbquy['level'], '" name="level" min="0" max="999999" required="required" style="text-align:right; width: 80px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<hr>'; echo '<h3>Roles</h3>'; echo '<li>'; echo '<label>WordPress Roles</label>'; echo '<input value="" name="roles[]" type="hidden">'; echo '<select style="width:400px; height:1.6em;" class="roles-selector" name="roles[]" multiple="multiple" placeholder="Select WordPress roles to apply on login">'; echo '<option value="">(None)</option>'; if (empty($vwplbquy['roles'] ) ) { $vwplbquy['roles'] = array(); } if (is_array($vwplluny3 ) ) { foreach ($vwplluny3 as $vwpl_ecm2 ) { echo '<option value="', $vwpl_ecm2['id'], '" ', in_array($vwpl_ecm2['id'], $vwplbquy['roles'] ) ? ' selected="selected" ' : '', '>', $vwpl_ecm2['name'], '</option>'; } } echo '</select>', wpljwbf2::wplypewkt(0000 ); echo '</li><br />'; echo '<hr>'; echo '<h3>Special Pages</h3>'; echo '<li>'; echo '<label>Home Page Priority</label>'; echo '<input type="number" value="', (int) $vwplbquy['login_redirect_priority'], '" name="login_redirect_priority" min="0" max="999999" required="required" style="text-align:right; width: 80px;">', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<li>'; echo '<label>First Login Page</label>'; echo '<input value="', (int) $vwplbquy['first_login_page'], '" name="first_login_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>Membership Home Page</label>'; echo '<input value="', $vwplbquy['login_page'], '" name="login_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>Membership Logout Page</label>'; echo '<input value="', $vwplbquy['logout_page'], '" name="logout_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>PAYF Home Page</label>'; echo '<input value="', (int) $vwplbquy['payf_homepage'] ,'" name="payf_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<li>'; echo '<label>SUSP Home Page</label>'; echo '<input value="', (int) $vwplbquy['susp_homepage'] ,'" name="susp_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<li>'; echo '<label>CANC Home Page</label>'; echo '<input value="', (int) $vwplbquy['canc_homepage'] ,'" name="canc_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<hr>'; echo '<h3>Theme</h3>'; echo '<li>'; echo '<label>Theme</label>'; echo '<input value="', $vwplbquy['theme'], '" name="theme" type="text" class="themelistdropdown" style="width:250px;">'; echo '</li>'; if (! empty($this->settings['settings']['dynamic_menus'] ) ) { wpljwbf2::wplsok6r('Exclude from Personal Menus','dynamic_menus', 0, $vwplbquy['dynamic_menus'] ); } else { echo '<input type="hidden" value="' . $vwplbquy['dynamic_menus'] . '" name="dynamic_menus">'; } echo '<hr>'; echo '</ul>'; echo '<input type="submit" class="button-primary" value="Update Membership Level">'; echo '</form>'; echo '</div>';  $vwpljrgp = wp_get_themes(); $vwplnxrh = array(); $vwplnxrh[] = array('id' => '', 'text' => '(Default )' ); foreach ($vwpljrgp as $vwplso1pw => $vwplqvwk ) { $vwplnxrh[] = array('id' => $vwplso1pw, 'text' => $vwplqvwk->Name ); } $vwplnxrh = json_encode($vwplnxrh ); unset($vwplso1pw, $vwplqvwk, $vwpljrgp );  $vwpls0hwb5 = wplj_l2t::wplaajf(TRUE ); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwpldbhwy9 = array(); $vwpldbhwy9[] = array( 'id' => 0, 'text' => '(None)' );  $vwplu14yc9 = array(); foreach ($this->settings['memberships'] as $vwply17edn => $vwplph268z ) { if ($vwply17edn <> $_GET['id'] ) { $vwplu14yc9[] = $vwply17edn; $vwplu14yc9[] = $vwplph268z['payf_id']; $vwplu14yc9[] = $vwplph268z['cancel_id']; $vwplu14yc9[] = $vwplph268z['suspend_id']; } } $vwplu14yc9 = array_unique(array_filter($vwplu14yc9 ) ); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju ) { if (! in_array($vwplopnf, $vwplu14yc9 ) ) { $vwpldbhwy9[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); $vwplepahq[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); } } $vwpldbhwy9 = json_encode($vwpldbhwy9 ); $vwplepahq = json_encode($vwplepahq ); unset($vwpls0hwb5, $vwplopnf, $vwpltmveju ); $vwplrx1f = $this->wplfb48t(); echo '<script>'; echo 'var themelist       = ', $vwplnxrh, ';'; echo 'var taglist         = ', $vwpldbhwy9, ';'; echo 'var requiredtaglist = ', $vwplepahq, ';'; echo 'var pagelist        = ', $vwplrx1f, ';'; echo '</script>'; } else { echo '<p>Invalid Membership Id</p>'; } } elseif (! empty($_GET['action'] ) && $_GET['action'] == 'add' ) {  echo '<div class="wrap memberium">'; echo '<p>Return to <a href="?page=memberium-memberships">Membership Screen</a></p>'; echo '<form method="post" action="?page=memberium-memberships">'; echo '<input name="action" value="add" type="hidden">'; echo '<h1 style="margin-bottom:20px;">Create Membership Tags and Level</h1>'; echo '<p style="margin-bottom:20px;">'; echo 'Looking for help to understand how to create a membership level or questions about what to input where? ', wpljwbf2::wplypewkt(9495, 'Click Here' ); echo '</p>'; echo '<label style="margin-left:0px;">Membership Name:</label>'; echo '<input type="text" name="name" value="" placeholder="Enter Membership Name" required="required" size="25" tabindex="1" style="font-size:150%; margin-top:-10px;"> '; echo '<ul>'; echo '<h3>Tags</h3>'; echo '<li>'; echo '<label><strong style="color:green;">Access Tag</strong> <strong>*</strong></label>'; echo '<input value="" name="main_id" type="text" placeholder="This setting is required" class="requiredtaglistdropdown" required="required" style="width:350px;">'; echo '</li>'; echo '<li>'; echo '<label><strong style="color:red;">Payment Failure (PAYF)</strong></label>'; echo '<input value="0" name="payf_id" type="text" class="taglistdropdown" style="width:350px;">'; echo '</li>'; echo '<li>'; echo '<label><strong style="color:red;">Cancellation (CANC)</strong></label>'; echo '<input value="0" name="cancel_id" type="text" class="taglistdropdown" style="width:350px;">'; echo '</li>'; echo '<li>'; echo '<label><strong style="color:red;">Suspension Tag (SUSP)</strong></label>'; echo '<input value="0" name="suspend_id" type="text" class="taglistdropdown" style="width:350px;">'; echo '</li>'; echo '<hr>'; echo '<h3>Level</h3>'; echo '<li>'; echo '<label>Level</label>'; echo '<input type="number" value="0" name="level" min="0" max="999999" style="text-align:right; width: 80px;">'; echo '</li>'; echo '<hr>'; echo '<h3>Roles</h3>'; echo '<li>'; echo '<label>WordPress Roles</label>'; echo '<input value="" name="roles[]" type="hidden">'; echo '<select style="width:400px; height:1.6em;" class="roles-selector" name="roles[]" multiple="multiple" placeholder="Select WordPress roles to apply on login">'; echo '<option value="">(None)</option>'; if (empty($vwplbquy['roles'] ) ) $vwplbquy['roles'] = array(); foreach ($vwplluny3 as $vwpl_ecm2 ) { echo '<option value="', $vwpl_ecm2['id'], '" ', in_array($vwpl_ecm2['id'], $vwplbquy['roles'] ) ? ' selected="selected" ' : '', '>', $vwpl_ecm2['name'], '</option>'; } echo '</select>', wpljwbf2::wplypewkt(0000 ); echo '</li>'; echo '<hr>'; echo '<h3>Special Pages</h3>'; echo '<li>'; echo '<label>First Login Page</label>'; echo '<input value="0" name="first_login_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>Membership Home Page</label>'; echo '<input value="0" name="login_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>Membership Logout Page</label>'; echo '<input value="0" name="logout_page" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<label>PAYF Home Page</label>'; echo '<input value="0" name="payf_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<li>'; echo '<label>SUSP Home Page</label>'; echo '<input value="0" name="susp_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; echo '<li>'; echo '<label>CANC Home Page</label>'; echo '<input value="0" name="canc_homepage" type="text" class="pagelistdropdown" style="width:500px;">'; echo '</li>'; echo '<li>'; $vwplbquy['theme'] = isset($vwplbquy['theme'] ) ? $vwplbquy['theme'] : ''; echo '<hr>'; echo '<h3>Theme</h3>'; echo '<li>'; echo '<label>Theme</label>'; echo '<input value="', $vwplbquy['theme'], '" name="theme" type="text" class="themelistdropdown" style="width:250px;">'; echo '</li>'; $vwplbquy['dynamic_menus'] = isset($vwplbquy['dynamic_menus'] ) ? $vwplbquy['dynamic_menus'] : 0; wpljwbf2::wplsok6r('Exclude from Personal Menus','dynamic_menus', 0, $vwplbquy['dynamic_menus'] ); echo '<hr>'; echo '</ul>'; echo '<input type="submit" class="button-primary" value="Create Membership Level">'; echo '</form>'; echo '<p style="margin-bottom:20px;">'; echo 'Looking for help to understand how to create a membership level or questions about what to input where? ', wpljwbf2::wplypewkt(9495, 'Click Here' ); echo '</p>'; echo '</div>';  $vwpljrgp = wp_get_themes(); $vwplnxrh = array(); $vwplnxrh[] = array('id' => '', 'text' => '(Default )' ); foreach ($vwpljrgp as $vwplso1pw => $vwplqvwk ) { $vwplnxrh[] = array( 'id' => $vwplso1pw, 'text' => $vwplqvwk->Name ); } $vwplnxrh = json_encode($vwplnxrh ); unset($vwplso1pw, $vwplqvwk, $vwpljrgp );  $vwpls0hwb5 = wplj_l2t::wplaajf(TRUE ); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwpldbhwy9 = array(); $vwplepahq = array(); $vwpldbhwy9[] = array('id' => 0, 'text' => '(None)' );  $vwplu14yc9 = array(); foreach ($this->settings['memberships'] as $vwply17edn => $vwplph268z ) { $vwplu14yc9[] = $vwply17edn; $vwplu14yc9[] = $vwplph268z['payf_id']; $vwplu14yc9[] = $vwplph268z['cancel_id']; $vwplu14yc9[] = $vwplph268z['suspend_id']; } $vwplu14yc9 = array_unique(array_filter($vwplu14yc9 ) ); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju ) { if (! in_array($vwplopnf, $vwplu14yc9 ) ) { $vwpldbhwy9[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); $vwplepahq[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); } } $vwpldbhwy9 = json_encode($vwpldbhwy9 ); $vwplepahq = json_encode($vwplepahq ); unset($vwpls0hwb5, $vwplopnf, $vwpltmveju );  $vwplx1ap5_ = "SELECT `ID`, `post_title` FROM `{$wpdb->posts}` WHERE `post_status` = 'publish' AND `post_type` IN ('" . implode("','", wpljwbf2::wplb9z47() ) . "' ) ORDER BY `id` ASC;"; $vwpldqjgk = $wpdb->get_results($vwplx1ap5_, ARRAY_A ); $vwplrx1f[] = array('id' => 0, 'text' => '(Default )' ); foreach ($vwpldqjgk as $vwplopnf=>$page ) { $vwplrx1f[] = array('id' => $page['ID'], 'text' => $page['post_title'] . ' (' . $page['ID'] . ')' ); unset($vwpldqjgk[$vwplopnf] ); } unset($page, $vwplx1ap5_ ); $vwplrx1f = json_encode($vwplrx1f ); echo '<script>'; echo 'var themelist       = ', $vwplnxrh, ';'; echo 'var taglist         = ', $vwpldbhwy9, ';'; echo 'var requiredtaglist = ', $vwplepahq, ';'; echo 'var pagelist        = ', $vwplrx1f, ';'; echo '</script>'; } else {  echo '<div class="wrap">'; echo '<h1>Memberium Membership Settings</h1>'; echo '<h3>Current Membership Levels', wpljwbf2::wplypewkt(1222 ), '</h3>'; echo '<div style="width:90%;">'; echo '<p>'; echo 'These are the membership levels you have already set up, click the name of a membership level below to edit it or click the "Create New Membership Level" button to add a new membership level.'; echo '</p>'; echo '<hr />'; echo '<form method="POST" action="">'; echo '<input type="submit" name="main_action" value="Update Levels" style="position:absolute;left:-100%;" />'; echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr style="background-color:#eee">'; echo '<th style="width:50px;"></th>'; echo '<th style="width:250px;"><strong>Level&nbsp;Name</strong></th>'; echo '<th><strong>Tag</strong></th>'; echo '<th style="width:75px;"><strong>Level</strong></th>'; echo '<th style="width:75px;"><strong>Login Priority</strong></th>'; echo '<th><strong>Homepage</strong></th>'; echo '<th></th>'; echo '</tr>'; $vwplgxrbm = empty($this->settings['memberships'] ) ? array() : $this->settings['memberships']; $vwplufm82 = count($vwplgxrbm ); $vwplcr3c9 = wplj_l2t::wplaajf(false ); $vwplcr3c9 = $vwplcr3c9['mc']; if ($vwplufm82 == 0 ) { echo '<tr><td colspan="99">You have no membership levels created.</td></tr>'; } else { foreach ($vwplgxrbm as $vwplopnf => $vwplbquy ) { $vwplqvwk = wp_get_theme($vwplbquy['theme'] ); $vwplzzlf5b = get_post($vwplbquy['login_page'] ); $vwplxfu6z8 = empty($vwplzzlf5b->post_title ) ? '(Default)' : $vwplzzlf5b->post_title; $vwplcltpy = $vwplbquy['login_page'] > 0 ? ' (' . $vwplbquy['login_page'] . ')' : ''; $vwpljy5dw3 = ! empty($vwplcr3c9[$vwplopnf]['name'] ) ? $vwplcr3c9[$vwplopnf]['name'] . ' (' . $vwplopnf . ')' : '<em>Tag Missing</em>'; $vwpljy5dw3 = ! empty($vwplcr3c9[$vwplopnf] ) ? $vwplcr3c9[$vwplopnf] . ' (' . $vwplopnf . ')' : '<em>Tag Missing</em>'; $vwplbquy['level'] = isset($vwplbquy['level'] ) ? $vwplbquy['level'] : 0; $vwplbquy['login_redirect_priority'] = isset($vwplbquy['login_redirect_priority'] ) ? $vwplbquy['login_redirect_priority'] : 0; echo '<tr>'; echo '<td><a class="button-secondary" href="?page=', $_GET['page'], '&action=edit&id=', $vwplopnf, '">Edit</a></td>'; echo '<td><strong><a href="?page=', $_GET['page'], '&action=edit&id=', $vwplopnf, '">', $vwplbquy['name'], '</a></strong></td>'; echo '<td>', $vwpljy5dw3, '</td>'; echo '<td><input type=number min=0 max=99999 maxlength=6 name="level[', $vwplopnf, ']" value="', (int) $vwplbquy['level'], '" style="width:80px;"></td>'; echo '<td><input type=number min=0 max=99999 maxlength=6 name="login_redirect_priority[', $vwplopnf, ']" value="', (int) $vwplbquy['login_redirect_priority'], '" style="width:80px;"></td>'; if (is_object($vwplzzlf5b ) ) { echo '<td><a href="', get_permalink($vwplzzlf5b->ID ), '">', $vwplxfu6z8, $vwplcltpy, '</a></td>'; } else { echo '<td>(Default)</td>'; } echo '<td>', get_submit_button('Delete', 'delete', 'main_action[' . $vwplopnf . ']', false ); '</td>'; echo '</tr>'; } } unset($vwplqvwk ); echo '</table>';  echo '<p>'; echo '<a href="?page=memberium-memberships&action=add" class="button-primary">Create New Membership Level</a> &nbsp; '; if (count($vwplgxrbm ) ) { echo '<input type="submit" name="main_action" value="Update Membership Levels" class="button-primary" />'; } echo '</form>'; echo '<hr />';  if (!isset($this->settings['settings']['ignore_tag_categories'] ) ) { $this->settings['settings']['ignore_tag_categories'] = ''; } $vwplx1ap5_ = 'SELECT id, name FROM ' . MEMBERIUM_DB_CONTACTGROUPCATEGORIES . ' WHERE appname = %s ORDER BY name ASC'; $vwplx1ap5_ = $wpdb->prepare($vwplx1ap5_, $this->appname ); $vwplawkh = $wpdb->get_results($vwplx1ap5_, ARRAY_A ); $vwpled973 = explode(',', $this->settings['settings']['ignore_tag_categories'] ); $vwplwio984 = ''; if (is_array($vwplawkh) ) { foreach ($vwplawkh as $tag_category) { $vwplwio984 .= '<option value="' . $tag_category['id'] . '">' . $tag_category['name'] . '</option>'; } } $vwplwio984 .= '<option value="0" selected="selected">(None)</option>'; unset($vwplx1ap5_, $vwplawkh, $vwpled973 );  echo '<h3>Tag Builder Pro</h3>'; echo '<table class="widefat">';  echo '<form method="POST" action="">'; echo '<tr>'; echo '<td>Create Membership Level:</td>'; echo '<td>'; echo '<input name="tag_name" type="text" size="20" /> &nbsp; '; echo '<select name="category_id" class="basic-single" style="width:200px;">', $vwplwio984, '</select> &nbsp; '; echo '<input type=checkbox name="create_set" value=all /> Include SUSP/CANC &nbsp; '; echo '<input type="submit" name="create-membership" value="Create" class="button-primary" /> &nbsp; '; echo wpljwbf2::wplypewkt(8853 ), '</td>'; echo '</tr>'; echo '</form>';  echo '<form method="POST" action="">'; echo '<tr>'; echo '<td>Create New Tag:</td>'; echo '<td>'; echo '<input name=tag_name type=text size=20 required=required /> &nbsp; '; echo '<select name=category_id class=basic-single required=required style="width:200px;">', $vwplwio984, '</select> &nbsp; '; echo '<input type="submit" name="create-tag" value="Create" class="button-primary" /> &nbsp; '; echo wpljwbf2::wplypewkt(8852 ), '</td>'; echo '</tr>'; echo '</form>';  echo '<form method="POST" action="">'; echo '<tr>'; echo '<td>Create Drip Tags:</td>'; echo '<td>'; echo '<input name="tag_name" type="text" size="20" required=required /> &nbsp; '; echo 'Start: <input name=start type=number min=1 value=1 max=300 size=3 required=required /> &nbsp; '; echo 'End: <input name=end type=number min=1 value=1 max=300 size=3 required=required/> &nbsp; '; echo '<select name="category_id" class="basic-single" style="width:200px;">', $vwplwio984, '</select> &nbsp; '; echo '<input type="submit" name="create-tags" value="Create All" class="button-primary" /> &nbsp; '; echo wpljwbf2::wplypewkt(8856 ), '</td>'; echo '</tr>'; echo '</form>';  echo '<form method="POST" action="">'; echo '<tr>'; echo '<td>Create New Category:</td>'; echo '<td>'; echo '<input name=category_name type=text size=20 required=required /> &nbsp; '; echo '<input type="submit" name="create-category" value="Create" class="button-primary" /> &nbsp;'; echo wpljwbf2::wplypewkt(8858 ), '</td>'; echo '</tr>'; echo '</form>'; echo '</table>'; echo '&nbsp;<br />'; echo '</div>'; echo '</div>'; }
