<?php
if (! defined('ABSPATH' ) ) { die(); } if (!current_user_can('manage_options' ) ) { wp_die(__('You do not have sufficient permissions to access this page.' ) ); } $vwplanieul = empty($_GET['limit'] ) ? 15 : (int) trim($_GET['limit'] ); $vwplx5d8 = empty($_GET['start'] ) ? 0 : (int) trim($_GET['start'] ); $vwplc_uoh4 = empty($_GET['name'] ) ? '' : strtolower(trim ($_GET['name'] ) ); $vwplc27lp = empty($_GET['ip'] ) ? '' : trim($_GET['ip'] ); $vwplw5rgd3 = wplz8bid::wplm3z9k('appname'); $vwplnzlj0t = MEMBERIUM_DB_LOGINLOG; $vwpljupbl4 = ''; $vwpljupbl4 .= empty($vwplc_uoh4 ) ? '' : " AND `username` LIKE '%" . $wpdb->esc_like($vwplc_uoh4 ) . "%' "; $vwpljupbl4 .= empty($vwplc27lp ) ? '' : " AND `ipaddress` LIKE '%" . $wpdb->esc_like($vwplc27lp ) . "%' "; $vwplx1ap5_ = "SELECT `logintime`, `ipaddress`, `username` FROM `{$vwplnzlj0t}` WHERE `appname` = '{$vwplw5rgd3}' {$vwpljupbl4} ORDER BY `id` DESC LIMIT {$vwplanieul} ;"; $vwply4j8x = $wpdb->get_results($vwplx1ap5_, ARRAY_A ); if (! is_array($vwply4j8x ) || empty($vwply4j8x ) ) { echo '<p>The login log is empty.</p>'; } else { $vwpli0fuq = array(); $vwpli_ys = get_option('timezone_string'); $vwplvu0pn = date_default_timezone_get(); if (! empty($vwpli_ys) ) { date_default_timezone_set($vwpli_ys ); } echo '<table class="widefat">'; echo '<tr>'; echo '<td width="150">Login Time</td>'; echo '<td width="125">IP Address</td>'; echo '<td>Username</td>'; echo '<td>Location</td>'; echo '</tr>'; foreach($vwply4j8x as $vwplheakg ) { $vwpla7rcb8 = $vwplheakg['ipaddress']; if (! isset($vwpli0fuq[$vwpla7rcb8] ) ) { $vwpli0fuq[$vwpla7rcb8] = wplr6om::wpld7onq($vwpla7rcb8 ); } echo '<tr>'; echo '<td>', date('Y-m-d H:i:s', $vwplheakg['logintime'] ), '</td>'; echo '<td><a href="https://geoiptool.com/en/?ip=' . $vwplheakg['ipaddress'] . '" target="geoip">', $vwplheakg['ipaddress'], '</a></td>'; echo '<td>', $vwplheakg['username'], '</td>'; echo '<td>'; if (! empty($vwpli0fuq[$vwpla7rcb8]['latitude'] ) ) { echo '<a target="map" href="https://www.google.com.au/maps/@', $vwpli0fuq[$vwpla7rcb8]['latitude'], ',', $vwpli0fuq[$vwpla7rcb8]['longitude'], ',13z">'; echo '<em class="fa fa-map-marker"></em> '; echo '</a>&nbsp;'; } if (isset($vwpli0fuq[$vwpla7rcb8] ) && is_array($vwpli0fuq[$vwpla7rcb8] ) ) { if (isset($vwpli0fuq[$vwpla7rcb8]['city'] ) ) { echo $vwpli0fuq[$vwpla7rcb8]['city'], ', ', $vwpli0fuq[$vwpla7rcb8]['region_name'], ' ', $vwpli0fuq[$vwpla7rcb8]['country_name']; } } else { echo '<em>Unknown</em>'; } echo '</td>'; echo '</tr>'; } date_default_timezone_set($vwplvu0pn ); echo '</table>'; } echo '<form method="get" style="margin-top:12px;display:inline-block;">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo "Username: <input type='text' name='name' value='{$vwplc_uoh4}' placeholder='Username'>"; echo "IP Address: <input type='text' name='ip' value='{$vwplc27lp}' placeholder='IP Address'>"; echo "Limit: <input type='text' name='limit' value='{$vwplanieul}' placeholder='# Results'>"; echo '<input type="submit" value="Search" class="button-primary" style="margin-left:15px;">'; echo '</form>'; echo '<form method="post">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo '<input type="hidden" name="tab" value="login">'; echo '<input type="submit" name="delete_login_log" value="Delete Log" class="button delete">'; echo '</form>';
