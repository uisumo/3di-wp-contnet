<?php
 if (!defined('ABSPATH' ) ) { die(); } if (!current_user_can('manage_options' ) ) { wp_die(__('You do not have sufficient permissions to access this page.' ) ); } global $i2sdk, $wpdb; $vwplelob86 = $this->settings['settings']; $vwplelob86['merchant_account_id'] = isset($vwplelob86['merchant_account_id'] ) ? $vwplelob86['merchant_account_id'] : 0; $vwplelob86['affiliate_detect'] = isset($vwplelob86['affiliate_detect'] ) ? $vwplelob86['affiliate_detect'] : 0; $_GET['tab'] = isset($_GET['tab'] ) ? $_GET['tab'] : 'general'; if ($_SERVER['REQUEST_METHOD'] == 'POST' ) { if (! wp_verify_nonce($_POST['memberium_ecommerce_nonce'], MEMBERIUM_LIB ) ) { wp_die('nonce error' ); return; } if (isset($_GET['tab'] ) ) { if ($_GET['tab'] == 'general' ) { $vwplelob86['affiliate_detect'] = isset($_POST['affiliate_detect'] ) ? $_POST['affiliate_detect'] : $vwplelob86['affiliate_detect']; $vwplelob86['merchant_account_id'] = isset($_POST['merchant_account_id'] ) ? (int) trim($_POST['merchant_account_id'] ) : $vwplelob86['merchant_account_id']; wpljwbf2::wplc1on7('General eCommerce Options Updated' ); } elseif ($_GET['tab'] == 'subscriptions' ) { $this->settings['ecommerce']['actions'] = array(); foreach($_POST as $vwply17edn => $vwplph268z ) { if (is_array($vwplph268z ) ) { $this->settings['ecommerce']['actions'][$vwply17edn] = $vwplph268z; } } wpljwbf2::wplc1on7('Subscription Management Options Updated' ); } elseif ($_GET['tab'] == 'invoices' ) { $vwplg2bf = get_option('memberium_invoice_template', false ); $vwplg2bf['header'] = isset($_POST['invoice_header'] ) ? trim(stripslashes($_POST['invoice_header'] ) ) : ''; $vwplg2bf['items'] = isset($_POST['invoice_items'] ) ? trim(stripslashes($_POST['invoice_items'] ) ) : ''; $vwplg2bf['pre_payments'] = isset($_POST['invoice_pre_payments'] ) ? trim(stripslashes($_POST['invoice_pre_payments'] ) ) : ''; $vwplg2bf['payments'] = isset($_POST['invoice_payments'] ) ? trim(stripslashes($_POST['invoice_payments'] ) ) : ''; $vwplg2bf['pre_scheduled'] = isset($_POST['invoice_pre_scheduled'] ) ? trim(stripslashes($_POST['invoice_pre_scheduled'] ) ) : ''; $vwplg2bf['scheduled'] = isset($_POST['invoice_scheduled'] ) ? trim(stripslashes($_POST['invoice_scheduled'] ) ) : ''; $vwplg2bf['footer'] = isset($_POST['invoice_footer'] ) ? trim(stripslashes($_POST['invoice_footer'] ) ) : ''; $vwplg2bf = update_option('memberium_invoice_template', $vwplg2bf ); wpljwbf2::wplc1on7('Invoice Display Options Updated' ); } } $this->settings['settings'] = $vwplelob86; update_option('memberium', $this->settings ); } wpljwbf2::wplyb40j1(); $vwpln5qyc = array( 'general' => '<i class="fas fa-shopping-cart"></i> General', 'subscriptions' => '<i class="fas fa-sync-alt fa-spin"></i> Subscriptions', 'invoices' => '<i class="fas fa-file-invoice-dollar"></i> Invoices', ); $vwpl_qd2 = isset($_GET['tab'] ) ? strtolower($_GET['tab'] ) : 'general'; echo '<div class="wrap">'; echo '<h1>', _('eCommerce Settings' ), '</h1>'; echo '<h2 class="nav-tab-wrapper">'; foreach ($vwpln5qyc as $vwplesora => $vwplso1pw ) { $class = ($vwplesora == $vwpl_qd2 ) ? ' nav-tab-active' : ''; if ($vwplesora == $vwpl_qd2 ) { echo "<span class='nav-tab$class'>$vwplso1pw</span>"; } else { echo "<a class='nav-tab$class' href='?page=", $_GET['page'], "&tab=$vwplesora'>$vwplso1pw</a>"; } } echo '</h2>'; echo '<div class="tabcontent" style="margin-top:10px;">'; if ($vwpl_qd2 == 'general' ) { echo '<form method="POST" action="">'; wp_nonce_field(MEMBERIUM_LIB, 'memberium_ecommerce_nonce' ); echo '<ul>'; wpljwbf2::wplsok6r('Affiliate AutoDetect', 'affiliate_detect', 9124, $vwplelob86['affiliate_detect'] ); wpljwbf2::wpln84ebf( 'Password Reset Tag', 'first_login_page', (int) $vwplelob86['password_reset_tag'], 'taglistdropdown', array('help_id' => 1183 ) ); wpljwbf2::wplt5xt( 'Default Merchant Account', 'merchant_account_id', $vwplelob86['merchant_account_id'], array('help_id' => 6167, 'min' => 0, 'max' => 999, 'size' => 4, 'style' => 'text-align:right;width:80px;' ) ); echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; } elseif ($vwpl_qd2 == 'subscriptions' ) { echo '<form method="POST" action="">'; wp_nonce_field(MEMBERIUM_LIB, 'memberium_ecommerce_nonce' ); echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr>'; echo '<th>Subscription</th><th>Payment Action</th><th>Payment Goal</th><th>Cancel Action</th><th>Cancel Goal</th><th>End Date Action</th><th>End Date Goal</th>'; echo '</tr>'; $vwplqkp4 = memberium_app()->wplvkevh(); $vwplvwi2o = memberium_app()->wplpg5eox(); if (is_array($vwplqkp4 ) ) { foreach ($vwplqkp4 as $vwplheakg ) { if ($vwplheakg['Active'] ) { $pay_action = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['pay_action'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['pay_action'] : ''; $cancel_action = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['cancel_action'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['cancel_action'] : ''; $end_action = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['end_action'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['end_action'] : ''; $pay_goal = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['pay_goal'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['pay_goal'] : ''; $cancel_goal = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['cancel_goal'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['cancel_goal'] : ''; $end_goal = isset($this->settings['ecommerce']['actions'][$vwplheakg['Id']]['end_goal'] ) ? $this->settings['ecommerce']['actions'][$vwplheakg['Id']]['end_goal'] : ''; echo '<tr>'; echo '<td>', $vwplvwi2o[$vwplheakg['ProductId']]['ProductName'], ' - $', sprintf('%01.2f', $vwplheakg['PlanPrice'] ), ' / ', $vwplheakg['FrequencyWord'], '</td>'; echo '<td><input class="actionsetdropdown" type="text" value="', $pay_action, '" name="', $vwplheakg['Id'], '[pay_action]"></td>'; echo '<td><input type="text" value="', $pay_goal, '" name="', $vwplheakg['Id'], '[pay_goal]"></td>'; echo '<td><input class="actionsetdropdown" type="number" min="0" max="99999" size="3" value="', (int) $cancel_action, '" name="', $vwplheakg['Id'], '[cancel_action]"></td>'; echo '<td><input type="text" value="', $cancel_goal, '" name="', $vwplheakg['Id'], '[cancel_goal]"></td>'; echo '<td><input class="actionsetdropdown" type="number" min="0" max="99999" size="5" value="', (int) $end_action, '" name="', $vwplheakg['Id'], '[end_action]"></td>'; echo '<td><input type="text" value="', $end_goal, '" name="', $vwplheakg['Id'], '[end_goal]"></td>'; echo '</tr>'; } } } echo '</table>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; } elseif ($vwpl_qd2 == 'invoices' ) { echo '<form method="POST" action="">'; wp_nonce_field(MEMBERIUM_LIB, 'memberium_ecommerce_nonce' ); echo '<ul>'; echo '<h2>Invoice Display Styler</h2>'; $vwplg2bf = get_option('memberium_invoice_template', false );  echo '<style> textarea { background-color: antiquewhite; } </style>'; echo '<li><label style="vertical-align:top;">Header ', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_header" cols=80 rows=3>', isset($vwplg2bf['header'] ) ? $vwplg2bf['header'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Line Items ', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_items" cols=80 rows=3>',isset($vwplg2bf['items'] ) ? $vwplg2bf['items'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Payments Header', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_pre_payments" cols=80 rows=3>',isset($vwplg2bf['pre_payments'] ) ? $vwplg2bf['pre_payments'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Payments ', wpljwbf2::wplypewkt(0 ), '</label>'; echo '<textarea name="invoice_payments" cols=80 rows=3>',isset($vwplg2bf['payments'] ) ? $vwplg2bf['payments'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Scheduled Payments Header ', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_pre_scheduled" cols=80 rows=3>',isset($vwplg2bf['pre_scheduled'] ) ? $vwplg2bf['pre_scheduled'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Scheduled Payments ', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_scheduled" cols=80 rows=3>',isset($vwplg2bf['scheduled'] ) ? $vwplg2bf['scheduled'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Footer ', wpljwbf2::wplypewkt(0000 ), '</label>'; echo '<textarea name="invoice_footer" cols=80 rows=3>',isset($vwplg2bf['footer'] ) ? $vwplg2bf['footer'] : '', '</textarea>'; echo '</li>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; echo '<li><label style="vertical-align:top;">%% Codes</label>'; echo '<div style="display:inline-block;width:600px;">'; $vwplxc60_ = array( 'invoice', array('job', 'order' ), 'contact', 'payplan', 'payment', array('payplanitem', 'scheduled' ), array('orderitem', 'item' ), ); foreach ($vwplxc60_ as $vwplnzlj0t ) { if (is_array ($vwplnzlj0t ) ) { $prefix = $vwplnzlj0t[1]; $vwplnzlj0t = $vwplnzlj0t[0]; } else { $prefix = $vwplnzlj0t; } $vwplmu62n = wpllbej::wplntnyv($vwplnzlj0t, false ); sort($vwplmu62n ); echo '<strong>', ucwords($prefix ), '</strong><br />'; if (is_array($vwplmu62n ) ) { foreach($vwplmu62n as $vwpl_s6l ) { $vwpluvdiz = '%%' . $prefix . '.' . strtolower($vwpl_s6l ) . '%%'; echo '<input type="text" size="', strlen($vwpluvdiz ) + 2, '" value="', $vwpluvdiz, '" readonly style="text-align:center;"> '; } echo '<br><br>'; } } echo '<strong>Custom Codes</strong><br />'; $vwplmu62n = array('subtotal' ); foreach($vwplmu62n as $vwpl_s6l ) { $vwpluvdiz = '%%receipt.' . strtolower($vwpl_s6l ) . '%%'; echo '<input type="text" size="', strlen($vwpluvdiz ) + 2, '" value="', $vwpluvdiz, '" readonly style="text-align:center;"> '; } echo '</div></li>'; echo '</ul>'; } elseif ($vwpl_qd2 == '1click' ) { } elseif ($vwpl_qd2 == 'products' ) { } elseif ($vwpl_qd2 == 'paypal' ) { echo '<form method="POST" action="">'; wp_nonce_field(MEMBERIUM_LIB, 'memberium_ecommerce_nonce' ); echo '<ul>'; echo '<li><label>PayPal API</label>'; echo '<li><label>API Username</label><input type="text" id="paypal_api_username" name="paypal_api_username" value="', $this->settings['settings']['paypal_api_username'], '">', wpljwbf2::wplypewkt(0000 ), '</li>'; echo '<li><label>API Password</label><input type="text" id="paypal_api_password" name="paypal_api_password" value="', $this->settings['settings']['paypal_api_password'], '">', wpljwbf2::wplypewkt(0000 ), '</li>'; echo '<li><label>API Signature</label><input type="text" id="paypal_api_signature" name="paypal_api_signature" value="', $this->settings['settings']['paypal_api_signature'], '">', wpljwbf2::wplypewkt(0000 ), '</li>'; echo wpljwbf2::wplsok6r('PayPal Live Mode', 'paypal_live', 000 ); echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; echo '<p>Need help finding your PayPal API credentials?  <a href="https://www.paypal.com/us/cgi-bin/webscr?cmd=_profile-api-access" target="_blank">Click Here</a>'; } elseif ($vwpl_qd2 == 'stripe' ) { echo '<form method="POST" action="">'; wp_nonce_field(MEMBERIUM_LIB, 'memberium_ecommerce_nonce' ); echo '<ul>'; echo '<li><label>Stripe API</label>'; echo '<li><label>Secret Key</label><input type="text" id="stripe_secret_key" name="stripe_secret_key" value="', $this->settings['settings']['stripe_secret_key'], '">', wpljwbf2::wplypewkt(0000 ), '</li>'; echo '<li><label>Publishable Key</label><input type="text" id="stripe_public_key" name="stripe_public_key" value="', $this->settings['settings']['stripe_public_key'], '">', wpljwbf2::wplypewkt(0000 ), '</li>'; echo wpljwbf2::wplsok6r('Stripe Live Mode', 'stripe_live', 000 ); echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; echo '<p>Need help finding your Stripe API credentials?  <a href="https://manage.stripe.com/account/apikeys" target="_blank">Click Here</a>'; } elseif ($vwpl_qd2 == 'amazon' ) { } elseif ($vwpl_qd2 == 'tax' ) { } else { memberium_app()->wpllfqh_('easter_egg' ); echo wp_oembed_get('https://www.youtube.com/watch?v=zgvXtexdgAM', array('autoplay' => '1' ) ); echo '<p>Klaatu Barada N... Necktie... Neckturn... Nickel...</p><p>It\'s an "N" word, it\'s definitely an "N" word!</p><p>Klaatu... Barada... N...</p>'; } echo '</div>'; echo '</div>'; $vwpls0hwb5 = wplj_l2t::wplaajf(true); $vwpls0hwb5 = $vwpls0hwb5['mc']; $vwplechli = array(); $vwplechli[] = array('id' => 0, 'text' => '(None)' ); foreach ( (array) $vwpls0hwb5 as $vwplopnf => $vwpltmveju ) { $vwplechli[] = array('id' => $vwplopnf, 'text' => $vwpltmveju . ' (' . $vwplopnf . ')' ); } $vwplechli = json_encode($vwplechli ); unset($vwpls0hwb5, $vwplopnf, $vwpltmveju ); $vwplx1ap5_ = 'SELECT `id`, `name` FROM ' . MEMBERIUM_DB_ACTIONSETS . ' WHERE `appname` = %s AND `name` > "" ORDER BY `name` ASC'; $vwplx1ap5_ = $wpdb->prepare($vwplx1ap5_, $this->appname ); $vwplewhxt_ = $wpdb->get_results($vwplx1ap5_, ARRAY_A ); $vwplvmes5 = array(); $vwplvmes5[] = array('id' => 0, 'text' => '(No Action)' ); foreach ($vwplewhxt_ as $vwplopnf => $vwplheakg ) { $vwplvmes5[] = array('id'=>$vwplheakg['id'], 'text'=>$vwplheakg['name'] ); } $vwplvmes5 = json_encode($vwplvmes5 ); unset($vwplewhxt_, $vwplopnf, $vwplheakg, $vwplx1ap5_ ); echo '<script>'; echo 'var actionsetlist = ', $vwplvmes5, ';'; echo 'var taglist       = ', $vwplechli, ';'; echo '</script>'; unset($vwplvmes5, $vwplechli );
