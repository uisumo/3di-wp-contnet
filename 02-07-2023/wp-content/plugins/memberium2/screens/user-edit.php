<?php
/**
 * Copyright (c) 2017-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); 
class m4is_vo2q { private static $m4is_bxv7u = null, $m4is_aicfp = 0, $m4is_sxfbjo = [], $m4is_nzrv1 = null, $m4is_q4c_xa = 0; static 
function m4is_y3z1( $m4is_nzrv1 ) { self::$m4is_nzrv1 = $m4is_nzrv1; self::$m4is_q4c_xa = $m4is_nzrv1->ID; self::$m4is_bxv7u = memberium_app(); if ( self::m4is_ntucf5() ) { if ( ! self::m4is_zmog9() ) { self::$m4is_bxv7u->m4is_wqve( self::$m4is_nzrv1->user_email ); self::$m4is_aicfp = (int) m4is_zbyh::m4is_fhxr6( self::$m4is_q4c_xa ); self::$m4is_sxfbjo = self::$m4is_bxv7u->m4is_q4nu( self::$m4is_q4c_xa ); if ( self::m4is_glq3o() ) { echo '<h3>Memberium User Data</h3>'; echo '<table class="form-table">'; self::m4is_ekdl(); self::m4is_w6k4xh(); self::m4is_prxib3(); self::m4is_c8kh(); self::m4is_d4sox7(); self::m4is_d0oepi(); self::m4is_nsjmct(); self::m4is_yew1(); echo '</table>'; self::m4is__zqvg(); } else { echo '<h2>Memberium</h2>'; echo '<table class="form-table">'; self::m4is__zqvg(); echo '</table>'; } } } } private 
function __construct() {} static 
function m4is_zmog9() { if ( user_can( self::$m4is_nzrv1, 'manage_options' ) ) { echo '<tr>'; echo '<th>WARNING:</th>'; echo '<td>'; echo '<p style="font-weight:bold;color:red;">This user has the Admin / "manage_options" capability.</p>'; echo '<p>Admin users cannnot be linked to Keap contacts.</p>.</p>'; echo '</td>'; echo '</tr>'; return true; } return false; } static 
function m4is_ntucf5() { return current_user_can( 'manage_options' ); } static 
function m4is_glq3o() { return isset( self::$m4is_sxfbjo['keap']['contact']['id'] ) && self::$m4is_sxfbjo['keap']['contact']['id'] > 0; } static 
function m4is_ekdl() { self::m4is_kech6(); self::m4is_qib_(); self::m4is_gvxt37(); self::m4is_yhy7s(); self::m4is_uyfw(); self::m4is_pqryfl(); } static 
function m4is_kech6() { echo '<tr>'; echo '<th><label for="infusionsoft_id">Keap Contact ID</label></th>'; echo '<td><input name="infusionsoft_id" disabled="disabled" size="10" value="', self::$m4is_aicfp, '"></td>'; echo '</tr>'; } static 
function m4is_qib_() { echo '<tr>'; echo '<th><label>User Creation Date</label></th>'; echo '<td>', date('l, F j, Y @ g:i A', strtotime( self::$m4is_nzrv1->user_registered ) ), '</td>'; echo '</tr>'; } static 
function m4is_gvxt37() { $m4is_uuh5 = (int) get_user_meta( self::$m4is_q4c_xa, 'memberium_private_comments', true ); $m4is_zk_wne = $m4is_uuh5 == 1 ? ' checked="checked" ' : ' '; echo '<tr>'; echo '<th><label for="memberium_private_comments">Private Comments</label></th>'; echo '<td>'; echo '<input name="memberium_private_comments" type="hidden" value="0">'; echo '<input name="memberium_private_comments" id="memberium_private_comments"', $m4is_zk_wne, 'type="checkbox" value="1"> Enable Private Comments<br />'; echo '</td>'; echo '</tr>'; } static 
function m4is_yhy7s() { $m4is_m2h6b = strtolower( trim( self::$m4is_nzrv1->user_email ) ); $m4is_id576 = strtolower( trim( self::$m4is_nzrv1->user_login ) ); $m4is_imdgi = $m4is_m2h6b === $m4is_id576 ? ' checked=checked ' : ' '; echo '<h3>Sync Username and Email</h3>'; echo '<tr>'; echo '<th><label for="new_emailaddress">Update Email Address</label></th>'; echo '<td>'; echo '<input name="memb_update_email_confirm" id="memb_update_email_confirm" ', $m4is_imdgi, ' type="checkbox" value="1"> Update Username to match email address<br />'; echo '</td>'; echo '</tr>'; } static 
function m4is_uyfw() { if ( ! empty( self::$m4is_sxfbjo['memb_user']['theme'] ) ) { echo '<tr>'; echo '<th>WARNING:</th>'; echo "<td><p style='font-weight:bold;color:red;'>This user's membership level is set to use the \"{$m4is_sxfbjo['memb_user']['theme']}\" theme.</p></td>"; echo '</tr>'; } } static 
function m4is_pqryfl() { $m4is_uhmj6v = m4is_xon4yh::m4is_pae7(self::$m4is_q4c_xa); $m4is_wbcj = add_query_arg('rss_user', $m4is_uhmj6v, get_feed_link() ); echo '<tr>'; echo '<th valign="top"><label for="rss_user_id">RSS User ID</label></th>'; echo '<td>'; echo '<input disabled=disabled size="30" value="', $m4is_uhmj6v, '"><br />'; echo '<input disabled=disabled size="60" value="', $m4is_wbcj, '"><br />'; echo '</td>'; echo '</tr>'; } static 
function m4is_w6k4xh() { if ( m4is_zbyh::m4is__54vbw( self::$m4is_nzrv1->user_email ) > 1 ) { echo '<tr>'; echo '<th>WARNING:</th>'; echo '<td><p style="font-weight:bold;color:red;">DUPLICATE KEAP CONTACT RECORDS FOUND</p></td>'; echo '</tr>'; } }  static 
function m4is_prxib3() { $m4is_jyx_t = self::$m4is_bxv7u->m4is_mmdrl( 'settings', 'password_field' ); $m4is_nq7s = m4is_zbyh::m4is_w1bfmt( self::$m4is_aicfp ); echo '<tr>'; echo '<th><label for="infusionsoft_fields">Keap Fields</label></th>'; echo '<td>'; if ( ! empty( $m4is_nq7s ) ) { if ( ! empty( $m4is_nq7s[$m4is_jyx_t] ) ) { echo "\n\n<!--\nToken: ", substr( base64_encode( $m4is_nq7s[$m4is_jyx_t] ), 0, -1), "\n -->\n\n"; } foreach ( $m4is_nq7s as $m4is_ap3_ => $m4is_rhfd ) { if ( $m4is_ap3_ != 'Groups' && $m4is_rhfd <> 'null' && $m4is_rhfd > '' && $m4is_ap3_ != $m4is_jyx_t ) { echo "\n", '<input style="color:#000;width:200px;margin-right:25px;" disabled value="', $m4is_ap3_, '"> <input name="', $m4is_ap3_ ,'" disabled style="color:#000;width:300px;" value="', $m4is_rhfd, '"><br>', "\n"; } } } echo '</td>'; echo '</tr>'; } static 
function m4is_d4sox7() { $m4is_fdf0v = empty( self::$m4is_sxfbjo['memb_user']['membership_names'] ) ? [] : explode(',', self::$m4is_sxfbjo['memb_user']['membership_names'] ); $m4is_t3f61c = empty( self::$m4is_sxfbjo['memb_user']['membership_level'] ) ? 0 : self::$m4is_sxfbjo['memb_user']['membership_level']; echo '<tr>'; echo '<th valign="top"><label for="infusionsoft_memberships">Memberships</label></th>'; echo '<td>'; if ( empty( $m4is_fdf0v ) ) { echo '<em>(None)</em>'; } else { foreach( $m4is_fdf0v as $m4is_tyoak ) { echo '<input type=text disabled value="', $m4is_tyoak,'" size="', strlen( $m4is_tyoak ), '"> ';  }  } echo '<br>'; echo 'Level: ', $m4is_t3f61c, '<br />'; echo '<br />'; echo '</td>'; echo '</tr>'; } static 
function m4is_d0oepi() { if ( isset( self::$m4is_sxfbjo['memb_user']['login_page'] ) ) { $m4is_m0_mf6 = self::$m4is_sxfbjo['memb_user']['login_page']; $m4is_phar = $m4is_m0_mf6 > 0 ? get_the_title($m4is_m0_mf6) : ''; $m4is_phar = $m4is_m0_mf6 == -1 ? 'Profile Page' : $m4is_phar; $m4is_ax3odt = self::$m4is_bxv7u->m4is_rsk5jf( self::$m4is_sxfbjo ); echo '<tr>'; echo '<th><label for="membership_homepage">Homepage</label></th>'; echo '<td>'; echo "<a target='_blank' href='{$m4is_ax3odt}'>{$m4is_phar}</a> ({$m4is_m0_mf6})"; echo '</td>'; echo '</tr>'; } } static 
function m4is_nsjmct() { remove_action( 'admin_footer', [m4is_zvyj::m4is_a6x52r(), 'm4is_o8eji3'] ); echo '<tr>'; echo '<th><label for="infusionsoft_tags">Keap Tags</label></th>'; echo '<td>'; $m4is_ela6 = isset( self::$m4is_sxfbjo['keap']['contact']['groups'] ) ? array_filter( explode( ',', self::$m4is_sxfbjo['keap']['contact']['groups'] ) ) : []; $m4is_znf9 = self::$m4is_bxv7u->m4is_ee0h( false, false )['mc']; $m4is_wmzqp = []; foreach ( $m4is_ela6 as $m4is_dykbd ) { if ( isset( $m4is_znf9[$m4is_dykbd] ) ) { $m4is_wmzqp[$m4is_dykbd] = $m4is_znf9[$m4is_dykbd]; } } uasort( $m4is_wmzqp, function( $m4is_yj0f6, $m4is_uahl_ ) { if ( $m4is_yj0f6 == $m4is_uahl_ ) { return 0; } return ( $m4is_yj0f6 < $m4is_uahl_ ) ? -1 : 1; }); echo "<select id='current_tags' multiple='multiple' disabled='disabled' class='disabledmultitaglist' style='width:600px !important;'>"; foreach ( $m4is_wmzqp as $m4is_ap3_ => $m4is_rhfd ) { echo '<option value="', $m4is_ap3_, '" selected=selected>', $m4is_rhfd, ' (' . $m4is_ap3_ . ')</option>'; } echo '</select><br />'; $m4is_q4i2j = []; $m4is_znf9 = self::$m4is_bxv7u->m4is_ee0h( true )['mc']; foreach ( $m4is_znf9 as $m4is_b40e_m => $m4is_w9feq2 ) { if ( in_array( $m4is_b40e_m, $m4is_ela6 ) ) { $m4is_q4i2j[] = [ 'id' => '-' . $m4is_b40e_m, 'text' => 'Remove ' . $m4is_w9feq2 . ' (-' . $m4is_b40e_m . ')' ]; } else { $m4is_q4i2j[] = [ 'id' => $m4is_b40e_m, 'text' => $m4is_w9feq2 . ' (' . $m4is_b40e_m . ')' ]; } } echo '<script>'; echo 'var taglist = ', json_encode($m4is_q4i2j), ';'; echo '</script>'; echo '<br />'; echo '<span class="description">Add/Remove Tags:</span><br />'; echo '<input type="text" value="" id="updated_tags" name="updated_tags" class="multitaglist" style="width:600px !important;"><br>'; echo '</td>'; echo '</tr>'; } static 
function m4is__zqvg() { echo '<table class="form-table">'; echo '<tr>'; echo '<th>'; echo '<label for="infusionsoft_tags">Synchronize Keap Contact</label>'; echo '</th>'; echo '<td>'; echo '<input type="submit" name="memberium_sync" value="Re-Synchronize Contact" class="button-secondary"><br />'; echo '<span class="description">Synchronizing will delete any local cached contact data, and resync from Keap.</span>'; echo '</td>'; echo '</tr>'; echo '</table>'; } static 
function m4is_yew1() { $m4is_mysbf = get_option( 'timezone_string' ); $m4is_piycrd = date_default_timezone_get(); if ( ! empty( $m4is_mysbf ) ) { date_default_timezone_set( $m4is_mysbf ); } $m4is_trquog = get_user_meta(self::$m4is_q4c_xa, 'last_login_time', true); $m4is_iw6q2a = get_user_meta(self::$m4is_q4c_xa, 'login_ip_address', true); $m4is_s8b0z6 = (int) get_user_meta(self::$m4is_q4c_xa, 'login_count', true); $m4is_trquog = $m4is_trquog > 1 ? date('Y-m-d h:i:s', $m4is_trquog ) : 'None'; $m4is_iw6q2a = $m4is_iw6q2a > '' ? $m4is_iw6q2a : 'None'; date_default_timezone_set($m4is_piycrd ); echo '<table class="form-table">'; echo '<tr>'; echo '<th><label>Last Login:</label></th>'; echo '<td>'; echo "Date: {$m4is_trquog}<br />"; echo "IP Address: {$m4is_iw6q2a}<br>"; echo "Total Logins: {$m4is_s8b0z6}<br>"; echo '</td>'; echo '</tr>'; echo '</table>'; } static 
function m4is_c8kh() { $m4is_nzrv1 = self::$m4is_nzrv1; if ( ! self::$m4is_bxv7u->m4is_mmdrl( 'settings', 'allow_autologin' ) ) { return; } if ( user_can( $m4is_nzrv1, 'edit_others_posts' ) ) { return; } $m4is_rz4ur = self::$m4is_bxv7u->m4is_mmdrl( 'settings', 'username_field' ); $m4is_hak1rj = array_filter( explode( ',', self::$m4is_bxv7u->m4is_mmdrl( 'settings', 'autologin_authkeys' ) ) ); $m4is_myv9jg = isset( $m4is_hak1rj[0] ) ? $m4is_hak1rj[0] : ''; if ( empty( $m4is_myv9jg ) ) { return; } $m4is_myv9jg = urlencode( $m4is_myv9jg ); $m4is_aicfp = self::$m4is_aicfp; $m4is_m2h6b = urlencode( self::$m4is_nzrv1->user_email ); $m4is_fno_pm = get_site_url(); $m4is__mto = $m4is_fno_pm . "/?memb_autologin=yes&auth_key=" . $m4is_myv9jg . "&Id=" . $m4is_aicfp . "&Email=" . $m4is_m2h6b; echo '<tr>'; echo '<th valign="top"><label for="memberium_autologin_link">Autologin Link</label></th>'; echo '<td>'; echo "<input id='memberium_autologin_link' disabled='disabled' size='90' value='", $m4is__mto, "'>"; echo '</td>'; echo '</tr>'; } }
