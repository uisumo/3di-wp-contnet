<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); new m4is_lkyte; 
class m4is_lkyte { private $m4is_bxv7u, $m4is_q7m2, $m4is_nwsv, $m4is_qqzo, $m4is_nz9s, $m4is_f9vi2l, $m4is_yu8j1; 
function __construct() { $this->m4is_gopgz(); $this->m4is_rxkap(); $this->m4is_gf_b(); } private 
function m4is_gopgz() { $this->m4is_bxv7u = memberium_app(); $this->m4is_q7m2 = $this->m4is_bxv7u->m4is_re5x('appname'); $this->m4is_qqzo = empty( $_GET['limit'] ) ? 5 : (int) trim( $_GET['limit'] ); $this->m4is_yu8j1 = empty( $_GET['start'] ) ? 0 : (int) trim( $_GET['start'] ); $this->m4is_f9vi2l = empty( $_GET['search'] ) ? '' : trim( $_GET['search'] ); $this->m4is_nwsv = empty( $_GET['ip'] ) ? '' : trim( $_GET['ip'] ); $this->m4is_nz9s = $this->m4is_s13f(); } private 
function m4is_s13f() { global $wpdb; $m4is_u13x = MEMBERIUM_DB_HTTPPOST; $m4is_c61wm7 = []; $m4is_mx1n8 = ''; if ( ! empty( $this->m4is_nwsv ) ) { $m4is_c61wm7[] = " `ipaddress` LIKE '%" . $wpdb->esc_like( $this->m4is_nwsv ) . "%' "; } if ( ! empty( $this->m4is_f9vi2l ) ) { if ( is_numeric( $this->m4is_f9vi2l ) ) { $m4is_c61wm7[] = " `contactid` = '" . $wpdb->esc_like( (int) $this->m4is_f9vi2l ) . "' OR `log` LIKE '%" . $wpdb->esc_like( $this->m4is_f9vi2l ) . "%' "; } else { $m4is_c61wm7[] = " `log` LIKE '%" . $wpdb->esc_like( $this->m4is_f9vi2l ) . "%' "; } } if ( ! empty( $m4is_c61wm7 ) ) { $m4is_mx1n8 .= ' AND (' . implode( ' AND ', $m4is_c61wm7 ) . ' )'; } $m4is_ioxk = "SELECT UNIX_TIMESTAMP(`time`) as `time`, `ipaddress`, `contactid`, `log` FROM `{$m4is_u13x}` WHERE `type` = 'loginfail' AND `appname` = '{$this->m4is_q7m2}' {$m4is_mx1n8} ORDER BY `id` DESC LIMIT {$this->m4is_qqzo} ;"; $m4is_jpzyit = $wpdb->get_results($m4is_ioxk, ARRAY_A ); return $m4is_jpzyit; } private 
function m4is_rxkap() { $m4is_jpzyit = $this->m4is_nz9s; if ( ! is_array( $this->m4is_nz9s ) || empty( $this->m4is_nz9s ) ) { if ( empty( $this->m4is_f9vi2l ) && empty( $this->m4is_nwsv ) ) { echo '<p>The Login Failure log is empty.</p>'; } else { echo '<p>No login failure records were found matching your search.</p>'; } } else { $m4is_mysbf = get_option( 'timezone_string' ); $m4is_piycrd = date_default_timezone_get(); date_default_timezone_set( $m4is_mysbf ); echo '<table class="widefat">'; echo '<tr>'; echo '<td width="175">Login Time</td>'; echo '<td width="125">IP Address</td>'; echo '<td width="100">Contact Id</td>'; echo '<td>Log</td>'; echo '</tr>'; foreach ( $this->m4is_nz9s as $m4is_wo7c93 ) { echo '<tr>'; printf( '<td>%s</td>', date( 'Y-m-d H:i:s', $m4is_wo7c93['time'] ) ); printf( '<td>%s</td>', $m4is_wo7c93['ipaddress'] ); printf( '<td>%s</td>', $m4is_wo7c93['contactid'] ); printf( '<td>%s</td>', esc_html( $m4is_wo7c93['log'] ) ); echo '</tr>'; } echo '</table>'; date_default_timezone_set( $m4is_piycrd ); } } private 
function m4is_gf_b() { echo '<form method="get" style="margin-top:12px;display:inline-block;">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo '<input type="hidden" name="tab" value="loginfail">'; printf( "Search: <input type='text' name='search' value='%s' placeholder='Search'>  ", $this->m4is_f9vi2l ); printf( "IP Address: <input type='text' name='ip' value='%s' placeholder='IP Address'>  ",$this->m4is_nwsv ); printf( "Limit: <input type='text' name='limit' value='%s' placeholder='# Results'>  ", $this->m4is_qqzo ); echo '<input type="submit" value="Search" class="button-primary" style="margin-left:15px;">  '; echo '</form>'; } }
