<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); global $wpdb; memberium_app()->m4is_v64c('view_memberships' ); $m4is_fdf0v = (array) memberium_app()->m4is_mmdrl('memberships'); $m4is_dtdi6 = m4is_k_3720(); $m4is__ph0v = []; foreach($m4is_fdf0v as $m4is_b40e_m => $m4is_ti8od ) { if ( (int) $m4is_b40e_m > 0 && (int) $m4is_ti8od['main_id'] == $m4is_b40e_m ) { $m4is_ti8od['login_redirect_priority'] = isset($m4is_ti8od['login_redirect_priority'] ) ? $m4is_ti8od['login_redirect_priority'] : 0; $m4is__ph0v[$m4is_b40e_m] = $m4is_ti8od; } } $m4is_fdf0v = $m4is__ph0v; memberium_app()->m4is_oqwxk($m4is_fdf0v, 'memberships'); unset($m4is__ph0v ); if ($_SERVER['REQUEST_METHOD'] == 'POST' ) {  if (isset($_POST['main_action'] ) ) { if (! empty($_POST['level'] ) && is_array($_POST['level'] ) ) { foreach($_POST['level'] as $m4is_ap3_ => $m4is_rhfd ) { $m4is_fdf0v[$m4is_ap3_]['level'] = $m4is_rhfd; } } if (! empty($_POST['login_redirect_priority'] ) && is_array($_POST['login_redirect_priority'] ) ) { foreach($_POST['login_redirect_priority'] as $m4is_ap3_ => $m4is_rhfd ) { $m4is_fdf0v[$m4is_ap3_]['login_redirect_priority'] = $m4is_rhfd; } } if (! empty($_POST['main_action'] ) && is_array($_POST['main_action'] ) ) { $deleted_memberships = []; foreach($_POST['main_action'] as $m4is_ap3_ => $m4is_rhfd ) { if ($m4is_rhfd == 'Delete' ) {  $m4is_e4l_7o = 'Memberium ' . $m4is_fdf0v[$m4is_ap3_]['name']; $m4is_f28o = sanitize_key('memberium_' . $m4is_fdf0v[$m4is_ap3_]['name'] ); remove_role($m4is_f28o ); m4is__95_::m4is_hbfrj('Your membership level &ldquo;<strong>' . $m4is_fdf0v[$m4is_ap3_]['name'] . '</strong>&rdquo; has been deleted.' ); unset($m4is_fdf0v[$m4is_ap3_] ); $deleted_memberships[] = $m4is_ap3_; } } $this->m4is_f9o4yu($deleted_memberships ); } } if (isset($_GET['action'] ) && $_GET['action'] == 'edit' ) { if (isset($_GET['id'] ) && is_array($m4is_fdf0v[$_GET['id']] ) ) { $m4is_fdf0v[$_GET['id']]['cancel_id'] = isset($_POST['cancel_id'] ) ? (int) $_POST['cancel_id'] : $m4is_fdf0v[$_GET['id']]['cancel_id']; $m4is_fdf0v[$_GET['id']]['level'] = isset($_POST['level'] ) ? (int) $_POST['level'] : $m4is_fdf0v[$_GET['id']]['level']; $m4is_fdf0v[$_GET['id']]['login_page'] = isset($_POST['login_page'] ) ? (int) $_POST['login_page'] : $m4is_fdf0v[$_GET['id']]['login_page']; $m4is_fdf0v[$_GET['id']]['first_login_page'] = isset($_POST['first_login_page'] ) ? (int) $_POST['first_login_page'] : $m4is_fdf0v[$_GET['id']]['first_login_page']; $m4is_fdf0v[$_GET['id']]['addltag_ids'] = isset($_POST['addltag_ids'] ) ? $_POST['addltag_ids'] : ''; $m4is_fdf0v[$_GET['id']]['logout_page'] = isset($_POST['logout_page'] ) ? (int) $_POST['logout_page'] : $m4is_fdf0v[$_GET['id']]['logout_page']; $m4is_fdf0v[$_GET['id']]['name'] = isset($_POST['name'] ) ? $_POST['name'] : $m4is_fdf0v[$_GET['id']]['name']; $m4is_fdf0v[$_GET['id']]['payf_id'] = isset($_POST['payf_id'] ) ? (int) $_POST['payf_id'] : $m4is_fdf0v[$_GET['id']]['payf_id']; $m4is_fdf0v[$_GET['id']]['suspend_id'] = isset($_POST['suspend_id'] ) ? (int) $_POST['suspend_id'] : $m4is_fdf0v[$_GET['id']]['suspend_id']; $m4is_fdf0v[$_GET['id']]['theme'] = isset($_POST['theme'] ) ? $_POST['theme'] : $m4is_fdf0v[$_GET['id']]['theme']; $m4is_fdf0v[$_GET['id']]['roles'] = array_filter(isset($_POST['roles'] ) ? $_POST['roles'] : $m4is_fdf0v[$_GET['id']]['roles'] ); $m4is_fdf0v[$_GET['id']]['main_id'] = $_GET['id']; $m4is_fdf0v[$_GET['id']]['login_redirect_priority'] = isset($_POST['login_redirect_priority'] ) ? (int) $_POST['login_redirect_priority'] : $m4is_fdf0v[$_GET['id']]['login_redirect_priority']; $m4is_fdf0v[$_GET['id']]['payf_homepage'] = isset($_POST['payf_homepage'] ) ? (int) $_POST['payf_homepage'] : $m4is_fdf0v[$_GET['id']]['payf_homepage']; $m4is_fdf0v[$_GET['id']]['susp_homepage'] = isset($_POST['susp_homepage'] ) ? (int) $_POST['susp_homepage'] : $m4is_fdf0v[$_GET['id']]['payf_homepage']; $m4is_fdf0v[$_GET['id']]['canc_homepage'] = isset($_POST['canc_homepage'] ) ? (int) $_POST['canc_homepage'] : $m4is_fdf0v[$_GET['id']]['canc_homepage']; $m4is_fdf0v[$_GET['id']]['dynamic_menus'] = isset($_POST['dynamic_menus'] ) ? (int) $_POST['dynamic_menus'] : $m4is_fdf0v[$_GET['id']]['dynamic_menus']; m4is__95_::m4is_hbfrj('Your membership level &ldquo;<strong>' . $_POST['name'] . '</strong>&rdquo; has been updated.' ); } } elseif (isset($_POST['action'] ) && $_POST['action'] == 'add' ) { if (! empty($_POST['name'] ) && ! empty($_POST['main_id'] ) ) { $m4is_fdf0v[$_POST['main_id']]['name'] = ucwords(trim($_POST['name'] ) ); $m4is_fdf0v[$_POST['main_id']]['main_id'] = (int) $_POST['main_id']; $m4is_fdf0v[$_POST['main_id']]['addltag_ids'] = (empty($_POST['addltag_ids'] ) ? '' : $_POST['addltag_ids'] ); $m4is_fdf0v[$_POST['main_id']]['payf_id'] = (int) $_POST['payf_id']; $m4is_fdf0v[$_POST['main_id']]['cancel_id'] = (int) $_POST['cancel_id']; $m4is_fdf0v[$_POST['main_id']]['suspend_id'] = (int) $_POST['suspend_id']; $m4is_fdf0v[$_POST['main_id']]['level'] = (int) $_POST['level']; $m4is_fdf0v[$_POST['main_id']]['roles'] = (array) $_POST['roles']; $m4is_fdf0v[$_POST['main_id']]['login_page'] = (int) $_POST['login_page']; $m4is_fdf0v[$_POST['main_id']]['first_login_page'] = (int) $_POST['first_login_page']; $m4is_fdf0v[$_POST['main_id']]['logout_page'] = (int) $_POST['logout_page']; $m4is_fdf0v[$_POST['main_id']]['theme'] = $_POST['theme']; $m4is_fdf0v[$_POST['main_id']]['payf_homepage'] = (int) $_POST['payf_homepage']; $m4is_fdf0v[$_POST['main_id']]['susp_homepage'] = (int) $_POST['susp_homepage']; $m4is_fdf0v[$_POST['main_id']]['canc_homepage'] = (int) $_POST['canc_homepage']; $m4is_fdf0v[$_POST['main_id']]['dynamic_menus'] = isset($_POST['dynamic_menus'] ) ? (int) $_POST['dynamic_menus'] : 0;  $m4is_e4l_7o = 'Memberium ' . $m4is_fdf0v[$_POST['main_id']]['name']; $m4is_f28o = sanitize_key('memberium_' . $m4is_fdf0v[$_POST['main_id']]['name'] ); $m4is_hqmdn = get_role($m4is_f28o ); if (! $m4is_hqmdn ) { $m4is_hqmdn = add_role($m4is_f28o, $m4is_e4l_7o ); } $m4is_hqmdn->add_cap('read'); } else { m4is__95_::m4is_hbfrj('Failed to add Membership Level.  Missing Fields' ); } } elseif (isset($_POST['action'] ) && $_POST['action'] == 'Delete' ) { unset($m4is_fdf0v[$_POST['membership_id']] ); m4is__95_::m4is_hbfrj('Your membership level &ldquo;<strong>' . $m4is_fdf0v[$_POST['membership_id']]['name'] . '</strong>&rdquo; has been deleted.' ); } elseif (! empty($_POST['create-category'] ) ) {  $m4is_pstn1 = trim($_POST['category_name'] ); $m4is_ioxk = 'SELECT count(*) FROM ' . MEMBERIUM_DB_CONTACTGROUPCATEGORIES . ' WHERE appname = %s AND name = %s ;'; $m4is_ioxk = $wpdb->prepare($m4is_ioxk, $this->appname, $m4is_pstn1 ); $m4is_ejfox = $wpdb->get_var($m4is_ioxk ); if (! $m4is_ejfox ) { $m4is_wo7c93 = ['CategoryName' => $m4is_pstn1]; m4is_f84s3h::m4is_y3qvg('ContactGroupCategory', $m4is_wo7c93 ); m4is_f84s3h::m4is_faik(); m4is__95_::m4is_hbfrj('Your Category &ldquo;<strong>' . $m4is_pstn1 . '</strong>&rdquo; has been created.' ); } else { m4is__95_::m4is_hbfrj('Your Category &ldquo;<strong>' . $m4is_pstn1 . '</strong>&rdquo; already exists.' ); } } elseif (! empty($_POST['create-tag'] ) ) {  $m4is_k4nl_ = trim($_POST['tag_name'] ); $m4is_xfv5nd = (int) abs(trim($_POST['category_id'] ) ); $m4is_ioxk = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; $m4is_ioxk = $wpdb->prepare($m4is_ioxk, $this->appname, $m4is_k4nl_ ); $m4is_ejfox = $wpdb->get_var($m4is_ioxk ); if (! $m4is_ejfox ) { memberium_app()->m4is_jxy4gf($m4is_k4nl_, $m4is_xfv5nd, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); m4is_f84s3h::m4is_omi1x4(); m4is__95_::m4is_hbfrj('Your Tag &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; has been created.' ); } else { m4is__95_::m4is_hbfrj('Your Tag &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; already exists.' ); } } elseif (! empty($_POST['create-membership'] ) ) {  $m4is_k4nl_ = trim($_POST['tag_name'] ); $m4is_xfv5nd = (int) abs(trim($_POST['category_id'] ) ); $m4is_f9fh = (empty($_POST['create_set']) ) ? false : true; $m4is_qkpf5 = $m4is_f9fh ? ['', 'PAYF', 'CANC', 'SUSP'] : ['', 'PAYF']; $m4is_o2td = false; $m4is_iye2s = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; $m4is_uwdq = []; foreach($m4is_qkpf5 as $m4is_ri5g ) { $m4is_sy2sa = $m4is_k4nl_ . $m4is_ri5g; $m4is_ioxk = $wpdb->prepare($m4is_iye2s, $this->appname, $m4is_sy2sa ); $m4is_ejfox = $wpdb->get_var($m4is_ioxk ); if (! $m4is_ejfox ) { $m4is_uwdq['Tag' . $m4is_ri5g] = memberium_app()->m4is_jxy4gf($m4is_k4nl_ . $m4is_ri5g, $m4is_xfv5nd, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); $m4is_o2td = true; } } if ($m4is_o2td ) { m4is_f84s3h::m4is_omi1x4(); $m4is_ntjic_ = [ 'name' => $m4is_k4nl_, 'main_id' => $m4is_uwdq['Tag'], 'payf_id' => isset($m4is_uwdq['TagPAYF'] ) ? $m4is_uwdq['TagPAYF'] : 0, 'cancel_id' => isset($m4is_uwdq['TagCANC'] ) ? $m4is_uwdq['TagCANC'] : 0, 'suspend_id' => isset($m4is_uwdq['TagSUSP'] ) ? $m4is_uwdq['TagSUSP'] : 0, 'level' => 0, 'roles' => [], 'login_page' => 0, 'first_login_page' => 0, 'logout_page' => 0, 'theme' => '', 'login_redirect_priority' => 0, 'addltag_ids' => '', 'payf_homepage' => 0, 'susp_homepage' => 0, 'canc_homepage' => 0, 'dynamic_menus' => 0, ]; $m4is_fdf0v[$m4is_uwdq['Tag']] = $m4is_ntjic_;  $m4is_e4l_7o = 'Memberium ' . $m4is_k4nl_; $m4is_f28o = sanitize_key('memberium_' . $m4is_k4nl_ ); $m4is_hqmdn = get_role($m4is_f28o ); if (! $m4is_hqmdn ) { $m4is_hqmdn = add_role($m4is_f28o, $m4is_e4l_7o ); } $m4is_hqmdn->add_cap('read'); m4is__95_::m4is_hbfrj('Your Membership Tags for &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; and Level have been created.' ); } else { m4is__95_::m4is_hbfrj('Your Membership Tags for &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; already exist.' ); } } elseif (! empty($_POST['create-tags'] ) ) {  $m4is_t6cz5n = trim($_POST['tag_name'] ); $m4is_yu8j1 = (int) $_POST['start']; $m4is_uf9a1i = (int) $_POST['end']; $m4is_xfv5nd = (int) abs(trim($_POST['category_id'] ) ); $m4is_o2td = false; $m4is_iye2s = 'SELECT count(*) FROM ' . MEMBERIUM_DB_TAGS . ' WHERE appname = %s AND name = %s ;'; if (false === strpos($m4is_t6cz5n, '%d' ) ) { $m4is_t6cz5n .= ' %d'; } for ($m4is_ll9yd5 = $m4is_yu8j1; $m4is_ll9yd5 <= $m4is_uf9a1i; $m4is_ll9yd5++ ) { $m4is_k4nl_ = sprintf($m4is_t6cz5n, $m4is_ll9yd5 ); memberium_app()->m4is_jxy4gf($m4is_k4nl_ . $m4is_ri5g, $m4is_xfv5nd, 'Auto-created by Memberium on ' . date('Y-m-d h:i:s' ) ); $m4is_o2td = true; } if ($m4is_o2td ) { m4is_f84s3h::m4is_omi1x4(); m4is__95_::m4is_hbfrj('Your Drip Tags for &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; have been created.' ); } else { m4is__95_::m4is_hbfrj('Your Drip Tags for &ldquo;<strong>' . $m4is_k4nl_ . '</strong>&rdquo; already exist.' ); } } else {   } uasort($m4is_fdf0v, function ($m4is__lt3, $m4is_gt4o ) { if ($m4is__lt3['level'] == $m4is_gt4o['level'] ) { if ($m4is__lt3['name'] == $m4is_gt4o['name'] ) { return 0; } return ($m4is__lt3['name'] < $m4is_gt4o['name'] ) ? -1 : 1; } return ($m4is__lt3['level'] < $m4is_gt4o['level'] ) ? -1 : 1; } ); if (isset($_GET['id']) ) { $m4is_fdf0v = apply_filters('memberium/memberships/save', $m4is_fdf0v, $_GET['id'], $_POST); } memberium_app()->m4is_oqwxk($m4is_fdf0v, 'memberships'); m4is__95_::m4is_r6_jy(); } if (! empty($_GET['id'] ) && ! empty($_GET['action'] ) && $_GET['action'] == 'edit' ) { require_once memberium_app()->m4is_n367bl('/memberships-edit.php'); } elseif (! empty($_GET['action'] ) && $_GET['action'] == 'add' ) { require_once memberium_app()->m4is_n367bl('/memberships-add.php'); $m4is_j7xjy = m4is_gapv7g(); $m4is_znf9 = memberium_app()->m4is_ee0h(TRUE)['mc'];  $m4is_gn1erg = []; $m4is_w190f4 = []; $m4is_w190f4[] = [ 'id' => 0, 'text' => '(None)' ];  $m4is_yta_se = []; $m4is_fdf0v = memberium_app()->m4is_mmdrl('memberships'); foreach ($m4is_fdf0v as $m4is_ap3_ => $m4is_rhfd ) { $m4is_yta_se[] = $m4is_ap3_; $m4is_yta_se[] = $m4is_rhfd['payf_id']; $m4is_yta_se[] = $m4is_rhfd['cancel_id']; $m4is_yta_se[] = $m4is_rhfd['suspend_id']; } $m4is_yta_se = array_unique(array_filter($m4is_yta_se ) ); foreach ( (array) $m4is_znf9 as $m4is_b40e_m => $m4is_w9feq2 ) { if (! in_array($m4is_b40e_m, $m4is_yta_se ) ) { $m4is_w190f4[] = [ 'id' => $m4is_b40e_m, 'text' => "{$m4is_w9feq2} ({$m4is_b40e_m})" ]; $m4is_gn1erg[] = [ 'id' => $m4is_b40e_m, 'text' => "{$m4is_w9feq2} ({$m4is_b40e_m})" ]; } } $m4is_w190f4 = json_encode($m4is_w190f4 ); $m4is_gn1erg = json_encode($m4is_gn1erg ); unset($m4is_znf9, $m4is_b40e_m, $m4is_w9feq2 ); $m4is_xq5r_m = m4is_p4xkl();  echo '<script>'; echo 'var themelist       = ', $m4is_j7xjy, ';'; echo 'var taglist         = ', $m4is_w190f4, ';'; echo 'var requiredtaglist = ', $m4is_gn1erg, ';'; echo 'var pagelist        = ', $m4is_xq5r_m, ';'; echo '</script>'; } else { require_once memberium_app()->m4is_n367bl('/memberships-list.php'); require_once memberium_app()->m4is_n367bl('/memberships-tagbuilder.php'); } 
function m4is_k_3720() { global $wp_roles; $m4is_dfi_em = $wp_roles->roles; $m4is_dtdi6 = []; $m4is_e4bhvp = [ 'activate_plugins', 'create_user', 'delete_plugins', 'delete_themes', 'delete_users', 'edit_plugins', 'edit_themes', 'edit_users', 'install_plugins', 'install_themes', 'manage_options', 'switch_themes', 'update_core', 'update_plugins', 'update_themes', ]; foreach ($m4is_dfi_em as $m4is_e4l_7o => $m4is_cznuy) { $m4is_ho0w2 = $m4is_cznuy['name']; $m4is_xmnb1d = $m4is_cznuy['capabilities']; foreach( $m4is_e4bhvp as $m4is_ap3_ ) { if ( array_key_exists( $m4is_ap3_, $m4is_xmnb1d ) ) { continue 2; } } $m4is_dtdi6[] = [ 'id' => $m4is_e4l_7o, 'name' => $m4is_cznuy['name'] ]; } return $m4is_dtdi6; } 
function m4is_gapv7g() {  $m4is_e7qs = wp_get_themes(); $m4is_j7xjy = []; $m4is_j7xjy[] = ['id' => '', 'text' => '(Default)']; foreach ($m4is_e7qs as $m4is_ho0w2 => $m4is_p1tdv ) { $m4is_j7xjy[] = [ 'id' => $m4is_ho0w2, 'text' => $m4is_p1tdv->Name ]; } return json_encode($m4is_j7xjy ); } 
function m4is_p4xkl() { global $wpdb; $m4is_ioxk = "SELECT `ID`, `post_title` FROM `{$wpdb->posts}` WHERE `post_status` = 'publish' AND `post_type` IN ('" . implode("','", m4is__95_::m4is_gel18() ) . "' ) ORDER BY `id` ASC;"; $m4is_bnuai = $wpdb->get_results($m4is_ioxk, ARRAY_A ); $m4is_xq5r_m[] = ['id' => 0, 'text' => '(Default)']; $m4is_xq5r_m[] = ['id' => -1, 'text' => '(User Profile Page)']; foreach ($m4is_bnuai as $m4is_b40e_m=>$page ) { $m4is_xq5r_m[] = [ 'id' => $page['ID'], 'text' => "{$page['post_title']} ({$page['ID']})" ]; } return json_encode($m4is_xq5r_m ); }
