<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); new m4is_nnde; final 
class m4is_nnde { private $m4is_bxv7u, $m4is_q7m2, $m4is_tct_hk; 
function __construct() { $this->m4is_gopgz(); $this->m4is_y3z1(); } private 
function m4is_gopgz() { $this->m4is_bxv7u = memberium_app(); $this->m4is_q7m2 = $this->m4is_bxv7u->m4is_re5x( 'appname' ); $this->m4is_tct_hk = 'settings'; } private 
function m4is_m_rx6() { $m4is_kbu63_ = $this->m4is_xlxc(); $m4is_x1l9x = ''; $m4is_gnbk = 'Password'; $m4is_jyx_t = $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'password_field', $m4is_gnbk );  $m4is_m_9gr = array_filter( explode( ',', $this->m4is_bxv7u->m4is_mmdrl( 'settings', 'ignore_contact_fields' ) ) ); if ( ! empty( $m4is_m_9gr ) ) { foreach ( $m4is_kbu63_ as $m4is_ap3_ => $m4is_tenvhx ) { if ( in_array( $m4is_tenvhx['name'], $m4is_m_9gr ) ) { unset( $m4is_kbu63_[$m4is_ap3_] ); } } }  foreach ( $m4is_kbu63_ as $m4is_wo7c93 ) { $m4is_bp1zf3 = $m4is_wo7c93['name'] == $m4is_jyx_t ? 'selected="selected"' : ''; $m4is_x1l9x = $m4is_x1l9x . sprintf( '<option value="%s" %s >%s</option>', $m4is_wo7c93['name'], $m4is_bp1zf3, $m4is_wo7c93['name'] ); } echo '<li><label>CRM Password Field</label>'; echo '<select id="password_field" name="password_field" class="basic-single" style="width:250px;">'; echo $m4is_x1l9x; echo '</select>', m4is__95_::m4is_d6u3( 1171 ); echo '</li>'; if ( $m4is_gnbk == $m4is_jyx_t ) { echo '<li><label>Create New Password Field</label>'; echo '<input type="text" autocomplete="off" name="new_crm_field" size="20" value="" />'; echo m4is__95_::m4is_d6u3( 5733 ), '</li>'; } } private 
function m4is_y3z1() { echo '<form method="POST" action="">'; wp_nonce_field( $this->m4is_bxv7u->m4is_yl5j8(), 'memberium_options_nonce' ); $this->m4is_zhol(); $this->m4is_x1z4(); $this->m4is_ghsn0(); $this->m4is_oglv(); $this->m4is_i2gv(); $this->m4is_tvwg6_(); echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; } private 
function m4is_zhol() { $m4is_oh897 = $this->m4is_uisjz(); $m4is_yw9rnp = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'min_password_length', 6 ); $m4is_t7wkfb = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'password_strength', 0 ); $m4is_ein8u7 = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'password_reset_tag', 0 ); $m4is_qy0cg = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'local_auth_only', 0 ); $m4is_c52hr = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'disable_password_reset', 0 ); $m4is_blh_u = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'disable_lost_password', 0 ); echo '<h3>Password Settings</h3>'; echo '<ul>'; $this->m4is_x12tl(); $this->m4is_bpiv(); $this->m4is_m_rx6(); $m4is_w5ky4q = [ 'help_id' => 1185, 'min' => 6, 'max' => 64, 'size' => 6 ]; m4is__95_::m4is_pfr32( 'Minimum Password Length', 'min_password_length', $m4is_yw9rnp, $m4is_w5ky4q ); m4is__95_::m4is_ouv1( 'Password Strength', 'password_strength', $m4is_t7wkfb, $m4is_oh897, ['style' => 'width:250px;', 'help_id' => 21852] ); m4is__95_::m4is_i6c5( 'Secure Passwords / Local Auth Only', 'local_auth_only', 6818, $m4is_qy0cg ); m4is__95_::m4is_i6c5( 'Disable Lost Password', 'disable_lost_password', 4422, $m4is_blh_u ); m4is__95_::m4is_i6c5( 'Disable WordPress Password Reset', 'disable_password_reset', 4421, $m4is_c52hr ); m4is__95_::m4is_e7f6( 'Password Reset Tag', 'password_reset_tag', $m4is_ein8u7, 'taglistdropdown', [ 'help_id' => 1183 ] ); echo '</ul>'; } private 
function m4is_x1z4() { $m4is_n8wbaf = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'site_ban_tag', 0 ); $m4is_xwj7 = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'maximum_login_ips', 0 ); $m4is_bmboyq = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'maximum_login_timeframe', 0 ); $m4is_fiuc = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'bruteforce_check', 0 ); $m4is_y7ozxq = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'require_membership', 0 ); $m4is_avugd = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'known_logins_only', 0 ); $m4is_mv90ys = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'allow_local_logins', 0 ); $m4is_yuapo1 = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'simultaneous_logins', 0 ); echo '<h3>Login Restrictions</h3>'; echo '<ul>'; m4is__95_::m4is_i6c5( 'Require Membership', 'require_membership', 1202, $m4is_y7ozxq ); m4is__95_::m4is_i6c5( 'Known Logins Only', 'known_logins_only', 6773, $m4is_avugd ); m4is__95_::m4is_i6c5( 'Allow Local Logins', 'allow_local_logins', 6367, $m4is_mv90ys ); m4is__95_::m4is_i6c5( 'Prevent Simultaneous Logins', 'simultaneous_logins', 1197, $m4is_yuapo1 ); m4is__95_::m4is_e7f6( 'Site Ban Tag', 'site_ban_tag', $m4is_n8wbaf, 'taglistdropdown', [ 'help_id' => 1195 ] ); m4is__95_::m4is_pfr32( 'Maximum Login IPs', 'maximum_login_ips', $m4is_xwj7, ['min' => 0, 'max' => 100, 'help_id' => 1204] ); m4is__95_::m4is_pfr32( 'Maximum Login Window (Hours)', 'maximum_login_timeframe', $m4is_bmboyq, ['min' => 0, 'max' => 672, 'help_id' => 1204] ); m4is__95_::m4is_ouv1( 'Bot Login Protection', 'bruteforce_check', $m4is_fiuc, $this->m4is__aci(), [ 'style' => 'width:250px;', 'help_id' => 0 ] ); if ($_SERVER['REMOTE_ADDR'] == '71.92.64.210') { m4is__95_::m4is_i6c5( 'Persistent Login', 'persistent_login', 0000, memberium_app()->m4is_mmdrl('settings', 'persistent_login', 0) ); } echo '</ul>'; } private 
function m4is_ghsn0() { $m4is_fidn4 = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'login_log', 0 ); $m4is_apfl = (string) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'last_login_field', '' ); $m4is_o1xs = $this->m4is_skz48j(); echo '<hr>'; echo '<h3>Login Logging</h3>'; echo '<ul>'; m4is__95_::m4is_i6c5( 'Login Log', 'login_log', 1187, $m4is_fidn4 ); m4is__95_::m4is_ouv1( 'Last Login Date Field', 'last_login_field', $m4is_apfl, $m4is_o1xs, [ 'help_id' => 1173 ] ); echo '</ul>'; } private 
function m4is_oglv() { $m4is_b_4h = $this->m4is_mf7dk3(); $m4is_f_kl = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'login_url', 0 ); $m4is_syxk4 = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'login_actionset', 0 ); $m4is_i2mvw1 = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'login_tag', 0 ); $m4is_r1vew = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'disable_displayname_update', 0 ); $m4is_gmjw = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'enable_slug_update', 0 ); $m4is_t0r5 = (string) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'displayname_format', '' ); echo '<hr>'; echo '<h3>Login Actions</h3>'; echo '<ul>'; m4is__95_::m4is_e7f6( 'Login Page <strong style="color:red;">(Caution)</strong>', 'login_url', $m4is_f_kl, 'pagelistdropdown', [ 'help_id' => 1208 ] ); m4is__95_::m4is_i6c5( 'Disable Display Name Update', 'disable_displayname_update', 9634, $m4is_r1vew ); m4is__95_::m4is_s_f53( 'Display Name Format', 'displayname_format', $m4is_t0r5, ['help_id' => 5731] ); m4is__95_::m4is_i6c5( 'Enable User URL Slug Update', 'enable_slug_update', 21857, $m4is_gmjw );  m4is__95_::m4is_e7f6( 'Login Tag', 'login_tag', $m4is_i2mvw1, 'taglistdropdown', [ 'help_id' => 000 ] ); if ( $m4is_b_4h ) { m4is__95_::m4is_e7f6( 'Login Actionset', 'login_actionset', $m4is_syxk4, 'actionsetdropdown', [ 'help_id' => 1175 ] ); } echo '</ul>'; } private 
function m4is_i2gv() { $m4is_b_4h = $this->m4is_mf7dk3(); $m4is_yu2c = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'autologout_time', 0 ); $m4is_uaeqy = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'logout_actionset', 0 ); echo '<hr>'; echo '<h3>Logout Actions</h3>'; echo '<ul>'; m4is__95_::m4is_pfr32( 'Autologout/Inactivity Timer (Seconds)', 'autologout_time', $m4is_yu2c, [ 'help_id' => 7688, 'max' => 86400, 'min' => 0, 'size' => 3, 'style' => 'text-align:right;width:80px;', ] ); if ( $m4is_b_4h ) { m4is__95_::m4is_e7f6( 'Logout Actionset', 'logout_actionset', $m4is_uaeqy, 'actionsetdropdown', ['help_id' => 1178] ); } echo '</ul>'; echo '<hr>'; } private 
function m4is_tvwg6_() { $m4is_kqin0 = (int) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'first_login_page', 0 ); $m4is_hxq2_y = (bool) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'allow_autologin', 0 ); $m4is_hak1rj = (string) $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'autologin_authkeys', '' ); echo '<h3>Auto-Login Settings</h3>'; echo '<ul>'; m4is__95_::m4is_i6c5( 'Allow Autologin', 'allow_autologin', 4398, $m4is_hxq2_y ); if ( ! $m4is_hxq2_y ) { return; } m4is__95_::m4is_e7f6( 'Autologin First Login Page', 'first_login_page', $m4is_kqin0, 'pagelistdropdown', [ 'help_id' => 9670 ] ); m4is__95_::m4is_s_f53( 'Autologin Auth Keys', 'autologin_authkeys', $m4is_hak1rj, [ 'help_id' => 2571, 'style' => 'text-align:left;width:350px;' ] ); echo '<hr>'; echo '</ul>'; } private 
function m4is_mf7dk3() { $m4is_in0ti = false; $m4is_ejfox = wp_cache_get('actionsets/count', 'memberium/infusionsoft', false, $m4is_in0ti); if (! $m4is_in0ti) { global $wpdb; $m4is_u13x = MEMBERIUM_DB_ACTIONSETS; $m4is_q7m2 = $this->m4is_q7m2; $m4is_ioxk = "SELECT count(*) FROM `{$m4is_u13x}` WHERE `appname` = %s AND `name` > '' ORDER BY `name` ASC"; $m4is_ioxk = $wpdb->prepare($m4is_ioxk, $m4is_q7m2 ); $m4is_ejfox = $wpdb->get_var($m4is_ioxk); if ($m4is_ejfox > 0) { wp_cache_set('actionsets/count', $m4is_ejfox, 'memberium/infusionsoft', 30); } } return $m4is_ejfox; } private 
function m4is_skz48j() { global $wpdb;  $m4is_q7m2 = $this->m4is_q7m2; $m4is_u13x = i2sdk_class::DB_DATAFORMFIELDS; $m4is_ioxk = "SELECT concat('_', name) as name FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' AND (datatype = 13 OR datatype = 14) ORDER BY name ASC"; $m4is_jpzyit = $wpdb->get_col( $m4is_ioxk ); $m4is_wmzqp = []; $m4is_wmzqp[''] = '(None)'; foreach( $m4is_jpzyit as $m4is_wo7c93 ) { $m4is_wmzqp[$m4is_wo7c93] = $m4is_wo7c93; } return $m4is_wmzqp; } private 
function m4is__aci() { return [ '0' => 'Disabled', '1' => 'Basic (Cache Friendly)', '2' => 'Maximum' ]; } private 
function m4is_x12tl() { $m4is_qy0cg = $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'min_password_length', 6 ); $m4is_jyx_t = $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'password_field', 'Password' ); if ( ! $m4is_qy0cg ) { echo '<p"><strong style="color:darkred;">RECOMMENDATION:</strong> Passwords are stored insecurely in Keap.  Turn on "Secure Passwords" below to only use encrypted passwords.</p>'; } if ( $m4is_jyx_t == 'Password') { echo '<p"><strong style="color:darkred;">RECOMMENDATION:</strong>  Using the default "Password" field may increase your API requirements.  We recommend using a custom field instead..</p>'; echo '<p"><strong style="color:darkred;">WARNING:</strong>  Passwords are limited to 20 characters due to using the built-in "Password" field.</p>'; } } private 
function m4is_bpiv() { $m4is_rz4ur = $this->m4is_bxv7u->m4is_mmdrl( $this->m4is_tct_hk, 'username_field', 'Email' ); $m4is_pgp9jx = ''; $m4is_xk2u = 1; $m4is_s0_c = [ 'Email', ]; if ( $m4is_rz4ur <> 'Email' ) { $m4is_s0_c[] = $m4is_rz4ur; } foreach( $m4is_s0_c as $m4is_waxrhu ) { $m4is_pgp9jx .= "<option value='{$m4is_waxrhu}' " . ( ($m4is_waxrhu == $m4is_rz4ur ) ? ' selected="selected" ' : '' ) . ">{$m4is_waxrhu}</option>"; } $m4is_xk2u = count($m4is_s0_c); if ( $m4is_xk2u > 1 ) { echo '<li><label>Keap Username Field</label>'; echo '<select id="username_field" name="username_field" class="basic-single" style="width:250px;">'; echo $m4is_pgp9jx; echo '</select>', m4is__95_::m4is_d6u3(1169 ), '</li>'; } }   private 
function m4is_xlxc() { $m4is_in0ti = false; $m4is_kbu63_ = wp_cache_get( 'fields/custom/text', 'memberium/infusionsoft', false, $m4is_in0ti ); if (! $m4is_in0ti) { global $wpdb; $m4is_q7m2 = $this->m4is_q7m2; $m4is_u13x = MEMBERIUM_DB_DATAFORMFIELDS; $m4is_ioxk = "SELECT concat('_', `name`) as `name` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' AND `datatype` = 15 AND `formid` = -1 ORDER BY `name` ASC"; $m4is_kbu63_ = $wpdb->get_results( $m4is_ioxk, ARRAY_A ); $m4is_kbu63_[]['name'] = 'Password'; if ( is_array( $m4is_kbu63_ ) ) { wp_cache_set( 'fields/custom/text', $m4is_kbu63_, 'memberium/infusionsoft', 30 ); } } return $m4is_kbu63_; } private 
function m4is_uisjz() { $m4is_wmzqp = [ 0 => 'Simple Lowercase (Level 0)', 1 => '+ Uppercase Consonants (Level 1)', 2 => '+ Uppercase Vowels (Level 2)', 3 => '+ Numbers (Level 3)', 4 => '+ Symbols (Level 4)', ]; if ( memberium_app()->m4is_mmdrl('settings', 'password_field') !== 'Password' ) { $m4is_wmzqp[5] = '4 Word Passphrase'; $m4is_wmzqp[6] = '5 Word Passphrase'; } return $m4is_wmzqp; } } global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_tct_hk = memberium_app()->m4is_mmdrl('settings');
