<?php
/**
 * Copyright (c) 2017-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); ?>
<style>
	.membWarning {
		font-weight:bold;
		color:red;
	}
	.membGood {
		font-weight:bold;
		color:green;
	}
</style>
<?php
 
class m4is_sm4g83 { private $m4is_q7m2 = '', $m4is_xkry = false, $m4is_gobre = false, $m4is_yqog2 = []; static 
function m4is_burleh() : self { static $m4is_jprj8 = null; return $m4is_jprj8 ? $m4is_jprj8 : $m4is_jprj8 = new self; } private 
function __construct() { $this->m4is_efgr75(); memberium_app()->m4is_v64c('view_dashboard' ); $this->m4is_j3n_9h(); $this->m4is_ewpr(); $this->m4is_g524o(); $this->m4is_xz15ah(); $this->m4is_v1fvj(); $this->m4is_hrzvt(); $this->m4is_q19a(); $this->m4is_i421x(); } private 
function m4is_efgr75() { $this->m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); add_filter('human_time_diff', [$this, 'm4is_i3fa'], 10, 4);  } 
function m4is_i3fa( $m4is_faygqn, $m4is_gacr, $m4is_d_f21o, $m4is_auvxt ) { return ( $m4is_d_f21o < 1325376000 || $m4is_gacr > (20 * YEAR_IN_SECONDS ) ) ? 'Never' : $m4is_faygqn; }  private 
function m4is_j3n_9h() { $m4is_dqth = m4is_zvyj::m4is_a6x52r()->m4is_rksu(); if ( count( $m4is_dqth ) ) { m4is_d2vzc::m4is_yw1mi( false ); } } private 
function m4is_ewpr() { if ( class_exists( 'm4is_q6lca' ) ) { $m4is_exuv = (int) memberium_app()->m4is_mmdrl( 'settings', 'session_timeout' ); $m4is_exuv = empty( $m4is_exuv ) ? ini_get('session.gc_maxlifetime') : $m4is_exuv; m4is_q6lca::m4is_d1zs6e($m4is_exuv); } }  
function m4is_du5icq() {  if ( m4is_o5aoir::m4is__qlbej() ) { $m4is_wql7a2 = '<strong class="membGood">Active</strong>'; $m4is_nvawk6 = m4is_o5aoir::m4is_ehns( get_option( memberium_app()->license_key_name, '' ) ); if ( $m4is_nvawk6['trial_mode'] ) { $m4is_wql7a2 = '<strong class="membGood">Test Mode</strong> <strong class="membWarning">(Limited to ' . $m4is_nvawk6['max_users'] . ' Users )</strong>'; } } else { $m4is_wql7a2 = '<strong class="membWarning">Inactive</strong> '; } return $m4is_wql7a2; }  
function m4is_s_aq() { $m4is_saqvir = 'memberium_tables_updated'; $m4is_troe = get_option( $m4is_saqvir, [] ); $m4is_troe = is_array( $m4is_troe ) ? $m4is_troe : []; $m4is_po4p = [ 'actionsets', 'affiliates', 'i2sdk_customfields', 'invoices', 'products', 'social', 'tagcategories', 'tags', ]; foreach ( $m4is_po4p as $m4is_u13x ) { $m4is_troe[$m4is_u13x] = isset( $m4is_troe[$m4is_u13x] ) ? $m4is_troe[$m4is_u13x] : 0; } update_option( $m4is_saqvir, $m4is_troe ); return $m4is_troe; } 
function m4is_moi1e() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `fieldname` = 'Id' AND `appname` = '{$this->m4is_q7m2}' "; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_ux1do() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_ACTIONSETS; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}' "; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_aonsmg() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_PRODUCTS; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}' "; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_n7hsef() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_DATAFORMFIELDS; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}'"; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_x43o7r() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_CONTACTGROUPCATEGORIES; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}'"; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_ef3u() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_TAGS; $m4is_ioxk = "SELECT count(`id`) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}'"; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_mf4g3u() { global $wpdb; $m4is_w6mt = i2sdk_class::DB_API_LOG; $m4is_ioxk = "SELECT count(*) from {$m4is_w6mt} WHERE `appname` = '{$this->m4is_q7m2}' "; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_cv5h() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_AFFILIATES; $m4is_ioxk = "SELECT count(*) from `{$m4is_w6mt}` WHERE `fieldname` = 'Id' AND `appname` = '{$this->m4is_q7m2}'"; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_s0w2() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_INVOICES; $m4is_ioxk = "SELECT count(*) from `{$m4is_w6mt}` WHERE `appname` = '{$this->m4is_q7m2}'"; return (int) $wpdb->get_var($m4is_ioxk ); } 
function m4is_pul4() { return 0; } 
function m4is_kypm() { global $wpdb; $m4is_w6mt = MEMBERIUM_DB_SESSIONS; $m4is_ioxk = "SELECT count(`session_key`) from `{$m4is_w6mt}` WHERE `email_key` > '' "; return $wpdb->get_var($m4is_ioxk ); } 
function m4is_q19a() { if (MEMBERIUM_BETA ) { echo '<label>Beta Mode</label><span class="metric"><strong class="membWarning">Beta</strong></span><br />'; } if (MEMBERIUM_DEBUG ) { echo '<label>Debug Mode</label><span class="metric"><strong class="membWarning">ON</strong></span><br />'; } if (WP_DEBUG ) { echo '<label>WordPress Debug Mode</label><span class="metric"><strong class="membWarning">ON</strong></span><br />'; } } 
function m4is_gvign() { global $wpdb; $m4is_w6mt = $wpdb->postmeta; $m4is_ioxk = "SELECT count(DISTINCT `post_id` ) FROM `{$m4is_w6mt}` WHERE meta_key IN ('_is4wp_membership_levels', '_is4wp_access_tags', '_is4wp_access_tags2', '_is4wp_any_membership', '_is4wp_hide_completely', '_is4wp_force_public') AND meta_value > '' "; return (int)$wpdb->get_var($m4is_ioxk ); } 
function m4is_i421x() { require ABSPATH . WPINC . '/version.php'; $m4is_bfyz = 0; $m4is_rgb1q_ = ini_get( 'memory_limit' ); $m4is_f4t2dr = intval( WP_MAX_MEMORY_LIMIT ); $m4is_v6l4_1 = max( (int) $m4is_rgb1q_, intval( WP_MEMORY_LIMIT ) ); $m4is_us1vby = defined('I2SDK_VERSION') ? I2SDK_VERSION : '<strong class="membWarning">None</strong>'; $m4is_lye5f = php_uname('s') . ' ' . php_uname('m'); $m4is_fx7z = phpversion(); $m4is_lou7 = ini_get('display_errors') ? '<strong class="membWarning">Yes' : '<strong class="membGood">No'; $m4is_b6m0f = strtoupper(MEMBERIUM_SKU); $m4is___8wl3 = count( get_plugin_updates() ); $m4is_f08u = count( get_theme_updates() ); $m4is_ijivc = count( memberium_app()->m4is_mmdrl( 'memberships' ) ); $m4is_oy9c = count( get_option( 'cron', [] ) ); $m4is_krmvx = json_decode( get_transient( 'health-check-site-status-result' ), true); $m4is_b90rz3 = wp_using_ext_object_cache() ? '<strong style="color:green;">Enabled</strong>' : '<strong style="color:red;">Unavailable</strong>'; $m4is_g58z = get_core_updates(); $m4is_lmu3 = get_bloginfo( 'version' ); $m4is__d3c9 = esc_url( admin_url('site-health.php') ); $m4is_xm0d8n = is_ssl() ? '<strong style="color:green;">Yes</strong>' : '<strong style="color:red;">No</strong>'; $m4is_t9vwqh = is_multisite() ? 'Yes' : 'No'; $m4is_s0gl = memberium_app()->m4is_fop0d() ? '<strong class="membGood">Yes' : '<strong class="membWarning">No'; $m4is_fw8sxz = ucwords( memberium_app()->m4is__z7_1k() ); $m4is_o2qgd5 = memberium_app()->m4is_gu3m(); $m4is_xvd3wf = m4is_o5aoir::m4is_i0_t(); $m4is_jzuv2 = m4is_lr56w2::m4is_nnbp() <> $_SERVER['REMOTE_ADDR']; $m4is_w2kdj6 = $this->m4is_gvign(); $m4is_ns4d7 = $this->m4is_dvcn3x(); $m4is_jz0t1s = $wp_version; $m4is_xr15ac = empty( $m4is_krmvx['recommended'] ) ? "None" : "<a href='{$m4is__d3c9}'><strong style='color:red;'>{$m4is_krmvx['recommended']}</strong></a>"; $m4is_cacir = empty( $m4is_krmvx['critical'] ) ? "None" : "<a href='{$m4is__d3c9}'><strong style='color:red;'>{$m4is_krmvx['critical']}</strong></a>"; if ( is_array( $m4is_g58z ) ) { foreach( $m4is_g58z as $m4is_g68c ) { $m4is_bfyz += (int) version_compare($m4is_g68c->version, $m4is_lmu3, '>' ); } } unset($m4is_g58z, $m4is_g68c, $m4is_lmu3 ); echo '<hr>'; echo '<h3>System Metrics</h3>'; if ($m4is_bfyz || $m4is___8wl3 || $m4is_f08u ) { echo '<label>Missing Core Updates</label><span class="metric membWarning">', $m4is_bfyz, '</span><br />'; echo '<label>Missing Plugin Updates</label><span class="metric membWarning">', $m4is___8wl3, '</span><br />'; echo '<label>Missing Theme Updates</label><span class="metric membWarning">', $m4is_f08u, '</span><br />'; echo '<hr>'; } echo '<label>WordPress User Count</label><span class="metric">', $m4is_xvd3wf, '</span><br />'; echo '<label>Membership Levels</label><span class="metric">', $m4is_ijivc, '</span><br />'; echo '<label>Protected Pages/Posts</label><span class="metric">', $m4is_w2kdj6, '</span><br />'; echo '<hr>'; echo '<label>WordPress Version</label><span class="metric">', $m4is_jz0t1s, '</span><br />'; echo '<label>WordPress Environment</label><span class="metric">', $m4is_fw8sxz, '</span><br />'; echo '<label>WordPress Recommended Issues</label><span class="metric">', $m4is_xr15ac, '</span><br />'; echo '<label>WordPress Critical Issues</label><span class="metric">', $m4is_cacir, '</span><br />'; echo '<label>WordPress SSL</label><span class="metric">', $m4is_xm0d8n, '</span><br />'; echo '<label>Wordpress Multisite</label><span class="metric"><strong>', $m4is_t9vwqh, '</strong></span><br />'; echo '<label>Wordpress Super Admin</label><span class="metric">', $m4is_s0gl, '</strong></span><br />'; echo '<label>WordPress Cron Jobs</label><span class="metric">', $m4is_oy9c, '</span><br />'; echo '<label>Wordpress Object Caching</label><span class="metric">', $m4is_b90rz3, '</strong></span><br />'; echo '<hr>'; echo '<label>PHP Memory Allocated</label><span class="metric">', $m4is_rgb1q_, 'B</span><br />'; echo '<label>WordPress Memory Limit</label><span class="metric">', $m4is_v6l4_1, 'MB</span><br />'; echo '<label>Admin Dashboard Memory Limit</label><span class="metric">', $m4is_f4t2dr, 'MB</span><br />'; echo '<hr>'; echo '<label>Memberium SKU</label><span class="metric">', $m4is_b6m0f, '</span><br />'; echo '<label>i2SDK Version</label><span class="metric">', $m4is_us1vby, '</span><br />'; echo '<label>XML RPC Library Version</label><span class="metric">', $m4is_ns4d7, '</span><br />'; echo '<label>PHP Version</label><span class="metric">', $m4is_fx7z, '</span><br />'; echo '<label>Operating System</label><span class="metric">', $m4is_lye5f, '</span><br />'; echo '<label>Display Errors</label><span class="metric">', $m4is_lou7, '</strong></span><br />'; echo '<label>Load Balancer / Proxy</label><span class="metric">', $m4is_jzuv2 ? '<strong class="membGood">Yes</strong>' : 'No' , '</span><br />'; echo '</form>'; } 
function m4is_dvcn3x() : string { if ( class_exists( 'i2sdk_ixr_client_class' ) ) { $version = '<strong style="color:green;">i2sdk-IXR</strong>'; } else { $version = property_exists( 'PhpXmlRpc\PhpXmlRpc', 'xmlrpcVersion' ) ? PhpXmlRpc\PhpXmlRpc::$xmlrpcVersion : 'Unknown'; $version = '<strong style="color:red;">' . $version . '</strong>'; } return $version; } 
function m4is_jdlyfk() { $m4is_troe = $this->m4is_s_aq(); $m4is_troe['tagcategories'] = time(); $m4is_troe['tags'] = time(); $this->m4is_xkry = true; m4is_f84s3h::m4is_faik(); m4is_f84s3h::m4is_omi1x4(); update_option( 'memberium_tables_updated', $m4is_troe, false ); } 
function m4is_miqxc() { $m4is_troe = $this->m4is_s_aq(); $m4is_troe['actionsets'] = time(); $this->m4is_xkry = true; m4is_f84s3h::m4is_miqxc(); update_option( 'memberium_tables_updated', $m4is_troe, false ); } 
function m4is_br8l() { $m4is_troe = $this->m4is_s_aq(); $m4is_troe['i2sdk_customfields'] = time(); $this->m4is_xkry = true; m4is_f84s3h::m4is_br8l(); update_option('memberium_tables_updated', $m4is_yqog2, false ); } 
function m4is_g524o() { if ( isset( $_GET['action'] ) ) { if ( $_GET['action'] == 'sync-tags' ) { $this->m4is_jdlyfk(); } elseif ($_GET['action'] == 'sync-actionsets') { $this->m4is_miqxc(); } elseif ($_GET['action'] == 'sync-fields') { $this->m4is_br8l(); } elseif($_GET['action'] == 'update-license') { m4is_o5aoir::m4is_qlzwa4(true); } } } 
function m4is_xz15ah() { if (! isset( $_GET['nosync'] ) ) { return; } if ( $this->m4is_xkry ) { return; } $m4is_troe = $this->m4is_s_aq(); if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['tags'] > 300 ) ) { m4is_f84s3h::m4is_omi1x4(); $m4is_troe['tags'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); } if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['tagcategories'] > 300 ) ) { m4is_f84s3h::m4is_faik(); $m4is_troe['tagcategories'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); } if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['actionsets'] > 300 ) ) { m4is_f84s3h::m4is_miqxc(); $m4is_troe['actionsets'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); } if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['i2sdk_customfields'] > 300 ) ) { m4is_f84s3h::m4is_br8l(); $m4is_troe['i2sdk_customfields'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); } if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['products'] > 300 ) ) { m4is_vvgc8::m4is_m_gb8n(); $m4is_troe['products'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); } if ( ( ! $this->m4is_xkry ) && ( time() - $m4is_troe['invoices'] > 300 ) ) { m4is_vvgc8::m4is_z3anvh(); $m4is_troe['invoices'] = time(); $this->m4is_xkry = true; update_option( 'memberium_tables_updated', $m4is_troe, false ); }  } 
function m4is_v1fvj() { $m4is_q7m2 = strtoupper( memberium_app()->m4is_re5x( 'appname' ) ); $m4is_q7m2 = empty( $m4is_q7m2 ) ? '<span class="membWarning">Missing</span>' : $m4is_q7m2; $m4is_ltc2 = (bool) memberium_app()->get_i2sdk_options()['server_verified']; $m4is_ltc2 = $m4is_ltc2 ? '<strong class="membGood">Connected</strong>' : '<strong class="membWarning">Not Connected</strong>'; $m4is_wql7a2 = $this->m4is_du5icq(); echo '<h3>Keap Connection</h3>'; echo '<form method="post" action="">'; echo '<label>App Name</label><strong>', $m4is_q7m2, '</strong><br />'; echo '<label>API Status</label>', $m4is_ltc2, '<br />'; echo '<label>License Status</label>', $m4is_wql7a2, '<br />'; echo '<p>'; echo '<input type="submit" name="save" value="Renew License" class="button-primary" style="margin-right:20px;">'; echo '<input type="submit" name="save" value="Re-Activate Plugin" class="button-primary">'; echo '</p>'; } 
function m4is_hrzvt() { $m4is_yqog2 = $this->m4is_s_aq(); $m4is_b_4h = $this->m4is_ux1do(); $m4is_swhg = $this->m4is_mf4g3u(); $m4is_wahjce = $this->m4is_x43o7r(); $m4is_ixli71 = $this->m4is_moi1e(); $m4is_bgd4r0 = $this->m4is_n7hsef(); $m4is_d34l = $this->m4is_aonsmg(); $m4is_n2trgn = $this->m4is_ef3u(); $m4is_qscp = $this->m4is_cv5h(); $m4is_yqjfs3 = $this->m4is_s0w2(); $m4is_tsmpok = $this->m4is_pul4(); $m4is_het3jw = memberium_app()->m4is_mmdrl( 'settings', 'ignore_tag_categories' ); $m4is_g58cd = memberium_app()->m4is_mmdrl( 'settings', 'ignore_contact_fields' ); $m4is_xb0juc = memberium_app()->m4is_mmdrl( 'settings', 'db_sessions' ); $m4is_tvd1p8 = count( array_filter( explode( ',', trim( $m4is_het3jw, ',' ) ) ) ); $m4is_g58cd = count( array_filter( explode( ',', trim( $m4is_g58cd ) ) ) ); $m4is_jhinz = $m4is_xb0juc ? $this->m4is_kypm() : 'Disabled'; if ( $m4is_swhg ) { $m4is_swhg = "<strong style='color:red;''>{$m4is_swhg}</strong>"; } echo '<h3>Keap Cache Metrics</h3>'; echo '<label>Synced Actionsets</label><span class="metric">', $m4is_b_4h, '</span> (', human_time_diff($m4is_yqog2['actionsets'] ), ')<br />'; echo '<label>Synced Custom Fields</label><span class="metric">', $m4is_bgd4r0, '</span> (', human_time_diff($m4is_yqog2['i2sdk_customfields'] ), ')<br />'; echo '<label>Synced Tag Categories</label><span class="metric">', $m4is_wahjce, '</span> (', human_time_diff($m4is_yqog2['tagcategories'] ), ')<br />'; echo '<label>Synced Tags</label><span class="metric">', $m4is_n2trgn, '</span> (', human_time_diff($m4is_yqog2['tags'] ), ')<br />'; echo '<label>Synced Products</label><span class="metric">', m4is_vvgc8::m4is_scnd(), '</span> (', human_time_diff($m4is_yqog2['products'] ), ')<br />'; echo '<label>Synced Invoices</label><span class="metric">', $m4is_yqjfs3, '</span> (', human_time_diff($m4is_yqog2['invoices'] ), ')<br />'; echo '<br />'; echo '<label>Cached Affiliates</label><span class="metric">', $m4is_qscp, '</span><br />'; echo '<label>Cached Contacts</label><span class="metric">', $m4is_ixli71, '</span><br />'; echo '<label>Database Backed Sessions</label><span class="metric">', $m4is_jhinz, '</span><br />'; echo '<label>Blocked Fields</label><span class="metric">', (empty($m4is_g58cd ) ? "<strong class='membWarning'>0</strong>" : $m4is_g58cd ), '</span><br />'; echo '<label>Blocked Tag Categories</label><span class="metric">', (empty($m4is_tvd1p8 ) ? 0 : '<strong class="membWarning">' . $m4is_tvd1p8 .'</strong>' ), '</span><br />'; echo '<label>API Log Entries</label><span class="metric">', $m4is_swhg, '</span><br />'; echo '<p>'; echo '<input type="submit" name="save" value="Synchronize Keap" class="button-primary"> ', m4is__95_::m4is_d6u3(8470 ); echo '</p>'; } } m4is_sm4g83::m4is_burleh();
