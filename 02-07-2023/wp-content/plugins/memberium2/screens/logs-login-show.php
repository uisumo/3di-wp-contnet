<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); m4is_j_2usg::m4is_burleh(); final 
class m4is_j_2usg { private $m4is_xw_lp ='', $m4is_qqzo = 15, $m4is_yu8j1 = 0, $m4is_id576 = ''; static 
function m4is_burleh() : self { static $m4is_jprj8; return $m4is_jprj8 ? $m4is_jprj8 : $m4is_jprj8 = new self; } 
function __construct() { $this->m4is_tpgkj(); $this->m4is_qzg1e(); $this->m4is_a4ox0(); } 
function m4is_tpgkj() { $this->m4is_xw_lp = empty( $_GET['ip'] ) ? '' : trim($_GET['ip'] ); $this->m4is_qqzo = empty( $_GET['limit'] ) ? 15 : (int) trim($_GET['limit'] ); $this->m4is_yu8j1 = empty( $_GET['start'] ) ? 0 : (int) trim($_GET['start'] ); $this->m4is_id576 = empty( $_GET['name'] ) ? '' : strtolower(trim ($_GET['name'] ) ); } 
function m4is_lkszb() { global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_u13x = MEMBERIUM_DB_LOGINLOG; $m4is_mx1n8 = ''; $m4is_mx1n8 .= empty( $this->m4is_id576 ) ? '' : " AND `username` LIKE '%" . $wpdb->esc_like( $this->m4is_id576 ) . "%' "; $m4is_mx1n8 .= empty( $this->m4is_xw_lp ) ? '' : " AND `ipaddress` LIKE '%" . $wpdb->esc_like( $this->m4is_xw_lp ) . "%' "; $m4is_ioxk = "SELECT `logintime`, `ipaddress`, `username` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' {$m4is_mx1n8} ORDER BY `id` DESC LIMIT {$this->m4is_qqzo} ;"; $m4is_jpzyit = $wpdb->get_results( $m4is_ioxk, ARRAY_A ); return $m4is_jpzyit; } 
function m4is_qzg1e() { $m4is_jpzyit = $this->m4is_lkszb(); if (! is_array($m4is_jpzyit ) || empty($m4is_jpzyit ) ) { echo '<p>The login log is empty.</p>'; } else { $m4is_xthvp = []; $m4is_mysbf = get_option('timezone_string'); $m4is_piycrd = date_default_timezone_get(); if (! empty($m4is_mysbf) ) { date_default_timezone_set($m4is_mysbf ); } echo '<table class="widefat">'; echo '<tr>'; echo '<td width="150">Login Time</td>'; echo '<td width="125">IP Address</td>'; echo '<td>Username</td>'; echo '<td>Location</td>'; echo '</tr>'; foreach($m4is_jpzyit as $m4is_wo7c93 ) { $m4is_i3i97 = $m4is_wo7c93['ipaddress']; if (! isset($m4is_xthvp[$m4is_i3i97] ) ) { $m4is_xthvp[$m4is_i3i97] = m4is_bjx91g::m4is_vshuxb($m4is_i3i97 ); } echo '<tr>'; echo '<td>', date('Y-m-d H:i:s', $m4is_wo7c93['logintime'] ), '</td>'; echo '<td><a href="https://geoiptool.com/en/?ip=' . $m4is_wo7c93['ipaddress'] . '" target="geoip">', $m4is_wo7c93['ipaddress'], '</a></td>'; echo '<td>', $m4is_wo7c93['username'], '</td>'; echo '<td>'; if (! empty($m4is_xthvp[$m4is_i3i97]['latitude'] ) ) { echo '<a target="map" href="https://www.google.com.au/maps/@', $m4is_xthvp[$m4is_i3i97]['latitude'], ',', $m4is_xthvp[$m4is_i3i97]['longitude'], ',13z">'; echo '<em class="fa fa-map-marker"></em> '; echo '</a>&nbsp;'; } if (isset($m4is_xthvp[$m4is_i3i97] ) && is_array($m4is_xthvp[$m4is_i3i97] ) ) { if (isset($m4is_xthvp[$m4is_i3i97]['city'] ) ) { echo $m4is_xthvp[$m4is_i3i97]['city'], ', ', $m4is_xthvp[$m4is_i3i97]['region_name'], ' ', $m4is_xthvp[$m4is_i3i97]['country_name']; } } else { echo '<em>Unknown</em>'; } echo '</td>'; echo '</tr>'; } date_default_timezone_set($m4is_piycrd ); echo '</table>'; } } 
function m4is_a4ox0() { echo '<form method="get" style="margin-top:12px;display:inline-block;">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo "Username: <input type='text' name='name' value='{$this->m4is_id576}' placeholder='Username'>"; echo "IP Address: <input type='text' name='ip' value='{$this->m4is_xw_lp}' placeholder='IP Address'>"; echo "Limit: <input type='text' name='limit' value='{$this->m4is_qqzo}' placeholder='# Results'>"; echo '<input type="submit" value="Search" class="button-primary" style="margin-left:15px;">'; echo '</form>'; echo '<form method="post" style="margin-top:10px;">'; echo '<input type="hidden" name="page" value="memberium-logs">'; echo '<input type="hidden" name="tab" value="login">'; echo '<input type="submit" name="delete_login_log" value="Delete Log" class="button delete">'; echo '</form>'; } }
