<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 */

 class_exists( 'm4is_emz57o' ) || die(); current_user_can( 'manage_options' ) || wp_die( __( 'You do not have sufficient permissions to access this page.' ) ); m4is_uj9ya::m4is_burleh(); final 
class m4is_uj9ya { private $m4is_obgvz = '', $m4is_bs50tf = 'general', $m4is_m_fnw0 = [], $m4is_q7m2 = ''; static 
function m4is_burleh() : self { static $m4is_jprj8; return $m4is_jprj8 ? $m4is_jprj8 : $m4is_jprj8 = new self; } private 
function __construct() { $this->m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $this->m4is_j_qc4(); $this->m4is_s_9s8(); m4is__95_::m4is_r6_jy(); $this->m4is_g3x7(); $this->m4is_ldvczt(); $this->m4is_qtrp0(); $this->m4is_qnie(); } 
function m4is__q4xjg() { $this->m4is_m_fnw0 = [ 'general' => '<i class="fas fa-shopping-cart"></i> General', 'subscriptions' => '<i class="fas fa-sync-alt fa-spin"></i> Subscriptions', 'invoices' => '<i class="fas fa-file-invoice-dollar"></i> Invoices', ]; return $this->m4is_m_fnw0; } 
function m4is_j_qc4() { if ( empty( $this->m4is_obgvz ) ) { $this->m4is_obgvz = isset( $_GET['tab'] ) ? strtolower( trim( $_GET['tab'] ) ) : $this->m4is_bs50tf; $this->m4is_obgvz = array_key_exists( $this->m4is_obgvz, $this->m4is__q4xjg() ) ? $this->m4is_obgvz : $this->m4is_obgvz; } return $this->m4is_obgvz; } 
function m4is_s_9s8() { if ( $_SERVER['REQUEST_METHOD'] <> 'POST') { return; } if ( ! wp_verify_nonce( $_POST['memberium_ecommerce_nonce'], memberium_app()->m4is_yl5j8() ) ) { wp_die( 'nonce error' ); return; } $m4is_bxv7u = memberium_app(); $m4is_shny = $this->m4is_j_qc4(); if ( $m4is_shny == 'general' ) { $this->m4is_dra5i(); } elseif ( $m4is_shny == 'subscriptions' ) { $this->m4is_hva_gm(); } elseif ( $m4is_shny == 'invoices' ) { $this->m4is_wiu_(); } } private 
function m4is_dra5i() { $m4is_bxv7u = memberium_app(); $m4is_sy3k = isset( $_POST['affiliate_detect'] ) ? (int) $_POST['affiliate_detect'] : $m4is_bxv7u->m4is_mmdrl( 'settings', 'affiliate_detect' ); $m4is_t5ovi = isset( $_POST['merchant_account_id'] ) ? (int) $_POST['merchant_account_id'] : $m4is_bxv7u->m4is_mmdrl( 'settings', 'merchant_account_id' ); $m4is_bxv7u->m4is_oqwxk( $m4is_sy3k, 'settings', 'affiliate_detect' ); $m4is_bxv7u->m4is_oqwxk( $m4is_t5ovi, 'settings', 'merchant_account_id' ); m4is__95_::m4is_hbfrj( 'General eCommerce Options Updated' ); } private 
function m4is_hva_gm() { $m4is_bxv7u = memberium_app(); $m4is_l926 = []; foreach($_POST as $m4is_ap3_ => $m4is_rhfd ) { if ( is_array( $m4is_rhfd ) ) { $m4is_l926[$m4is_ap3_] = $m4is_rhfd; } $m4is_bxv7u->m4is_oqwxk( $m4is_l926, 'ecommerce', 'actions' ); } m4is__95_::m4is_hbfrj( 'Subscription Management Options Updated' ); } private 
function m4is_wiu_() { $m4is_i0ltb = get_option( 'memberium_invoice_template', false ); $m4is_i0ltb['header'] = isset($_POST['invoice_header'] ) ? trim( stripslashes($_POST['invoice_header'] ) ) : ''; $m4is_i0ltb['items'] = isset($_POST['invoice_items'] ) ? trim( stripslashes($_POST['invoice_items'] ) ) : ''; $m4is_i0ltb['pre_payments'] = isset($_POST['invoice_pre_payments'] ) ? trim( stripslashes($_POST['invoice_pre_payments'] ) ) : ''; $m4is_i0ltb['payments'] = isset($_POST['invoice_payments'] ) ? trim( stripslashes($_POST['invoice_payments'] ) ) : ''; $m4is_i0ltb['pre_scheduled'] = isset($_POST['invoice_pre_scheduled'] ) ? trim( stripslashes($_POST['invoice_pre_scheduled'] ) ) : ''; $m4is_i0ltb['scheduled'] = isset($_POST['invoice_scheduled'] ) ? trim( stripslashes($_POST['invoice_scheduled'] ) ) : ''; $m4is_i0ltb['footer'] = isset($_POST['invoice_footer'] ) ? trim( stripslashes($_POST['invoice_footer'] ) ) : ''; $m4is_i0ltb = update_option( 'memberium_invoice_template', $m4is_i0ltb ); m4is__95_::m4is_hbfrj( 'Invoice Display Options Updated' ); } 
function m4is_g3x7() { echo '<div class="wrap">'; echo '<h1>', _('eCommerce Settings' ), '</h1>'; echo '<h2 class="nav-tab-wrapper">'; foreach ($this->m4is_m_fnw0 as $m4is_obgvz => $m4is_ho0w2 ) { $class = ($m4is_obgvz == $this->m4is_obgvz ) ? ' nav-tab-active' : ''; if ( $m4is_obgvz == $this->m4is_obgvz ) { echo "<span class='nav-tab$class'>$m4is_ho0w2</span>"; } else { echo "<a class='nav-tab{$class}' href='?page=", $_GET['page'], "&tab={$m4is_obgvz}'>{$m4is_ho0w2}</a>"; } } echo '</h2>'; echo '<div class="memberium_tabcontent" style="margin-top:10px;">'; echo '<form method="POST" action="">'; } 
function m4is_qtrp0 () { echo '</form>'; echo '</div>'; echo '</div>'; } 
function m4is_ldvczt() { if ( $this->m4is_obgvz == 'general' ) { $this->m4is_tyzt(); } elseif ( $this->m4is_obgvz == 'subscriptions' ) { $this->m4is_nei0jt(); } elseif ( $this->m4is_obgvz == 'invoices' ) { $this->m4is_r8uaq(); } } 
function m4is_nei0jt() { wp_nonce_field(memberium_app()->m4is_yl5j8(), 'memberium_ecommerce_nonce' ); $m4is_muiqev = memberium_app()->m4is_nisz(); $m4is_yar3 = m4is_vvgc8::m4is_yelt(); $m4is_l926 = memberium_app()->m4is_mmdrl('ecommerce', 'actions'); echo '<table class="widefat" style="white-space:nowrap;">'; echo '<tr>'; echo '<th>Subscription</th><th>Payment Action</th><th>Payment Goal</th><th>Cancel Action</th><th>Cancel Goal</th><th>End Date Action</th><th>End Date Goal</th>'; echo '</tr>'; if ( is_array( $m4is_muiqev ) ) { foreach ( $m4is_muiqev as $m4is_wo7c93 ) { $m4is_b40e_m = $m4is_wo7c93['Id']; $m4is_sdob0 = $m4is_wo7c93['ProductId']; if ($m4is_wo7c93['Active'] ) { $cancel_action = empty( $m4is_l926[ $m4is_b40e_m ]['cancel_action'] ) ? 0 : $m4is_l926[ $m4is_b40e_m ]['cancel_action']; $cancel_goal = empty( $m4is_l926[ $m4is_b40e_m ]['cancel_goal'] ) ? '' : $m4is_l926[ $m4is_b40e_m ]['cancel_goal']; $end_action = empty( $m4is_l926[ $m4is_b40e_m ]['end_action'] ) ? 0 : $m4is_l926[ $m4is_b40e_m ]['end_action']; $end_goal = empty( $m4is_l926[ $m4is_b40e_m ]['end_goal'] ) ? '' : $m4is_l926[ $m4is_b40e_m ]['end_goal']; $pay_action = empty( $m4is_l926[ $m4is_b40e_m ]['pay_action'] ) ? 0 : $m4is_l926[ $m4is_b40e_m ]['pay_action']; $pay_goal = empty( $m4is_l926[ $m4is_b40e_m ]['pay_goal'] ) ? '' : $m4is_l926[ $m4is_b40e_m ]['pay_goal']; echo '<tr>'; echo '<td>', $m4is_yar3[ $m4is_sdob0 ]['ProductName'], ' - $', sprintf('%01.2f', $m4is_wo7c93['PlanPrice'] ), ' / ', $m4is_wo7c93['FrequencyWord'], '</td>'; echo '<td><input class="actionsetdropdown" type="text" value="', $pay_action, '" name="', $m4is_b40e_m, '[pay_action]"></td>'; echo '<td><input type="text" value="', $pay_goal, '" name="', $m4is_b40e_m, '[pay_goal]"></td>'; echo '<td><input class="actionsetdropdown" type="number" min="0" max="99999" size="3" value="', (int) $cancel_action, '" name="', $m4is_b40e_m, '[cancel_action]"></td>'; echo '<td><input type="text" value="', $cancel_goal, '" name="', $m4is_wo7c93['Id'], '[cancel_goal]"></td>'; echo '<td><input class="actionsetdropdown" type="number" min="0" max="99999" size="5" value="', (int) $end_action, '" name="', $m4is_b40e_m, '[end_action]"></td>'; echo '<td><input type="text" value="', $end_goal, '" name="', $m4is_wo7c93['Id'], '[end_goal]"></td>'; echo '</tr>'; } } } echo '</table>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; } 
function m4is_tyzt() { $m4is_bxv7u = memberium_app(); $m4is_sy3k = $m4is_bxv7u->m4is_mmdrl( 'settings', 'affiliate_detect' ); $m4is_ein8u7 = $m4is_bxv7u->m4is_mmdrl( 'settings', 'password_reset_tag' ); $m4is_qkiet = $m4is_bxv7u->m4is_mmdrl( 'settings', 'merchant_account_id' ); $m4is_u_3t = 'm4is__95_'; wp_nonce_field(memberium_app()->m4is_yl5j8(), 'memberium_ecommerce_nonce' ); echo '<ul>'; $m4is_u_3t::m4is_i6c5( 'Affiliate AutoDetect', 'affiliate_detect', 9124, $m4is_sy3k ); $m4is_u_3t::m4is_pfr32( 'Default Merchant Account', 'merchant_account_id', $m4is_qkiet, ['help_id' => 6167, 'min' => 0, 'max' => 999, 'size' => 4, 'style' => 'text-align:right;width:80px;'] ); $m4is_u_3t::m4is_e7f6( 'Password Reset Tag', 'first_login_page', $m4is_ein8u7, 'taglistdropdown', ['help_id' => 1183] ); echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; } 
function m4is_r8uaq() { wp_nonce_field(memberium_app()->m4is_yl5j8(), 'memberium_ecommerce_nonce' ); echo '<ul>'; echo '<h2>Invoice Display Styler</h2>'; $m4is_b7n4c2 = get_option('memberium_invoice_template', false);  echo '<style> textarea { background-color: antiquewhite; } </style>'; echo '<li><label style="vertical-align:top;">Header ', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_header" cols=80 rows=3>', isset($m4is_b7n4c2['header'] ) ? $m4is_b7n4c2['header'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Line Items ', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_items" cols=80 rows=3>',isset($m4is_b7n4c2['items'] ) ? $m4is_b7n4c2['items'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Payments Header', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_pre_payments" cols=80 rows=3>',isset($m4is_b7n4c2['pre_payments'] ) ? $m4is_b7n4c2['pre_payments'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Payments ', m4is__95_::m4is_d6u3(0 ), '</label>'; echo '<textarea name="invoice_payments" cols=80 rows=3>',isset($m4is_b7n4c2['payments'] ) ? $m4is_b7n4c2['payments'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Scheduled Payments Header ', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_pre_scheduled" cols=80 rows=3>',isset($m4is_b7n4c2['pre_scheduled'] ) ? $m4is_b7n4c2['pre_scheduled'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Scheduled Payments ', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_scheduled" cols=80 rows=3>',isset($m4is_b7n4c2['scheduled'] ) ? $m4is_b7n4c2['scheduled'] : '', '</textarea>'; echo '</li>';  echo '<li><label style="vertical-align:top;">Footer ', m4is__95_::m4is_d6u3(0000 ), '</label>'; echo '<textarea name="invoice_footer" cols=80 rows=3>',isset($m4is_b7n4c2['footer'] ) ? $m4is_b7n4c2['footer'] : '', '</textarea>'; echo '</li>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; echo '<li><label style="vertical-align:top;">%% Codes</label>'; echo '<div style="display:inline-block;width:600px;">'; $m4is_po4p = [ 'invoice', ['job', 'order'], 'contact', 'payplan', 'payment', ['payplanitem', 'scheduled'], ['orderitem', 'item'], ]; foreach ($m4is_po4p as $m4is_u13x ) { if (is_array ($m4is_u13x ) ) { $prefix = $m4is_u13x[1]; $m4is_u13x = $m4is_u13x[0]; } else { $prefix = $m4is_u13x; } $m4is_kbu63_ = m4is_f84s3h::m4is_cm6nr($m4is_u13x, false ); sort($m4is_kbu63_ ); echo '<strong>', ucwords($prefix ), '</strong><br />'; if (is_array($m4is_kbu63_ ) ) { foreach($m4is_kbu63_ as $m4is_tenvhx ) { $m4is_rz70ok = '%%' . $prefix . '.' . strtolower($m4is_tenvhx ) . '%%'; echo '<input type="text" size="', strlen($m4is_rz70ok ) + 2, '" value="', $m4is_rz70ok, '" readonly style="text-align:center;"> '; } echo '<br><br>'; } } echo '<strong>Custom Codes</strong><br />'; $m4is_kbu63_ = [ 'subtotal' ]; foreach($m4is_kbu63_ as $m4is_tenvhx ) { $m4is_rz70ok = '%%receipt.' . strtolower($m4is_tenvhx ) . '%%'; echo '<input type="text" size="', strlen($m4is_rz70ok ) + 2, '" value="', $m4is_rz70ok, '" readonly style="text-align:center;"> '; } echo '</div></li>'; echo '</ul>'; } 
function m4is_qnie() { global $wpdb;  $m4is_znf9 = memberium_app()->m4is_ee0h(true); $m4is_znf9 = $m4is_znf9['mc']; $m4is_q4i2j = []; $m4is_q4i2j[] = [ 'id' => 0, 'text' => '(None)' ]; foreach ( (array) $m4is_znf9 as $m4is_b40e_m => $m4is_w9feq2 ) { $m4is_q4i2j[] = [ 'id' => $m4is_b40e_m, 'text' => "{$m4is_w9feq2} ({$m4is_b40e_m})", ]; } $m4is_q4i2j = json_encode($m4is_q4i2j ); unset($m4is_znf9, $m4is_b40e_m, $m4is_w9feq2 );  $m4is_ioxk = "SELECT `id`, `name` FROM " . MEMBERIUM_DB_ACTIONSETS . " WHERE `appname` = %s AND `name` > '' ORDER BY `name` ASC"; $m4is_ioxk = $wpdb->prepare($m4is_ioxk, $this->m4is_q7m2 ); $m4is_b8ve = $wpdb->get_results($m4is_ioxk, ARRAY_A ); $m4is_ofi8h = []; $m4is_ofi8h[] = [ 'id' => 0, 'text' => '(No Action)' ]; foreach ($m4is_b8ve as $m4is_b40e_m => $m4is_wo7c93 ) { $m4is_ofi8h[] = [ 'id' => $m4is_wo7c93['id'], 'text' => $m4is_wo7c93['name'] ]; } $m4is_ofi8h = json_encode($m4is_ofi8h ); unset($m4is_b8ve, $m4is_b40e_m, $m4is_wo7c93, $m4is_ioxk ); echo '<script>'; echo 'var actionsetlist = ', $m4is_ofi8h, ';'; echo 'var taglist       = ', $m4is_q4i2j, ';'; echo '</script>'; unset($m4is_ofi8h, $m4is_q4i2j ); } }
