<?php
 class_exists('m4is_emz57o') || die(); if (! current_user_can('manage_options') ) { wp_die( __('You do not have sufficient permissions to access this page.') ); } 
function m4is__a_m() { $m4is_ay7a = [ 'AccountId', 'CreatedBy', 'DateCreated', 'Email', 'Groups', 'Id', 'LastUpdated', 'LastUpdatedBy', 'Validated', ]; $m4is_kbu63_ = []; $m4is_c3v2 = m4is_f84s3h::m4is_cm6nr( 'Contact', true ); foreach($m4is_c3v2 as $m4is_tenvhx) { if (! in_array($m4is_tenvhx, $m4is_ay7a)) { $m4is_kbu63_[$m4is_tenvhx] = $m4is_tenvhx; } } return $m4is_kbu63_; } 
function m4is_oxn5l() { $m4is_p3cm = [ 'Address3Street1', 'Address3Street2', 'Address3Type', 'AssistantName', 'City2', 'City3', 'Fax1Type', 'Fax2Type', 'Phone3Type', 'Phone4Type', 'Phone5Type', 'ReferralCode', 'SpouseName', ]; $m4is_kbu63_ = []; $m4is_c3v2 = m4is_f84s3h::m4is_cm6nr('Contact', true); foreach( $m4is_c3v2 as $m4is_tenvhx ) { if (in_array($m4is_tenvhx, $m4is_p3cm) || substr($m4is_tenvhx, 0, 1) == '_') { $m4is_kbu63_[$m4is_tenvhx] = $m4is_tenvhx; } } return $m4is_kbu63_; } 
function m4is_u8ef($m4is_tct_hk) : array { if (! empty($_POST['child_added_goal']) ) { $_POST['child_added_actionset'] = ''; } if (! empty($_POST['child_cancel_goal']) ) { $_POST['child_cancel_actionset'] = ''; } if (! empty($_POST['parent_added_goal']) ) { $_POST['parent_added_actionset'] = ''; }  $m4is_dhrs = [ ]; foreach( $m4is_dhrs as $m4is_ap3_ ) { $m4is_tct_hk[$m4is_ap3_] = isset($_POST[$m4is_ap3_]) ? (int) (bool) $_POST[$m4is_ap3_] : $m4is_tct_hk[$m4is_ap3_]; }  $m4is_dhrs = [ 'child_count_add', 'child_field', 'parent_field', 'child_added_goal', 'child_cancel_goal', 'parent_added_goal', 'whitelist_memberships', ]; foreach( $m4is_dhrs as $m4is_ap3_ ) { $m4is_tct_hk[$m4is_ap3_] = isset($_POST[$m4is_ap3_]) ? trim($_POST[$m4is_ap3_]) : $m4is_tct_hk[$m4is_ap3_]; }  $m4is_dhrs = [ 'inherited_fields', 'parent_tags', 'tag_whitelist', ]; foreach( $m4is_dhrs as $m4is_ap3_ ) { $m4is_tct_hk[$m4is_ap3_] = isset($_POST[$m4is_ap3_] ) ? trim(implode(',', $_POST[$m4is_ap3_]) ) : $m4is_tct_hk[$m4is_ap3_]; }  $m4is_dhrs = [ 'child_added_actionset', 'child_cancel_actionset', 'parent_added_actionset', 'max_child_accounts', 'parent_cache_ttl', ]; foreach( $m4is_dhrs as $m4is_ap3_ ) { $m4is_tct_hk[$m4is_ap3_] = ( isset( $_POST[$m4is_ap3_] ) ? trim( $_POST[$m4is_ap3_] ) : $m4is_tct_hk[$m4is_ap3_] ); } if ( ! empty( $_POST['subscription'] ) ) { unset( $m4is_tct_hk['subscriptions'] ); $m4is_tct_hk['subscriptions'] = array_map( 'intval', $_POST['subscription'] ); $m4is_tct_hk['ecommerce'] = (int) ( array_sum( $m4is_tct_hk['subscriptions'] ) > 0 ); } if ( isset( $_POST['add-tag-grant'] ) ) { $m4is_tct_hk['tag_grants'][$_POST['tag']] = (int) $_POST['seats']; } if ( isset( $_POST['update-tag-grants'] ) ) { $m4is_tct_hk['tag_grants'] = $_POST['tag_grants']; foreach( $_POST['tag_grants'] as $m4is_w9feq2 => $m4is_b_mw ) { if ( $m4is_b_mw == 0 ) { unset( $m4is_tct_hk['tag_grants'][$m4is_w9feq2] ); } } } if ( isset( $_POST['add-tag-translation'] ) ) { if ( $_POST['oldtag'] <> $_POST['newtag'] ) { $_POST['oldtag'] = (int) $_POST['oldtag']; $_POST['newtag'] = (int) $_POST['newtag']; $m4is_tct_hk['tag_translation'][$_POST['oldtag']] = $_POST['newtag']; } if ( ( $_POST['oldtag'] == $_POST['newtag'] ) || $_POST['newtag'] == 0 ) { unset( $m4is_tct_hk['tag_translation'][$_POST['oldtag']] ); } } if ( isset( $_POST['update-tag-translation'] ) ) { } m4is_skoru::m4is_a6x52r()->m4is__qy9a3( $m4is_tct_hk ); memberium_app()->m4is_sc3a(); return $m4is_tct_hk; } global $wpdb; $m4is_tct_hk = $this->memberium_umbrella_core_class->m4is_zld3p(); $m4is_p78sgz = [ 'child_added_goal' => '', 'child_cancel_goal' => '', 'parent_added_goal' => '', 'child_added_actionset' => 0, 'child_cancel_actionset' => 0, 'parent_added_actionset' => 0, 'whitelist_memberships' => false, 'tag_whitelist' => '', ]; $m4is_tct_hk = wp_parse_args($m4is_tct_hk, $m4is_p78sgz); $_GET['tab'] = isset( $_GET['tab'] ) ? $_GET['tab'] : 'general'; if ( $_SERVER['REQUEST_METHOD'] == 'POST' ) { $m4is_tct_hk = m4is_u8ef($m4is_tct_hk); } m4is__95_::m4is_r6_jy(); $m4is_m_fnw0 = [ 'general' => '<i class="fa fa-umbrella"></i> General', 'tags' => '<i class="fa fa-tags"></i> Tags', 'subscriptions' => '<i class="fa fa-shopping-cart"></i> Subscriptions', 'about' => '<i class="fa fa-users"></i> About', ]; $m4is_shny = isset( $_GET['tab'] ) ? strtolower( $_GET['tab'] ) : 'general'; echo '<div class="wrap">'; echo '<h2>', _( 'Umbrella Account Settings' ), '</h2>'; echo '<h2 class="nav-tab-wrapper">'; foreach ($m4is_m_fnw0 as $m4is_obgvz => $m4is_ho0w2) { $class = $m4is_obgvz == $m4is_shny ? ' nav-tab-active' : ''; if ($m4is_obgvz == $m4is_shny) { echo "<span class='nav-tab{$class}'>{$m4is_ho0w2}</span>"; } else { echo "<a class='nav-tab{$class}' href='?page=", $_GET['page'], "&tab={$m4is_obgvz}'>{$m4is_ho0w2}</a>"; } } echo '</h2>'; echo '<div class="memberium_tabcontent" style="margin-top:10px;">'; if ( $m4is_shny == 'general' ) {  $m4is_jlrug = m4is_oxn5l(); $m4is_nh7nk = m4is_f84s3h::m4is_l4up1h();  $m4is_cb7_5 = ! empty($m4is_tct_hk['child_added_actionset']) || ! empty($m4is_tct_hk['child_cancel_actionset']) || ! empty($m4is_tct_hk['parent_added_actionset']); echo '<form method="POST" action="">'; wp_nonce_field( memberium_app()->m4is_yl5j8(), 'memberium_umbrella_account_nonce' ); echo '<ul>'; echo '<h3>Management Automations</h3>'; if ($m4is_nh7nk || $m4is_cb7_5) { if ($m4is_cb7_5) { echo '<h4>Legacy Actionsets</h4>'; } if (empty($m4is_tct_hk['child_added_goal']) ) { echo '<li><label>Child Added Actionset</label>'; echo '<input value="', $m4is_tct_hk['child_added_actionset'], '"  name="child_added_actionset" id="child_added_actionset" type="text" class="dropdown actionsetdropdown">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; } if (empty($m4is_tct_hk['child_cancel_goal']) ) { echo '<li><label>Child Cancel Actionset</label>'; echo '<input value="', $m4is_tct_hk['child_cancel_actionset'], '"  name="child_cancel_actionset" id="child_cancel_actionset" type="text" class="dropdown actionsetdropdown">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; } if (empty($m4is_tct_hk['parent_added_goal']) ) { echo '<li><label>Parent Added Actionset</label>'; echo '<input value="', $m4is_tct_hk['parent_added_actionset'], '"  name="parent_added_actionset" id="parent_added_actionset" type="text" class="dropdown actionsetdropdown">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; } } echo '<h4>Campaign Builder API Goals <em>(New / Replaces Actionsets)</em></h4>'; echo '<li><label>Child Added Goal</label>'; echo '<input value="', $m4is_tct_hk['child_added_goal'], '" name="child_added_goal" id="child_added_goal" type="text" style="width:400px;" maxlength="32">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '<li><label>Child Cancel Goal</label>'; echo '<input value="', $m4is_tct_hk['child_cancel_goal'], '" name="child_cancel_goal" id="child_cancel_goal" type="text" style="width:400px;" maxlength="32">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '<li><label>Parent Added Goal</label>'; echo '<input value="', $m4is_tct_hk['parent_added_goal'], '" name="parent_added_goal" id="parent_added_goal" type="text" style="width:400px;" maxlength="32">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Profile</h3>'; echo '<li><label>Parent Tags</label>'; echo '<input value="', $m4is_tct_hk['parent_tags'], '" type="text" class="multitaglist" id="parent_tags" name="parent_tags[]" style="width:500px;">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; $m4is_w5ky4q = [ 'class' => 'basic-single', 'disabled' => ! isset($_GET['safety-override']), 'id' => 'child_field', 'style' => 'width:400px;', ]; echo "<li><label>Child's Field to Match to Parent</label>"; echo m4is_zvyj::m4is_a6x52r()->m4is_ak52('child_field', $m4is_jlrug, $m4is_tct_hk['child_field'], $m4is_w5ky4q); echo m4is__95_::m4is_d6u3( 0000 ), ' <strong style="color:red;">Do Not Change Unless Advised by Support</strong></li>'; $m4is_w5ky4q = [ 'class' => 'basic-single', 'disabled' => ! isset($_GET['safety-override']), 'id' => 'parent_field', 'style' => 'width:400px;', ]; echo '<li><label>Parent Field to Match To</label>'; echo m4is_zvyj::m4is_a6x52r()->m4is_ak52('parent_field', $m4is_jlrug, $m4is_tct_hk['parent_field'], $m4is_w5ky4q); echo m4is__95_::m4is_d6u3( 0000 ), ' <strong style="color:red;">Do Not Change Unless Advised by Support</strong></li>'; $m4is_kbu63_ = m4is__a_m(); $m4is_w5ky4q = [ 'class' => 'basic-single', 'id' => 'inherited_fields', 'multiple' => true, 'size' => 2, 'style' => 'width:400px;', ]; echo '<li><label>Inherited Fields</label>'; echo m4is_zvyj::m4is_a6x52r()->m4is_ak52('inherited_fields[]', $m4is_kbu63_, $m4is_tct_hk['inherited_fields'], $m4is_w5ky4q ); echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; $m4is_w5ky4q = [ 'id' => 'whitelist_memberships', 'label' => 'Whitelist Memberships', ]; echo '<li><label>Whitelist Memberships</label>'; m4is__95_::m4is_b1zo( 'whitelist_memberships', $m4is_tct_hk['whitelist_memberships'], $m4is_w5ky4q ); echo '<li><label>Tag Whitelist</label>'; echo '<input value="', $m4is_tct_hk['tag_whitelist'], '" type="text" class="multitaglist" id="tag_whitelist" name="tag_whitelist[]" style="width:500px;">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Child Accounts</h3>'; echo '<li><label>Minimum Child Accounts</label>'; echo '<input value="', $m4is_tct_hk['max_child_accounts'], '"  name="max_child_accounts" id="max_child_accounts" type="number" min="-1" max="999999" class="">'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; $m4is_w5ky4q = [ 'id' => 'child_count_add', 'class' => 'basic-single', 'style' => 'width:400px;', ]; $this_fields = array_merge(['' => '(None)'], $m4is_kbu63_); $m4is_tct_hk['child_count_add'] = isset( $m4is_tct_hk['child_count_add'] ) ? $m4is_tct_hk['child_count_add'] : ''; echo '<li><label>Additional Children Field</label>'; echo m4is_zvyj::m4is_a6x52r()->m4is_ak52( 'child_count_add', $this_fields, $m4is_tct_hk['child_count_add'], $m4is_w5ky4q ); echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '<hr>'; echo '<h3>Performance</h3>'; echo '<li><label>Parent Cache TTL</label>'; echo '<input value="', $m4is_tct_hk['parent_cache_ttl'], '"  name="parent_cache_ttl" id="parent_cache_ttl" type="number" min="0" max="999999" class=""> seconds'; echo m4is__95_::m4is_d6u3( 0000 ), '</li>'; echo '</ul>'; echo '<p><input type="submit" value="Update" class="button-primary"></p>'; echo '</form>'; } elseif ( $m4is_shny == 'tags' ) { $m4is_znf9 = memberium_app()->m4is_ee0h( true ); $m4is_znf9 = $m4is_znf9['mc'];  $m4is_d65cy = isset( $m4is_tct_hk['tag_grants'] ) ? $m4is_tct_hk['tag_grants'] : []; $m4is_irsh = count( $m4is_d65cy ); echo '<h3>Tag Grants</h3>'; if ( $m4is_irsh > 0 ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:150px;">Children/Tag</td>'; echo '<td style="width:100px;">Tag Id</td>'; echo '<td>Tag Name</td>'; echo '</tr>'; foreach( $m4is_d65cy as $m4is_ap3_ => $m4is_rhfd ) { echo '<tr>'; echo '<td><input min=0 step=1 type="number" name="tag_grants[', $m4is_ap3_,']" value="', $m4is_rhfd, '" style="width:70px; !important"></td>'; echo '<td>', $m4is_ap3_, '</td>'; echo '<td>', $m4is_znf9[$m4is_ap3_], '</td>'; echo '</tr>'; } echo '</table>'; echo '<p><input type="submit" class="button-primary" name="update-tag-grants" value="Update"></p>'; echo '</form>'; } else { echo '<p>You have no tags assigned to give child account slots.  Create a new tag grant below:</p>'; } echo '<form method="post">'; echo '<p>'; echo '<label>Create New Tag Grant</label>'; $m4is_w5ky4q = [ 'class' => 'basic-single', 'required' => true, 'style' => 'width:250px;margin-right:30px;' ]; m4is_zvyj::m4is_a6x52r()->m4is_ak52( 'tag', $m4is_znf9, '', $m4is_w5ky4q ); echo 'Seats:  <input name="seats" type="number" min="1" value="1" style="width:60px;margin-right:30px;"> '; echo '<input type="submit" class="button-primary" name="add-tag-grant" value="Add Tag Grant"></p>'; echo '</form>'; echo '<hr>'; echo '<h3>Tag Translations</h3>'; if ( ! empty( $m4is_tct_hk['tag_translation'] ) ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:350px;">Original Tag</td>'; echo '<td style="width:350px;">New Tag</td>'; echo '<td></td>'; echo '</tr>'; foreach( $m4is_tct_hk['tag_translation'] as $m4is_wk7yu => $m4is_uwdq ) { echo '<tr>'; echo '<td>', $m4is_znf9[$m4is_wk7yu], ' (', $m4is_wk7yu, ')</td>'; echo '<td>', $m4is_znf9[$m4is_uwdq], ' (', $m4is_uwdq, ')</td>'; echo '</tr>'; } echo '</table>';  echo '</form>'; } else { echo '<p>You have no tag translations created.  Create a new tag translation below:</p>'; } echo '<form method="post">'; echo '<p>'; echo '<label>Create New Tag Translation</label>'; $m4is_w5ky4q = [ 'class' => 'basic-single', 'required' => true, 'style' => 'width:250px;margin-right:30px;' ]; $m4is_zjae4o = ['0' => '(None)'] + $m4is_znf9; m4is_zvyj::m4is_a6x52r()->m4is_ak52( 'oldtag', $m4is_znf9, '', $m4is_w5ky4q ); m4is_zvyj::m4is_a6x52r()->m4is_ak52( 'newtag', $m4is_zjae4o, '', $m4is_w5ky4q ); unset( $m4is_zjae4o ); echo '<input type="submit" class="button-primary" name="add-tag-translation" value="Set Tag Translation"></p>'; echo '</form>'; } elseif ( $m4is_shny == 'about' ) { echo '<h2>Memberium Umbrella Account Extension for Keap</h2>'; echo '<p>', _( 'Version' ), ' ', $this->memberium_umbrella_core_class->m4is_gu3m(), '</p>'; echo '<p>Copyright &copy; 2015-2017 David Bullock</p>'; echo '<p>For documentation on this extension, please <a href="https://memberium.com/?p=12000" target="_blank">view our help page</a>.</p>'; } elseif ( $m4is_shny == 'subscriptions' ) { $m4is_z9ikd = memberium_app()->m4is_nisz(); $m4is_yar3 = m4is_vvgc8::m4is_yelt(); $m4is_vo2jqr = [ 6 => 'Days', 3 => 'Weeks', 2 => 'Months', 1 => 'Years', ]; if ( ! empty($m4is_z9ikd) ) { echo '<form method="post">'; echo '<table class="widefat">'; echo '<tr style="font-weight:bold;">'; echo '<td style="width:150px;">Children/Active Sub</td>'; echo '<td>Subscription Plan Name</td>'; echo '<td>Charge</td>'; echo '<td>Frequency</td>'; echo '<td>Cycles</td>'; echo '</tr>'; foreach( $m4is_z9ikd as $m4is_rzpbn ) { if ( $m4is_rzpbn['Active'] ) { $m4is_rzpbn['name'] = $m4is_yar3[$m4is_rzpbn['ProductId']]['ProductName']; $m4is_rzpbn['period'] = $m4is_vo2jqr[$m4is_rzpbn['Cycle']]; $m4is_rzpbn['NumberOfCycles'] = isset( $m4is_rzpbn['NumberOfCycles'] ) ? $m4is_rzpbn['NumberOfCycles'] : 0; $m4is_rhfd = ( empty( $m4is_tct_hk['subscriptions'][$m4is_rzpbn['Id']] ) ? 0 : $m4is_tct_hk['subscriptions'][$m4is_rzpbn['Id']] ); echo '<tr>'; echo '<td><input min=0 step=1 type="number" name="subscription[',$m4is_rzpbn['Id'],']" value="', $m4is_rhfd, '" style="width:70px; !important"></td>'; echo '<td>', $m4is_rzpbn['name'], '</td>'; echo '<td>$', $m4is_rzpbn['PlanPrice'], '</td>'; echo '<td>', $m4is_rzpbn['Frequency'], ' ', $m4is_rzpbn['period'], '</td>'; echo '<td>', $m4is_rzpbn['NumberOfCycles'] > 0 ? $m4is_rzpbn['NumberOfCycles'] : 'Unlimited', '</td>'; echo '</tr>'; } } echo '</table>'; echo '<p><input type="submit" class="button-primary"></p>'; echo '</form>'; } } $m4is_znf9 = memberium_app()->m4is_ee0h( true ); $m4is_znf9 = $m4is_znf9['mc']; $m4is_q4i2j = []; $m4is_q4i2j[] = [ 'id' => 0, 'text' => '(None)' ]; foreach ( (array) $m4is_znf9 as $m4is_b40e_m => $m4is_w9feq2 ) { $m4is_q4i2j[] = [ 'id' => $m4is_b40e_m, 'text' => "{$m4is_w9feq2} ({$m4is_b40e_m})", ]; } $m4is_q4i2j = json_encode( $m4is_q4i2j ); unset( $m4is_znf9, $m4is_b40e_m, $m4is_w9feq2 ); $m4is_c3v2 = m4is_f84s3h::m4is_cm6nr( 'Contact', true ); $m4is_ukcl2e = []; $m4is_ukcl2e[] = [ 'id' => '', 'text' => '(None)' ]; foreach ( $m4is_c3v2 as $m4is_tenvhx ) { $m4is_ukcl2e[] = [ 'id' => $m4is_tenvhx, 'text' => $m4is_tenvhx ]; } $m4is_ukcl2e = json_encode( $m4is_ukcl2e ); unset( $m4is_c3v2 ); $m4is_ioxk = "SELECT `id`, `name` FROM " . MEMBERIUM_DB_ACTIONSETS . " WHERE `appname` = %s AND `name` > '' ORDER BY `name` ASC"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, memberium_app()->m4is_re5x('appname') ); $m4is_b8ve = $wpdb->get_results( $m4is_ioxk, ARRAY_A ); $m4is_ofi8h = []; $m4is_ofi8h[] = [ 'id' => 0, 'text' => '(No Action)' ]; foreach ( $m4is_b8ve as $m4is_b40e_m => $m4is_wo7c93 ) { $m4is_ofi8h[] = [ 'id' => $m4is_wo7c93['id'], 'text' => $m4is_wo7c93['name'] ]; } $m4is_ofi8h = json_encode( $m4is_ofi8h ); unset( $m4is_b8ve, $m4is_b40e_m, $m4is_wo7c93, $m4is_ioxk ); echo '<script>'; echo 'var actionsetlist = ', $m4is_ofi8h, ';'; echo 'var fieldlist     = ', $m4is_ukcl2e, ';'; echo 'var taglist       = ', $m4is_q4i2j, ';'; echo '</script>'; unset( $m4is_ofi8h, $m4is_ukcl2e, $m4is_c3v2 ); echo '</div>'; echo '</div>';
