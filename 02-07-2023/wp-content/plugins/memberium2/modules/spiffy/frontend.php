<?php
/**
 * Copyright (c) 2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 class_exists( 'm4is_emz57o' ) || die(); final 
class m4is_gs2a { private $m4is_bxv7u; 
function __construct() { $this->m4is_gopgz(); $this->m4is_g376p(); } private 
function m4is_gopgz() { $this->m4is_bxv7u = memberium_app(); } private 
function m4is_g376p() { $this->m4is_vkeqv(); add_action('memberium/shortcodes/add', [$this, 'm4is_vkeqv'], 10, 0); add_action('memberium/shortcodes/remove', [$this, 'm4is_jv87zb'], 10, 0); if (! empty($_POST['memb_form_type']) ) { add_action('template_redirect', [$this, 'm4is_mkrnif'], 1); } } private 
function m4is_w8ymc() { $m4is_rz_h['standard'] = [ 'memb_spiffy_login' => 'm4is_t68x', ]; return $m4is_rz_h; } 
function m4is_mkrnif() { $m4is_td9ams = strtolower($_POST['memb_form_type']); $m4is_zaem = ['memberium/spiffy_login_button' => 'm4is_hf3h9']; if (array_key_exists($m4is_td9ams, $m4is_zaem)) { $m4is_qo6luf = $m4is_zaem[$m4is_td9ams]; $this->$m4is_qo6luf(); } } 
function m4is_vkeqv() { $m4is_znf9 = $this->m4is_w8ymc();  if (isset($m4is_znf9['standard']) && is_array($m4is_znf9['standard']) ) { foreach($m4is_znf9['standard'] as $m4is_w9feq2 => $m4is_oqzu1) { add_shortcode($m4is_w9feq2, [$this, $m4is_oqzu1]); } } } 
function m4is_jv87zb() { $m4is_znf9 = $this->m4is_w8ymc(); if (isset($m4is_znf9['standard']) && is_array($m4is_znf9['standard']) ) { foreach($m4is_znf9['standard'] as $m4is_w9feq2 => $m4is_oqzu1) { remove_shortcode($m4is_w9feq2); } } } 
function m4is_t68x($m4is_qvehs, $m4is_amunwi = NULL, $m4is_rz70ok = '') { if (! m4is_o5aoir::m4is_du5icq() ) { return; } m4is_d8yr0_::m4is_vsv0mr(); if (! is_user_logged_in() ) { return; } $m4is_uv_d = $this->m4is_bxv7u->m4is_mmdrl('settings', 'spiffy_subdomain'); $m4is_p78sgz = [ 'button_text' => 'Get Spiffy Login', 'button_url' => '', 'css_button_class' => 'memb_spiffy_login_button', 'css_button_id' => 'memb_spiffy_login_button', 'css_button_name' => 'memb_spiffy_login_button', 'css_button_style' => '', 'css_class' => 'memb_spiffy_login_form', 'css_id' => 'memb_spiffy_login_form', 'css_message_class' => 'memb_spiffy_login_message', 'css_message_id' => 'memb_spiffy_login_message', 'css_message_style' => '', 'css_name' => 'memb_spiffy_login_form', 'css_style' => '', 'message' => 'Please check your email for your Spiffy login link.', 'email' => empty($_SESSION['keap']['contact']['email']) ? wp_get_current_user()->user_email : $_SESSION['keap']['contact']['email'], 'style' => '', ]; if (isset($m4is_qvehs[0]) && $m4is_qvehs[0] == 'showatts') { return implode(',', array_keys($m4is_p78sgz) ); } if (empty($m4is_uv_d) && $this->m4is_bxv7u->m4is_fop0d() ) { return "<strong style='color:red;'>Admin Notice:  The [{$m4is_rz70ok}] shortcode has been disabled due to missing configuration.</strong>"; } $m4is_qvehs = shortcode_atts($m4is_p78sgz, $m4is_qvehs, 'memberium'); $m4is_dn09xt = [ 'email' => $m4is_qvehs['email'], 'message' => $m4is_qvehs['message'], ]; $m4is_dn09xt = base64_encode( serialize( $m4is_dn09xt ) ); $m4is_k_fdu = $this->m4is_bxv7u->m4is_rxyecs($m4is_dn09xt); $m4is_qiwse4 = wp_nonce_field('memb_spiffy_login_' . $m4is_qvehs['css_id'], '_wpnonce', true, false); $m4is_rpscuy = ''; $m4is_fgxy = $this->m4is_bxv7u->m4is_ey7zc('memb_spiffy_login'); if (! empty($m4is_fgxy)) { $m4is_rpscuy .= "<div id='{$m4is_qvehs['css_message_id']}' class='{$m4is_qvehs['css_message_class']}' style='{$m4is_qvehs['css_message_style']}'>{$m4is_fgxy}</div>"; } else { $m4is_rpscuy .= "<form name='{$m4is_qvehs['css_name']}' id='{$m4is_qvehs['css_id']}' method='post' action=''>"; $m4is_rpscuy .= "<input type='hidden' name='memb_form_type' value='memberium/spiffy_login_button'>"; $m4is_rpscuy .= "<input type='hidden' name='form_id' value='{$m4is_qvehs['css_id']}'>"; $m4is_rpscuy .= "<input type='hidden' name='parameters' value='{$m4is_dn09xt}'>"; $m4is_rpscuy .= "<input type='hidden' name='signature' value='{$m4is_k_fdu}'>"; $m4is_rpscuy .= $m4is_qiwse4; if (empty($m4is_qvehs['button_url']) ) { $m4is_rpscuy .= "<input type='submit' style='{$m4is_qvehs['css_button_style']}' id='{$m4is_qvehs['css_button_id']}' value='{$m4is_qvehs['button_text']}'>"; } else { $m4is_rpscuy .= "<input type='image' src='{$button_url}' class='{$css_class}' id='{$m4is_bgcfdt}' >"; } $m4is_rpscuy .= "</form>"; } return $m4is_rpscuy; }    
function m4is_hf3h9() { if (! m4is_o5aoir::m4is__qlbej() ) { return; } m4is_d8yr0_::m4is_vsv0mr(); if (! wp_verify_nonce($_POST['_wpnonce'], "memb_spiffy_login_{$_POST['form_id']}") ) { wp_die(_x('Security Check Failed - Nonce Validation Error', 'memb_spiffy_login', 'memberium') ); exit; } if (! $this->m4is_bxv7u->m4is_c479wl($_POST['signature'], $_POST['parameters']) ) { wp_die(_x('Security Check Failed - Signature Validation Error', 'memb_spiffy_login', 'memberium') ); exit; } $m4is_u1syn = $this->m4is_bxv7u->m4is_mmdrl('settings', 'spiffy_subdomain'); $m4is_dn09xt = unserialize(base64_decode($_POST['parameters']));  $m4is__mto = 'https://api.spiffy.co/customer-portal/auth'; $m4is_w5ky4q = [ 'headers' => [ 'x-subdomain' => $m4is_u1syn, ], 'body' => [ 'email' => $m4is_dn09xt['email'], ], 'sslverify' => false, ]; $m4is_n_bp6 = wp_remote_post($m4is__mto, $m4is_w5ky4q); $this->m4is_bxv7u->m4is_l04_ip('memb_spiffy_login', $m4is_dn09xt['message'] ); } }
