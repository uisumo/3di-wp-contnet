<?php
 class_exists( 'm4is_mifz' ) || die(); final 
class m4is_i6vs { private static $m4is_bxv7u, $m4is_q7m2, $m4is_u5sq3z, $m4is_y_zsb; static 
function m4is_a6x52r() : self { static $m4is_jprj8; return isset( $m4is_jprj8 ) ? $m4is_jprj8 : $m4is_jprj8 = new self; } private 
function __construct() { } static 
function m4is_wj1xmr() { self::$m4is_y_zsb = date( 'Y-m-d' ); self::$m4is_bxv7u = memberium_app(); self::$m4is_q7m2 = self::$m4is_bxv7u->m4is_re5x('appname'); self::$m4is_u5sq3z = m4is_mifz::m4is_a6x52r(); $m4is_g8qm = self::$m4is_u5sq3z->m4is_owh5(); foreach( $m4is_g8qm as $m4is_ap3_ => $m4is_g4ulmz ) { $m4is_k1c6mi = []; if ( empty( $m4is_g4ulmz['cache'] ) || ( $m4is_g4ulmz['start_date'] <= self::$m4is_y_zsb && $m4is_g4ulmz['end_date'] >= self::$m4is_y_zsb ) ) { $m4is_g8qm[$m4is_ap3_] = self::m4is_uhdub5( $m4is_g4ulmz ); } } self::$m4is_u5sq3z->m4is_co90ks( $m4is_g8qm ); } static 
function m4is_p_1k() { self::$m4is_bxv7u = memberium_app(); global $wpdb; $m4is_q7m2 = self::$m4is_bxv7u->m4is_re5x('appname'); $m4is_ioxk = 'SELECT `id` FROM `' . MEMBERIUM_DB_AFFILIATES . '` WHERE (`appname` = %s AND `fieldname` = "AffName" ) AND ( `value` LIKE "!%%" ) OR ( `value` LIKE "(INTERNAL)%%" );'; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, self::$m4is_q7m2 ); $m4is_xpasr0 = $wpdb->get_col( $m4is_ioxk ); return is_array($m4is_xpasr0) ? $m4is_xpasr0 : []; } static 
function m4is_uhdub5( $m4is_g4ulmz ) { $m4is_k1c6mi = []; if ( $m4is_g4ulmz['type'] == 'leads' ) { $m4is_k1c6mi = self::m4is_deo7v( $m4is_g4ulmz ); } elseif ( in_array( $m4is_g4ulmz['type'], ['dollars', 'invoices'] ) ) { $m4is_k1c6mi = self::m4is_yks4i( $m4is_g4ulmz ); } $m4is_g4ulmz['cache'] = $m4is_k1c6mi; $m4is_g4ulmz['last_updated'] = time(); return $m4is_g4ulmz; } static 
function m4is_deo7v( $m4is_g4ulmz ) { $m4is__qaej = self::m4is_p_1k();  $m4is_rt_x = date( 'Ymd\T23:59:59', strtotime( $m4is_g4ulmz['end_date'] ) ); $m4is_k1c6mi = []; $m4is_u13x = 'Referral'; $m4is_qqzo = 1000; $m4is_zvxijt = 0; $m4is_c_3n = 0; $m4is_hkp7s = [ 'AffiliateId', 'ContactId', 'DateSet', ]; $m4is_kc1q = [ 'DateSet' => '~>=~ ' . $m4is_g4ulmz['start_date'], ]; do { $m4is_jpzyit = m4is_f84s3h::m4is_l2n5pg( $m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s, 'DateSet', true ); foreach( $m4is_jpzyit as $m4is_wo7c93 ) { if ( $m4is_wo7c93['DateSet'] <= $m4is_rt_x ) { if ( ! in_array( $m4is_wo7c93['AffiliateId'], $m4is__qaej ) ) { $m4is_k1c6mi[$m4is_wo7c93['AffiliateId']] = isset( $m4is_k1c6mi[$m4is_wo7c93['AffiliateId']] ) ? $m4is_k1c6mi[$m4is_wo7c93['AffiliateId']]++ : 1; } } } $m4is_zvxijt++; $m4is_c_3n = $m4is_c_3n + count( $m4is_jpzyit ); } while ( count( $m4is_jpzyit ) == $m4is_qqzo); arsort( $m4is_k1c6mi ); unset( $m4is_k1c6mi[0] ); return array_slice( $m4is_k1c6mi, 0, $m4is_g4ulmz['slots'], true ); } static 
function m4is_yks4i( $m4is_g4ulmz ) {  $m4is__qaej = self::m4is_p_1k(); $m4is_rt_x = date( 'Ymd\T23:59:59', strtotime( $m4is_g4ulmz['end_date'] ) ); $m4is_k1c6mi = []; $m4is_s2hf4k = []; $m4is_u13x = 'Invoice'; $m4is_qqzo = 1000; $m4is_zvxijt = 0; $m4is_uw9fnu = array_filter( explode( ',', $m4is_g4ulmz['products'] ) ); $m4is_hkp7s = [ 'AffiliateId', 'LeadAffiliateId', 'DateCreated', 'InvoiceTotal', 'ProductSold', ]; $m4is_kc1q = [ 'DateCreated' => '~>=~ ' . date( 'Ymd\This', strtotime( $m4is_g4ulmz['start_date'] ) ), 'PayStatus' => 1, 'RefundStatus' => 0, ]; do { $m4is_jpzyit = m4is_f84s3h::m4is_l2n5pg( $m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s, 'DateCreated', true ); foreach($m4is_jpzyit as $m4is_wo7c93) { $m4is_lhad = array_filter( explode( ',', $m4is_wo7c93['ProductSold'] ) ); $m4is_fdmw5 = (int) $m4is_wo7c93['AffiliateId']; $m4is_c1lsgt = (int) $m4is_wo7c93['LeadAffiliateId']; $m4is_qwab = (bool) ( $m4is_fdmw5 > 0 || $m4is_c1lsgt > 0 ); $m4is_qwab = $m4is_qwab && ( $m4is_wo7c93['DateCreated'] < $m4is_rt_x ); $m4is_qwab = $m4is_qwab && ( ! in_array( $m4is_fdmw5, $m4is__qaej ) ); if ( $m4is_qwab && ! empty( $m4is_uw9fnu ) ) { $m4is_s4hu9 = array_intersect( $m4is_uw9fnu, $m4is_lhad ); $m4is_qwab = ! empty( $m4is_s4hu9 ); } if ( $m4is_qwab ) { if ( $m4is_g4ulmz['type'] == 'dollars' ) { $m4is_k1c6mi[$m4is_fdmw5] += (double) $m4is_wo7c93['InvoiceTotal']; } elseif ( $m4is_g4ulmz['type'] == 'invoices' ) { $m4is_k1c6mi[$m4is_fdmw5]++; } } } $m4is_zvxijt++; $m4is_c_3n = $m4is_c_3n + count( $m4is_jpzyit ); } while ( count( $m4is_jpzyit ) == $m4is_qqzo); unset( $m4is_k1c6mi[0], $m4is_s2hf4k[0] ); arsort( $m4is_k1c6mi ); return array_slice( $m4is_k1c6mi, 0, $m4is_g4ulmz['slots'], true ); } }
