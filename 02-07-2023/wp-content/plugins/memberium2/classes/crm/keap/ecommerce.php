<?php
/**
 * Copyright (c) 2018-2022 David J Bullock
 * Web Power and Light
 */

 class_exists('m4is_emz57o') || die(); final 
class m4is_vvgc8 {    private static 
function m4is_soe6(int $m4is_zcyj) : string { $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); return "memberium/{$m4is_q7m2}/payplans//{$m4is_zcyj}"; }  static 
function m4is_vksg(int $m4is_zcyj) { $m4is_mvjikp = false; $m4is_sfxdru = 1800; if ($m4is_zcyj) { $m4is_t7i0bz = self::m4is_soe6($m4is_zcyj); $m4is_mvjikp = get_transient($m4is_t7i0bz); if ($m4is_mvjikp === false) { $m4is_u13x = 'PayPlan'; $m4is_kc1q = ['InvoiceId' => $m4is_zcyj]; $m4is_hkp7s = m4is_f84s3h::m4is_cm6nr($m4is_u13x); $m4is_mvjikp = m4is_f84s3h::m4is_yt5p0l($m4is_u13x, 1, 0, $m4is_kc1q, $m4is_hkp7s); } if (is_array($m4is_mvjikp) && ! empty($m4is_mvjikp) ) { set_transient($m4is_t7i0bz, $m4is_mvjikp[0], $m4is_sfxdru); $m4is_mvjikp = $m4is_mvjikp[0]; } } return $m4is_mvjikp; }    private static 
function m4is_g9htep(int $m4is_yhq4i0) : string { $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); return "memberium/{$m4is_q7m2}/payplanitems//{$m4is_yhq4i0}"; }  static 
function m4is_vjtd7(int $m4is_yhq4i0) { $m4is_u8got = false; if ($m4is_yhq4i0) { $m4is_t7i0bz = self::m4is_g9htep($m4is_yhq4i0); $m4is_u8got = get_transient($m4is_t7i0bz); if ($m4is_u8got === false) { $m4is_u13x = 'PayPlanItem'; $m4is_kc1q = [ 'PayPlanId' => $m4is_yhq4i0 ]; $m4is_hkp7s = m4is_f84s3h::m4is_cm6nr($m4is_u13x); $m4is_u8got = m4is_f84s3h::m4is_l2n5pg($m4is_u13x, 1000, 0, $m4is_kc1q, $m4is_hkp7s, 'DateDue', true); if (is_array($m4is_u8got) && count($m4is_u8got) > 0) { set_transient($m4is_t7i0bz, $m4is_u8got, 1800); } } } return $m4is_u8got; }    private static 
function m4is_javl(array $m4is_yar3) { global $wpdb; $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_kbu63_ = m4is_f84s3h::m4is_cm6nr('product'); $m4is_m_9gr = []; $m4is_h9ti6y = []; $m4is_o1af2 = []; $m4is_dhrs = []; foreach($m4is_yar3 as $m4is_jfohk) { $m4is_h9ti6y[] = $m4is_jfohk['Id']; } if (! empty($m4is_h9ti6y)) { $m4is_qrhk_ = implode(',', $m4is_h9ti6y); $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `id` NOT IN ({$m4is_qrhk_})"; $wpdb->query($m4is_ioxk); } foreach($m4is_yar3 as $m4is_b40e_m => $m4is_jfohk) { $m4is_ddj4bp = self::m4is_kv6sp( (int) $m4is_jfohk['Id']);  foreach($m4is_ddj4bp as $m4is_sv3h => $m4is_rhfd) { if (! array_key_exists($m4is_sv3h, $m4is_jfohk) ) { $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' AND `id` = {$m4is_jfohk['Id']} AND `fieldname` = '{$m4is_sv3h}' "; $wpdb->query($m4is_ioxk); } }  foreach($m4is_jfohk as $m4is_e3k_mi => $m4is_waxrhu) { if (! in_array($m4is_e3k_mi, $m4is_m_9gr) ) { if ( (! isset($m4is_ddj4bp[$m4is_e3k_mi]) || ($m4is_ddj4bp[$m4is_e3k_mi] <> $m4is_waxrhu) ) ) { $m4is_o1af2[] = $wpdb->prepare('(%d, %s, %s, %s)', $m4is_b40e_m, $m4is_q7m2, $m4is_e3k_mi, $m4is_waxrhu); $m4is_dhrs[] .= $wpdb->prepare("%s", $m4is_e3k_mi); } } } if (! empty($m4is_o1af2) ) { $m4is_ioxk = "INSERT INTO {$m4is_u13x} (id, appname, fieldname, value) VALUES " . implode(',', $m4is_o1af2) . " ON DUPLICATE KEY UPDATE id=VALUES(id), appname=VALUES(appname), fieldname=VALUES(fieldname), value=VALUES(value);"; $m4is_n_bp6 = $wpdb->query($m4is_ioxk); } } } static 
function m4is_scnd() : int { $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_ioxk = "SELECT count(DISTINCT `id`) FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}'"; return (int) $GLOBALS['wpdb']->get_var($m4is_ioxk); } static 
function m4is_m_gb8n() { global $wpdb; $m4is_n94k = 3 * HOUR_IN_SECONDS; $m4is_yqog2 = get_option('memberium_tables_updated', []); $m4is_qqzo = defined('MEMBERIUM_PRODUCT_LIMIT') ? constant('MEMBERIUM_PRODUCT_LIMIT') : 1000; $m4is_u13x = 'Product'; $m4is_zvxijt = 0; $m4is__dxt_o = 'Id'; $m4is_v_fri = '%'; $m4is_hkp7s = m4is_f84s3h::m4is_cm6nr( $m4is_u13x, false, ['LargeImage']); $m4is_c_3n = 0; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_t7i0bz = "Memberium_{$m4is_q7m2}_Product"; $m4is_kc1q = ['Id' => $m4is_v_fri]; $m4is_yar3 = []; $m4is_gwtb03 = memberium_app()->m4is_wnlbj_(); $m4is_ppq5 = 'all'; $m4is_nasl4j = 'memberium2/products'; do { $m4is_jpzyit = $m4is_gwtb03->dsQuery($m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s); $m4is_zvxijt++; if ( is_array($m4is_jpzyit) ) { foreach ($m4is_jpzyit as $m4is_wo7c93) { $m4is_yar3[$m4is_wo7c93['Id']] = $m4is_wo7c93; } } } while (count($m4is_jpzyit) == $m4is_qqzo); unset($m4is_jpzyit, $m4is_wo7c93); if (is_array($m4is_yar3) ) { set_transient($m4is_t7i0bz, $m4is_yar3, $m4is_n94k); set_transient('memberium_products_updated', time() ); self::m4is_javl($m4is_yar3); } else { $m4is_yar3 = false; } $m4is_yqog2['products'] = time(); update_option('memberium_tables_updated', $m4is_yqog2, false); return $m4is_yar3; } static 
function m4is_kv6sp(int $m4is_sdob0) { global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_jfohk = []; $m4is_ioxk = "SELECT `fieldname`, `value` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' AND `id` = {$m4is_sdob0}"; $m4is_jr7f6 = $wpdb->get_results($m4is_ioxk, ARRAY_A); if (is_array($m4is_jr7f6)) { foreach($m4is_jr7f6 as $m4is_n_bp6) { $m4is_jfohk[$m4is_n_bp6['fieldname']] = $m4is_n_bp6['value']; } } return $m4is_jfohk; } static 
function m4is_rrn0() { $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_ioxk = "SELECT `id`, `fieldname`, `value` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}'"; $m4is_jpzyit = $GLOBALS['wpdb']->get_results($m4is_ioxk, ARRAY_A); $m4is_yar3 = []; foreach($m4is_jpzyit as $m4is_wo7c93) { $m4is_yar3[$m4is_wo7c93['id']][$m4is_wo7c93['fieldname']] = $m4is_wo7c93['value']; } return $m4is_yar3; }  static 
function m4is_gnm5q9( int $m4is_b40e_m, bool $m4is_m0nora = false ) { $m4is_ppq5 = $m4is_b40e_m; $m4is_nasl4j = 'memberium2/product'; $m4is_n94k = 900; $m4is_in0ti = false; $m4is_jfohk = wp_cache_get( $m4is_ppq5, $m4is_nasl4j, false, $m4is_in0ti ); if ( $m4is_in0ti === false ) { $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_ioxk = "SELECT `fieldname`, `value` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}' AND `id` = {$m4is_b40e_m}"; $m4is_jpzyit = $GLOBALS['wpdb']->get_results($m4is_ioxk, ARRAY_A); $m4is_jfohk = []; if (is_array($m4is_jpzyit)) { foreach($m4is_jpzyit as $m4is_wo7c93) { $m4is_sv3h = $m4is_m0nora ? strtolower($m4is_wo7c93['fieldname']) : $m4is_wo7c93['fieldname']; $m4is_jfohk[$m4is_sv3h] = $m4is_wo7c93['value']; } } if (! empty($m4is_jfohk)) { wp_cache_set($m4is_ppq5, $m4is_jfohk, $m4is_nasl4j, $m4is_n94k); } } return $m4is_jfohk; }  static 
function m4is_yelt( $m4is_m0nora = false ) { $m4is_ppq5 = 'all'; $m4is_nasl4j = 'memberium2/products'; $m4is_n94k = 900; $m4is_in0ti = false; $m4is_yar3 = wp_cache_get( $m4is_ppq5, $m4is_nasl4j, false, $m4is_in0ti ); if ( $m4is_in0ti === false ) { $m4is_u13x = MEMBERIUM_DB_PRODUCTS; $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_ioxk = "SELECT `id`, `fieldname`, `value` FROM `{$m4is_u13x}` WHERE `appname` = '{$m4is_q7m2}'"; $m4is_jpzyit = $GLOBALS['wpdb']->get_results( $m4is_ioxk, ARRAY_A ); $m4is_yar3 = []; foreach( $m4is_jpzyit as $m4is_b40e_m => $m4is_wo7c93 ) { $m4is_sv3h = $m4is_m0nora ? strtolower( $m4is_wo7c93['fieldname'] ) : $m4is_wo7c93['fieldname']; $m4is_yar3[$m4is_wo7c93['id']][$m4is_sv3h] = $m4is_wo7c93['value']; unset( $m4is_jpzyit[$m4is_b40e_m] ); } if (! empty( $m4is_yar3 ) ) { wp_cache_set( $m4is_ppq5, $m4is_yar3, $m4is_nasl4j, $m4is_n94k ); } } return $m4is_yar3; }    private static 
function m4is_p_ri3a() : string { return 'memberium/ecommerce/subscriptionplans'; }  static 
function m4is_d9auv() { $m4is_t7i0bz = self::m4is_p_ri3a(); $m4is_w6xi = DAY_IN_SECONDS; $m4is_muiqev = get_transient($m4is_t7i0bz); if ($m4is_muiqev === false) { $m4is_u13x = 'SubscriptionPlan'; $m4is_ltqb = 1000; $m4is_zvxijt = 0; $m4is_muiqev = []; $m4is_kc1q = [ 'Id' => '%' ]; $m4is_jpzyit = m4is_f84s3h::m4is_yt5p0l($m4is_u13x, $m4is_ltqb, $m4is_zvxijt, $m4is_kc1q); if (is_array($m4is_jpzyit) ) { foreach ($m4is_jpzyit as $m4is_wo7c93) { $m4is_b40e_m = $m4is_wo7c93['Id']; $m4is_qvd2 = (int) $m4is_wo7c93['Cycle']; $m4is_twkpt = (int) $m4is_wo7c93['Frequency']; $m4is_muiqev[$m4is_b40e_m] = $m4is_wo7c93; if ($m4is_qvd2 == 6) { $m4is_muiqev[$m4is_b40e_m]['FrequencyWord'] = ($m4is_twkpt == 1) ? 'Day' : $m4is_twkpt . ' Days'; } elseif ($m4is_qvd2 == 3) { $m4is_muiqev[$m4is_b40e_m]['FrequencyWord'] = ($m4is_twkpt == 1) ? 'Week' : $m4is_twkpt . ' Weeks'; } elseif ($m4is_qvd2 == 2) { $m4is_muiqev[$m4is_b40e_m]['FrequencyWord'] = ($m4is_twkpt == 1) ? 'Month' : $m4is_twkpt . ' Months'; } elseif ($m4is_qvd2 == 1) { $m4is_muiqev[$m4is_b40e_m]['FrequencyWord'] = ($m4is_twkpt == 1) ? 'Year' : $m4is_twkpt . ' Years'; } } } set_transient('memberium_subscriptionplans', $m4is_muiqev, $m4is_w6xi); } return $m4is_muiqev; }     static 
function m4is_z3anvh() { global $wpdb; $m4is_kb2yx5 = get_option('memberium_tables_updated', [] ); $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_yz1j = MEMBERIUM_DB_INVOICES;  $m4is_ioxk = "SELECT MAX(`lastupdated`) FROM `{$m4is_yz1j}` WHERE `appname` = '{$m4is_q7m2}';"; $m4is_i8ic4 = $wpdb->get_var($m4is_ioxk); if (! $m4is_i8ic4) { $m4is_i8ic4 = '1969-01-20T00:00:00'; }  $m4is_u13x = 'Invoice'; $m4is_qqzo = 400; $m4is_zvxijt = 0; $m4is_c_3n = 0; $m4is_hkp7s = m4is_f84s3h::m4is_cm6nr($m4is_u13x, false); $m4is_kc1q = [ 'LastUpdated' => "~>=~ {$m4is_i8ic4}" ]; $m4is_hog6 = [ 'CreditStatus' => 0, 'Description' => '', 'InvoiceTotal' => 0, 'InvoiceType' => '', 'JobId' => 0, 'LeadAffiliateId' => 0, 'PayPlanStatus' => 0, 'PayStatus' => 0, 'ProductSold' => '', 'PromoCode' => '', 'RefundStatus' => 0, 'Synced' => 0, 'TotalDue' => 0, 'TotalPaid' => 0, ]; $m4is_vhs4te = [ 'appname' => '%s', 'contactid' => '%d', 'creditstatus' => '%s', 'datecreated' => '%s', 'description' => '%s', 'id' => '%d', 'invoicetotal' => '%d', 'invoicetype' => '%s', 'jobid' => '%d', 'lastupdated' => '%s', 'leadaffiliateid' => '%s', 'payplanstatus' => '%s', 'paystatus' => '%s', 'productsold' => '%s', 'promocode' => '%s', 'refundstatus' => '%s', 'totaldue' => '%s', 'totalpaid' => '%s', ]; $m4is_kt8fc5 = '`' . implode('`, `', array_keys($m4is_vhs4te)) . '`'; $m4is_ii1pc0 = "'" . implode("', '", $m4is_vhs4te) . "'"; $m4is_ju7s = "INSERT INTO `{$m4is_yz1j}` ( {$m4is_kt8fc5} ) VALUES ( {$m4is_ii1pc0} )"; do { $m4is_jpzyit = m4is_f84s3h::m4is_l2n5pg($m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s, 'LastUpdated', true); $m4is_n90js = is_array($m4is_jpzyit) ? count($m4is_jpzyit) : 0; if (is_array($m4is_jpzyit) && count($m4is_jpzyit) > 0) { foreach ($m4is_jpzyit as $m4is_wo7c93) { $m4is_wo7c93 = array_merge($m4is_hog6, $m4is_wo7c93); $m4is_b40e_m = (int) $m4is_wo7c93['Id']; $m4is_xc6t12 = isset($m4is_wo7c93['LastUpdated']) ? $m4is_wo7c93['LastUpdated'] : $m4is_wo7c93['DateCreated']; $m4is_sgd1 = [ 'appname' => $m4is_q7m2, 'contactid' => $m4is_wo7c93['ContactId'], 'creditstatus' => $m4is_wo7c93['CreditStatus'], 'datecreated' => date('Y-m-d h:i:s', strtotime($m4is_wo7c93['DateCreated']) ), 'description' => $m4is_wo7c93['Description'], 'id' => $m4is_b40e_m, 'invoicetotal' => $m4is_wo7c93['InvoiceTotal'], 'invoicetype' => $m4is_wo7c93['InvoiceType'], 'jobid' => $m4is_wo7c93['JobId'], 'lastupdated' => date('Y-m-d h:i:s', strtotime($m4is_xc6t12) ), 'leadaffiliateid' => $m4is_wo7c93['LeadAffiliateId'], 'payplanstatus' => $m4is_wo7c93['PayPlanStatus'], 'paystatus' => $m4is_wo7c93['PayStatus'], 'productsold' => $m4is_wo7c93['ProductSold'], 'promocode' => isset($m4is_wo7c93['PromoCode']) ? $m4is_wo7c93['PromoCode'] : '', 'refundstatus' => $m4is_wo7c93['RefundStatus'], 'totaldue' => $m4is_wo7c93['TotalDue'], 'totalpaid' => $m4is_wo7c93['TotalPaid'], ]; $wpdb->query("DELETE FROM `{$m4is_yz1j}` WHERE `appname` = '{$m4is_q7m2}' AND `id` = {$m4is_b40e_m};"); $wpdb->query($wpdb->prepare($m4is_ju7s, $m4is_sgd1) ); } } $m4is_zvxijt++; $m4is_c_3n = $m4is_c_3n + $m4is_n90js; } while (is_array($m4is_jpzyit) && $m4is_n90js == $m4is_qqzo); $m4is_kb2yx5['invoices'] = time(); update_option('memberium_tables_updated', $m4is_kb2yx5, false); return $m4is_c_3n; }     static 
function m4is_vzxm9q(int $m4is_ccru2k) { if (! empty($m4is_ccru2k) ) { $m4is_kc1q = [ 'OriginatingOrderId' => $m4is_ccru2k ]; $m4is_kbu63_ = [ 'Id' ]; $m4is_uke5g = m4is_f84s3h::m4is_yt5p0l('RecurringOrder', 998, 0, $m4is_kc1q, $m4is_kbu63_);  if (is_array($m4is_uke5g) ) { foreach($m4is_uke5g as $m4is_ie4p50) { $m4is_n_bp6 = $app->dsDelete('RecurringOrder', (int) $m4is_ie4p50['Id']); } } } }  static 
function m4is_udjo() { $m4is_qqzo = 999; $m4is_u13x = 'RecurringOrder'; $m4is_zvxijt = 0; $m4is__dxt_o = 'Id'; $m4is_v_fri = '%'; $m4is_c_3n = 0; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_z9ikd = []; $m4is_hkp7s = [ 'ContactId', 'EndDate', 'Id', 'ReasonStopped', 'Status', ]; $m4is_kc1q = [ 'Status' => 'Active', 'EndDate' => '~<=~' . date('Y-m-d'), ]; do { $m4is_jpzyit = m4is_f84s3h::m4is_yt5p0l($m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s); if (! empty($m4is_jpzyit) ) { foreach ($m4is_jpzyit as $m4is_wo7c93) { $m4is_wo7c93['EndDate'] = (isset($m4is_wo7c93['EndDate']) ) ? $m4is_wo7c93['EndDate'] : ''; $m4is_wo7c93['ReasonStopped'] = (isset($m4is_wo7c93['ReasonStopped']) ) ? trim($m4is_wo7c93['ReasonStopped']) : ''; if ($m4is_wo7c93['EndDate'] > '' && $m4is_wo7c93['EndDate'] < date('Ymd\T00:00:00') ) { $m4is_l1zv = []; if ($m4is_wo7c93['ReasonStopped'] == '') { $m4is_l1zv['ReasonStopped'] = "End Date Passed.\nAutoEnded by Memberium"; } $m4is_l1zv['EndDate'] = date('Ymd\Th:i:s'); $m4is_l1zv['Status'] = 'Inactive'; m4is_f84s3h::m4is_go6re('RecurringOrder', (int) $m4is_wo7c93['Id'], $m4is_l1zv); } } } $m4is_zvxijt++; } while (count($m4is_jpzyit) == $m4is_qqzo); unset($m4is_jpzyit, $m4is_wo7c93); return $m4is_z9ikd; } }
