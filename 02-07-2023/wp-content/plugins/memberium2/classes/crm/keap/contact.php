<?php
/**
 * Copyright (c) 2018-2022 David J Bullock
 * Web Power and Light
 */

 class_exists('m4is_emz57o') || die(); m4is_zbyh::m4is_gopgz(); final 
class m4is_zbyh {    private static $m4is_bxv7u, $m4is_q7m2, $m4is_gwtb03; static 
function m4is_gopgz() { self::$m4is_bxv7u = memberium_app(); self::$m4is_gwtb03 = self::$m4is_bxv7u->m4is_wnlbj_(); self::$m4is_q7m2 = self::$m4is_bxv7u->m4is_re5x( 'appname' ); }  static 
function m4is_eb7n8k() { global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_u13x = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `appname` = %s ( `value` = '' OR `value` IS NULL ) "; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_q7m2 ); $wpdb->query( $m4is_ioxk ); }  static 
function m4is_tm75y() { $m4is_ay7a = memberium_app()->m4is_mmdrl( 'settings', 'ignore_contact_fields' ); if ( empty( $m4is_ay7a ) ) { return; } global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_u13x = MEMBERIUM_DB_CONTACTS; $m4is_ay7a = explode( ',', $m4is_ay7a ); $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `fieldname` IN ('" . implode( "','", $m4is_ay7a ) . "') AND `appname` = '{$m4is_q7m2}' "; $wpdb->query( $m4is_ioxk ); }     static 
function m4is_fhxr6( ?int $m4is_q4c_xa = 0) : int { static $m4is_in0ti = []; $m4is_aicfp = 0;  if ( isset($m4is_in0ti[$m4is_q4c_xa]) ) { return $m4is_in0ti[$m4is_q4c_xa]; }  $m4is_aicfp = get_user_meta( $m4is_q4c_xa, 'infusionsoft_user_id', true ); if ( $m4is_aicfp ) { $m4is_in0ti[$m4is_q4c_xa] = $m4is_aicfp; return $m4is_aicfp; }  $m4is_nzrv1 = get_userdata( $m4is_q4c_xa ); if ( is_a( $m4is_nzrv1, 'WP_User' ) ) { $m4is_m2h6b = $m4is_nzrv1->user_email; if ( ! empty( $m4is_m2h6b ) ) { $m4is_aicfp = self::m4is_e6ntsy( $m4is_m2h6b ); if ( is_array( $m4is_aicfp ) ) { $m4is_aicfp = isset( $m4is_aicfp[0] ) ? $m4is_aicfp[0] : 0; } return $m4is_aicfp; } } return 0; }  static 
function m4is_e6ntsy( ?string $m4is_m2h6b, $m4is_w5ky4q = []) { $m4is_m2h6b = strtolower( trim( $m4is_m2h6b ) ); $m4is_ppq5 = 'email:' . $m4is_m2h6b; $m4is_nasl4j = 'memberium2/contacts'; $m4is_in0ti = false; $m4is_ulo1 = wp_cache_get( $m4is_ppq5, $m4is_nasl4j, false, $m4is_in0ti ); if (! $m4is_in0ti) { global $wpdb; $m4is_znoa3z = MEMBERIUM_DB_CONTACTS; $m4is_tct_hk = memberium_app()->m4is_mmdrl( 'settings' ); $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_rz4ur = memberium_app()->m4is_mmdrl( 'settings', 'username_field' ); $sql_maxage = intval( time() - $m4is_tct_hk['max_contact_age'] ) - 10; $m4is_ioxk = "SELECT `id` FROM `{$m4is_znoa3z}` WHERE `appname` = '{$m4is_q7m2}' AND `fieldname` = '{$m4is_rz4ur}' AND `value` = %s ORDER BY `id` ASC;"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_m2h6b ); $m4is_ulo1 = $wpdb->get_col( $m4is_ioxk ); if ( is_array( $m4is_ulo1 ) && ! empty( $m4is_ulo1 ) ) { wp_cache_set( $m4is_ppq5, $m4is_ulo1, $m4is_nasl4j, 300 ); } } if (! empty( $m4is_w5ky4q['single'] ) ) { $m4is_ulo1 = $m4is_ulo1[0]; } return $m4is_ulo1; }   static 
function m4is__nfdz9( ?int $m4is_aicfp = 0) { global $wpdb; static $m4is_gmy1qk = []; if (empty($m4is_aicfp) ) { return 0; } if (isset($m4is_gmy1qk[$m4is_aicfp]) ) { return $m4is_gmy1qk[$m4is_aicfp]; } $m4is_q4c_xa = 0; $m4is_id576 = ''; $m4is_oqymz9 = []; $m4is_b9hmo = m4is_lpl4d::m4is_a_2z(); if ($m4is_b9hmo == $m4is_aicfp) { $m4is_q4c_xa = get_current_user_id(); $m4is_gmy1qk[$m4is_aicfp] = $m4is_q4c_xa; return $m4is_q4c_xa; } $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_kohrvn = 'memberium/contact_id/' . $m4is_aicfp; $m4is_ioxk = "SELECT `user_id` FROM `{$wpdb->usermeta}` WHERE `meta_key` = 'memberium/contact_id/{$m4is_aicfp}' ORDER BY `umeta_id` DESC"; $m4is_q4c_xa = $wpdb->get_var( $m4is_ioxk ); if (! $m4is_q4c_xa) { $m4is_ioxk = "SELECT `user_id` FROM `{$wpdb->usermeta}` WHERE `meta_key` = 'infusionsoft_user_id' AND `meta_value` = {$m4is_aicfp} "; $m4is_q4c_xa = $wpdb->get_var( $m4is_ioxk ); if ($m4is_q4c_xa) { memberium_app()->m4is_cuoc($m4is_q4c_xa, $m4is_aicfp); } }  if (! $m4is_q4c_xa) { $m4is_u13x = MEMBERIUM_DB_CONTACTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_rz4ur = memberium_app()->m4is_mmdrl('settings', 'username_field'); $m4is_ioxk = "SELECT `value` FROM `{$m4is_u13x}` WHERE `id` = %d AND `appname` = %s AND `fieldname` = %s ORDER BY `id` LIMIT 1"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_aicfp, $m4is_q7m2, $m4is_rz4ur ); $m4is_id576 = $wpdb->get_var( $m4is_ioxk ); if ( ! empty($m4is_id576) ) { $m4is_nzrv1 = get_user_by('email', $m4is_id576); if (! $m4is_nzrv1) { $m4is_nzrv1 = get_user_by('login', $m4is_id576); } if ($m4is_nzrv1) { $m4is_q4c_xa = $m4is_nzrv1->ID; $m4is_gmy1qk[$m4is_aicfp] = $m4is_q4c_xa; return $m4is_q4c_xa; }  $m4is_ioxk = "SELECT `id` FROM `{$m4is_u13x}` WHERE `value` = %s AND `appname` = %s AND `fieldname` = %s ORDER BY `id` ASC "; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_id576, $m4is_q7m2, $m4is_rz4ur ); $m4is_oqymz9 = $wpdb->get_col( $m4is_ioxk ); $m4is_ioxk = "SELECT `ID` FROM `{$wpdb->users}` WHERE `user_login` = %s OR `user_email` = %s ;"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_id576, $m4is_id576 ); $m4is_q4c_xa = $wpdb->get_var( $m4is_ioxk ); if ( ! empty( $m4is_q4c_xa ) ) { $m4is_b40e_m = get_user_meta($m4is_q4c_xa, 'infusionsoft_user_id', true); if ( $m4is_b40e_m === false ) {  } if ( $m4is_b40e_m == $m4is_aicfp ) { $m4is_gmy1qk[$m4is_aicfp] = $m4is_q4c_xa; return $m4is_q4c_xa; } } } } if (user_can($m4is_q4c_xa, 'manage_options') ) { $m4is_q4c_xa = 0; } if (! empty($m4is_q4c_xa)) { $m4is_gmy1qk[$m4is_aicfp] = $m4is_q4c_xa; return $m4is_q4c_xa; } return false; }     static 
function m4is__54vbw( ?string $m4is_m2h6b ) : int { $m4is_rz4ur = memberium_app()->m4is_mmdrl( 'settings', 'username_field' ); $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_w6mt = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "SELECT COUNT( `id` ) FROM `{$m4is_w6mt}` WHERE `appname` = %s AND `fieldname` = %s AND `value` = %s "; $m4is_ioxk = $GLOBALS['wpdb']->prepare( $m4is_ioxk, $m4is_q7m2, $m4is_rz4ur, $m4is_m2h6b ); $m4is_n_bp6 = (int) $GLOBALS['wpdb']->get_var( $m4is_ioxk ); return $m4is_n_bp6; }  static 
function m4is_w1bfmt( ?int $m4is_aicfp, ?bool $m4is_qcu7zp = false ) : array { $m4is_w6mt = MEMBERIUM_DB_CONTACTS; $m4is_sv3h = $m4is_qcu7zp ? 'LOWER(`fieldname`) as `fieldname`' : '`fieldname`'; $m4is_ioxk = "SELECT {$m4is_sv3h}, `value` FROM `{$m4is_w6mt}` WHERE `id` = %d AND `appname` = %s"; $m4is_ioxk = $GLOBALS['wpdb']->prepare( $m4is_ioxk, $m4is_aicfp, self::$m4is_q7m2 ); $m4is_jpzyit = $GLOBALS['wpdb']->get_results( $m4is_ioxk, ARRAY_A ); $m4is_nq7s = []; if ( is_array( $m4is_jpzyit ) ) { foreach ( $m4is_jpzyit as $m4is_b40e_m => $m4is_wo7c93 ) { $m4is_nq7s[$m4is_wo7c93['fieldname']] = $m4is_wo7c93['value']; } } return apply_filters( 'memberium_contact_load', $m4is_nq7s ); }  static 
function m4is_prqoyt( ?array $m4is_ulo1 = [] ) { $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_w6mt = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "SELECT id, value FROM `{$m4is_w6mt}` WHERE `appname` = %s AND `fieldname` = 'Groups'"; if ( ! empty( $m4is_ulo1 ) ) { $m4is_ioxk .= " AND `id` IN ('%s')"; $m4is_ioxk = $GLOBALS['wpdb']->prepare( $m4is_ioxk, $m4is_q7m2, implode( ',', $m4is_ulo1 ) ); } else { $m4is_ioxk = $GLOBALS['wpdb']->prepare( $m4is_ioxk, $m4is_q7m2 ); } return $GLOBALS['wpdb']->get_results( $m4is_ioxk, OBJECT_K ); }  static 
function m4is__98tl( ?int $m4is_aicfp, ?bool $m4is_wsf6 = false ) { global $wpdb; $m4is_q7m2 = memberium_app()->m4is_re5x( 'appname' ); $m4is_u13x = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `id` = %d AND `appname` = %s"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_aicfp, $m4is_q7m2 ); $wpdb->query( $m4is_ioxk ); if ( $m4is_aicfp ) { memberium_app()->m4is_l41p7r( $m4is_aicfp ); if ( $m4is_wsf6 ) {  $m4is_u13x = MEMBERIUM_DB_CONTACTTAGS; $m4is_ioxk = "DELETE FROM `{$m4is_u13x}` WHERE `contactid` = %d AND `appname` = %s"; $m4is_ioxk = $wpdb->prepare( $m4is_ioxk, $m4is_aicfp, $m4is_q7m2 ); $wpdb->query( $m4is_ioxk ); $m4is_fdmw5 = m4is__q5cn::m4is_ma1q8( $m4is_aicfp ); m4is__q5cn::m4is_nvjoa8( $m4is_fdmw5 ); } } }  static 
function m4is_p6r1() { $m4is_yyrt = 'memberium/async/next_run'; $m4is_l8wvap = 'memberium/async/last_count'; $m4is_vfy5p = 'memberium/async/last_update'; $m4is_e2kyt = time(); $m4is__blm89 = get_option($m4is_yyrt, 0); if ($m4is_e2kyt >= $m4is__blm89) { $m4is_qqzo = (int) memberium_app()->m4is_mmdrl('settings', 'async_limit', 0); $m4is_o2wm4 = (int) memberium_app()->m4is_mmdrl('settings', 'async_tag', 0); if ($m4is_qqzo && $m4is_o2wm4 ) { $m4is_oqymz9 = []; $m4is_ptw7 = 300; $m4is_zvxijt = 0; $m4is_u13x = 'Contact'; $m4is_ejfox = 0; $m4is_h9ti6y = []; $m4is_c_q65 = get_option($m4is_vfy5p, '2000-01-01 00:00:00'); $m4is_gwtb03 = memberium_app()->m4is_wnlbj_(); $m4is_yz1j = MEMBERIUM_DB_CONTACTS; $m4is_q7m2 = memberium_app()->m4is_re5x('appname'); $m4is_hkp7s = m4is_f84s3h::m4is_cm6nr($m4is_u13x, true); $m4is_kc1q = [  'LastUpdated' => "~>=~ {$m4is_c_q65}", 'Groups' => $m4is_o2wm4, ]; $m4is_oqymz9 = $m4is_gwtb03->dsQueryOrderBy($m4is_u13x, $m4is_qqzo, $m4is_zvxijt, $m4is_kc1q, $m4is_hkp7s, 'LastUpdated', true); if (is_array($m4is_oqymz9) && ! empty($m4is_oqymz9)) { $m4is_ejfox = count($m4is_oqymz9); update_option($m4is_l8wvap, $m4is_ejfox, false); foreach($m4is_oqymz9 as $m4is_nq7s) { $m4is_h9ti6y[] = $m4is_nq7s['Id']; } $m4is_msxe = implode(',', $m4is_h9ti6y); $m4is_ioxk = "SELECT `id`, `value` FROM `{$m4is_yz1j}` WHERE `id` IN ({$m4is_msxe}) AND `appname` = %s AND `fieldname` = 'LastUpdated' "; $m4is_ioxk = $GLOBALS['wpdb']->prepare($m4is_ioxk, $m4is_q7m2); $m4is_n3zp = $GLOBALS['wpdb']->get_results($m4is_ioxk, OBJECT_K); foreach($m4is_oqymz9 as $m4is_ap3_ => $m4is_nq7s) { $m4is_aicfp = $m4is_nq7s['Id']; $m4is_a5qfj = $m4is_nq7s['LastUpdated']; $m4is_cuc_9 = $m4is_n3zp[$m4is_aicfp]->value; if ($m4is_cuc_9 >= $m4is_a5qfj) { unset($m4is_oqymz9[$m4is_ap3_]); } } } if (is_array($m4is_oqymz9) && ! empty($m4is_oqymz9) ) { foreach($m4is_oqymz9 as $m4is_nq7s) { memberium_app()->m4is_ba7dk($m4is_nq7s); if (! empty($m4is_nq7s['LastUpdated']) ) { $m4is_coq45 = date('Y-m-d H:i:s', strtotime($m4is_nq7s['LastUpdated']) ); update_option($m4is_vfy5p, $m4is_coq45, true); } } } m4is_q1amx::m4is_u4dk(0, 'cron', 'Background Contact Updater - ' . count($m4is_oqymz9) . ' contacts synced.') ; if ($m4is_ptw7 == $m4is_qqzo) { $m4is_ptw7 = 30; } update_option($m4is_yyrt, time() + $m4is_ptw7); } } }  static 
function m4is_pp0i( ?int $m4is_aicfp, ?array $m4is_kbu63_ = [], ?bool $m4is_afcz_x = false ) { $m4is_aicfp = (int) $m4is_aicfp; if ( $m4is_aicfp ) { self::$m4is_gwtb03->updatecon( $m4is_aicfp, $m4is_kbu63_ ); if ( $m4is_afcz_x ) { self::$m4is_bxv7u->m4is_qjrxkl( $m4is_aicfp ); } } return $m4is_aicfp; }  static 
function m4is_kbc0w( ?string $m4is_m2h6b = '', ?string $m4is_kgtwp = 'Memberium') { if ( ! empty( $m4is_m2h6b ) ) { memberium_app()->m4is_wnlbj_()->optin($m4is_m2h6b, $m4is_kgtwp); } }  static 
function m4is_dj3iv( ?array $m4is_nq7s, ?string $m4is_krkto6 = 'Email' ) : int { return (int) memberium_app()->m4is_wnlbj_()->addWithDupCheck($m4is_nq7s, $m4is_krkto6); }  static 
function m4is_n0_ck( ?int $m4is_aicfp, ?array $m4is_kbu63_ = [] ) { if (empty($m4is_kbu63_)) { $m4is_kbu63_ = m4is_f84s3h::m4is_cm6nr('Contact', true); } return memberium_app()->m4is_wnlbj_()->loadCon($m4is_aicfp, $m4is_kbu63_); }  static 
function m4is_tukr( ?string $m4is_m2h6b = '', ?array $m4is_kbu63_ = [] ) { if ( empty ($m4is_kbu63_ ) ) { $m4is_kbu63_ = m4is_f84s3h::m4is_cm6nr( 'Contact', true ); } return memberium_app()->m4is_wnlbj_()->findByEmail( $m4is_m2h6b, $m4is_kbu63_ ); } static 
function m4is_qjrxkl( ?int $m4is_aicfp ) { $m4is_nq7s = self::m4is_n0_ck( $m4is_aicfp ); if ( is_array( $m4is_nq7s ) ) { memberium_app()->m4is_ba7dk( $m4is_nq7s ); } return $m4is_nq7s; } }
