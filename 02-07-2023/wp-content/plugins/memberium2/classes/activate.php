<?php
/**
 * Copyright (c) 2012-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 class_exists('m4is_emz57o') || die(); final 
class m4is_d2vzc { static 
function m4is_fpjv2( $m4is_alji = false ) { self::m4is_yw1mi( false ); if ( function_exists( 'is_multisite' ) && is_multisite() ) { global $wpdb;  if ( $m4is_alji ) { $m4is_enqyc = $wpdb->blogid; $m4is_q047 = $wpdb->get_col( "SELECT blog_id FROM `{$wpdb->blogs}`" );  if ( is_array( $m4is_q047 ) ) { foreach ( $m4is_q047 as $m4is_q_to1c ) { switch_to_blog( $m4is_q_to1c ); self::m4is_yw1mi( true ); } switch_to_blog( $m4is_enqyc ); } } } } static 
function m4is_yw1mi( bool $m4is_o2hq8 = false ) { global $wpdb; $m4is_pverx = time(); add_option( 'memberium/activation_timestamp', $m4is_pverx, false ); update_option( 'memberium/system/config/timestamp', microtime( true ), true ); self::m4is_x50tx(); self::m4is_nsp7(); require_once ABSPATH . 'wp-admin/includes/upgrade.php';  $m4is_bxv7u = memberium_app(); $m4is_bd92x = get_option('i2sdk'); self::m4is__804(); self::m4is_lq95t0(); self::m4is_xt2185();  self::m4is_wrnt67();  self::m4is_nk657p();  m4is_xdqx::m4is_aq4vwi();   self::m4is_uzdo();  self::m4is_ov5j(); self::m4is_nzum(); if (! defined('I2SDK_HOME') ) { $m4is_d10o = $m4is_bxv7u->m4is_mmdrl( 'settings', 'beta/oauth' ) ? 'i2sdkng' : 'i2sdk'; require_once $m4is_bxv7u->m4is_pri6vy() . "vendor/{$m4is_d10o}/i2sdk.php"; wpal_i2sdk_activate(); } if (! $m4is_o2hq8) {  if (defined('MEMBERIUM_DEFER_ACTIVATION_SYNC') ) { return; } if (function_exists('wpal_i2sdk_activate') && function_exists('wp_generate_password')) { if (! function_exists('wp_generate_password')) { include ABSPATH . 'wp-includes/pluggable.php'; } m4is_o5aoir::m4is_qlzwa4(true); }  if (! method_exists( $m4is_bxv7u->m4is_nn6s_(), 'isVerified') ) { return; } }  $m4is_e3ei = get_option('memberium_extensions', [] ); $m4is_ql75i = glob( $m4is_bxv7u->m4is_wule6i( '*/init.php' ) ); $expensive_extensions = [ 'page-tracking', ]; if (! empty($m4is_ql75i) ) { foreach ($m4is_ql75i as $extension) { $m4is_t_qmg = basename( dirname( $extension ) ); if (! isset($m4is_ql75i[$m4is_t_qmg]) ) { if (in_array($m4is_t_qmg, $expensive_extensions) ) { $m4is_e3ei[$m4is_t_qmg] = 0; } else { $m4is_e3ei[$m4is_t_qmg] = 1; } } } } update_option( 'memberium_extensions', $m4is_e3ei, true ); if ( ! isset( $m4is_bd92x['server_verified']) || $m4is_bd92x['server_verified'] <> 1 ) { return; } }  static 
function m4is_vvfujp() { $m4is_hxrbd = get_option( 'memberium_cron' ); if ( $m4is_hxrbd > 0 ) { wp_unschedule_event( $m4is_hxrbd, 'memberium_scanmakepass', 0 ); wp_unschedule_event( $m4is_hxrbd, 'memberium_maintenance', 0 ); wp_unschedule_event( $m4is_hxrbd, 'memberium_licensecheck', 0 ); } delete_option( 'memberium_cron' ); $m4is_tct_hk = get_option( 'memberium' ); if ( ! empty( $m4is_tct_hk['delete_configuration'] ) ) { delete_option( 'memberium' ); } } static 
function m4is_hpwynq() { self::m4is_m2uf8(); self::m4is_dlka19(); }     static private 
function m4is_lq95t0() { $m4is_hlzimx = get_option('memberium_site_id', false); if (! $m4is_hlzimx) { $m4is_hlzimx = hash_hmac('sha256', wp_basename('/'), wp_salt( 'nonce' ) ); update_option('memberium_site_id', $m4is_hlzimx, 'yes'); } } static private 
function m4is_nsp7() { if (! defined('MEMBERIUM_DEV') ) { $m4is_s3dnu = dirname(MEMBERIUM_HOME) . '/lib/ext-dev/'; if (file_exists($m4is_s3dnu) ) { self::m4is_j1nvc($m4is_s3dnu); } $m4is_s3dnu = dirname(MEMBERIUM_HOME) . '/lib7/ext-dev/'; if (file_exists($m4is_s3dnu) ) { self::m4is_j1nvc($m4is_s3dnu); } } } static private 
function m4is_x50tx() { $m4is_qvfmk = [ 'memberium2-installer/memberium2-installer.php', 'memberium-install-wizard/memberium-install-wizard.php', ]; foreach($m4is_qvfmk as $m4is_m_21) { if (is_plugin_active($m4is_m_21) ) { deactivate_plugins($m4is_m_21); } } } static private 
function m4is_m2uf8() { $m4is_hqmdn = get_role('administrator'); $m4is_hqmdn->remove_cap('memberium_view_user_info'); $m4is_hqmdn->remove_cap('memberium_edit_user_info'); $m4is_hqmdn->remove_cap('memberium_view_private_comments'); } static private 
function m4is_dlka19() { $m4is_hxrbd = get_option('memberium_cron'); if ($m4is_hxrbd > 0) { $m4is_oy9c = [ 'memberium_license_check', 'memberium_maintenance', 'memberium_maintenance12', 'memberium_scanmakepass', ]; foreach($m4is_oy9c as $m4is_mhrv6_) { wp_clear_scheduled_hook($m4is_mhrv6_); } } delete_option('memberium_cron'); } static private 
function m4is__804() { $m4is_wmzqp = memberium_app()->m4is_mmdrl(); $m4is_ot4v7 = trim(get_plugin_data(MEMBERIUM_HOME, false, false)['Version']); $m4is_ot4v7 = function_exists('get_plugin_data') ? trim(get_plugin_data(MEMBERIUM_HOME, false, false)['Version']) : false; if (empty($m4is_wmzqp['settings']) || ! is_array($m4is_wmzqp['settings']) ) { $m4is_wmzqp['settings'] = []; }    $m4is_xoig0r = [ 'max_record_age', 'paypal_api_password', 'paypal_api_signature', 'paypal_api_username', 'paypal_api_verified', 'stripe_live', 'stripe_public_key', 'stripe_secret_key', 'stripe_verified', 'username_field', ]; foreach ($m4is_xoig0r as $m4is_ap3_) { unset($m4is_wmzqp['settings'][$m4is_ap3_]); } $m4is_wmzqp['settings']['autologin_authkeys'] = empty($m4is_wmzqp['settings']['autologin_authkeys']) ? self::m4is_sl0w(12) : $m4is_wmzqp['settings']['autologin_authkeys']; $m4is_wmzqp['settings']['random_seed'] = empty($m4is_wmzqp['settings']['random_seed']) ? self::m4is_sl0w(16) : $m4is_wmzqp['settings']['random_seed'];  $m4is_leoz3x = [   ]; foreach ($m4is_leoz3x as $m4is_ap3_ => $m4is_rhfd) { if ( ! isset($m4is_wmzqp['settings'][$m4is_ap3_]) ) { $m4is_wmzqp['settings'][$m4is_ap3_] = $m4is_rhfd; } } if (empty($m4is_wmzqp['infusionsoft']) ) { $m4is_wmzqp['infusionsoft'] = []; }  $m4is_xoig0r = [ ]; foreach ($m4is_xoig0r as $m4is_ap3_) { unset($m4is_wmzqp['infusionsoft'][$m4is_ap3_]); } $m4is_leoz3x = [ ]; foreach ($m4is_leoz3x as $m4is_ap3_ => $m4is_rhfd) { if (empty($m4is_wmzqp['infusionsoft'][$m4is_ap3_]) ) { $m4is_wmzqp['infusionsoft'][$m4is_ap3_] = $m4is_rhfd; } } $m4is_wmzqp = self::m4is_hezn0($m4is_wmzqp); $m4is_wmzqp = self::m4is_kzn7j($m4is_wmzqp); $m4is_wmzqp['settings']['version'] = trim(get_plugin_data(MEMBERIUM_HOME, false, false)['Version']); add_option('memberium', $m4is_wmzqp, '', 'yes'); update_option('memberium', $m4is_wmzqp, 'yes'); memberium_app()->m4is_oqwxk($m4is_wmzqp); return $m4is_wmzqp; } static private 
function m4is_hezn0(array $m4is_wmzqp = []) : array { $m4is_xoig0r = []; $m4is_leoz3x = []; foreach ($m4is_xoig0r as $m4is_ap3_) { unset($m4is_wmzqp['sync'][$m4is_ap3_]); } if (empty($m4is_wmzqp['sync']) ) { $m4is_wmzqp['sync'] = []; } $m4is_b9nqt = [ 'Email', 'FirstName', 'Groups', 'Id', 'LastName', 'LastUpdated' ]; $m4is_kbu63_ = m4is_f84s3h::m4is_cm6nr('Contact'); $m4is_ay7a = array_diff($m4is_kbu63_, $m4is_b9nqt); $m4is_leoz3x['required_fields']['Contact'] = implode(',', $m4is_b9nqt); $m4is_leoz3x['ignored_sync_fields']['Contact'] = implode(',', $m4is_ay7a);  foreach ($m4is_leoz3x as $m4is_ap3_ => $m4is_rhfd) { if (empty($m4is_wmzqp['sync'][$m4is_ap3_]) ) { $m4is_wmzqp['sync'][$m4is_ap3_] = $m4is_rhfd; } } return $m4is_wmzqp; } static private 
function m4is_kzn7j(array $m4is_wmzqp = []) : array { if (is_array($m4is_wmzqp['memberships']) ) { foreach ($m4is_wmzqp['memberships'] as $m4is_ap3_ => $m4is_rhfd) { if (! isset($m4is_wmzqp['memberships'][$m4is_ap3_]['main_id']) ) { $m4is_wmzqp['memberships'][$m4is_ap3_]['main_id'] = $m4is_ap3_; } $m4is_e4l_7o = 'Memberium ' . $m4is_rhfd['name']; $m4is_f28o = sanitize_key('memberium_' . $m4is_rhfd['name']); $m4is_hqmdn = get_role($m4is_f28o); if (! $m4is_hqmdn) { $m4is_hqmdn = add_role($m4is_f28o, $m4is_e4l_7o); } $m4is_hqmdn->add_cap('read'); } }  if (is_array($m4is_wmzqp['memberships']) ) { foreach ($m4is_wmzqp['memberships'] as $m4is_ap3_ => $m4is_t3f61c) { $m4is_t3f61c['main_id'] = isset($m4is_t3f61c['main_id']) ? $m4is_t3f61c['main_id'] : $m4is_ap3_; $m4is_t3f61c['cancel_id'] = isset($m4is_t3f61c['cancel_id']) ? $m4is_t3f61c['cancel_id'] : 0; $m4is_t3f61c['level'] = isset($m4is_t3f61c['level']) ? $m4is_t3f61c['level'] : 0; $m4is_t3f61c['login_page'] = isset($m4is_t3f61c['login_page']) ? $m4is_t3f61c['login_page'] : 0; $m4is_t3f61c['first_login_page'] = isset($m4is_t3f61c['first_login_page']) ? $m4is_t3f61c['first_login_page'] : 0; $m4is_t3f61c['logout_page'] = isset($m4is_t3f61c['logout_page']) ? $m4is_t3f61c['logout_page'] : 0; $m4is_t3f61c['payf_id'] = isset($m4is_t3f61c['payf_id']) ? $m4is_t3f61c['payf_id'] : 0; $m4is_t3f61c['roles'] = is_array($m4is_t3f61c['roles']) ? $m4is_t3f61c['roles'] : []; $m4is_t3f61c['suspend_id'] = isset($m4is_t3f61c['suspend_id']) ? $m4is_t3f61c['suspend_id'] : 0; $m4is_t3f61c['theme'] = isset($m4is_t3f61c['theme']) ? $m4is_t3f61c['theme'] : ''; $m4is_t3f61c['login_redirect_priority'] = isset($m4is_t3f61c['login_redirect_priority']) ? $m4is_t3f61c['login_redirect_priority'] : $m4is_t3f61c['level']; $m4is_t3f61c['payf_homepage'] = isset($m4is_t3f61c['payf_homepage']) ? $m4is_t3f61c['payf_homepage'] : 0; $m4is_t3f61c['susp_homepage'] = isset($m4is_t3f61c['susp_homepage']) ? $m4is_t3f61c['susp_homepage'] : 0; $m4is_t3f61c['canc_homepage'] = isset($m4is_t3f61c['canc_homepage']) ? $m4is_t3f61c['canc_homepage'] : 0; $m4is_t3f61c['dynamic_menus'] = isset($m4is_t3f61c['dynamic_menus']) ? $m4is_t3f61c['dynamic_menus'] : 0; $m4is_wmzqp['memberships'][$m4is_ap3_] = $m4is_t3f61c; } } return $m4is_wmzqp; } static private 
function m4is_j1nvc($m4is_r_2vlj) { if (is_dir($m4is_r_2vlj) ) { $m4is_npwiyu = glob($m4is_r_2vlj . '*', GLOB_MARK); foreach ($m4is_npwiyu as $m4is_qfup8) { self::m4is_j1nvc($m4is_qfup8); } rmdir($m4is_r_2vlj); } elseif (is_file($m4is_r_2vlj) ) { unlink($m4is_r_2vlj); } } static private 
function m4is_xt2185() { global $wpdb; require_once ABSPATH . 'wp-admin/includes/upgrade.php'; $m4is_rzqr = []; $m4is_eikg = method_exists( $wpdb, 'get_charset_collate' ) ? $wpdb->get_charset_collate() : '';  $m4is_po4p = [ 'memberium_tables', ]; foreach( $m4is_po4p as $m4is_u13x ) { $m4is_ioxk = " DROP TABLE IF EXISTS `{$m4is_u13x}` "; $wpdb->query( $m4is_ioxk ); } $m4is_w6mt = MEMBERIUM_DB_APP; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "appname varchar(32) NOT NULL, \n" . "UNIQUE KEY appname (appname), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_ACTIONSETS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "name varchar(64) NOT NULL, \n" . "KEY appname (appname), \n" . "KEY id (id), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_AFFILIATES; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "fieldname varchar(64) NOT NULL DEFAULT '', \n" . "value longtext, \n" . "KEY id (id), \n" . "KEY fieldname (fieldname), \n" . "KEY appname (appname), \n" . "KEY value (value(64) ), \n" . "PRIMARY KEY  (id,appname,fieldname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_AFFILIATES_TOTALS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, \n" . "amount_earned double NOT NULL DEFAULT 0, \n" . "payments double NOT NULL DEFAULT 0, \n" . "clawbacks double NOT NULL DEFAULT 0, \n" . "running_balance double NOT NULL DEFAULT 0, \n" . "KEY id (id), \n" . "KEY appname (appname), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_CONTACTGROUPCATEGORIES; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "name varchar(64) NOT NULL, \n" . "KEY id (id), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_CONTACTS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "fieldname varchar(64) NOT NULL DEFAULT '', \n" . "value longtext, \n" . "KEY id (id), \n" . "KEY fieldname (fieldname), \n" . "KEY appname (appname), \n" . "KEY value (value(64) ), \n" . "PRIMARY KEY  (appname,id,fieldname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_CONTACTTAGS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL AUTO_INCREMENT, \n" . "appname varchar(32) NOT NULL, \n" . "contactid int(20) NOT NULL, \n" . "tagid int(20) NOT NULL, \n" . "created timestamp, \n" . "KEY id (id), \n" . "KEY appname (appname), \n" . "KEY contactid (contactid), \n" . "KEY tagid (tagid), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_HTTPPOST; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, \n" . "appname varchar(16) NOT NULL, \n" . "contactid int(11) NOT NULL, \n" . "ipaddress varchar(20) NOT NULL, \n" . "type varchar(16) NOT NULL, \n" . "log longtext NOT NULL, \n" . "KEY appname (appname), \n" . "KEY contactid (contactid), \n" . "KEY type (type), \n" . "KEY ipaddress (ipaddress), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_INVOICES; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL, \n" . "appname varchar(32), \n" . "affiliateid int(11) NOT NULL, \n" . "contactid int(11) NOT NULL, \n" . "creditstatus int(11) NOT NULL, \n" . "datecreated datetime NOT NULL, \n" . "description varchar(255) NOT NULL, \n" . "invoicetotal double NOT NULL, \n" . "invoicetype varchar(32) NOT NULL, \n" . "jobid int(11) NOT NULL, \n" . "lastupdated datetime NOT NULL, \n" . "leadaffiliateid int(11) NOT NULL, \n" . "payplanstatus int(11) NOT NULL, \n" . "paystatus int(11) NOT NULL, \n" . "productsold varchar(255) NOT NULL, \n" . "promocode varchar(32) NOT NULL, \n" . "refundstatus int(11) NOT NULL, \n" . "totaldue double NOT NULL, \n" . "totalpaid double NOT NULL, \n" . "KEY job_id (jobid), \n" . "KEY contactid (contactid), \n" . "KEY affiliateid (affiliateid), \n" . "KEY datecreated (datecreated), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_LANG; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "language varchar(10) NOT NULL, \n" . "context varchar(160) NOT NULL, \n" . "name varchar(40) NOT NULL, \n" . "origtext text NOT NULL, \n" . "value text NOT NULL, \n" . "KEY language (language), \n" . "KEY context (context), \n" . "KEY name (name), \n" . "KEY origtext (origtext(255) ), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_LOGINLOG; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "appname varchar(32) NOT NULL, \n" . "logintime int(11) NOT NULL, \n" . "ipaddress varchar(20) NOT NULL, \n" . "username varchar(64) NOT NULL, \n" . "KEY logintime (logintime), \n" . "KEY username (username), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4is_eikg} AUTO_INCREMENT=1;"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_PAGETRACKING; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "starttime timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, \n" . "endtime timestamp, \n" . "session varchar(64) NOT NULL, \n" . "userid int(11) NOT NULL, \n" . "pageid int(11) NOT NULL, \n" . "ipaddress varchar(20) NOT NULL, \n" . "KEY starttime (starttime), \n" . "KEY pageid (pageid), \n" . "KEY session (session), \n" . "KEY userid (userid), \n" . "KEY ipaddress (ipaddress), \n" . "PRIMARY KEY  (id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_PRODUCTS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "fieldname varchar(64) NOT NULL default '', \n" . "value longtext, \n" . "KEY id (id), \n" . "PRIMARY KEY  (id,appname,fieldname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_QUEUE; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(11) NOT NULL AUTO_INCREMENT, \n" . "pidlock int(11) NOT NULL default 0, \n" . "appname varchar(16) NOT NULL, \n" . "actiontype varchar(20) NOT NULL, \n" . "scheduled timestamp NOT NULL, \n" . "contactid int(11) NOT NULL default 0, \n" . "userid int(11) NOT NULL default 0, \n" . "data text NOT NULL, \n" . "KEY scheduled (scheduled), \n" . "KEY actiontype (actiontype), \n" . "KEY contactid (contactid), \n" . "KEY userid (userid), \n" . "PRIMARY KEY  (id,appname) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = m4is_q6lca::m4is_otlz(); $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "session_key varchar(32) NOT NULL default '', \n" . "email_key varchar(32) NOT NULL default '', \n" . "expiration int(10) unsigned NOT NULL default '0', \n" . "value text NOT NULL, \n" . "KEY email_key (email_key), \n" . "PRIMARY KEY  (session_key) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_TAGS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "name varchar(255) default NULL, \n" . "category int(20) default NULL, \n" . "KEY id (id), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_WORDS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(10) unsigned NOT NULL AUTO_INCREMENT, \n" . "word varchar(10) NOT NULL, \n" . "PRIMARY KEY (id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; $m4is_n_bp6[] = dbDelta( $m4is_ioxk ); $m4is_rzqr[] = $m4is_w6mt; $m4is_w6mt = MEMBERIUM_DB_SOCIAL; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (\n" . "id int(20) NOT NULL, \n" . "appname varchar(32) NOT NULL, \n" . "contactid int(20) NOT NULL, \n" . "accountname varchar(64) default '', \n" . "accounttype varchar(20) default '', \n" . "KEY id (id), \n" . "KEY contactid (contactid), \n" . "KEY accounttype (accounttype), \n" . "PRIMARY KEY  (appname,id) \n" . ") ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_rzqr[] = $m4is_w6mt; if ( class_exists('i2sdk_class') ) { $m4is_w6mt = i2sdk_class::DB_API_LOG; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (
				id int(20) NOT NULL AUTO_INCREMENT,
				appname varchar(32) NOT NULL,
				timestamp timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
				duration float NOT NULL DEFAULT '0',
				retries int(11) NOT NULL DEFAULT '0',
				ip_address varchar(15) DEFAULT NULL,
				user varchar(32) DEFAULT NULL,
				service varchar(32) DEFAULT NULL,
				caller longtext,
				result longtext,
				PRIMARY KEY  (id)
			) ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); $m4is_w6mt = i2sdk_class::DB_DATAFORMFIELDS; $m4is_ioxk = "CREATE TABLE {$m4is_w6mt} (
				id int(11) NOT NULL,
				appname varchar(32) NOT NULL,
				name varchar(64) NOT NULL,
				label varchar(64) NOT NULL,
				datatype smallint(6) NOT NULL,
				formid smallint(6) NOT NULL,
				PRIMARY KEY  (id,appname)
				) ENGINE=InnoDB {$m4is_eikg};"; dbDelta($m4is_ioxk); } update_option('memberium_tables', $m4is_rzqr, false); } static private 
function m4is_wrnt67() { global $wpdb; $m4is_ioxk = "SELECT SUBSTRING(`option_name`, 12) as `transient` FROM `{$wpdb->options}` WHERE `option_name` like '%_transient_memberium%';"; $m4is_jpzyit = $wpdb->get_col($m4is_ioxk); foreach($m4is_jpzyit as $m4is_wo7c93) { delete_transient($m4is_wo7c93); } } static private 
function m4is_nk657p() { global $wpdb; $m4is_ioxk = 'DELETE FROM `' . $wpdb->options . '` WHERE `option_name` LIKE "%telemetry%" '; $wpdb->query($m4is_ioxk); } static private 
function m4is_uzdo() { } static private 
function m4is_ov5j() { $m4is_hqmdn = get_role('administrator'); if ($m4is_hqmdn) { $m4is_hqmdn->add_cap('memberium_view_user_info'); $m4is_hqmdn->add_cap('memberium_edit_user_info'); $m4is_hqmdn->add_cap('memberium_view_private_comments'); } } static private 
function m4is_sl0w( $m4is_aa5b = 8 ) { if ( function_exists( 'wp_generate_password' ) ) { return wp_generate_password( $m4is_aa5b, false, false ); } else { return substr( md5( wp_salt( 'auth' ) . wp_salt( 'logged_in' ) . wp_salt( 'secure_auth' ) . microtime() . mt_rand( 0, 999999999 ) ), 0, $m4is_aa5b ); } } private static 
function m4is_nzum() { global $wpdb; $m4is_u13x = MEMBERIUM_DB_WORDS; $m4is_ioxk = "SELECT count(*) FROM `{$m4is_u13x}` WHERE 1 = 1;"; $m4is_ejfox = (int) $wpdb->get_var($m4is_ioxk); if ($m4is_ejfox !== 7776) {  $m4is__mto = 'https://memberium.s3.amazonaws.com/downloads/eff_large_wordlist.txt'; $m4is_zv59 = wp_remote_get($m4is__mto); if (! is_a($m4is_zv59, 'WP_Error')) { $m4is_tpn1 = 0; $m4is_vs5ci = array_filter( explode( "\n", wp_remote_retrieve_body($m4is_zv59) ) ); $m4is_vs5ci = array_map( function( string $m4is_rhfd ) { return trim( substr( $m4is_rhfd, 6, 9 ) ); }, $m4is_vs5ci ); if ( ! empty( $m4is_vs5ci ) ) { foreach($m4is_vs5ci as $m4is_glzun) { $wpdb->insert($m4is_u13x, ['word' => $m4is_glzun]); } } } } $m4is_tpn1 = $wpdb->get_var("SELECT max(`id`) FROM `{$m4is_u13x}` WHERE 1"); update_option( 'memberium/database/words', $m4is_tpn1 ); } }
