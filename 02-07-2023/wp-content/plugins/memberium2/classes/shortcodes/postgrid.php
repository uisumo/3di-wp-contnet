<?php
/**
 * Copyright (c) 2017-2022 David J Bullock
 * Web Power and Light, LLC
 * https://webpowerandlight.com
 * support@webpowerandlight.com
 *
 */

 class_exists('m4is_emz57o') || die(); final 
class m4is_lc2d5w {    private static 
function m4is_aeal6() { return apply_filters('memberium/lms/course_type', 'page'); } private static 
function m4is_jh60k() { return apply_filters('memberium/lms/course_category', 'category'); } private static 
function m4is_pdmwb() { return apply_filters('memberium/lms/course_tag', 'post_tag'); }    static 
function m4is_lyold5($m4is_qvehs = [], $m4is_amunwi = '', $m4is_rz70ok = '') { self::$m4is_q47a = ++self::$m4is_q47a; $m4is_ig_w = self::m4is_aeal6(); $m4is_l2z7 = [ 'container_template' => 'coursegrid_container', 'grid_template' => 'coursegrid_item' ]; $m4is_p78sgz = [ 'container_template' => $m4is_l2z7['container_template'],  'css_class' => '',  'css_id' => '',  'grid_template' => $m4is_l2z7['grid_template'],  'order' => 'asc',  'sort' => 'course_order',  'post_ids' => '',  'post_type' => $m4is_ig_w,  'posts_per_page' => -1,  'categories' => '',  'tags' => '',  'taxonomy_compare' => 'AND',  'columns' => 3,  'mobile_cols' => 1,  'tablet_cols' => 2,  'widescreen_cols' => 3,  'no_breakpoints' => 0,  'progress_bar' => 1,  'no_css' => 0  ]; if (isset($m4is_qvehs[0]) && $m4is_qvehs[0] == 'showatts') { return implode(',', array_keys($m4is_p78sgz) ); } $m4is_qvehs = wp_parse_args($m4is_qvehs, $m4is_p78sgz); $m4is_dmesa = $m4is_qvehs['post_type'] = empty($m4is_qvehs['post_type']) ? $m4is_ig_w : $m4is_qvehs['post_type']; add_filter('memberium/lms/course/item/data', [__CLASS__, 'course_grid_item_data'], PHP_INT_MAX - 1, 2);  foreach ($m4is_l2z7 as $m4is_q0n_b => $m4is_lphf) { $m4is_gghkd_ = empty($m4is_qvehs[$m4is_q0n_b]) ? false : m4is_qipkj::m4is_i8pv7($m4is_qvehs[$m4is_q0n_b]);  if (! $m4is_gghkd_) { if (memberium_app()->m4is_fop0d()) { $m4is_a6g9qj = __('Error : template missing for %s', 'memberium'); return "<p>".sprintf($m4is_a6g9qj, $m4is_q0n_b )."</p>"; } return ''; } else{ if ($m4is_q0n_b === 'grid_template') { $m4is_d927p = $m4is_gghkd_; } } }  $m4is_stwjyi = [ 'post_type' => $m4is_dmesa, 'posts_per_page' => $m4is_qvehs['posts_per_page'], ];  $m4is_do7e = self::m4is_q5kws('post_ids', $m4is_qvehs); if ($m4is_do7e) { $m4is_stwjyi['post__in'] = $m4is_do7e; }  $m4is_lv24 = self::m4is_bb6e2u($m4is_qvehs); if ($m4is_lv24) { $m4is_stwjyi['tax_query'] = $m4is_lv24; }   elseif ($m4is_dmesa == 'post' || $m4is_dmesa === 'page') { if (memberium_app()->m4is_fop0d()) { $m4is_a6g9qj = __('Error : memb_coursegrid shortcode for %ss requires a category or tag filter to display.', 'memberium'); return "<p>" . sprintf($m4is_a6g9qj, $m4is_dmesa) . "</p>"; } return ''; }  $m4is_lik9gu = ! empty($m4is_qvehs['order']) ? strtolower($m4is_qvehs['order']) : 'asc'; $m4is_lik9gu = ! in_array($m4is_lik9gu, ['asc','desc']) ? 'asc' : $m4is_lik9gu; $m4is_miwh = !empty($m4is_qvehs['sort']) ? strtolower($m4is_qvehs['sort']) : 'course_order'; $m4is_nr1m = in_array($m4is_miwh, ['title', 'date']); if ($m4is_nr1m) { $m4is_stwjyi['orderby'] = $m4is_miwh; $m4is_stwjyi['order'] = $m4is_lik9gu; }  $m4is_kc1q = self::m4is_y4z6($m4is_stwjyi, $m4is_qvehs); $m4is_eb465e = $m4is_kc1q ? $m4is_kc1q->get_posts() : false; $m4is_oo43y = []; if ($m4is_eb465e) { foreach ($m4is_eb465e as $m4is__xysg) { $m4is_oo43y[] = apply_filters("memberium/lms/course/item/data", [], $m4is__xysg); }  if (! $m4is_nr1m) { if ($m4is_miwh === 'course_order') { add_filter('memberium/course/grid/sort', [__CLASS__, 'course_grid_course_order_sort'], PHP_INT_MAX - 1, 2); } $m4is_oo43y = apply_filters("memberium/course/grid/sort", $m4is_oo43y, $m4is_miwh); if (!empty($m4is_oo43y) && $m4is_lik9gu === 'desc') { $m4is_oo43y = array_reverse($m4is_oo43y); } } } $m4is_ejal = ['css_class' => '', 'css_id' => ''];  $m4is_z_0zw = 'memberium-course-grid';  foreach ($m4is_ejal as $m4is_i71yt => $m4is_mmt_) { if (!empty(esc_attr($m4is_qvehs[$m4is_i71yt]) )) { $m4is_ejal[$m4is_i71yt] = esc_attr($m4is_qvehs[$m4is_i71yt]); } } if ((int)$m4is_qvehs['no_breakpoints'] > 0) { $m4is_eoabf0 = ''; } else{ $m4is_eoabf0 = self::m4is_m8yg($m4is_qvehs, $m4is_z_0zw); } $m4is_z_0zw .= empty($m4is_ejal['css_class']) ? "" : " {$m4is_ejal['css_class']}"; $m4is_fkzsa = empty($m4is_ejal['css_id']) ? "" : " {$m4is_ejal['css_id']}"; $m4is_aiyzg = [ 'grid-number' => self::$m4is_q47a, 'grid-items' => $m4is_oo43y, 'grid-item-template' => $m4is_d927p, 'query_args' => $m4is_stwjyi, 'wrapper-id' => $m4is_fkzsa, 'wrapper-class' => $m4is_z_0zw, 'wrapper-col-styles' => $m4is_eoabf0 ];  if ( (int) $m4is_qvehs['no_css'] < 1) { wp_enqueue_style('memb_coursegrid_css'); }  return m4is_qipkj::m4is_jers4($m4is_l2z7['container_template'], $m4is_qvehs, $m4is_amunwi, $m4is_rz70ok, $m4is_aiyzg); }  static 
function m4is_y4z6($m4is_w5ky4q, $m4is_qvehs) { $m4is_p78sgz = [ 'post_type' => self::m4is_aeal6(), 'post_status' => 'publish', 'posts_per_page' => -1, 'orderby' => 'date', 'order' => 'ASC', 'fields' => 'ids' ]; $m4is_w5ky4q = wp_parse_args($m4is_w5ky4q, $m4is_p78sgz); $m4is_dmesa = $m4is_w5ky4q['post_type']; $m4is_w5ky4q = apply_filters('memberium/lms/query/args', $m4is_w5ky4q, $m4is_qvehs); if (empty($m4is_w5ky4q)) { return false; } $m4is_kc1q = new WP_Query($m4is_w5ky4q ); wp_reset_postdata(); return ($m4is_kc1q->have_posts() ) ? $m4is_kc1q : false; }  static 
function m4is_bb6e2u($m4is_rxc9n1) { $m4is_lv24 = []; $m4is_dmesa = $m4is_rxc9n1['post_type']; $m4is_s7epbf = ($m4is_dmesa === self::m4is_aeal6() );  $m4is_hmeo = self::m4is_q5kws('categories', $m4is_rxc9n1); if ($m4is_hmeo) { $m4is_lv24[] = [ 'taxonomy' => $m4is_s7epbf ? self::m4is_jh60k() : 'category', 'field' => 'term_id', 'terms' => $m4is_hmeo, 'operator' => 'IN', 'include_children' => false, ]; } $m4is_znf9 = self::m4is_q5kws('tags', $m4is_rxc9n1); if ($m4is_znf9) { $m4is_lv24[] = [ 'taxonomy' => ($m4is_s7epbf) ? self::m4is_pdmwb() : 'post_tag', 'field' => 'term_id', 'terms' => $m4is_znf9, 'operator' => 'IN' ]; } if (! empty($m4is_lv24) && count($m4is_lv24) > 1) { $m4is_eqc3 = 'AND'; if (!empty($m4is_rxc9n1['tax_compare'])) { $m4is_eqc3 = strtoupper(trim($m4is_rxc9n1['tax_compare']) ); if ($m4is_eqc3 !== 'OR' || $m4is_eqc3 !== 'AND') { $m4is_eqc3 = 'AND'; } } $m4is_lv24[] = [ 'relation' => $m4is_eqc3 ]; } return empty($m4is_lv24) ? false : $m4is_lv24; }  static 
function course_grid_item_data(array $m4is_j0n7, int $m4is_b40e_m) { $m4is_ti8od = get_post_meta($m4is_b40e_m, '_memberium/coursegrid/config', true); $m4is_ti8od = $m4is_ti8od ? $m4is_ti8od : []; $m4is_nxs4 = empty($m4is_ti8od['excerpt']) ? '' : html_entity_decode(stripslashes($m4is_ti8od['excerpt']) );  $m4is_u2q7lt = [ 'ID' => $m4is_b40e_m, 'title' => get_the_title($m4is_b40e_m), 'excerpt' => $m4is_nxs4, 'url' => get_the_permalink($m4is_b40e_m), 'status' => 'unlocked', 'progress' => 0, 'access' => 1, 'order' => empty($m4is_ti8od['order']) ? 0 : (int)$m4is_ti8od['order'] ]; $m4is_j0n7 = wp_parse_args($m4is_j0n7, $m4is_u2q7lt); $m4is_j0n7['thumbnails'] = self::m4is_mxhcie($m4is_b40e_m, $m4is_j0n7, $m4is_ti8od);  if (! (int)$m4is_j0n7['access'] > 0) { $m4is_j0n7['status_text'] = _x('Not Enrolled', 'course_grid_status', 'memberium'); $m4is_j0n7['progress_text'] = _x('Locked', 'course_grid_progress', 'memberium'); $m4is_j0n7['button_text'] = _x('Locked', 'course_grid_button', 'memberium'); $m4is_j0n7['thumbnail'] = $m4is_j0n7['thumbnails']['locked']; $m4is_j0n7['url'] = !empty($m4is_ti8od['locked_url']) ? $m4is_ti8od['locked_url'] : ''; } else{ $m4is_zd_f = (int)$m4is_j0n7['progress']; $m4is_j0n7['thumbnail'] = $m4is_j0n7['thumbnails']['unlocked']; $m4is_j0n7['status_text'] = _x('Enrolled', 'course_grid_status', 'memberium');  if ($m4is_zd_f > 0 && $m4is_zd_f < 100) { $m4is_j0n7['progress_text'] = sprintf(_x('%d%% Completed', 'course_grid_progress', 'memberium') , $m4is_zd_f); $m4is_j0n7['button_text'] = _x("Continue", 'course_grid_button', 'memberium'); }  else if ($m4is_zd_f >= 100) { $m4is_j0n7['status'] = 'completed'; $m4is_j0n7['status_text'] = _x('Completed', 'course_grid_status', 'memberium'); $m4is_j0n7['progress_text'] = _x('Completed', 'course_grid_progress', 'memberium'); $m4is_j0n7['button_text'] = _x('Completed', 'course_grid_button', 'memberium'); }  else{ if( $m4is_j0n7['status'] === 'not_enrolled' ){ $m4is_j0n7['status'] = 'unlocked'; $m4is_j0n7['status_text'] = _x('Not Enrolled', 'course_grid_status', 'memberium'); } $m4is_j0n7['progress_text'] = _x('Not Started', 'course_grid_progress', 'memberium'); $m4is_j0n7['button_text'] = _x('Start', 'course_grid_button', 'memberium'); } } return $m4is_j0n7; } static 
function m4is_mxhcie($m4is_b40e_m, $m4is_j0n7, $m4is_ti8od) { $m4is_zfgztr = get_post_thumbnail_id($m4is_b40e_m); $m4is_fhe946 = get_the_post_thumbnail_url($m4is_b40e_m, 'medium'); $m4is_ab48 = []; $m4is_rr90 = [ 'unlocked', 'locked' ]; if (empty($m4is_fhe946)) { $m4is_fhe946 = plugin_dir_url(MEMBERIUM_HOME) . "css/memberium-default-course.svg"; } foreach ($m4is_rr90 as $m4is_waxrhu) { $m4is_tofpz = !empty($m4is_ti8od[$m4is_waxrhu]) ? $m4is_ti8od[$m4is_waxrhu] : []; $m4is_afkz64 = !empty($m4is_tofpz['url']) ? esc_url($m4is_tofpz['url']) : ''; $m4is_pb3qa = !empty($m4is_tofpz['id']) ? (int)$m4is_tofpz['id'] : 0; $m4is_b925 = !empty($m4is_pb3qa) ? wp_get_attachment_image_srcset($m4is_pb3qa) : ''; if (empty($m4is_afkz64)) { $m4is_afkz64 = $m4is_fhe946; $m4is_pb3qa = $m4is_zfgztr; $m4is_b925 = $m4is_fhe946; }  $m4is_ab48[$m4is_waxrhu] = [ 'src' => $m4is_afkz64, 'id' => $m4is_pb3qa, 'srcset' => $m4is_b925 ]; } return $m4is_ab48; } static 
function m4is_m8yg($m4is_rxc9n1, $m4is_z_0zw) { $m4is_eoabf0 = "<style>"; $m4is_cdbto = [ 'mobile_cols' => [ 'col' => 1 ], 'tablet_cols' => [ 'col' => 2, 'break' => 768 ], 'columns' => [ 'col' => 3, 'break' => 992 ], 'widescreen_cols' => [ 'col' => 3, 'break' => 1312 ] ];      foreach ($m4is_cdbto as $m4is_cdbto => $m4is_p78sgz) { $m4is_o49lqo = (int)esc_attr($m4is_rxc9n1[$m4is_cdbto]); $m4is_o49lqo = empty($m4is_o49lqo) ? $m4is_p78sgz['col'] : $m4is_o49lqo;  if ($m4is_cdbto != 'mobile_cols') { $m4is_v8k_0 = (int)esc_attr(apply_filters("memberium/lms/breakpoint/pixel/{$m4is_cdbto}", $m4is_p78sgz['break']) ); $m4is_v8k_0 = empty($m4is_v8k_0) ? $m4is_p78sgz['break'] : $m4is_v8k_0; $m4is_eoabf0 .= "@media (min-width: {$m4is_v8k_0}px) {"; }  $m4is_eoabf0 .= ".{$m4is_z_0zw} {"; if ($m4is_cdbto === 'mobile_cols') { $m4is_eoabf0 .= "margin:0 auto;display:grid;grid-gap:2em;"; } $m4is_eoabf0 .= "grid-template-columns: repeat({$m4is_o49lqo}, 1fr);"; $m4is_eoabf0 .= "}";  $m4is_eoabf0 .= ($m4is_cdbto != 'mobile_cols' ) ? "}" : "";  } $m4is_eoabf0 .= "</style>"; return $m4is_eoabf0; }  static 
function m4is_q5kws($m4is_ap3_, $m4is_rxc9n1) { if (is_array($m4is_rxc9n1) && is_string($m4is_ap3_) && !empty($m4is_rxc9n1[$m4is_ap3_])) { $m4is_ev3c = $m4is_rxc9n1[$m4is_ap3_]; $m4is_tihq2k = array_unique(explode(',', trim($m4is_ev3c, ',') )); $m4is_tihq2k = array_values(array_filter($m4is_tihq2k, 'is_numeric' ) ); return (!empty($m4is_tihq2k) ) ? $m4is_tihq2k : false; } return false; }  static 
function course_grid_course_order_sort($m4is_oo43y, $m4is_miwh) { if ($m4is_miwh !== 'course_order' || empty($m4is_oo43y)) { return $m4is_oo43y; } $m4is_xm0s_ = [ 'unlocked' => 1, 'completed' => 2, 'locked' => 3 ]; usort($m4is_oo43y, function ($m4is_rq0hia, $m4is_gyuf1_) use($m4is_xm0s_) {  if ($m4is_rq0hia['order'] === $m4is_gyuf1_['order']) {  if ($m4is_rq0hia['status'] === $m4is_gyuf1_['status']) {  if ($m4is_rq0hia['status'] === 'unlocked') { return $m4is_rq0hia['progress'] < $m4is_gyuf1_['progress'] ? 1 : -1; } else{ return 1; } }  else { return $m4is_xm0s_[$m4is_rq0hia['status']] > $m4is_xm0s_[$m4is_gyuf1_['status']] ? 1 : -1; } }  return $m4is_rq0hia['order'] > $m4is_gyuf1_['order'] ? 1 : -1; }); return $m4is_oo43y; } static $m4is_q47a = 0; private 
function __construct() { } }
