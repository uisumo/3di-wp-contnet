!function(l){var i,n=window.GetDiscount;window.GetDiscount=function(){for(var t=arguments.callee.caller;"PopulateDiscountInfo"!==t.name&&"function"==typeof t.caller;)t=t.caller;"PopulateDiscountInfo"===t.name&&(i=t.arguments[1]);var r=n.apply(this,arguments);return i=void 0,r};var r=window.gformGetPrice;function o(t,r,n,o){var e,a=null==(e=o)||"number"==typeof e||"boolean"==typeof e?o:n(o),i=r.get(a);return void 0===i&&(i=t.call(this,o),r.set(a,i)),i}function e(t,r,n){var o=Array.prototype.slice.call(arguments,3),e=n(o),a=r.get(e);return void 0===a&&(a=t.apply(this,o),r.set(e,a)),a}function a(t,r,n,o,e){return n.bind(r,t,o,e)}function t(t,r){return a(t,this,1===t.length?o:e,r.cache.create(),r.serializer)}function u(){return JSON.stringify(arguments)}function c(){this.cache=Object.create(null)}window.gformGetPrice=function(t){return"string"!=typeof t?0:r(t)},c.prototype.has=function(t){return t in this.cache},c.prototype.get=function(t){return this.cache[t]},c.prototype.set=function(t,r){this.cache[t]=r};var d={create:function(){return new c}};function f(t){t=function(t,r){for(key in r)r.hasOwnProperty(key)&&void 0===t[key]&&(t[key]=r[key]);return t}(t,{intent:"",total:0,formId:null,amount:null,amountType:null,products:null,productsType:null,includeShipping:!0,includeDiscounts:!1,calculateByProduct:!1});var r,n=0,o=l.isArray(t.products)&&0<t.products.length?_(t.formId,t.products,t.includeDiscounts):0;switch(t.amount||(t.amount=0),t.includeShipping||(t.total-=(r=t.formId,gformGetShippingPrice(r))),t.productsType){case"include":t.total=o;break;case"exclude":t.total-=o}switch(t.amountType){case null:n=t.total;break;case"percent":n=t.total*(t.amount/100);break;default:var e=t.amount;if(t.calculateByProduct){var a=v(t.formId);e*=100*t.total/a/100}n=e}return n=Math.max(0,parseFloat(n))}l(document).on("gform_pre_conditional_logic",function(t,r){I(r)}),gform.addFilter("gform_calculation_formula",function(t,r,n,o){if(!P(t))return t;var e=l("#field_{0}_{1}".format(n,r.field_id)).hasClass("gfield_price");if(e&&(!window._gformPriceFields||!window._gformPriceFields.length))return t=(t=(t=t.replace(/{coupons}/gi,0)).replace(/{discounts}/gi,0)).replace(/{subtotal}/gi,0);var a=""!=(gformIsHidden(l("#gf_coupon_code_"+n))?"":l("#gf_coupon_codes_"+n).val())||""!=l("#gf_coupons_"+n).val(),i=l("#gf_total_no_discount_"+n).val(),u=0,c=-1*y(n,v(n));return void 0!==i&&a&&window.PopulateDiscountInfo&&(u=PopulateDiscountInfo(i,n)),t=(t=(t=t.replace(/{coupons}/gi,parseFloat(u))).replace(/{discounts}/gi,parseFloat(c+u))).replace(/{subtotal}/gi,parseFloat(v(n,e?[r.field_id]:null)))}),gform.addFilter("gform_coupons_discount_amount",function(t,r,n,o,e){if(!i)return t;var a=gformGetShippingPrice(i);o=Math.max(0,o-a);return"percentage"==r?t=o*Number(n/100):"flat"==r&&o<(t=Number(n))&&0!=o&&(t=o),t}),gform.addFilter("gform_product_total",function(n,o){return l("#gform_wrapper_"+o+" .ginput_subtotal_input").each(function(){var t=l(this).val();if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;var r=f({intent:"Calculating subtotal for Subtotal field {0}".format(l(this).attr("id")),total:n,formId:o,amount:null,amountType:null,productsType:l(this).data("productstype"),products:l(this).data("products"),includeShipping:!1});String(t)!=String(r)&&l(this).val(r).change()}),n},48),gform.addFilter("gform_product_total",function(t,r){return t+=y(r,t),Math.max(0,t)},49),"true"===window.GPECF.ppcpRequiresDiscountFilter&&gform.addFilter("gform_ppcp_discount_total",function(t,r){return t+-1*y(r,v(r))}),gform.addFilter("gform_product_total",function(n,o){var t=l("#gform_wrapper_"+o+" .ginput_tax_input"),e=0;return t.each(function(){var t,r=l(this).val();if(gformIsHidden(l(this)))return 0!==r&&"0"!==r&&l(this).val(0).change(),!0;t=0==n&&"exclude"===l(this).data("productstype")?0:f({intent:"Calculating tax for Tax field {0}".format(l(this).attr("id")),total:n,formId:o,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:l(this).data("products"),productsType:l(this).data("productstype"),includeDiscounts:!0}),String(r)!==String(t)&&l(this).val(t).change(),e+=F(t,2)}),F(n+=e,2)},51),gform.addFilter("gform_product_total",function(t,r){var n=l("#gf_coupon_codes_{0}".format(r));return n.data("gpecfChanged")&&(n.data("gpecfChanged",!1),l(document).trigger("gform_post_conditional_logic")),t}),l(document).on("gform_post_render",function(t,r){var i;!function(){if(window.gform){var t=window.gform.hooks.filter.gform_product_total;for(var r in t)t.hasOwnProperty(r)&&-1!==t[r].callable.toString().indexOf("update_dynamic_price_ajax")&&(t[r].priority=52)}}(),l("#gf_coupon_codes_{0}".format(r)).change(function(){l(this).data("gpecfChanged",!0)}),l(document).on("gform_price_change",function(t,r,n){I(r.formId)}),gform.addAction("gpcp_after_update_pricing",function(t,r){I(r._formId)}),gform.addAction("gform_input_change",function(t,r,n){if(window!==t){var o=l(t),e=o.attr("id")&&0===o.attr("id").indexOf("ginput_base_price"),a=o.parents(".gfield").hasClass("gfield_calculation");l(t).data("gpecfIsCalculating")||e&&a&&(l(t).data("gpecfIsCalculating",!0),i&&(clearTimeout(i),i=void 0),i=setTimeout(function(){I(r),l(t).data("gpecfIsCalculating",!1)},5))}});var n=setInterval(function(){window._gformPriceFields&&window._gformPriceFields[r]&&(I(r),clearInterval(n))});l("#gform_wrapper_"+r).find(".ginput_subtotal_input, .ginput_discount_input, .ginput_tax_input").change()});var s,p,g,m,_=function(t,r,n){return window._gformPriceFields&&window._gformPriceFields[t]?h(parseInt(t),r,n,jQuery("form#gform_"+t).serializeArray()):0},h=(s=function(t,r,n,o){if(void 0===r&&window._gformPriceFields?r=_gformPriceFields[t]:l.isArray(r)||(r=[r]),!r)return 0;for(var e=0,a=0;a<r.length;a++)try{var i=gformCalculateProductPrice(t,r[a]);if(e+=i,n)e-=Math.abs(y(t,i,r[a]))+(jQuery("#gf_coupons_"+t).val()?w(t,i):0)}catch(t){console.debug("Unable to re-calculate price for product ID "+r[a]);continue}return e},g=p&&p.cache?p.cache:d,m=p&&p.serializer?p.serializer:u,(p&&p.strategy?p.strategy:t)(s,{cache:g,serializer:m}));function v(t,r){return _(t)-(void 0!==r&&r?_(t,r):0)}function y(a,i,u){var t=l("#gform_wrapper_"+a+" .ginput_discount_input"),c=0;return t.each(function(){var t=l(this).val(),r=l(this).data("products"),n=l(this).data("productstype");if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;if(u&&r){if("include"==n&&(-1===l.inArray(u,r)||0===parseInt(i)))return!0;if("exclude"==n&&(-1!==l.inArray(u,r)||0===parseInt(i)))return!0}var o=u&&0<u,e=f({intent:"Calculating discount for Discount field {0}".format(l(this).attr("id")),total:i,formId:a,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:r,productsType:n,includeShipping:!1,calculateByProduct:o});"include"===n&&0<r.length&&(e=Math.min(_(a,r,!1),e)),e*=-1,e=gform.applyFilters("gpecf_discount_total",e,l(this)),o||String(t)===String(e)||l(this).val(e).change(),c+=e}),c}function w(t,r){var n,o,e=window["gf_coupons"+t],a=0;for(n in e)e.hasOwnProperty(n)&&(o=e[n],a+=GetDiscount(o.type,o.amount,r,a));return a}var I=function(t){var r=rgars(window,"gf_global/gfcalc/{0}".format(t));if(r){for(var n=[],o=0;o<r.formulaFields.length;o++){var e=r.formulaFields[o];P(e.formula)&&n.push(e)}n.length&&r.runCalcs(t,n)}};function P(t){var r=-1!=t.search("{coupons}"),n=-1!=t.search("{discounts}"),o=-1!=t.search("{subtotal}");return r||n||o}function F(t,r){return Number(Math.round(t+"e"+r)+"e-"+r)}}(jQuery);
//# sourceMappingURL=gp-ecommerce-fields.js.map