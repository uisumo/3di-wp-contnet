<?php  if(!defined('ABSPATH')){exit;}class IW_RemoveCartItem_Action extends IW_Automation_Action{function get_title(){return "Remove products from cart";}function allowed_triggers(){return array('IW_PageVisit_Trigger','IW_AddToCart_Trigger','IW_UserAction_Trigger','IW_Checkout_Trigger');}function display_html($config=array()){$type=isset($config['type'])?$config['type']:'';$categ=isset($config['categ'])?$config['categ']:array();$pts=isset($config['prodtype'])?$config['prodtype']:array();$smart_apply=isset($config['smart_apply'])?$config['smart_apply']:'on';$html='<hr>Products to Remove:<br><select name="type" class="full-select wptype-sel browser-default" style="margin-top: 10px; width: 100%" autocomplete="off">
			<option value="all"'.($type =='specific'?' selected':'').'>all products</option>
			<option value="specific"'.($type =='specific'?' selected':'').'>specific product / variation...</option>
			<option value="category"'.($type =='category'?' selected':'').'>from certain product category...</option>
			<option value="wptype"'.($type =='wptype'?' selected':'').'>from certain product type...</option>
			</select>';$html .='<div class="iwar-minisection minisection-wooproducts" style="'.($type =='specific'?'':'display:none;').'">';$html .='<input type="text" name="wooproducts" class="iwar-dynasearch" data-src="wooproducts" placeholder="Start typing to add products..." style="width: 100% !important; margin: 5px 0;" />';$html .='<div class="wooproducts-contain dynasearch-contain">';if(isset($config['wooproducts-val'])&&is_array($config['wooproducts-val'])){foreach($config['wooproducts-val']as $k =>$val){$wc_prod=wc_get_product($val);$test_var=$wc_prod->is_type('variation');if(!empty($wc_prod->post->post_parent))$link_id=$wc_prod->post->post_parent;else $link_id=$val;$label=isset($config['wooproducts-label'][$k])?$config['wooproducts-label'][$k]:'Product ID # '.$val;$html .='<span class="wooproducts-item">';$html .='<a href="'.get_edit_post_link($link_id).'" target="_blank">'.$label."</a>";$html .='<input type="hidden" name="wooproducts-label[]" value="'.$label.'" />';$html .='<input type="hidden" name="wooproducts-val[]" value="'.$val.'" />';$html .='<i class="fa fa-times-circle"></i>';$html .='</span>';}}$html .='</div></div>';$html .='<div class="iwar-minisection minisection-categ" style="'.($type =='category'?'':'display:none;').'">';$html .='<br><select class="browser-default" multiple name="categ[]" style="min-width: 280px;">';$args=array('taxonomy' =>'product_cat','orderby' =>'name','show_count' =>0,'pad_counts' =>0,'hierarchical' =>1,'title_li' =>0,'hide_empty' =>0);$all_categories=get_categories($args);foreach($all_categories as $cat){if($cat->category_parent ==0){$category_id=$cat->term_id;$html .='<option value="';$html .=$category_id;$html .='"'.(in_array($category_id,$categ)?' selected':'').'>'.$cat->name." [ {$category_id} ]";$html .="</option>";}}$html .='</select>';$html .='</div>';$html .='<div class="iwar-minisection minisection-type" style="'.($type =='wptype'?'':'display:none;').'">';$html .='<br><select class="browser-default" multiple name="prodtype[]" style="min-width: 280px;">';$prodtypes=wc_get_product_types();foreach($prodtypes as $k =>$type){$html .='<option value="';$html .=$k;$html .='"'.(in_array($k,$pts)?' selected':'').'>'.$type;$html .="</option>";}$html .='</select>';$html .='</div>';return $html;}function validate_entry($config){}function process($config,$trigger){$cart=&WC()->cart;$contents=$cart->get_cart();foreach($contents as $cartkey =>$content){$product=$content['data'];$product_id=$product->get_id();$variation_id=0;if($config['type']=='all')$cart->remove_cart_item($cartkey);else if($config['type']=='specific'){if(in_array($product_id,$config['wooproducts-val'])||in_array($variation_id,$config['wooproducts-val'])){$cart->remove_cart_item($cartkey);}}else if($config['type']=='category'){$cats=get_the_terms($product_id,'product_cat');if(is_array($cats)){foreach($cats as $cat){if(in_array($cat->term_id,$config['categ'])){$cart->remove_cart_item($cartkey);}}}}else{$wc_product=wc_get_product($product_id);$prodtype=$wc_product->get_type();if(in_array($prodtype,$config['prodtype'])){$cart->remove_cart_item($cartkey);}}}}}iw_add_action_class('IW_RemoveCartItem_Action');