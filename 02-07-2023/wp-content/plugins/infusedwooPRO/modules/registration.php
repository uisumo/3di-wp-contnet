<?php  if(!defined('ABSPATH')){exit;}add_action('user_register','ia_new_user_reg',10,1);function ia_new_user_reg($user_id){global $iwpro;if($iwpro->regtoifs =='yes'){$iwpro->ia_app_connect();$ia_user_info=array();$user_info=get_userdata($user_id);if(!empty($user_info->user_email))$user_email=$user_info->user_email;else if(isset($_POST['user_email']))$user_email=$_POST['user_email'];else if(isset($_POST['email']))$user_email=$_POST['email'];else if(isset($_POST['Email']))$user_email=$_POST['Email'];else if(isset($_POST['email2']))$user_email=$_POST['Email'];else if(isset($_POST['billing_email']))$user_email=$_POST['billing_email'];if(strpos($user_email,'@')===false ||strpos($user_email,'.')===false)return;if(!empty($user_email))$ia_user_info['Email']=$user_email;if(!empty($user_info->first_name))$user_fname=$user_info->first_name;else if(isset($_POST['first_name']))$user_fname=$_POST['first_name'];else if(isset($_POST['firstname']))$user_fname=$_POST['firstname'];else if(isset($_POST['FirstName']))$user_fname=$_POST['FirstName'];else if(isset($_POST['Firstname']))$user_fname=$_POST['Firstname'];else if(isset($_POST['billing_first_name']))$user_fname=$_POST['billing_first_name'];if(!empty($user_fname))$ia_user_info['FirstName']=$user_fname;if(!empty($user_info->last_name))$user_lname=$user_info->last_name;else if(isset($_POST['last_name']))$user_lname=$_POST['last_name'];else if(isset($_POST['lastname']))$user_lname=$_POST['lastname'];else if(isset($_POST['LastName']))$user_lname=$_POST['LastName'];else if(isset($_POST['Lastname']))$user_lname=$_POST['Lastname'];else if(isset($_POST['billing_last_name']))$user_lname=$_POST['billing_last_name'];if(!empty($user_lname))$ia_user_info['LastName']=$user_lname;if(isset(WC()->session)){$get_leadsource=WC()->session->get('iw_leadsource');if(!empty($get_leadsource)){$ia_user_info['Leadsource']=WC()->session->get('iw_leadsource');}}$user_pass=$user_info->user_pass;$username=$user_info->user_login;$contact=$iwpro->app->dsFind('Contact',5,0,'Email',$user_email,array('Id'));$ia_user_info=apply_filters('iw_reg_contactvals',$ia_user_info,$user_email);if(isset($contact[0]['Id'])){if(!empty($ia_user_info)){$contactId=(int) $contact[0]['Id'];$contactinfo=apply_filters('iw_before_updatecontact',$ia_user_info,$contactId);$contactId=$iwpro->app->updateCon($contactId,$ia_user_info);}$iwpro->app->optIn($user_email,"API: User registered to Shop");}else{$contactinfo=apply_filters('iw_before_addcontact',$ia_user_info);$contactId=$iwpro->app->addCon($ia_user_info);$iwpro->app->optIn($user_email,"API: User registered to Shop");}$is_aff=isset($_COOKIE['is_aff'])?(int) $_COOKIE['is_aff']:"";if(empty($is_aff)){$is_aff=(WC()->session)?WC()->session->get('iw_is_aff'):"";}$is_aff=apply_filters('iw_set_leadaffiliateid',$is_aff);if(empty($is_aff)){$is_affcode=isset($_COOKIE['is_affcode'])?(int) $_COOKIE['is_affcode']:"";if(empty($is_affcode))$is_affcode=(WC()->session)?WC()->session->get('iw_is_affcode'):"";if(!empty($is_affcode)){$returnFields=array('Id');$affiliate=$iwpro->app->dsFind('Affiliate',1,0,'AffCode',$is_affcode,$returnFields);$affiliate=$affiliate[0];$is_aff=(int) $affiliate['Id'];}}if(!empty($is_aff)){$iwpro->app->dsAdd('Referral',array('ContactId' =>$contactId,'AffiliateId' =>$is_aff,'IPAddress' =>$_SERVER['REMOTE_ADDR'],'Type' =>0,'DateSet' =>date("Y-m-d")));}$ras=(int) $iwpro->reg_as;$iwpro->app->runAS($contactId,$ras);do_action('infusedwoo_reg_process',$contactId,$user_email);$iwpro->app->achieveGoal("wooevent","register",$contactId);}} ?>